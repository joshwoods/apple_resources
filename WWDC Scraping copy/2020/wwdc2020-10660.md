# Wwdc2020 10660

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Transcript

What's new in locationLocation technologies are core to delivering context-based services within your app. Discover how the latest privacy controls in Core Location add a whole new dimension to determining position and what that means for your app. We'll walk you through best practices for implementing these latest location updates and show you how they're designed to ensure more people get an experience they're going to love.ResourcesCore LocationHD VideoSD VideoRelated VideosWWDC21Meet the Location ButtonWWDC20Build location-aware enterprise appsBuild trust through better privacyDesign for location privacyExplore App ClipsMeet Nearby InteractionMeet WidgetKit

Location technologies are core to delivering context-based services within your app. Discover how the latest privacy controls in Core Location add a whole new dimension to determining position and what that means for your app. We'll walk you through best practices for implementing these latest location updates and show you how they're designed to ensure more people get an experience they're going to love.

Core Location

HD VideoSD Video

HD Video

SD Video

Meet the Location Button

Build location-aware enterprise apps

Build trust through better privacy

Design for location privacy

Explore App Clips

Meet Nearby Interaction

Meet WidgetKit

Search this videoâ€¦Hello and welcome to WWDC.Hello there. I'm Ilya Veygman. I'm a software engineer with Core Location.Today I'll be telling you about all the cool new stuff in Core Location this year.We will be primarily covering Location Authorization. And we willalso discuss some new features from this year's release, App Clips and Widgets.Let's start with Location Authorization.I want to begin by talking about the state of the world in iOS 13.As of the most recent major release there are basically three ways a usercan control the circumstances under which an app can access their location.A user can respond to a location prompt or go to Settings and set one ofthese options. Which means that an app can get their location informationat no time. Only while it's in use, or at anytime. As user privacy is andhas been a major priority for Apple we thought: are there any other controlswe can give the user which will allow them to regulate access to theirsensitive location data? To do so we ask ourselves this question - What doesthis app really need to know about me in order to do its job? A privacyconscious user is likely to ask themselves the same question. And one waythe user will ask this is not just is this app getting my location whenI don't want it to. They will also ask whether the app needs to know exactlywhere they are as opposed to approximately where they are. There are certainclasses of apps where a user may not see the need to give their exact locationand will be satisfied with the app knowing just approximately where they are.Does this dating app for example, really need to know anything other thanmy town. Does this local events app have to know what hotel I'm staying in.Does a social media app need to know exactly where I've been. In factthey might prefer to give only minimal information and nothing more.There are certainly use cases where exact location is preferred if not necessary.For example if you want to use a navigation app to get turn by turn directionsfrom wherever you may be to your destination you would need the app toknow exactly where you are. But there are other classes of apps where sharingjust a little bit of location information makes sense for the appsexpected functionality. In the case of a dating app or a local events app for example,it's certainly possible to make hyper- targeted recommendations or matchesto a user if you have their exact location. And this is a great featurefor some, but others may not be interested in that level of detail and wouldprefer to not share location at all rather than to access that functionality.In cases like these approximate location might in fact be good enough formany users. In iOS 13 a user getting an initial prompt for location authorizationwould see something like this. Starting in iOS 14, and as you saw in thekeynote a new option will appear in the prompts for users -  Precise.This option lets the user grant an app only their approximate rather than theirexact location. This will also be visible to users under Settings. By disablingthe precise location switch, the user can choose to grant only approximatelocation to the app. As a result of this the user now has two dimensionsupon which to specify how much location access they would like to grant an app.There is the "what circumstances" of an app accessing location and thereis now also the "how much" dimension of location access. Now instead of justthe one notion of location authorization we have two. Users can do all sortsof things with authorization now. Initially grant while using with reducedaccuracy, upgrade it to the full accuracy and even do things like change theauthorization to "always" and then downgrade the accuracy to "reduced" again.Now, one thing that should be made very clear before we continue. Apps cannotopt out of this new feature. This functionality is controlled entirelyby the user. It's another form of authorization after all, and the userdecides whether they grant or revoke authorization at any time.You, the app must adapt to this new world where you just can decide not to givethe app exact location information at all times. Given that, I think it'stime to talk about the tools we're providing you to adopt this new feature.First we're deprecating the CLLocationManager class method for authorizationstatus and replacing it with a property that delivers the app's authorizationstatus just like before. We also introduced a new instance property thatindicates how accurately the app can know user location. There are twooptions for this enum, full and reduced. Full is a sort of default fromthe pre-iOS 14 world, while reduced is the new scenario. To further accommodatethese new notions of location authorization. We're further changing upthe authorization status delegate callback. We're deprecating the oldDidChangeAuthorization status callback and replacing it with a new locationManagerDidChangeAuthorizationcallback method. This new method is invoked whenevereither the authorizationStatus or accuracyAuthorization property values change.Here's how you might want to implement the new delegate callback method.You will need to check the values of both the authorization status and theaccuracy to determine how to proceed. Now, a few notes on how these aredelivered. Reduced accuracy fixes are still delivered to the didUpdateLocationsdelegate just like before. And they're still expressedas CLLocation objects with a CLLocationCoordinate2D center points anda large value for horizontal accuracy. These locations are recomputed aboutfour times per hour. So if you have some timeout logic in the applicationyou should make sure to inform it using the value of accuracyAuthorization.Finally while these are represented as CLLocation objects you should nottreat them like you would a typical location with full accuracy.Instead you should consider them to contain the user's true position. Now, let'shave a look at a case study of a top notch adoption of this new featurein maps. The Maps team have worked closely with ours to bring you whatyou can see in iOS 14. And have done an amazing job of adopting thenew Accuracy Authorization API. Please check out their talk on Designingfor Location Privacy which will cover some topics that are very relevantto what we'll discuss here. New in iOS 14 when Maps, or any app asksfor location for the first time they would see this prompt. Just likeyou saw before which will show an inset map with your location on it.Let's toggle the "Precise: On" pill to see what happens. This will show you whatthe underlying app would get if you gave it full versus reduced accuracy.This will be immediately obvious by seeing the big circle indicating theuser's approximate location in the app rather than the familiar blue dot.Let's see how this looks when you grant authorization to the app and launch it.As you'd expect, the UI will show a large circle indicating the user's approximatelocation rather than the blue dot that you're probably used to. Again thiscircle contains the user's true position and now Maps also does a reallygood thing here by placing a banner at the top of the UI which clearlyindicates to the user that they have reduced accuracy for this app.This is a good thing to consider when you're designing your own app to adoptthis feature. How to reflect this reduced accuracy and authorization backto the user. Now, looking at where we are isn't the only thing we use Maps for.We also like to use it to navigate to places. I'm going to look up directionsto my favorite museum after work. Swipe up here. Tap on California Academyof Sciences. And OK we see something new here. Maps is informing us thatgetting directions from where I am to the museum needs my exact locationwith full accuracy. If you have a feature that needs exact location butyou don't have full accuracy authorized, what do you do? So let's pauseand talk about that. What do you the developer, do if the user is only sharingapproximate location with your app which you have a feature that needsexact location. Well you've got two options here. First you can send theuser to Settings and ask them to upgrade you to full accuracy permanently.This may not be attractive to all users and some might prefer to simply notuse that feature or even stop using your app entirely, rather thangrant you more access than they want. Fortunately the other option is far moreattractive for these kinds of users - temporarily granting full accuracy.Here's how you would do that. We have a new method on CLLocationManagerthat allows you to prompt the user for temporary full accuracy. In thisexample the user is prompted to upgrade their location accuracy authorization.If they do not have full accuracy. After they respond this completion blockis called which calls start navigation if we got the renewed response.Now we must set a purpose key when requesting this temporary accuracy authorization upgrade.This is a very important point to remember. You have to explain to theuser why you need this upgrade and this purpose key will show them whatthat reason is. So let's talk about how to specify these. To ask for temporaryfull accuracy, you must specify a purpose key like you just saw in theprevious slide. These strings must be within a dictionary keyed offNSLocationTemporaryUsageDescriptionDictionary in your Info.plist likeyou see in this example. Make sure you explain clearly to the user whyyou want their exact location to insure they grant you the access needed.Following on the previous slide CoreLocation will select the string underWantsToNavigate to then display to the user. It's important that youput these strings under this dictionary as CoreLocation will only look underthis path for your purpose keys. The prompt the user sees will ultimatelylook something like this. Note that the purpose key is shown to the userjust above the map inset and explains why the app wants their exact location.Temporary location accuracy upgrades work a lot like things to do withthe "Allow Once" behavior introduced in iOS 13. That is to say your userwill be prompted for an accuracy upgrade the next time they relaunch yourapp and trigger the feature that requires a temporary accuracy upgrade.This upgrade last as long as the user keeps using the app, so as long asthey don't close it, you won't have to ask for it again. OK let's bring allthis together and see how it works. Your user sees a prompt indicatingwhat location info the app would get, were they to grant exact location.Upon allowing this, the app can now proceed to give navigation instructionsfrom their exact location to their destination. So, just a few takeawaysto consider before we move on. You should make sure your apps location-based features are able to deal with not having been granted full location accuracy.Maps is a really good example of this. They might seem like an app thatwould always require full accuracy location but they deliver a greatuser experience in both full and reduced accuracy authorization. When theylack full accuracy, it's reflected in the UI to the user with both thelarge position circle and the status bar at the top of the UI. This UI reflectionis worth a strong consideration when making your own app. Sometimes, howeverfull accuracy is needed. At that point, it's perfectly fine to ask the userto grant full accuracy. Maps does this well by showing in the search barthat it needs exact location to navigate from the user's location to thedestination and will then prompt for it if the user selects this option.Asking for full accuracy only when it's actually needed makes users morelikely to give you what you need. It shows that you're not asking for moreinformation than is necessary.Following on this you should also make sure to use purpose strings for accuracyupgrades just like you would with location authorization in general.Explain to the user why it's necessary. You can have more than one feature perapp that needs full accuracy so you can have as many such purpose stringsin your info.plist as you need. When asking for full accuracy it's oftenbetter to use a temporary upgrade prompt rather than to send the user toSettings whenever that's possible for you. Now let's talk a bit about howto consider background location updates in light of this new accuracy authorization.Let's start with significant location change monitoring. This monitoringadapts well to reducedAccuracy. You'll get updates no more often then you would withdidUpdateLocations results. About four times per hour. Similarly, wedo not deliver duplicate locations if your position has not changed enoughto have also changed your reduced accuracy location. When accuracyAuthorizationis reduced, visit monitoring API is still accurate in time. It is onlythe spatial information which is reduced in accuracy. Let me explain whatthis means. Let's say I arrive at work bright and early in the morning.If I have two apps monitoring for visits, one receiving fullAccuracy, one receivingreducedAccuracy, then the full accuracy app will receive a visit notificationthat I arrived at coordinates within Apple Park at 10:08. But the reducedaccuracy app will receive a visit notification that I arrived at coordinates somewherewithin Cupertino but still at 10:08. Finally, Beacons and regions.Region entry and exit notifications will not be delivered for apps that are notauthorized for full accuracy. You will need to get full accuracy to usethis feature. More on this in just a bit. We know that there are many appswhich use region monitoring to deliver features to users. Let's look atone popular example, Reminders. As you probably know Reminders can deliverlocation based reminders to the user by setting a perimeter around some location.Let's see how they adopted the new Accuracy Authorization API. I have areminder set for myself to buy some tuna for my cats. And I want to bereminded of this when I'm leaving work so I don't forget this incrediblyimportant task. Let's see how this works in the canonical example withfull accuracy. Now I can authorize tapping the reminder and then go seta location for this reminder. Here I'll be able to set a region aroundmy office such that I'll be notified when I leave work. OK so great.I'll be reminded by some tasty tuna for my cats as I leave work.Let's see this again but this time with reduced accuracy. You remember how Itold you that region monitoring won't work in this configuration. This timereminders prompts me to go to Settings to turn on full accuracy. It's correctfor Reminder's to do this here rather than to ask for a temporary upgradebecause this app needs full accuracy at all times to deliver timelylocation-based reminders. Now the user can choose not to grant full accuracyhere and still set a location for the reminder. But this location basedreminder won't fire on any device where the user has not granted full access.So a few key takeaways for background location updates. Region monitoring requiresfull accuracy. So apps needing it have to have full accuracy granted to them.While it might be tempting to always check at launch if your app has fullaccuracy and then send the user to Settings if you don't you should thinkcarefully about whether that's actually necessary. Not every app needsthe user to grant them full accuracy at all times. When it's possible, designyour app in a way that will let the user interact with it without havingto increase the authorized accuracy. This will make for an overall betteruser experience and make the user more likely to keep using your app.As I mentioned at the start of this talk there exists a set of applicationsthat really do not need more than reducedAccuracy locations. I previouslytalked about how to get full accuracy when you only have reduced. So nowlet's talk about the inverse case. Even though you might be authorizedfor fullAccuracy it doesn't mean you should get full accuracy locationsif you don't actually need them. Luckily you can set your location managerto get only reducedAccuracy locations when that makes sense. We introduced anew CLLocationAccuracy constant that you can use to put your locationmanager into this mode. You can also change your app's behavior to requestreducedAccuracy locations by default when asking for authorization by setting thiskey in your Info.plist. Note that there is no Precise:On pill in the Mapthis time. This is another effect of this key. It prevents the user fromaccidentally giving more location access then they intend. In some casesthe user may want to go back and change their mind about having grantedreduced accuracy to their app. And they can do so simply by going to Settingsand toggling the Precise:On switch. This is still going to be availabledespite the mentioned info.plist being set. Let's have a look at an exampleapp that does request reduced accuracy locations by default, TV. Many of us arefamiliar with region locking for streaming content as well as televisionblackouts for sporting events and pairing with local affiliates. With theproliferation of content streaming services like Apple's TV app there isa legitimate business need for video streaming applications to know thelocations of their users. But like we discussed before that doesn't meanthe app needs to collect more information about the user then is actually necessary.TV only asks for location when it actually needs it and when it does itonly asks for approximate location. If I feel like watching some sportsI would go to the sports tab then find the game and tap it to watch.If I click on one of these games. TV verifies my location and after grantinglocation access it only gets my approximate location. But taking this approachTV still respects broadcast rules while minimizing how much informationit has to collect about the user. So by now you've probably wondered howexactly these locations work and you're probably thinking that desiredAccuracywas doing this for you all along. So I like to talk about that for a bit.desiredAccuracy is a property that we introduced to encourage you to onlyuse as much accuracy as you need. There are many reasons for this but theforemost was to allow iOS to save battery life. Now, this is different fromwhat we now have with reducedAccuracy in two ways. First there wasn't actuallya guarantee that you would get the desired accuracy asked for either becausethere was a lack of a GPS signal or because there could be another apprunning simultaneously which is receiving more accurate locations thatwe would then opportunistically deliver to your app. Second, there was notan effective way to surface this information to the user. That is the userreally had no control over how much information an app would get. So whatdoes this new API actually do. It might be tempting to think that reducedaccuracy locations are simply your true location with some noise added in.But that is not the case. Simply adding some random noise on top of theuser's true location is actually not that secure against someone who mightwish to disambiguate the true location. Instead it's better to think ofwhat happens under the hood as a quantization of sorts. Let me explain further.Let's look at an example area. Consider different users going on a drivein the vicinity of El Paso, Texas and Juarez, Mexico. Note that this is nearan international boundary, with the US being in the northern half of themap, and Mexico being in the southern half, bordered by this pink line yousee here. The true position of the user is represented by the cars whilethe reported position, that is to say what an app would see if it had reducedaccuracy, will be shown by a circle. Again as I mentioned earlier in thispresentation, these reported locations will contain the user's true location.As these users drive down Interstate 10 the location snaps to within differentquantize regions of varying sizes. Both the red and yellow users are goingto be quantized or "snapped" into the same regions as they drive along the road.But the amount of snapping will vary. In denser urban areas, this amountof quantization can be a couple of kilometers, but in less dense placeslike rural areas, it can be 10 kilometers or a bit more. A typical valuefor this quantization radius is around five kilometers. Note that despitethe cars continuously driving along the road the region to which the trueposition quantities will not continuously update. This is because ReducedAccuracy locations are recomputed about 4 times per hour. So depending onexactly how fast these cars are moving there might be some lag betweenquantized snaps. The actual semantics of the quantization are intended toreplicate what the user would expect to hear if they were to ask for anapproximate answer to the question "Where am I"? We tried to ensure thatthe resultant reduced accuracy location is still going to be somewherethat the user actually expects to be. We use a location we have for youto place your approximate location on the appropriate side of the border here.Again though remember that the center point does not represent the locationof the user. It only represents the center of a region where they approximatelyare. Approximate location snapping however might put you in a neighboringcity especially if there are cities close together. To reiterate the bitabout quantization around borders, let's see what happens to someone drivingon the other side of the border in Juarez and what they might expect to see.Note that the blue car is quantized into regions whose centers are on theMexican side of the border. This new reduced accuracy API is availablein iOS and watchOS. And apps accuracyAuthorization status is synced betweencompanion apps on paired phones and watches just like the canonical authorization status.We've also made an improvement to watch connectivity for sharing your appsauthorization status. We introduce this capability in iOS 9 and we'vemade an improvement this year. Now, you'll be able to share apps temporaryauthorization status as well as end user state across both platforms.This means that if a user selects 'Allow Once' on your companion watch app ordoes a temporary accuracy upgrade, your phone app will be able to benefitfrom that decision. No more needing to ask for permanent authorizationwhen you don't need it. In summary, this new API brings with it a whole new dimensionof location authorization. And with it you will need to consider how yourapp should change to accommodate the user giving you only reducedAccuracy.If you have features that do require full accuracy, think carefully aboutwhether you really need permanent full accuracy or whether you can usea temporary upgrade API. Whether your app uses background location updateswill help you to inform this decision. Finally, consider whether your applicationcould utilize reduced accuracy by default. There's no need to get moreinformation from the user than is actually necessary. A few more thingsabout CLLocationManager. First we'd like to address the changes wemade in iOS 13 for always authorization. For some apps, we made some improvementsin a recent release. You may recognize this diagram from last years presentation,and that it was not possible to get always authorization without firstgoing through the provisional always state. The idea behind this was tohelp the user understand always authorization by asking them to addressit within the context of where it was actually being used. But for someapps this made it tricky to know when location updates would actually be delivered.Asking for always permission when authorized whenInUse would put youinto the provisional always state just like it would had you asked forit from notDetermined. We've changed this up in the latest releases to betterbalance functionality and privacy. Starting in iOS 13.4we slightly changed the state diagram to provide a more deterministic path toalways authorization. An app which has previously asked only for whenInUseauthorization and got it may now request always authorization and havethe user immediately be prompted to consider granting it without leavingthe app's context. If you need to know exactly when Always authorization hasbeen granted to your app, please consider this. Don't ask the user foralways right away. Instead ask for whenInUse the first time they accesslocation features. Only ask for always once the user accesses a featurethat really needs it. If users better understand why your app needs authorizationthey're more likely to grant it. One last thing. We've had feedback fromdevelopers that are using activityType in their apps. And we wanted torehash some recommendations for you. The activityType field on CLLocationManagerhelps inform our underlying positioning algorithms give you and yourusers a better experience. And it's important to use them correctly.Airborne should only be used for actual airborne activities like flying. Fitnessshould only be used if the user is specifically intending a workout sessionlike an outdoor run, a swim or some other sport. automotiveNavigation is a specialcase of positioning where you know the user will definitely stay on a roadlike if they're driving a car. Selecting best accuracy for navigation hereis also a good idea. otherNavigation is when the user is definitely movingbut not necessarily going to be on the road. This includes cases like Off-RoadVehicles, Hikes, Boats, Walking and so on. Others should be used when you don'thave something that will neatly fit into one of these other buckets orhas no clear user intention like a workout. OK, let's talk about AppClips and Widgets. You probably heard about App Clips in this year's keynote.These are a great new feature that will enable an entirely new experiencefor your users. I'm not going to spend too much time rehashing exactlywhat these are. And you can look at this talk to get more information onthat subject. The key point for us to remember though, is that these areessentially a lightweight subset of a corresponding app. This concept appliesto using CoreLocation within App Clips as well. From our perspective AppClips are more or less the same as the corresponding apps, but with twovery important distinctions. First, they will not receive Always authorization.Second, instead of "While Using," they will see this - "While Using Until Tomorrow."This means that they get While Using authorization only temporarily.The authorization is automatically cleared the following morning after being granted.So, in terms of design considerations, don't put any features into an AppClip that would require Always authorization because you can't get it.You should also remember that App Clips Location authorization expires.Cinderella can use an App Clip to hire a pumpkin carriage and a gorgeousdress for the night. But just like her magical accoutrements the App Clip'slocation authorization disappears by morning. Finally I'd like to touchbriefly upon WidgetKit. This is an awesome new feature in iOS 14 andthe new macOS that you should definitely check out. When making a widgetthat uses location, you have to include the NSWidgetWantsLocation keyin your widgets info.plist. You should also consider that widgets arenot able to show authorization prompts. Their authorization will derivefrom the parent app. So if you have an application whose experience willbe primarily driven by its widget you will need to consider how to promptfor location access in the parent app should you need it. Today we talkedabout some big changes to location authorization. A whole new conceptualdimension. Giving the user more control over their data privacy is importantto Apple. Users are increasingly conscious of how different services use userdata. And location is a prime example. When you design an app to accountfor reduced accuracy you can deliver an amazing user experience and buildtrust with your users by showing them that you're not actually asking formore information than you need. We also talked about two types of appsentirely, App Clips and Widgets. And how to use CoreLocation effectively in them.These are great tools that were designed by a troupe of amazing engineers.And we hope you get the chance to try them out. If there's nothing elseyou'll take for my talk then please just remember this. Don't ask the usersfor more information than they want to share with you and that you truly need.This isn't just for the users benefit. It's for your own too. Users don't wantto give away more information than they have to. And by minimizing whatyou ask for, you can build trust with them and give them a better user experience.Think about your features.Think about what they do. And think about what can work with reduced accuracy.Thank you.

Hello and welcome to WWDC.

Hello there. I'm Ilya Veygman. I'm a software engineer with Core Location.Today I'll be telling you about all the cool new stuff in Core Location this year.We will be primarily covering Location Authorization. And we willalso discuss some new features from this year's release, App Clips and Widgets.

Let's start with Location Authorization.

I want to begin by talking about the state of the world in iOS 13.As of the most recent major release there are basically three ways a usercan control the circumstances under which an app can access their location.

A user can respond to a location prompt or go to Settings and set one ofthese options. Which means that an app can get their location informationat no time. Only while it's in use, or at anytime. As user privacy is andhas been a major priority for Apple we thought: are there any other controlswe can give the user which will allow them to regulate access to theirsensitive location data? To do so we ask ourselves this question - What doesthis app really need to know about me in order to do its job? A privacyconscious user is likely to ask themselves the same question. And one waythe user will ask this is not just is this app getting my location whenI don't want it to. They will also ask whether the app needs to know exactlywhere they are as opposed to approximately where they are. There are certainclasses of apps where a user may not see the need to give their exact locationand will be satisfied with the app knowing just approximately where they are.

Does this dating app for example, really need to know anything other thanmy town. Does this local events app have to know what hotel I'm staying in.Does a social media app need to know exactly where I've been. In factthey might prefer to give only minimal information and nothing more.There are certainly use cases where exact location is preferred if not necessary.For example if you want to use a navigation app to get turn by turn directionsfrom wherever you may be to your destination you would need the app toknow exactly where you are. But there are other classes of apps where sharingjust a little bit of location information makes sense for the appsexpected functionality. In the case of a dating app or a local events app for example,it's certainly possible to make hyper- targeted recommendations or matchesto a user if you have their exact location. And this is a great featurefor some, but others may not be interested in that level of detail and wouldprefer to not share location at all rather than to access that functionality.In cases like these approximate location might in fact be good enough formany users. In iOS 13 a user getting an initial prompt for location authorizationwould see something like this. Starting in iOS 14, and as you saw in thekeynote a new option will appear in the prompts for users -  Precise.This option lets the user grant an app only their approximate rather than theirexact location. This will also be visible to users under Settings. By disablingthe precise location switch, the user can choose to grant only approximatelocation to the app. As a result of this the user now has two dimensionsupon which to specify how much location access they would like to grant an app.There is the "what circumstances" of an app accessing location and thereis now also the "how much" dimension of location access. Now instead of justthe one notion of location authorization we have two. Users can do all sortsof things with authorization now. Initially grant while using with reducedaccuracy, upgrade it to the full accuracy and even do things like change theauthorization to "always" and then downgrade the accuracy to "reduced" again.

Now, one thing that should be made very clear before we continue. Apps cannotopt out of this new feature. This functionality is controlled entirelyby the user. It's another form of authorization after all, and the userdecides whether they grant or revoke authorization at any time.You, the app must adapt to this new world where you just can decide not to givethe app exact location information at all times. Given that, I think it'stime to talk about the tools we're providing you to adopt this new feature.

First we're deprecating the CLLocationManager class method for authorizationstatus and replacing it with a property that delivers the app's authorizationstatus just like before. We also introduced a new instance property thatindicates how accurately the app can know user location. There are twooptions for this enum, full and reduced. Full is a sort of default fromthe pre-iOS 14 world, while reduced is the new scenario. To further accommodatethese new notions of location authorization. We're further changing upthe authorization status delegate callback. We're deprecating the oldDidChangeAuthorization status callback and replacing it with a new locationManagerDidChangeAuthorizationcallback method. This new method is invoked whenevereither the authorizationStatus or accuracyAuthorization property values change.

Here's how you might want to implement the new delegate callback method.You will need to check the values of both the authorization status and theaccuracy to determine how to proceed. Now, a few notes on how these aredelivered. Reduced accuracy fixes are still delivered to the didUpdateLocationsdelegate just like before. And they're still expressedas CLLocation objects with a CLLocationCoordinate2D center points anda large value for horizontal accuracy. These locations are recomputed aboutfour times per hour. So if you have some timeout logic in the applicationyou should make sure to inform it using the value of accuracyAuthorization.

Finally while these are represented as CLLocation objects you should nottreat them like you would a typical location with full accuracy.Instead you should consider them to contain the user's true position. Now, let'shave a look at a case study of a top notch adoption of this new featurein maps. The Maps team have worked closely with ours to bring you whatyou can see in iOS 14. And have done an amazing job of adopting thenew Accuracy Authorization API. Please check out their talk on Designingfor Location Privacy which will cover some topics that are very relevantto what we'll discuss here. New in iOS 14 when Maps, or any app asksfor location for the first time they would see this prompt. Just likeyou saw before which will show an inset map with your location on it.Let's toggle the "Precise: On" pill to see what happens. This will show you whatthe underlying app would get if you gave it full versus reduced accuracy.

This will be immediately obvious by seeing the big circle indicating theuser's approximate location in the app rather than the familiar blue dot.

Let's see how this looks when you grant authorization to the app and launch it.

As you'd expect, the UI will show a large circle indicating the user's approximatelocation rather than the blue dot that you're probably used to. Again thiscircle contains the user's true position and now Maps also does a reallygood thing here by placing a banner at the top of the UI which clearlyindicates to the user that they have reduced accuracy for this app.This is a good thing to consider when you're designing your own app to adoptthis feature. How to reflect this reduced accuracy and authorization backto the user. Now, looking at where we are isn't the only thing we use Maps for.We also like to use it to navigate to places. I'm going to look up directionsto my favorite museum after work. Swipe up here. Tap on California Academyof Sciences. And OK we see something new here. Maps is informing us thatgetting directions from where I am to the museum needs my exact locationwith full accuracy. If you have a feature that needs exact location butyou don't have full accuracy authorized, what do you do? So let's pauseand talk about that. What do you the developer, do if the user is only sharingapproximate location with your app which you have a feature that needsexact location. Well you've got two options here. First you can send theuser to Settings and ask them to upgrade you to full accuracy permanently.

This may not be attractive to all users and some might prefer to simply notuse that feature or even stop using your app entirely, rather thangrant you more access than they want. Fortunately the other option is far moreattractive for these kinds of users - temporarily granting full accuracy.

Here's how you would do that. We have a new method on CLLocationManagerthat allows you to prompt the user for temporary full accuracy. In thisexample the user is prompted to upgrade their location accuracy authorization.If they do not have full accuracy. After they respond this completion blockis called which calls start navigation if we got the renewed response.

Now we must set a purpose key when requesting this temporary accuracy authorization upgrade.This is a very important point to remember. You have to explain to theuser why you need this upgrade and this purpose key will show them whatthat reason is. So let's talk about how to specify these. To ask for temporaryfull accuracy, you must specify a purpose key like you just saw in theprevious slide. These strings must be within a dictionary keyed offNSLocationTemporaryUsageDescriptionDictionary in your Info.plist likeyou see in this example. Make sure you explain clearly to the user whyyou want their exact location to insure they grant you the access needed.

Following on the previous slide CoreLocation will select the string underWantsToNavigate to then display to the user. It's important that youput these strings under this dictionary as CoreLocation will only look underthis path for your purpose keys. The prompt the user sees will ultimatelylook something like this. Note that the purpose key is shown to the userjust above the map inset and explains why the app wants their exact location.

Temporary location accuracy upgrades work a lot like things to do withthe "Allow Once" behavior introduced in iOS 13. That is to say your userwill be prompted for an accuracy upgrade the next time they relaunch yourapp and trigger the feature that requires a temporary accuracy upgrade.

This upgrade last as long as the user keeps using the app, so as long asthey don't close it, you won't have to ask for it again. OK let's bring allthis together and see how it works. Your user sees a prompt indicatingwhat location info the app would get, were they to grant exact location.

Upon allowing this, the app can now proceed to give navigation instructionsfrom their exact location to their destination. So, just a few takeawaysto consider before we move on. You should make sure your apps location-based features are able to deal with not having been granted full location accuracy.Maps is a really good example of this. They might seem like an app thatwould always require full accuracy location but they deliver a greatuser experience in both full and reduced accuracy authorization. When theylack full accuracy, it's reflected in the UI to the user with both thelarge position circle and the status bar at the top of the UI. This UI reflectionis worth a strong consideration when making your own app. Sometimes, howeverfull accuracy is needed. At that point, it's perfectly fine to ask the userto grant full accuracy. Maps does this well by showing in the search barthat it needs exact location to navigate from the user's location to thedestination and will then prompt for it if the user selects this option.

Asking for full accuracy only when it's actually needed makes users morelikely to give you what you need. It shows that you're not asking for moreinformation than is necessary.Following on this you should also make sure to use purpose strings for accuracyupgrades just like you would with location authorization in general.Explain to the user why it's necessary. You can have more than one feature perapp that needs full accuracy so you can have as many such purpose stringsin your info.plist as you need. When asking for full accuracy it's oftenbetter to use a temporary upgrade prompt rather than to send the user toSettings whenever that's possible for you. Now let's talk a bit about howto consider background location updates in light of this new accuracy authorization.Let's start with significant location change monitoring. This monitoringadapts well to reducedAccuracy. You'll get updates no more often then you would withdidUpdateLocations results. About four times per hour. Similarly, wedo not deliver duplicate locations if your position has not changed enoughto have also changed your reduced accuracy location. When accuracyAuthorizationis reduced, visit monitoring API is still accurate in time. It is onlythe spatial information which is reduced in accuracy. Let me explain whatthis means. Let's say I arrive at work bright and early in the morning.If I have two apps monitoring for visits, one receiving fullAccuracy, one receivingreducedAccuracy, then the full accuracy app will receive a visit notificationthat I arrived at coordinates within Apple Park at 10:08. But the reducedaccuracy app will receive a visit notification that I arrived at coordinates somewherewithin Cupertino but still at 10:08. Finally, Beacons and regions.Region entry and exit notifications will not be delivered for apps that are notauthorized for full accuracy. You will need to get full accuracy to usethis feature. More on this in just a bit. We know that there are many appswhich use region monitoring to deliver features to users. Let's look atone popular example, Reminders. As you probably know Reminders can deliverlocation based reminders to the user by setting a perimeter around some location.

Let's see how they adopted the new Accuracy Authorization API. I have areminder set for myself to buy some tuna for my cats. And I want to bereminded of this when I'm leaving work so I don't forget this incrediblyimportant task. Let's see how this works in the canonical example withfull accuracy. Now I can authorize tapping the reminder and then go seta location for this reminder. Here I'll be able to set a region aroundmy office such that I'll be notified when I leave work. OK so great.I'll be reminded by some tasty tuna for my cats as I leave work.Let's see this again but this time with reduced accuracy. You remember how Itold you that region monitoring won't work in this configuration. This timereminders prompts me to go to Settings to turn on full accuracy. It's correctfor Reminder's to do this here rather than to ask for a temporary upgradebecause this app needs full accuracy at all times to deliver timelylocation-based reminders. Now the user can choose not to grant full accuracyhere and still set a location for the reminder. But this location basedreminder won't fire on any device where the user has not granted full access.

So a few key takeaways for background location updates. Region monitoring requiresfull accuracy. So apps needing it have to have full accuracy granted to them.

While it might be tempting to always check at launch if your app has fullaccuracy and then send the user to Settings if you don't you should thinkcarefully about whether that's actually necessary. Not every app needsthe user to grant them full accuracy at all times. When it's possible, designyour app in a way that will let the user interact with it without havingto increase the authorized accuracy. This will make for an overall betteruser experience and make the user more likely to keep using your app.As I mentioned at the start of this talk there exists a set of applicationsthat really do not need more than reducedAccuracy locations. I previouslytalked about how to get full accuracy when you only have reduced. So nowlet's talk about the inverse case. Even though you might be authorizedfor fullAccuracy it doesn't mean you should get full accuracy locationsif you don't actually need them. Luckily you can set your location managerto get only reducedAccuracy locations when that makes sense. We introduced anew CLLocationAccuracy constant that you can use to put your locationmanager into this mode. You can also change your app's behavior to requestreducedAccuracy locations by default when asking for authorization by setting thiskey in your Info.plist. Note that there is no Precise:On pill in the Mapthis time. This is another effect of this key. It prevents the user fromaccidentally giving more location access then they intend. In some casesthe user may want to go back and change their mind about having grantedreduced accuracy to their app. And they can do so simply by going to Settingsand toggling the Precise:On switch. This is still going to be availabledespite the mentioned info.plist being set. Let's have a look at an exampleapp that does request reduced accuracy locations by default, TV. Many of us arefamiliar with region locking for streaming content as well as televisionblackouts for sporting events and pairing with local affiliates. With theproliferation of content streaming services like Apple's TV app there isa legitimate business need for video streaming applications to know thelocations of their users. But like we discussed before that doesn't meanthe app needs to collect more information about the user then is actually necessary.

TV only asks for location when it actually needs it and when it does itonly asks for approximate location. If I feel like watching some sportsI would go to the sports tab then find the game and tap it to watch.If I click on one of these games. TV verifies my location and after grantinglocation access it only gets my approximate location. But taking this approachTV still respects broadcast rules while minimizing how much informationit has to collect about the user. So by now you've probably wondered howexactly these locations work and you're probably thinking that desiredAccuracywas doing this for you all along. So I like to talk about that for a bit.desiredAccuracy is a property that we introduced to encourage you to onlyuse as much accuracy as you need. There are many reasons for this but theforemost was to allow iOS to save battery life. Now, this is different fromwhat we now have with reducedAccuracy in two ways. First there wasn't actuallya guarantee that you would get the desired accuracy asked for either becausethere was a lack of a GPS signal or because there could be another apprunning simultaneously which is receiving more accurate locations thatwe would then opportunistically deliver to your app. Second, there was notan effective way to surface this information to the user. That is the userreally had no control over how much information an app would get. So whatdoes this new API actually do. It might be tempting to think that reducedaccuracy locations are simply your true location with some noise added in.But that is not the case. Simply adding some random noise on top of theuser's true location is actually not that secure against someone who mightwish to disambiguate the true location. Instead it's better to think ofwhat happens under the hood as a quantization of sorts. Let me explain further.

Let's look at an example area. Consider different users going on a drivein the vicinity of El Paso, Texas and Juarez, Mexico. Note that this is nearan international boundary, with the US being in the northern half of themap, and Mexico being in the southern half, bordered by this pink line yousee here. The true position of the user is represented by the cars whilethe reported position, that is to say what an app would see if it had reducedaccuracy, will be shown by a circle. Again as I mentioned earlier in thispresentation, these reported locations will contain the user's true location.

As these users drive down Interstate 10 the location snaps to within differentquantize regions of varying sizes. Both the red and yellow users are goingto be quantized or "snapped" into the same regions as they drive along the road.But the amount of snapping will vary. In denser urban areas, this amountof quantization can be a couple of kilometers, but in less dense placeslike rural areas, it can be 10 kilometers or a bit more. A typical valuefor this quantization radius is around five kilometers. Note that despitethe cars continuously driving along the road the region to which the trueposition quantities will not continuously update. This is because ReducedAccuracy locations are recomputed about 4 times per hour. So depending onexactly how fast these cars are moving there might be some lag betweenquantized snaps. The actual semantics of the quantization are intended toreplicate what the user would expect to hear if they were to ask for anapproximate answer to the question "Where am I"? We tried to ensure thatthe resultant reduced accuracy location is still going to be somewherethat the user actually expects to be. We use a location we have for youto place your approximate location on the appropriate side of the border here.

Again though remember that the center point does not represent the locationof the user. It only represents the center of a region where they approximatelyare. Approximate location snapping however might put you in a neighboringcity especially if there are cities close together. To reiterate the bitabout quantization around borders, let's see what happens to someone drivingon the other side of the border in Juarez and what they might expect to see.

Note that the blue car is quantized into regions whose centers are on theMexican side of the border. This new reduced accuracy API is availablein iOS and watchOS. And apps accuracyAuthorization status is synced betweencompanion apps on paired phones and watches just like the canonical authorization status.

We've also made an improvement to watch connectivity for sharing your appsauthorization status. We introduce this capability in iOS 9 and we'vemade an improvement this year. Now, you'll be able to share apps temporaryauthorization status as well as end user state across both platforms.This means that if a user selects 'Allow Once' on your companion watch app ordoes a temporary accuracy upgrade, your phone app will be able to benefitfrom that decision. No more needing to ask for permanent authorizationwhen you don't need it. In summary, this new API brings with it a whole new dimensionof location authorization. And with it you will need to consider how yourapp should change to accommodate the user giving you only reducedAccuracy.

If you have features that do require full accuracy, think carefully aboutwhether you really need permanent full accuracy or whether you can usea temporary upgrade API. Whether your app uses background location updateswill help you to inform this decision. Finally, consider whether your applicationcould utilize reduced accuracy by default. There's no need to get moreinformation from the user than is actually necessary. A few more thingsabout CLLocationManager. First we'd like to address the changes wemade in iOS 13 for always authorization. For some apps, we made some improvementsin a recent release. You may recognize this diagram from last years presentation,and that it was not possible to get always authorization without firstgoing through the provisional always state. The idea behind this was tohelp the user understand always authorization by asking them to addressit within the context of where it was actually being used. But for someapps this made it tricky to know when location updates would actually be delivered.

Asking for always permission when authorized whenInUse would put youinto the provisional always state just like it would had you asked forit from notDetermined. We've changed this up in the latest releases to betterbalance functionality and privacy. Starting in iOS 13.4we slightly changed the state diagram to provide a more deterministic path toalways authorization. An app which has previously asked only for whenInUseauthorization and got it may now request always authorization and havethe user immediately be prompted to consider granting it without leavingthe app's context. If you need to know exactly when Always authorization hasbeen granted to your app, please consider this. Don't ask the user foralways right away. Instead ask for whenInUse the first time they accesslocation features. Only ask for always once the user accesses a featurethat really needs it. If users better understand why your app needs authorizationthey're more likely to grant it. One last thing. We've had feedback fromdevelopers that are using activityType in their apps. And we wanted torehash some recommendations for you. The activityType field on CLLocationManagerhelps inform our underlying positioning algorithms give you and yourusers a better experience. And it's important to use them correctly.Airborne should only be used for actual airborne activities like flying. Fitnessshould only be used if the user is specifically intending a workout sessionlike an outdoor run, a swim or some other sport. automotiveNavigation is a specialcase of positioning where you know the user will definitely stay on a roadlike if they're driving a car. Selecting best accuracy for navigation hereis also a good idea. otherNavigation is when the user is definitely movingbut not necessarily going to be on the road. This includes cases like Off-RoadVehicles, Hikes, Boats, Walking and so on. Others should be used when you don'thave something that will neatly fit into one of these other buckets orhas no clear user intention like a workout. OK, let's talk about AppClips and Widgets. You probably heard about App Clips in this year's keynote.

These are a great new feature that will enable an entirely new experiencefor your users. I'm not going to spend too much time rehashing exactlywhat these are. And you can look at this talk to get more information onthat subject. The key point for us to remember though, is that these areessentially a lightweight subset of a corresponding app. This concept appliesto using CoreLocation within App Clips as well. From our perspective AppClips are more or less the same as the corresponding apps, but with twovery important distinctions. First, they will not receive Always authorization.Second, instead of "While Using," they will see this - "While Using Until Tomorrow."This means that they get While Using authorization only temporarily.The authorization is automatically cleared the following morning after being granted.

So, in terms of design considerations, don't put any features into an AppClip that would require Always authorization because you can't get it.

You should also remember that App Clips Location authorization expires.Cinderella can use an App Clip to hire a pumpkin carriage and a gorgeousdress for the night. But just like her magical accoutrements the App Clip'slocation authorization disappears by morning. Finally I'd like to touchbriefly upon WidgetKit. This is an awesome new feature in iOS 14 andthe new macOS that you should definitely check out. When making a widgetthat uses location, you have to include the NSWidgetWantsLocation keyin your widgets info.plist. You should also consider that widgets arenot able to show authorization prompts. Their authorization will derivefrom the parent app. So if you have an application whose experience willbe primarily driven by its widget you will need to consider how to promptfor location access in the parent app should you need it. Today we talkedabout some big changes to location authorization. A whole new conceptualdimension. Giving the user more control over their data privacy is importantto Apple. Users are increasingly conscious of how different services use userdata. And location is a prime example. When you design an app to accountfor reduced accuracy you can deliver an amazing user experience and buildtrust with your users by showing them that you're not actually asking formore information than you need. We also talked about two types of appsentirely, App Clips and Widgets. And how to use CoreLocation effectively in them.

These are great tools that were designed by a troupe of amazing engineers.And we hope you get the chance to try them out. If there's nothing elseyou'll take for my talk then please just remember this. Don't ask the usersfor more information than they want to share with you and that you truly need.This isn't just for the users benefit. It's for your own too. Users don't wantto give away more information than they have to. And by minimizing whatyou ask for, you can build trust with them and give them a better user experience.Think about your features.Think about what they do. And think about what can work with reduced accuracy.

Thank you.

## Code Samples

