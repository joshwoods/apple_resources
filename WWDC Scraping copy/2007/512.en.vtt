WEBVTT

00:00:14.230 --> 00:00:18.980
>> Good afternoon and welcome to the Bending
Directory Services Tier well session.

00:00:18.980 --> 00:00:24.480
My name is Nicole Jacque and I'm an engineer
with the Enterprise Support Engineering Group.

00:00:24.480 --> 00:00:31.269
And what we're going to talk about today is we're
going to start out by talking about Leopard,

00:00:31.269 --> 00:00:32.890
because that's why we're all here, right?

00:00:32.890 --> 00:00:35.259
We want to hear about Leopard.

00:00:35.259 --> 00:00:37.210
Okay, I heard, what?

00:00:37.210 --> 00:00:37.509
( Laughter )

00:00:37.509 --> 00:00:37.809
( Applause )

00:00:37.810 --> 00:00:40.090
Okay, thank you.

00:00:40.090 --> 00:00:45.230
And then because Leopard is not
here, not here for a little while,

00:00:45.229 --> 00:00:48.599
we're going to talk also about trouble
shooting Directory Services

00:00:48.600 --> 00:00:54.609
and in particular trouble shooting the active
directory plug-in so that you have some of the things

00:00:54.609 --> 00:01:01.299
that you can take back with you right away, start
using, information that will useful right now.

00:01:01.299 --> 00:01:05.780
( Applause )

00:01:05.780 --> 00:01:08.730
Another just little bit of administrativia here.

00:01:08.730 --> 00:01:11.060
There is a file associated with this session.

00:01:11.060 --> 00:01:15.769
If you log into the attendee site, I tried to
make it a little easier for you guys this year.

00:01:15.769 --> 00:01:20.769
Instead of having to scribble down notes because
there's some slides that have a lot of content on them,

00:01:20.769 --> 00:01:25.079
I've actually put most of the command
line things into a notes file.

00:01:25.079 --> 00:01:31.230
I think it's called session notes or release notes
or something like that, associated with this session.

00:01:31.230 --> 00:01:36.840
So if you are on a slide and you're trying
to take notes, you can not worry so much.

00:01:36.840 --> 00:01:43.930
They should, the content of most of
that should be in this file for you.

00:01:43.930 --> 00:01:45.570
( Applause )

00:01:45.569 --> 00:01:51.689
So, let's start out talking about Leopard.

00:01:51.689 --> 00:01:58.649
The first we need to talk about is we made a lot of
architectural changes to Directory Services in Leopard.

00:01:58.650 --> 00:02:02.400
To talk about where we're going, we
have to start with where we've been.

00:02:02.400 --> 00:02:09.060
Directory Services has always been this layer in
between your software and the backend plug-ins.

00:02:09.060 --> 00:02:13.590
And we've had look up D, which came
to us from NeXT and it handled things

00:02:13.590 --> 00:02:17.240
like your lib system calls, it did caching and DNS.

00:02:17.240 --> 00:02:23.650
And it, it talked to the local
node which was always NetInfo.

00:02:23.650 --> 00:02:26.039
That, hey I heard that.

00:02:26.039 --> 00:02:28.289
( Laughter )

00:02:28.289 --> 00:02:32.259
Then for OS X, we added the Directory Services daemon.

00:02:32.259 --> 00:02:37.620
And this added the ability to talk to things
like LDAP servers and Active Directory.

00:02:37.620 --> 00:02:47.210
And finally with Tiger we added member D. And we did this
to get past the 16 group limit that we'd always had coming

00:02:47.210 --> 00:02:51.510
from Unix and this handled all of
your group resolution and caching.

00:02:51.509 --> 00:02:56.500
So its time to make a little bit of a change here.

00:02:57.870 --> 00:03:06.810
So for Leopard, what we've done is we've
brought all three daemons into one big daemon.

00:03:06.810 --> 00:03:13.629
It's the directory service daemon and it handles everything
that look up D and member D had handled before along

00:03:13.629 --> 00:03:17.780
with all of things that Directory
Services had traditionally handled.

00:03:17.780 --> 00:03:20.479
And why did we do this?

00:03:20.479 --> 00:03:24.359
Well for one thing, we have one daemon.

00:03:24.360 --> 00:03:26.370
We have less IPC dispatch.

00:03:26.370 --> 00:03:28.340
We have better performance.

00:03:28.340 --> 00:03:32.420
We save a little bit of memory by
going from three processes to one.

00:03:32.419 --> 00:03:37.189
And now there's less overlap because each of
the three processes handle things that other

00:03:37.189 --> 00:03:43.949
of the processes also handled and now we
just have one process that does everything.

00:03:48.400 --> 00:03:54.370
For everything that accesses Directory
Services, you don't need to make any changes

00:03:54.370 --> 00:03:56.460
to your applications or anything like that.

00:03:56.460 --> 00:03:59.760
They'll call into directory services
the same way they always have.

00:03:59.759 --> 00:04:06.099
But for you as administrators, as troubleshooters,
you need to know that where the functionality

00:04:06.099 --> 00:04:08.340
of the things that have gone away have gone.

00:04:08.340 --> 00:04:15.710
So if you use look up D in Tiger, the main
functionality as I said went into directory service.

00:04:15.710 --> 00:04:21.319
But if you used to use look up D to
actually adjust some of the cache values,

00:04:21.319 --> 00:04:25.409
we have a new utility called DS cache util.

00:04:25.410 --> 00:04:31.640
And also if you used look up D to actually look up
records, things like users or mount records and so on,

00:04:31.639 --> 00:04:34.519
you can use DSCL which already exists in Tiger.

00:04:34.519 --> 00:04:42.089
For member D, the main functionality
again is in directory service.

00:04:42.089 --> 00:04:47.009
But we have a new utility called DS
member until that you use to do things

00:04:47.009 --> 00:04:51.930
like resolve UIDs to GUIDs or SIDs and back and forth.

00:04:51.930 --> 00:04:58.600
And finally we had our GUI utility, directory
access, which has gotten a face lift.

00:04:58.600 --> 00:05:00.080
And a rename.

00:05:00.079 --> 00:05:01.629
It's now called Directory Utility.

00:05:01.629 --> 00:05:08.279
And it's gone from something that looked like this,
lots of options right there on the, the first screen.

00:05:08.279 --> 00:05:12.919
Something a lot similar but simpler.

00:05:12.920 --> 00:05:19.550
And right from the first glance, you can tell what
nodes are functioning, what nodes might be disconnected

00:05:19.550 --> 00:05:28.100
and then you can always still get to the advanced
settings to set everything that you used to set.

00:05:28.100 --> 00:05:31.460
Now as long as we're talking about architectural changes

00:05:31.459 --> 00:05:35.529
with Directory Services, we need
to talk about the local node.

00:05:35.529 --> 00:05:39.259
Which traditionally has always been NetInfo.

00:05:39.259 --> 00:05:42.300
NetInfo has been with us for a long time.

00:05:42.300 --> 00:05:49.509
And for Leopard, there is really only
one piece of information about it.

00:05:49.509 --> 00:05:56.319
( Applause )

00:05:56.319 --> 00:05:58.480
Sound effects, yes.

00:05:58.480 --> 00:06:03.290
NetInfo has kicked the bucket.

00:06:03.290 --> 00:06:06.520
It has shuffled off this mortal coil.

00:06:06.519 --> 00:06:11.439
It has rung down the curtain, joined the choir invisible.

00:06:11.439 --> 00:06:13.870
This is an X directory service.

00:06:13.870 --> 00:06:15.980
( Applause )

00:06:15.980 --> 00:06:24.689
We do need something to perform the tasks
that NetInfo had been doing however.

00:06:24.689 --> 00:06:30.060
And that something is we knew DS local node.

00:06:30.060 --> 00:06:36.490
If you start out with a fresh Leopard install,
this is what you will get for your local node.

00:06:36.490 --> 00:06:41.300
If you do an upgrade install of Leopard,
we will actually pull all of your data

00:06:41.300 --> 00:06:44.800
out of NetInfo, put it in a DS local node.

00:06:44.800 --> 00:06:47.610
There will be no NetInfo running.

00:06:47.610 --> 00:06:51.040
Not for local access, not for network access.

00:06:51.040 --> 00:06:52.530
NetInfo is gone.

00:06:52.529 --> 00:06:57.399
( Applause )

00:06:57.399 --> 00:07:04.699
Now with the disappearance of NetInfo, we
should take a look at what's replacing it.

00:07:04.699 --> 00:07:11.039
And so DS local node is a very simple database
that gets rid of a lot of the extra functionality

00:07:11.040 --> 00:07:15.240
that was left over from NetInfo
being a network directory service.

00:07:15.240 --> 00:07:17.379
We didn't need all of that for a local node.

00:07:17.379 --> 00:07:20.889
So its basically just flat file record storage.

00:07:20.889 --> 00:07:28.360
If you look inside of it, as a node as its stored in
the file system, its just a series of directories,

00:07:28.360 --> 00:07:39.560
each named for the record type that its storing; you
find this directory in VAR DB DS Local Nodes default.

00:07:39.560 --> 00:07:46.519
If you were to look inside one of these
directories, you would see a whole lot of files.

00:07:46.519 --> 00:07:50.079
Each of these files is an actual record.

00:07:50.079 --> 00:07:55.060
And if you look we have some built in user accounts here.

00:07:55.060 --> 00:07:57.370
They are all prefixed with an underscore.

00:07:57.370 --> 00:08:02.040
And we have the accounts that were
actually set up by you on the system.

00:08:02.040 --> 00:08:07.140
And if you can't guess, they're all dot P list.

00:08:07.139 --> 00:08:10.680
So they are just P list files.

00:08:10.680 --> 00:08:12.090
You get your standard P list header.

00:08:12.089 --> 00:08:19.959
And you can see you've got all the various record
attributes that you are accustomed to seeing

00:08:19.959 --> 00:08:23.120
with in this case for example a user account.

00:08:23.120 --> 00:08:27.069
Nothing has changed about the types
of data that we're storing here.

00:08:27.069 --> 00:08:30.709
It's just how we're storing it on the back end.

00:08:30.709 --> 00:08:38.139
The good thing about this is that this is all pretty
transparent to you how it's being stored on the back end

00:08:38.139 --> 00:08:40.620
and the actual data that's being stored there.

00:08:40.620 --> 00:08:43.940
So you can actually, if you think you
might some sort of local node obstruction,

00:08:43.940 --> 00:08:47.590
you can just open the file and take a look.

00:08:47.590 --> 00:08:53.899
It's also pretty handy in the case where maybe
you make a change that you need to back out of,

00:08:53.899 --> 00:08:56.039
but you're already locked out of the system.

00:08:56.039 --> 00:09:00.799
Just as an example, lets say you
are playing with service accls

00:09:00.799 --> 00:09:05.000
and you accidentally lock yourself
out of the system altogether.

00:09:05.000 --> 00:09:12.200
Go to the single user mode, you can remove the service
allc record, reboot, and you're back to normal.

00:09:13.500 --> 00:09:21.029
Along with having NetInfo go away, we also have
the various NetInfo utilities that have gone away.

00:09:21.029 --> 00:09:26.829
So for all of the NetInfo utilities that
existed, which were the NI something,

00:09:26.830 --> 00:09:29.740
there is an equivalent DS something equivalent.

00:09:29.740 --> 00:09:38.840
So if you were using NICL or NI Util, you can
use DSCL or DS edit group to edit your records.

00:09:38.840 --> 00:09:44.269
If you were using NI Load, you can use DS Import.

00:09:44.269 --> 00:09:48.319
If you were using NI Dump, you can use DS Export.

00:09:48.320 --> 00:09:54.490
In the file that I associated with this session, I've
actually given you an example of a script written

00:09:54.490 --> 00:09:59.169
with the NI utilities and then converted
over to use a DS utilities.

00:09:59.169 --> 00:10:01.539
It's not any longer or harder.

00:10:01.539 --> 00:10:02.959
You just need to make the change.

00:10:02.960 --> 00:10:10.570
If you are using scripts that might use these utilities
or you were using them for your trouble shooting.

00:10:10.570 --> 00:10:18.750
There's also one GUI utility for NetInfo
and not surprisingly that's also going away.

00:10:18.750 --> 00:10:23.779
There were really three main things
that people used NetInfo manager for.

00:10:23.779 --> 00:10:28.059
And so instead of having a new replacement NetInfo manager,

00:10:28.059 --> 00:10:32.879
we've just moved that functionality
into the appropriate place.

00:10:32.879 --> 00:10:41.850
So the first thing that people used NetInfo manager for was
to edit the advanced settings of user and group accounts.

00:10:41.850 --> 00:10:50.590
So it made sense to move that functionality
into the account pane in System Preferences.

00:10:50.590 --> 00:11:02.649
So if you right click on a user account, you have access to
edit all the users that you might need access to.

00:11:02.649 --> 00:11:03.709
( Applause )

00:11:03.710 --> 00:11:09.879
Also hidden, but still there, you can
right click and you can also edit groups.

00:11:09.879 --> 00:11:16.070
And one thing that you can do with this is that even though
by default you may see only a list of users that you can add

00:11:16.070 --> 00:11:21.710
to a group that are on that machine,
if you choose to add a user or a group,

00:11:21.710 --> 00:11:27.330
you can actually add a network user
to the group and it will add them.

00:11:27.330 --> 00:11:29.060
It's just adding them to the file.

00:11:29.059 --> 00:11:30.199
You just can't browse.

00:11:30.200 --> 00:11:38.640
But we're not going to show you all of you know 5
million users you might have in your network node.

00:11:38.639 --> 00:11:44.210
The second thing that people use NetInfo
manager for was to create mount records.

00:11:44.210 --> 00:11:52.350
And so we've moved that functionality
into the Directory Utility.

00:11:52.350 --> 00:11:56.970
If you go into the advanced settings,
we have a tab for mounts.

00:11:56.970 --> 00:12:00.090
And you can go ahead, create you
mount records as you need to.

00:12:00.090 --> 00:12:10.000
And finally the last reason that people used
NetInfo manager was to enable or disable root.

00:12:10.000 --> 00:12:13.809
So that functionality also moved into directory utility.

00:12:13.809 --> 00:12:17.569
It's just an item in the edit pull down menu.

00:12:17.570 --> 00:12:21.200
There's also a command line utility that you can use.

00:12:21.200 --> 00:12:22.250
DS Enable Root.

00:12:22.250 --> 00:12:24.889
That actually already exists in Tiger.

00:12:24.889 --> 00:12:29.269
It'll still be there in Leopard.

00:12:29.269 --> 00:12:36.360
The next thing that we want to talk about is one
of our really popular directory service plug-ins.

00:12:36.360 --> 00:12:37.879
The Active Directory plug-in.

00:12:37.879 --> 00:12:42.149
How many people here use the Active Directory plug-in?

00:12:42.149 --> 00:12:46.279
Wow, forest of arms here.

00:12:47.509 --> 00:12:55.259
( Laughter )

00:12:55.259 --> 00:12:56.470
I'm sorry.

00:12:56.470 --> 00:12:59.600
( Period of silence )

00:12:59.600 --> 00:13:03.750
What we've done with the Active Directory
plug-in for Leopard is we are trying

00:13:03.750 --> 00:13:10.250
to make our Active Directory client fit in
better with the Active Directory domains,

00:13:10.250 --> 00:13:13.870
whether you have large domains and forests.

00:13:13.870 --> 00:13:15.379
We're trying to scale up to those.

00:13:15.379 --> 00:13:25.220
We're also trying to make our client be able to behave like
the Windows client without having to make special allowances

00:13:25.220 --> 00:13:30.149
for it, special settings in active
directory to allow us to work correctly.

00:13:30.149 --> 00:13:32.419
So okay.

00:13:32.419 --> 00:13:35.579
( Applause )

00:13:35.580 --> 00:13:41.940
One of the things that we have also done
is we have added domain and policy caching.

00:13:41.940 --> 00:13:45.760
So that your mobile users, how
many people use mobile accounts?

00:13:45.759 --> 00:13:47.629
( Period of silence )

00:13:47.629 --> 00:13:53.450
Mobile users will not have to sit
and query for this information.

00:13:53.450 --> 00:13:54.400
It'll be there.

00:13:54.399 --> 00:13:57.990
We'll eliminate some of the delays that
you may have seen with mobile accounts.

00:13:57.990 --> 00:14:01.950
( Applause )

00:14:01.950 --> 00:14:06.300
And as I said, we're just more
scale, more scalable in general.

00:14:06.299 --> 00:14:10.269
We've also added a few new configuration options.

00:14:10.269 --> 00:14:13.230
Package signing and encryption is now available.

00:14:13.230 --> 00:14:16.320
( Applause )

00:14:16.320 --> 00:14:21.840
This is actually in the Leopard
bill that you got here at WWDC.

00:14:21.840 --> 00:14:28.149
So you can actually test it today, well you can test
it today if you brought an Active Directory domain to,

00:14:28.149 --> 00:14:31.470
did anybody bring an Active Directory domain to test?

00:14:31.470 --> 00:14:32.240
I'm disappointed.

00:14:32.240 --> 00:14:33.110
( Laughter )

00:14:33.110 --> 00:14:34.250
All right.

00:14:34.250 --> 00:14:41.779
So, DS config AD, you can enable this
with package and packet encrypt options.

00:14:41.779 --> 00:14:45.259
They have three settings, allow, disable or require.

00:14:45.259 --> 00:14:47.379
So allow, the server allows it.

00:14:47.379 --> 00:14:49.240
Disable it or require it.

00:14:49.240 --> 00:14:54.080
And by default, these will be on and set to allow.

00:14:54.080 --> 00:14:57.000
( Period of silence )

00:14:57.000 --> 00:15:03.720
The second option that we are adding is the ability to
change your computer trust account password periodically.

00:15:03.720 --> 00:15:08.200
PCs do this with a group policy.

00:15:08.200 --> 00:15:14.600
We're not going to read group policy, we actually will set
an interval on the client using the pass interval option.

00:15:14.600 --> 00:15:20.840
But now if you have requirements for example from your
auditors to change your computer trust account password

00:15:20.840 --> 00:15:26.509
or you just want to be able to use the password last set
value of your, your computer accounts to tell whether

00:15:26.509 --> 00:15:30.689
or not its an old computer account
that's been sitting around for a while,

00:15:30.690 --> 00:15:34.650
now you'll be able to do that by setting this on the client.

00:15:34.649 --> 00:15:38.230
By default, this may not be enabled.

00:15:38.230 --> 00:15:39.560
You may have to enable it.

00:15:39.559 --> 00:15:44.789
It is currently not in the build that you have.

00:15:44.789 --> 00:15:53.000
The last option that we've added is an option
that we've added to solve a particular problem

00:15:53.000 --> 00:16:00.909
where you have a large forest and you have domains
which the policies for creating those users names

00:16:00.909 --> 00:16:04.089
in the various domains, you may have ended up with overlap.

00:16:04.090 --> 00:16:08.280
So you may have a J Smith in domain one.

00:16:08.279 --> 00:16:10.350
You may have a J Smith in domain two.

00:16:10.350 --> 00:16:14.110
And for Windows, this is no problem.

00:16:14.110 --> 00:16:18.930
Windows clients have to choose a domain name
before, before they can actually log in.

00:16:18.929 --> 00:16:25.309
For Mac though, we actually look at all the
various search nodes that you have configured.

00:16:25.309 --> 00:16:29.059
And so the short user name could be kind of confusing.

00:16:29.059 --> 00:16:32.269
Which J Smith are we talking about?

00:16:32.269 --> 00:16:39.340
The name space option will let you have your short user
names in the format of domain name backslash user name.

00:16:39.340 --> 00:16:49.230
And so now it will be pretty obvious when you turn
this on which domain you actually should be able

00:16:49.230 --> 00:16:51.029
to see the, oh there appears to be a typo here.

00:16:51.029 --> 00:16:52.789
There should be the user name on here as well.

00:16:52.789 --> 00:16:58.879
But you will be able to tell from
which domain J Smith is coming.

00:16:58.879 --> 00:17:02.100
( Applause )

00:17:02.100 --> 00:17:07.099
Finally, we have a new record type in Leopard.

00:17:07.099 --> 00:17:13.289
And the reason we have this new record type called
an augmented record, is to solve the problem

00:17:13.289 --> 00:17:17.139
of we have these great new services in Leopard.

00:17:17.140 --> 00:17:20.990
How many people are excited about
iCal Server and Wiki Server?

00:17:20.990 --> 00:17:26.819
I hear there was a really great session on this.

00:17:26.819 --> 00:17:33.509
( Applause )
You want to be able to provide these services to your
clients and you may be giving user accounts that are coming

00:17:33.509 --> 00:17:37.569
from some directory server that you don't have control over.

00:17:37.569 --> 00:17:43.869
Maybe it's your Active Directory server or you
Sun LDAP server, some other server that you,

00:17:43.869 --> 00:17:46.559
or directory I heard a plug for that up here.

00:17:46.559 --> 00:17:55.289
If you do not have right access to these it can be very
tricky to try to implement services that want to be able

00:17:55.289 --> 00:18:00.480
to read information and write information
to these user records.

00:18:00.480 --> 00:18:06.799
So a little solution that we came up with is a new
server configuration option called the workgroup

00:18:06.799 --> 00:18:08.609
server configuration.

00:18:08.609 --> 00:18:14.029
So if you've installed server already,
you probably have seen this screen.

00:18:15.210 --> 00:18:22.690
What this will actually do after you choose
this is it will ask you to import users.

00:18:22.690 --> 00:18:26.580
And so you'll see all the users in
the node that you have configured.

00:18:26.579 --> 00:18:33.319
What are you actually doing when you
import these users though is the question.

00:18:33.319 --> 00:18:37.079
Because it'll let you actually
go ahead and edit these users.

00:18:37.079 --> 00:18:43.809
You don't have write access to these LDAP
servers or these directory servers.

00:18:43.809 --> 00:18:52.099
What it's actually doing is sort of tagging the record from
this other directory service with the extra information

00:18:52.099 --> 00:18:59.409
that you want to be able to provide for your services and
then it will return this when something queries for it.

00:18:59.410 --> 00:19:02.870
One thing to keep in mind here, is
it can only add extra information.

00:19:02.869 --> 00:19:08.269
If there's information that's already coming from
this other directory server, you can't replace it.

00:19:08.269 --> 00:19:13.460
It's purely an extra piece of information that you add.

00:19:13.460 --> 00:19:19.600
So when you actually import these users, you're not creating
new users records, you're creating augmented records.

00:19:19.599 --> 00:19:22.209
So these will be stored in the augment container.

00:19:22.210 --> 00:19:28.610
And the records will be stored
as record type colon record name.

00:19:28.609 --> 00:19:33.519
So in the case of a user record,
it would be users colon user name.

00:19:33.519 --> 00:19:40.799
It does not have to be just for user accounts, but
at the moment that's the primary use for these.

00:19:40.799 --> 00:19:44.579
Just to look a little bit closer at how this works,

00:19:44.579 --> 00:19:51.829
let's say we have an Active Directory
server and we have your Leopard server.

00:19:51.829 --> 00:19:56.639
You've put a few users in your Leopard server,
but you want to be able to provide services

00:19:56.640 --> 00:19:59.130
to these users coming from Active Directory.

00:19:59.130 --> 00:20:08.430
So you use workgroup mode, you use server settings,
you import some of these users in the Leopard server.

00:20:08.430 --> 00:20:14.890
So what does this look like if you
actually try to query directory services?

00:20:14.890 --> 00:20:22.670
If you were to use DSCL or workgroup manager or something
where you could directly query a particular search node,

00:20:22.670 --> 00:20:28.580
or a particular node in directory services,
if you query the Active Directory node

00:20:28.579 --> 00:20:31.460
for a user named Nicole, it'll say here you go.

00:20:31.460 --> 00:20:34.220
Here's a Nicole user record.

00:20:34.220 --> 00:20:42.529
And in the same way if you directly query the LDAP node
for a user name Steve, you would get the Steve user record.

00:20:42.529 --> 00:20:52.690
But even though we've imported a user into
the Leopard server, if you search LDAP node

00:20:52.690 --> 00:20:56.130
for a user named Nicole, its going
to say there's no such user.

00:20:56.130 --> 00:20:59.620
Because there is no actual user record in the LDAP node.

00:20:59.619 --> 00:21:02.699
It's an augment record.

00:21:02.700 --> 00:21:07.950
Where the magic takes place is
because for most applications,

00:21:07.950 --> 00:21:11.970
most things that use directory
service, they use the search node.

00:21:11.970 --> 00:21:18.620
And the search node is smart enough that if you query
for Nicole, it will say oh, there's Nicole over here,

00:21:18.619 --> 00:21:25.139
then there's some extra information about this Nicole over
here and some extra information about Nicole over here.

00:21:25.140 --> 00:21:29.190
And it will actually give you both pieces of information.

00:21:30.210 --> 00:21:37.100
There will be more information on augmented records
and about other new things in Leopard in Open Directory

00:21:37.099 --> 00:21:40.899
in the Open Directory session that's Friday morning.

00:21:40.900 --> 00:21:43.750
I think it's the first session of the morning.

00:21:43.750 --> 00:21:49.250
So if you're interested in this,
I highly recommend that session.

00:21:49.250 --> 00:21:57.269
But this should give you something to think about in
terms of how you plan to deploy your Leopard servers

00:21:57.269 --> 00:22:04.509
for the services and the directory
servers that you need to use.

00:22:04.509 --> 00:22:08.519
( Period of silence )

00:22:08.519 --> 00:22:12.529
( Applause )

00:22:12.529 --> 00:22:15.180
Leopard's great.

00:22:15.180 --> 00:22:18.029
Leopard's got some really amazing stuff in it.

00:22:18.029 --> 00:22:18.889
But its not here yet.

00:22:18.890 --> 00:22:23.410
And we got a few months before it is.

00:22:23.410 --> 00:22:25.800
So we're going to switch tracks a little bit here.

00:22:25.799 --> 00:22:31.039
And we're going to talk about trouble shooting what
you've already got in front of you which is Tiger.

00:22:31.039 --> 00:22:39.009
And this is all information that will also
help you as you move forward to Leopard.

00:22:39.009 --> 00:22:42.879
And we're going to start looking at some
general directory services issues.

00:22:42.880 --> 00:22:46.950
And the way we're going to look at
this is we're going to look at three

00:22:46.950 --> 00:22:52.690
of the most commonly seen configuration
issues that we see with directory services.

00:22:52.690 --> 00:22:58.549
And the first one is issues with your search path.

00:23:00.099 --> 00:23:09.039
The symptoms that you might notice is that you set up
your client or your server to talk to a directory node

00:23:09.039 --> 00:23:16.019
and if you open up DSCL or you open up workgroup
manager, you see all your records, things look great.

00:23:16.019 --> 00:23:18.619
Unless you happen to check the search node.

00:23:18.619 --> 00:23:25.119
But then if you actually try and do anything with
these users such as add them to file permissions,

00:23:25.119 --> 00:23:31.239
look them up with the ID command, or just
have them try and authenticate, doesn't work.

00:23:31.240 --> 00:23:41.019
If you see symptoms like this, first thing to do is
just check your authentication tab in directory access.

00:23:41.019 --> 00:23:46.740
Most likely its just defaulted to
automatic and you need to set that.

00:23:46.740 --> 00:23:51.549
Now this is all great if you happen to
be sitting right in front of your machine

00:23:51.549 --> 00:23:54.220
or you've only got one machine to deal with.

00:23:54.220 --> 00:24:01.809
But if you got lots of clients out there and you can't
actually access your server by sitting right in front of it,

00:24:01.809 --> 00:24:07.019
you've got to SSH in, it's also pretty handy to know how
to get at this information from the command line.

00:24:07.019 --> 00:24:10.069
And you can use DSCL to do this.

00:24:10.069 --> 00:24:15.730
This information is in the CSP
Search path of the search node.

00:24:15.730 --> 00:24:22.230
If you look at the root of the search node, in
DSCL, there's an attribute called CSP Search path

00:24:22.230 --> 00:24:27.460
and it will list what you have in that authentication path.

00:24:27.460 --> 00:24:32.710
Now because you might have lots of clients out
there that maybe need a change made to them,

00:24:32.710 --> 00:24:37.670
you can also edit this information from the command line.

00:24:37.670 --> 00:24:47.789
And so you can use DSCL again to create the CSP search path
value for the search policy and then append any search nodes

00:24:47.789 --> 00:24:52.970
that need to be added to that search path.

00:24:52.970 --> 00:25:00.190
Also because order is important in terms of what order
directory services looks at your various search nodes,

00:25:00.190 --> 00:25:06.360
you can reorder the order that, so this would be
the equivalent of dragging them and dropping them

00:25:06.359 --> 00:25:12.529
in that authentication tab by using
the change I option in DSCL.

00:25:12.529 --> 00:25:16.799
Only thing to remember here is that
index zero is always your local node.

00:25:16.799 --> 00:25:18.149
You can't change that.

00:25:18.150 --> 00:25:23.450
So you are essentially working with indexes one and beyond.

00:25:23.450 --> 00:25:32.130
All these commands are in the sample notes, so if you're
furiously trying to take these down, relax a little bit.

00:25:32.130 --> 00:25:32.570
( Period of silence )

00:25:32.569 --> 00:25:38.220
The next issue we're going to look
at is the issue of slow queries.

00:25:38.220 --> 00:25:46.930
This can happen with any directory service node that
you might have whether it's a third party LDAP service,

00:25:46.930 --> 00:25:52.320
Active Directory plug-in, particularly if you're using
any custom mappings with your Active Directory server.

00:25:52.319 --> 00:25:59.789
But the symptoms that you would see are you get
slowed directory service queries on your Mac clients.

00:25:59.789 --> 00:26:01.649
And you'll also get slow log ins.

00:26:01.650 --> 00:26:07.710
And the more clients that you have doing the log
ins or doing the queries, the slower it gets.

00:26:07.710 --> 00:26:13.940
And then you'll also, from the server side
of things, see really high CPU utilization.

00:26:13.940 --> 00:26:20.500
And it'll spike or plateau depending on
how you have your clients hitting it.

00:26:20.500 --> 00:26:23.640
But you'll definitely notice something on the server side.

00:26:23.640 --> 00:26:29.140
The reason for this is probably because you're doing
a lot of queries on attributes that are not indexed.

00:26:29.140 --> 00:26:36.130
And for every query, the directory server has
to go and check every single record that it has.

00:26:36.130 --> 00:26:39.880
It's usually not real fast, especially
if you have a lot of records.

00:26:39.880 --> 00:26:45.720
So the three most important attributes
that you should make sure you have indexed

00:26:45.720 --> 00:26:53.549
in whatever directory server you have are whatever
you have mapped to unique ID, whatever you have mapped

00:26:53.549 --> 00:26:59.450
to primary group ID, and whatever
you have mapped to map address.

00:26:59.450 --> 00:27:04.230
How many people are using the Microsoft
R2 Active Directory schema?

00:27:04.230 --> 00:27:07.309
Anybody? A few.

00:27:07.309 --> 00:27:15.179
The R2 schema adds the Mac address attribute to the schema.

00:27:15.180 --> 00:27:21.150
So whereas before it didn't even exist in the schema,
so you couldn't really search on it, now its there.

00:27:21.150 --> 00:27:30.300
So if clients start querying on it and they will,
you will start seeing utilization on your 80 servers

00:27:30.299 --> 00:27:34.980
because it has to visit all these records.

00:27:34.980 --> 00:27:43.089
It's a simple fix, you just need to index this inactive
directory to check box in your schema manager snap in.

00:27:43.089 --> 00:27:51.019
And the last directory service issue we're going to
talk about is problems with mobile accounts.

00:27:51.019 --> 00:27:52.470
How many people use mobile accounts?

00:27:52.470 --> 00:27:59.100
One of the things that can happen when
you start having problems with log ins

00:27:59.099 --> 00:28:02.429
with mobile accounts is people sort of overreact.

00:28:02.430 --> 00:28:07.430
They'll start just reimaging the machine,
because that makes the problem go away.

00:28:07.430 --> 00:28:13.350
It does, it works, but there may be a simpler solution.

00:28:13.349 --> 00:28:17.969
And so this could be mobile accounts using any node.

00:28:17.970 --> 00:28:24.960
And the symptom would be you have a user
account that can't log into a particular client.

00:28:24.960 --> 00:28:31.860
But that user can log into other clients
and other users can log into that client.

00:28:31.859 --> 00:28:37.419
If you have a symptom like this, before
you go and blow the whole thing away,

00:28:37.420 --> 00:28:41.670
what you should is check cache account on that client.

00:28:41.670 --> 00:28:49.610
Look for the authentication authority
attribute and see what it's set to.

00:28:49.609 --> 00:28:51.129
( Period of silence )

00:28:51.130 --> 00:28:54.530
The highlighting unfortunately is wrong on this slide.

00:28:54.529 --> 00:28:56.649
Imagine it up a line.

00:28:56.650 --> 00:29:05.580
But what can happen if you set a user to be disabled,

00:29:05.579 --> 00:29:10.449
that will get you the disabled user
value in authentication authority.

00:29:10.450 --> 00:29:18.450
Or there's a problem in the process of caching the
account, for security reasons, its set to disabled user

00:29:18.450 --> 00:29:25.380
to prevent some unknown bad thing from happening.

00:29:25.380 --> 00:29:32.290
So if you look at a cache record, you see
disabled user, just delete the cache record.

00:29:32.289 --> 00:29:34.059
It won't affect the home directory.

00:29:34.059 --> 00:29:34.980
The user can log in.

00:29:34.980 --> 00:29:37.759
It'll recache the record and things will be fine.

00:29:37.759 --> 00:29:40.579
It's a lot easier than reimaging the whole machine.

00:29:40.579 --> 00:29:41.159
( Period of silence )

00:29:41.160 --> 00:29:52.410
So finally we're going to switch over to talking
very specifically about the 80 plug-in.

00:29:52.410 --> 00:29:56.880
Which is good because I saw there were an awful
lot of hands in here for Active Directory.

00:29:56.880 --> 00:30:05.340
And again we're going to look at three of most common
Active Directory configuration issues that we see.

00:30:05.339 --> 00:30:09.019
And the first one relates to binding.

00:30:09.019 --> 00:30:17.730
Binding is something that if you're using the
Active Directory plug-in, you've all done it,

00:30:17.730 --> 00:30:25.579
and I've actually chosen to ignore a lot of the
failures that there's four steps before step five.

00:30:25.579 --> 00:30:31.379
We're not going to talk about those because for the
majority of those, there was a really simple answer.

00:30:31.380 --> 00:30:32.210
Fix your DNS.

00:30:32.210 --> 00:30:32.690
( Laughter )

00:30:32.690 --> 00:30:41.309
And I did, I did a preso last year and I have these
slides with bright red, I, they wouldn't make,

00:30:41.309 --> 00:30:45.970
let me make them blink or anything,
but they said fix your DNS.

00:30:45.970 --> 00:30:51.210
And interestingly as time has gone
on, people have fixed their DNS.

00:30:51.210 --> 00:30:56.809
And honestly, we don't see as many of
those kind of problems come in anymore.

00:30:56.809 --> 00:31:06.819
So one of the remaining binding issues that we see is
where the binding sort of seems to stall at step five.

00:31:08.119 --> 00:31:14.799
When binding is having a problem, first thing
to do is turn on directory service debugging.

00:31:14.799 --> 00:31:21.460
And to do that, you're going to send the USR1 signal to
directory service, use the kill all command to do this.

00:31:21.460 --> 00:31:25.350
It's way less fatal than it sounds.

00:31:25.349 --> 00:31:33.869
If you wanted to have directory services, just turn on all
the time, you can just create a file dot DS log at start.

00:31:33.869 --> 00:31:36.619
Put it in library preferences directory service.

00:31:36.619 --> 00:31:43.439
And then every time that directory service is restarted,
it will automatically turn on directory service debugging.

00:31:43.440 --> 00:31:49.519
The logging for this goes to library logs directory
service, directory service dot debug dot log.

00:31:49.519 --> 00:31:52.809
And if you are getting that failure at step five,

00:31:52.809 --> 00:31:57.849
if you were to look at a debug log,
you would see something like this.

00:31:57.849 --> 00:32:06.969
See, the AD plug-in trying to change the password for that
computer account that its creating over and over again,

00:32:06.970 --> 00:32:10.160
until finally it'll come back and say that it failed.

00:32:11.250 --> 00:32:14.039
So why, why would this be happening?

00:32:14.039 --> 00:32:19.299
We need a little bit more background information here.

00:32:19.299 --> 00:32:25.750
When it is doing this step, it's using the
K password protocol to change the password.

00:32:25.750 --> 00:32:30.039
And in Tiger, K password is strictly over UDP.

00:32:30.039 --> 00:32:38.750
In Leopard, you'll be able to do it over TCP
and Windows clients can use both TCP and UDP.

00:32:38.750 --> 00:32:45.400
But for Tiger, it's strictly UDP and
this is part of what can lead to cases

00:32:45.400 --> 00:32:49.519
where you say, well the Windows clients can still bind.

00:32:49.519 --> 00:32:51.920
The Windows clients are using different
protocol essentially.

00:32:51.920 --> 00:32:55.310
So how do you fix this?

00:32:55.309 --> 00:33:03.230
Well, one of the first things to check
is make sure that the port is open.

00:33:03.230 --> 00:33:07.930
K password over UDP uses port 464 UDP.

00:33:07.930 --> 00:33:12.340
So make sure that there's not a firewall
between your client and your server.

00:33:12.339 --> 00:33:14.959
And that that port is open.

00:33:14.960 --> 00:33:24.079
This is something that often goes unnoticed because
the Windows clients don't necessarily use that port.

00:33:24.079 --> 00:33:30.720
The second thing can be that if you have an admin account
that you're using to do debind to Active Directory

00:33:30.720 --> 00:33:35.410
and that user's in a lot of groups, they
accumulate a lot of curb rows pack data.

00:33:35.410 --> 00:33:39.340
And that all gets put in the curb rows packet.

00:33:39.339 --> 00:33:42.379
Eventually this gets too big for UDP.

00:33:42.380 --> 00:33:44.630
And then it fails.

00:33:44.630 --> 00:33:51.490
So in that case, just use a different admin account.

00:33:51.490 --> 00:33:55.120
Something that's in less groups.

00:33:56.349 --> 00:34:03.939
A third reason that this happens, and this actually
happens fairly often is that you have a domain controller

00:34:03.940 --> 00:34:10.880
or two somewhere in your Active Directory
domain or forest and it's on multiple networks.

00:34:10.880 --> 00:34:20.119
Maybe on your regular network, but it's also on maybe a
private network for your SAN or a private backup network.

00:34:20.119 --> 00:34:23.940
And those addresses are not routable
to the rest of the world.

00:34:23.940 --> 00:34:27.159
So because it's UDP, we just keep sending.

00:34:27.159 --> 00:34:29.569
We don't know if the packet ever got there or not.

00:34:29.570 --> 00:34:32.550
We just keep trying and we never hear back from the server.

00:34:32.550 --> 00:34:41.940
We don't really have any way of telling if the address that
we got from DNS, if there's two addresses for a server,

00:34:41.940 --> 00:34:44.889
we don't know which ones the better address.

00:34:44.889 --> 00:34:53.299
So make sure that what you have registered in DNS
for domain controller is only the IP addresses

00:34:53.300 --> 00:34:56.390
that are actually accessible to the rest of the world.

00:34:56.389 --> 00:35:08.440
So to fix that, well, the part that got grayed out
here, there's a check box in the network settings

00:35:08.440 --> 00:35:13.309
for your Windows computers and this
would be on your domain controllers.

00:35:13.309 --> 00:35:17.549
There's a check box for whether or not you
should register that connection in DNS.

00:35:17.550 --> 00:35:22.850
Disable that on any connections to private networks.

00:35:22.849 --> 00:35:28.969
And finally as sort of a catch all, you might just have some
network setting somewhere either on your client on a switch

00:35:28.969 --> 00:35:32.879
or router somewhere that might
be interfering with UDP traffic.

00:35:32.880 --> 00:35:36.440
So fix it.

00:35:36.440 --> 00:35:42.820
Sorry. It's hard to get more specific than that.

00:35:42.820 --> 00:35:49.710
The next issue that we're going to talk about which
is one that we hear about a lot which is issues

00:35:49.710 --> 00:35:56.190
with authenticating SMB clients to an OS X
servers that's bound to Active Directory.

00:35:56.190 --> 00:36:05.900
So this could be an OS X server providing SMB
services to windows clients, Linux clients,

00:36:05.900 --> 00:36:10.880
Mac clients, anything that wants to do SMB.

00:36:10.880 --> 00:36:21.500
And as a symptom, any Active Directory user that
tries to log in over SMB can't authenticate.

00:36:21.500 --> 00:36:28.110
But if you have users that are in for example the
local node or any other directory service node

00:36:28.110 --> 00:36:33.010
of the OS X server, they can authenticate just fine to SMB.

00:36:33.010 --> 00:36:37.710
And also you're connection back to active
directory appears to be working fine

00:36:37.710 --> 00:36:39.949
You can see users and everything else.

00:36:39.949 --> 00:36:45.289
And those Active Directory users are able to
authenticate to other services on the same server.

00:36:45.289 --> 00:36:46.429
They can use ASP.

00:36:46.429 --> 00:36:51.259
They can use FTP, whatever other
services you might be providing.

00:36:51.260 --> 00:36:58.610
The first thing you want to check is what kinds of
authentication are actually working and which kinds are not.

00:36:58.610 --> 00:37:05.110
And to do that, use the dirt tool,
which stands for directory tool.

00:37:05.110 --> 00:37:10.390
You can test two types of authentication here.

00:37:10.389 --> 00:37:14.029
Standard authentication, you just need
to provide a user name and password.

00:37:14.030 --> 00:37:18.450
It'll tell you the authentication succeed or fail.

00:37:18.449 --> 00:37:22.909
You can also force it to specially test
MTL authentication which is the type

00:37:22.909 --> 00:37:26.219
of authentication that SMB clients are going to use.

00:37:26.219 --> 00:37:33.119
And for that, specify the user name and the password
and to force it to do NTLM, use the dash ANT option.

00:37:33.119 --> 00:37:42.539
So if you find that standard authentication
is working fine, NTLM authentication is not,

00:37:42.539 --> 00:37:47.550
you need to figure out do you fix
the NTLM authentication part.

00:37:47.550 --> 00:37:55.510
And this is actually a fairly complex configuration.

00:37:55.510 --> 00:37:59.190
So I'm going to give you a little check
list for what you need to check.

00:37:59.190 --> 00:38:02.720
And also by the way, I've put all this in the notes for you.

00:38:02.719 --> 00:38:04.339
( Applause )
You're welcome.

00:38:04.340 --> 00:38:08.960
( Applause )

00:38:08.960 --> 00:38:14.539
First thing, after you bind your server,
run DS config AD dash enable SSO.

00:38:14.539 --> 00:38:21.940
That's going to set up all of your services including
SMB to do authentication back to Active Directory.

00:38:21.940 --> 00:38:24.409
It's going to set up the service principles for them.

00:38:24.409 --> 00:38:30.690
In the case of SMB, it's also going
to edit your SMB dot com file.

00:38:30.690 --> 00:38:37.349
Now you should probably still check this by
hand anyway, especially if it's not working.

00:38:37.349 --> 00:38:39.569
And so files in FC, SMB dot com.

00:38:39.570 --> 00:38:43.960
And there's five options in there that you need to look at.

00:38:43.960 --> 00:38:49.280
The first one, make sure that your
workgroup is set to the net bios name

00:38:49.280 --> 00:38:53.510
of your Active Directory domain that you're bound to.

00:38:53.510 --> 00:39:01.790
The second one, make sure that security is set
to ADS, which stands for Active Directory server.

00:39:01.789 --> 00:39:08.389
Some people will say well you could also use domain here.

00:39:08.389 --> 00:39:09.699
Don't do that.

00:39:09.699 --> 00:39:15.149
What happens if you use the domain setting,
is that periodically someone will go,

00:39:15.150 --> 00:39:21.349
try to change the machine trust account password, kind
of forget to tell the Active Directory plug-in about it

00:39:21.349 --> 00:39:27.019
and then all the sudden your machine
account password is busted.

00:39:27.019 --> 00:39:28.909
And nothing will work on your server.

00:39:28.909 --> 00:39:30.529
So don't use domain here.

00:39:30.530 --> 00:39:33.570
Make sure you have it set to ADS.

00:39:33.570 --> 00:39:42.850
The third option, make sure that net bios name is set
to BOG, or is set to the computer account that you used

00:39:42.849 --> 00:39:49.690
when you bound to Active Directory in directory
access or directory utility for Leopard.

00:39:49.690 --> 00:39:54.470
This is actually specifying the computer
account that you created when you bound.

00:39:54.469 --> 00:40:00.269
If you use a different name here, its going to be looking
for a different computer account that's not going to exist

00:40:00.269 --> 00:40:02.570
and that's not going to have a password for.

00:40:02.570 --> 00:40:07.630
You want to have use spnego set to yes.

00:40:07.630 --> 00:40:11.750
This is going to enable negotiation
of your authentication protocols.

00:40:11.750 --> 00:40:12.440
That's a good thing.

00:40:12.440 --> 00:40:21.269
And finally you need to have realm set to
be the name of your Active Directory domain,

00:40:21.269 --> 00:40:25.480
the Kerberos domain which will match
the name of your Active Directory domain.

00:40:25.480 --> 00:40:32.210
And this does need to be in all
caps, Kerberos is case sensitive.

00:40:32.210 --> 00:40:38.949
If all this checks out, the next thing to take
a look at is make sure that win bind is running.

00:40:38.949 --> 00:40:46.079
Win bind in the process that directory services uses
to proxy authentication back to Active Directory.

00:40:46.079 --> 00:40:49.369
If it's not running, authentication is not going to work.

00:40:49.369 --> 00:40:54.139
So you should actually have two Win bind processes running.

00:40:54.139 --> 00:40:58.739
If you do not see these running, you can start it manually.

00:40:58.739 --> 00:41:04.639
You just need to supply the location of
the Win bind configuration file to Win bind

00:41:04.639 --> 00:41:10.079
and that is currently located library
preferences directory service Win bind dot com.

00:41:10.079 --> 00:41:13.449
That may change, that location may change for Leopard.

00:41:13.449 --> 00:41:15.779
That's where it is for Tiger.

00:41:15.780 --> 00:41:17.310
You'll get two processes.

00:41:17.309 --> 00:41:18.449
You only need to start one.

00:41:18.449 --> 00:41:21.389
It will start the other one for you.

00:41:23.289 --> 00:41:32.550
If that all checks out, the last piece that you need to
check is to make sure that both the Active Directory plug-in

00:41:32.550 --> 00:41:38.289
and samba are using the same password
for your machine account.

00:41:38.289 --> 00:41:43.750
If these two get out of synch, it's not going to work.

00:41:43.750 --> 00:41:53.019
And since everything seems to be working except Samba,
we can assume that the 80 plug-in has the right password.

00:41:53.019 --> 00:41:58.869
So let's figure out how you can
tell whether or not Samba does.

00:41:58.869 --> 00:42:02.730
So first we're going to get the machine account
password from the Active Directory plug-in.

00:42:02.730 --> 00:42:09.130
To do that, look in the Active Directory P list file
that's in library preferences directory service.

00:42:09.130 --> 00:42:13.920
There's a key called AD computer password.

00:42:13.920 --> 00:42:16.559
The data field looks just like gibberish.

00:42:16.559 --> 00:42:22.519
It's actually a base 64 encoded version of the password.

00:42:22.519 --> 00:42:27.230
So use your favorite base 64 decoder to decode that.

00:42:27.230 --> 00:42:29.449
I know you all have a favorite base 64 decoder

00:42:29.449 --> 00:42:37.129
I personally happen to like using the open SSL
command line tool, but use your favorite one.

00:42:37.130 --> 00:42:41.030
Also keep in mind you do need to
be root to access this file.

00:42:41.030 --> 00:42:44.600
So now that you know what the Active Directory

00:42:44.599 --> 00:42:50.210
you know what the correct password is,
let's look at what samba thinks it is.

00:42:50.210 --> 00:42:55.559
To find that out, you need to look at
the contents of the secrets database.

00:42:55.559 --> 00:43:03.650
And that's in VAR DB samba secret stack TDB, use the
TDB dump tool to actually dump the contents of that.

00:43:03.650 --> 00:43:06.420
You will need to be root to do that.

00:43:06.420 --> 00:43:12.730
You should see a key called secrets machine
password and then the name of your domain.

00:43:12.730 --> 00:43:21.710
The data field here will actually be the
plain text computer account password.

00:43:21.710 --> 00:43:24.970
So hopefully it matches what you got from AD.

00:43:24.969 --> 00:43:27.989
But if things aren't working, more than likely it doesn't.

00:43:27.989 --> 00:43:31.699
And by the way it will still look kind of like gibberish.

00:43:31.699 --> 00:43:33.469
It's just a randomly generated password.

00:43:33.469 --> 00:43:39.459
So if they don't match, you need to reset
the password that samba has for this.

00:43:39.460 --> 00:43:43.599
And to do that you're going to use the net command.

00:43:43.599 --> 00:43:47.960
Use dash F to force it and the option is change secret PW.

00:43:47.960 --> 00:43:51.480
It will prompt you for a password.

00:43:51.480 --> 00:44:04.920
Use the password, the plain text password after you
base 64 decoded it that you got from the AD plug-in.

00:44:04.920 --> 00:44:05.070
( Period of silence )

00:44:05.070 --> 00:44:08.760
This is on, this will be all on your Tiger server.

00:44:08.760 --> 00:44:09.370
( Period of silence )

00:44:09.369 --> 00:44:22.569
The last AD specific problem that we're going to look
at is problems where you are using Active Directory

00:44:22.570 --> 00:44:30.510
for your directory services but you're providing home
directories to some of these users from an OS X server.

00:44:30.510 --> 00:44:34.440
How many people have a set up kind of like this?

00:44:34.440 --> 00:44:35.309
( Period of silence )

00:44:35.309 --> 00:44:38.809
A few, okay.

00:44:38.809 --> 00:44:44.860
The configuration that we're talking about
here is you have Active Directory back here.

00:44:44.860 --> 00:44:52.120
You've actually configured your user account records
to point to storage that's on your OS X server.

00:44:52.119 --> 00:44:59.130
And you're providing file services to Macs,
PCs, any clients that you want to use.

00:44:59.130 --> 00:45:04.340
And also important to his configuration is
that you actually have the storage located

00:45:04.340 --> 00:45:07.500
on some volume that's not your boot volume.

00:45:07.500 --> 00:45:11.349
So it could be external RAID storage,
it can be just a second hard drive.

00:45:11.349 --> 00:45:12.650
Could be anything.

00:45:12.650 --> 00:45:15.280
That's not on your boot volume.

00:45:16.530 --> 00:45:19.410
And what you'll notice as symptoms is that you'll notice

00:45:19.409 --> 00:45:24.069
that clients may not be able to
auto mount their home directories.

00:45:24.070 --> 00:45:30.860
Or if you go into workgroup manager, you say create home
now or you use the create home dir command line tool,

00:45:30.860 --> 00:45:34.329
they don't get, the home directories
don't get created on your OS X server.

00:45:34.329 --> 00:45:40.639
Or, you'll notice they get created someplace
other than where you intended them to be.

00:45:40.639 --> 00:45:44.650
Also you may notice you're virtual home shares may not work

00:45:44.650 --> 00:45:48.250
which are the special share points
that are named for the user.

00:45:48.250 --> 00:45:52.170
They can connect to instead of
the share points you've defined.

00:45:52.170 --> 00:46:01.340
And in the worse case, you may see that AFP log ins
may just fail all together after authentications.

00:46:01.340 --> 00:46:08.950
So the reason behind this has to do with how we translate
the home directory path coming from Active Directory

00:46:08.949 --> 00:46:16.179
When you put this in Active Directory, you put
in a regular Windows file path type of strain,

00:46:16.179 --> 00:46:21.699
something like backslash backslash server
backslash share backslash user name.

00:46:21.699 --> 00:46:29.289
That doesn't really make a whole lot of sense to in that
client, so the AD plug-in translates that into something

00:46:29.289 --> 00:46:37.320
that looks like network servers then the fully qualified
name of the server and then the share and the user name.

00:46:37.320 --> 00:46:43.230
This is your typical auto mounted home directory path.

00:46:43.230 --> 00:46:43.780
That's great.

00:46:43.780 --> 00:46:46.760
It looks like it should work.

00:46:46.760 --> 00:46:54.750
Except that in reality, if you have these home
directories on a volume that's not your boot volume,

00:46:54.750 --> 00:47:05.500
the real file system path looks very similar
except it has volume slash volume name in the path.

00:47:05.500 --> 00:47:10.389
So to get around this, because you
can't really tell the AD plug-in whether

00:47:10.389 --> 00:47:15.329
or not a given home directory is,
should go through slash volumes or not.

00:47:15.329 --> 00:47:24.349
The way to get around this is actually to provide a link
in the file system itself so that it can traverse the root

00:47:24.349 --> 00:47:28.389
and get to the share points without
having to go through slash volumes.

00:47:28.389 --> 00:47:33.569
So you just create a symbolic link at
the root, use the LN dash S command.

00:47:33.570 --> 00:47:44.500
And once you have this, you'll actually be able to get
from network server server name share home directory

00:47:44.500 --> 00:47:47.559
without having to use the slash volumes path.

00:47:47.559 --> 00:47:52.659
And now the value that the AD plug
in has calculated will be correct.

00:47:52.659 --> 00:47:57.199
( Period of silence )

00:47:57.199 --> 00:48:04.259
So wrapping up, things that you need
to take with you about Leopard are

00:48:04.260 --> 00:48:07.690
that you've got some new utilities to replace the old ones.

00:48:07.690 --> 00:48:14.269
We've got a new local node so there'll
be some things there that you may need

00:48:14.269 --> 00:48:16.699
to adjust how you trouble shot things in the past.

00:48:16.699 --> 00:48:19.589
Your script workflows that you may have existing.

00:48:19.590 --> 00:48:23.150
You may need to take a look at
those, make sure that you don't need

00:48:23.150 --> 00:48:27.940
to change them, update them to use the new utilities.

00:48:27.940 --> 00:48:32.840
You've got some new Active Directory plug-in
configuration options which may affect how you plan

00:48:32.840 --> 00:48:35.380
to deploy Leopard with the AD plug-in in the future.

00:48:35.380 --> 00:48:44.300
And for providing Leopard services you'll need
to think about what the best configuration is

00:48:44.300 --> 00:48:47.230
for your particular directory service set up, whether

00:48:47.230 --> 00:48:52.050
or not you use another directory server
or a Leopard Open Directory server.

00:48:52.050 --> 00:48:58.510
And whether or not you should be using the
standard work group or advanced type configuration.

00:48:58.510 --> 00:49:05.360
Remember that the workgroup configuration is the
one that gives you the magic augmented records.

00:49:05.360 --> 00:49:13.360
And finally for troubleshooting, make sure
you check your authentication search paths,

00:49:13.360 --> 00:49:17.970
index any attributes that you know
are going to get queried commonly.

00:49:17.969 --> 00:49:24.699
If you have problems with either log ins or things
that just aren't working the way they should,

00:49:24.699 --> 00:49:30.329
just verify with DSCL that the information
in the records is what you expect it to be.

00:49:30.329 --> 00:49:38.799
And finally if you're doing NTML authentication
from an OS X server, take a look at the checklist

00:49:38.800 --> 00:49:43.170
of the various different parts of the
configuration that you need to have in place

00:49:43.170 --> 00:49:46.789
and make sure that those are all correct.

00:49:46.789 --> 00:49:52.179
For more information, we have Mark as a contact here.

00:49:52.179 --> 00:49:58.000
And as I said if you log in to the attendees site, you
can find the notes that I've attached to the session.

00:49:58.000 --> 00:50:00.820
Hopefully they should be helpful to you.

00:50:00.820 --> 00:50:05.960
There's also some other notes that
are about directory services

00:50:05.960 --> 00:50:08.730
like the directory services reference and stuff like that.

00:50:08.730 --> 00:50:09.889
That you may also find useful.