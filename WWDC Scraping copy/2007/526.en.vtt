WEBVTT

00:00:13.169 --> 00:00:14.619
>> My name is Armin Briegel.

00:00:14.619 --> 00:00:19.539
I'm a Server Consulting Engineer for Apple Education.

00:00:19.539 --> 00:00:24.379
And today we're going to talk about
network home directories.

00:00:24.379 --> 00:00:30.359
This is one of the sessions where we talk
about stuff that's current today in Tiger.

00:00:30.359 --> 00:00:33.409
So stuff you might take it home right away.

00:00:33.409 --> 00:00:40.099
But we also have lots of nice new good stuff in
Leopard, which you can look forward to in October.

00:00:41.369 --> 00:00:45.000
So first, a few things that we're all on the same page.

00:00:45.000 --> 00:00:47.840
Why would I even want to do network home directories?

00:00:47.840 --> 00:00:55.150
And the most common reason, obviously, is to centralize
the data, to get the data off the client machines,

00:00:55.149 --> 00:01:00.329
so that people can maybe move between machines,
very common education scenarios where we have labs.

00:01:00.329 --> 00:01:04.890
But in some businesses, they can switch
between machines depending on the application.

00:01:04.890 --> 00:01:09.469
If you set it up right, you can even access
the data from different operating systems.

00:01:09.469 --> 00:01:11.909
You can log into UNIX and have your home available.

00:01:11.909 --> 00:01:16.959
You can have the same data available
on Mac OS X or even Windows.

00:01:16.959 --> 00:01:23.359
And centralizing the data, getting it, everything into
one spot also makes the back-up plan much simpler.

00:01:23.359 --> 00:01:28.359
Most back-up companies charge by volume and client amounts.

00:01:28.359 --> 00:01:33.049
And I hope nobody's in the room here, but you can
save a lot of money by reducing the client licenses

00:01:33.049 --> 00:01:38.060
because you're only backing up a handful of servers
instead of hundreds and hundreds of client machines.

00:01:38.060 --> 00:01:40.290
So that helps a lot as well.

00:01:45.349 --> 00:01:47.209
Is there a range for this thing?

00:01:47.209 --> 00:01:50.469
There we go.

00:01:50.469 --> 00:01:55.269
Also, once I've moved the data onto the server
it exists independent of the client hardware.

00:01:55.269 --> 00:02:00.590
And especially nowadays, everybody here has a laptop
open, everybody everywhere has a laptop because we want

00:02:00.590 --> 00:02:06.880
to move the data everywhere, want to be in Starbucks,
want to work in the airport when we're traveling.

00:02:06.879 --> 00:02:12.849
That mobility has a risk because the data might
get lost because the laptop might get lost, stolen,

00:02:12.849 --> 00:02:15.169
breaks easier because it moves all the time.

00:02:15.169 --> 00:02:22.209
We have all this fancy stuff like the MagSafe adapter
and sudden motion sensors but still they move a lot.

00:02:22.210 --> 00:02:27.379
So if I have my data on the server
that's a much safer place.

00:02:27.379 --> 00:02:28.680
I have raids.

00:02:28.680 --> 00:02:29.629
I have large redundancy.

00:02:29.629 --> 00:02:32.250
The room is locked.

00:02:32.250 --> 00:02:34.030
Simplifies hardware upgrades.

00:02:34.030 --> 00:02:37.650
I don't have to worry about the user
data because it's on the server.

00:02:37.650 --> 00:02:41.330
I can just reimage the machine if something goes wrong.

00:02:41.330 --> 00:02:46.150
It shouldn't be your first choice of action
but at least it makes it much easier.

00:02:46.150 --> 00:02:50.789
And for some system admins it's
the backdoor where you can get

00:02:50.789 --> 00:02:54.959
to introduce client management even
though the users might not like it.

00:02:54.960 --> 00:02:57.650
Because you need client management
for network home directories.

00:02:57.650 --> 00:03:03.260
And you can tell them all the benefits just
don't mention the client management part.

00:03:05.969 --> 00:03:10.419
There's five different approaches on
how to handle the home directories.

00:03:10.419 --> 00:03:13.559
Well, there's four in Tiger and one is new in Leopard.

00:03:13.560 --> 00:03:19.920
The first one is local home directories, which is basically
no network home directories, but that's an approach.

00:03:19.919 --> 00:03:23.000
Then there's guests or generic accounts.

00:03:23.000 --> 00:03:28.560
The real true network home directories and
then we have portable home directories,

00:03:28.560 --> 00:03:33.000
sometimes they're called mobile accounts
depending on where you look in the documentation.

00:03:33.000 --> 00:03:37.860
And external accounts, which are new in Leopard.

00:03:37.860 --> 00:03:42.280
I will be mentioning a lot of services and servers.

00:03:42.280 --> 00:03:46.590
Three, three parts are essential
for network home directories.

00:03:46.590 --> 00:03:52.500
I usually need some kind of directory services,
essential directory where all my user data is stored.

00:03:52.500 --> 00:03:58.180
I probably will be referring to Open
Directory a lot because that's what I use.

00:03:58.180 --> 00:03:59.170
That's what I sell.

00:03:59.169 --> 00:04:00.299
I'm with Apple.

00:04:00.300 --> 00:04:03.210
But it could basically be any directory server.

00:04:03.210 --> 00:04:07.500
Because the Open Directory framework, and I'm
referring you to the Open Directory sessions there,

00:04:07.500 --> 00:04:11.120
will basically work with anything that talks LDAP.

00:04:11.120 --> 00:04:13.730
You need a file server or a home server.

00:04:13.729 --> 00:04:17.089
Again, I will be referring to Xserve and Mac OS X a lot.

00:04:17.089 --> 00:04:24.599
But basically we work with anything that serves
Samba, NFS or AFP and then the client machine,

00:04:24.600 --> 00:04:29.410
which definitely has to be a Mac for today because
we're talking about home directories on a Mac.

00:04:29.410 --> 00:04:32.320
And the client machine has some
kind of means to authenticate

00:04:32.319 --> 00:04:36.300
against the directory servers and
then mounts the home directory.

00:04:37.720 --> 00:04:43.030
So just briefly, this is what a lot of people
are doing as their home directory strategy.

00:04:43.029 --> 00:04:44.649
We have local home directories.

00:04:44.649 --> 00:04:46.370
I log in locally.

00:04:46.370 --> 00:04:51.230
My data is locally on one machine because that's my machine.

00:04:51.230 --> 00:04:54.210
And that isn't a bad approach depending
on what you want to do.

00:04:54.209 --> 00:04:57.519
I don't want to diss you too much on this.

00:04:57.519 --> 00:05:04.089
The system might actually still be linked to a directory
service and I can still use central authentication

00:05:04.089 --> 00:05:08.000
and get the user information off the
network but the user is stored locally.

00:05:08.000 --> 00:05:12.420
And usually there's some way the user
mounts the network share, moves tiles back

00:05:12.420 --> 00:05:14.370
and forth, then I have my central storage.

00:05:14.370 --> 00:05:16.889
And there's some user training involved.

00:05:16.889 --> 00:05:18.300
How do I mount that?

00:05:18.300 --> 00:05:19.920
Do I automate that?

00:05:19.920 --> 00:05:25.069
There's some nice ways in Workgroup Manager
to automate the mounting of the user share

00:05:25.069 --> 00:05:27.839
and then whatever is on the server is safe.

00:05:27.839 --> 00:05:30.500
What's on your machine isn't.

00:05:32.589 --> 00:05:35.469
And Active Directory actually made that kind of visible.

00:05:35.470 --> 00:05:40.380
There's this option which is called for
false local home directory and start-up disk.

00:05:40.379 --> 00:05:45.909
So even though the user information comes out of the Active
Directory, the home directory is local and the user might

00:05:45.910 --> 00:05:49.330
or might not get to link in the doc to his network share.

00:05:49.329 --> 00:05:52.129
And there's ways of doing that in Open Directory.

00:05:55.290 --> 00:06:01.500
Generic Account is a similar approach, probably
one step backward depending on how you look at it.

00:06:01.500 --> 00:06:03.879
Very common in labs.

00:06:03.879 --> 00:06:08.420
You have one student account and
a password that's known to all.

00:06:08.420 --> 00:06:13.400
If you're really fancy the password gets cycled
every month but usually it's just something generic.

00:06:13.399 --> 00:06:18.649
It used to be apple apple for Apple's
demo machines but that's a few years ago

00:06:18.649 --> 00:06:23.979
so I thought it would be safe if I put it up here.

00:06:23.980 --> 00:06:25.780
This has a lot of disadvantages.

00:06:25.779 --> 00:06:28.509
All users share the same data in the home directory.

00:06:28.509 --> 00:06:32.310
They might, I might be able to see
what the guy in front of me did.

00:06:32.310 --> 00:06:36.550
Go into the Safari history might be interesting.

00:06:36.550 --> 00:06:39.829
But the main advantage is its simple.

00:06:39.829 --> 00:06:43.569
I just put two or three accounts
on it when I make the machine,

00:06:43.569 --> 00:06:47.399
and I just blast out using net restore, net install.

00:06:47.399 --> 00:06:48.439
It's really simple to manage.

00:06:48.439 --> 00:06:50.589
I don't really have to worry about that.

00:06:50.589 --> 00:06:54.129
Obviously it's a huge security hole.

00:06:54.129 --> 00:06:58.659
Not only might anybody log in and do
stuff I can't really track who did what.

00:06:58.660 --> 00:07:02.870
I might be able to track what machine
did what but that's about it.

00:07:04.430 --> 00:07:10.600
So there's some improvements to that and the main
and obvious one is the self cleaning user account

00:07:10.600 --> 00:07:14.480
and it's obviously to avoid the unintended data sharing.

00:07:14.480 --> 00:07:18.050
You have to put something like these three lines.

00:07:18.050 --> 00:07:18.910
I just put the stub.

00:07:18.910 --> 00:07:21.160
I thought this was the developer's conference.

00:07:21.160 --> 00:07:23.370
You can write your own scripts.

00:07:23.370 --> 00:07:29.209
But I put the main information here and
you have to remove the home directory

00:07:29.209 --> 00:07:31.629
and restore it from some kind of template.

00:07:31.629 --> 00:07:38.810
You can use the standard template that's in the
system library or prepare your own standard template

00:07:38.810 --> 00:07:43.060
with maybe some special things
on the desktop or some notices.

00:07:43.060 --> 00:07:46.680
And leave that, put that into a log in hook.

00:07:46.680 --> 00:07:50.250
One hint is go to Mike Bombich's website.

00:07:50.250 --> 00:07:54.269
He has the entire explanation how to do this.

00:07:54.269 --> 00:07:57.699
We've simplified this a lot in Leopard
because we kind of made it official.

00:07:57.699 --> 00:08:01.269
In Leopard we now have the option of guest accounts.

00:08:01.269 --> 00:08:05.949
And a guest is a special user on the
operating system that actually has no password.

00:08:05.949 --> 00:08:09.069
So then you have to remember the password.

00:08:09.069 --> 00:08:14.709
And basically the guest account will
be wiped every time the user logs out.

00:08:14.709 --> 00:08:18.979
So that's a feature you can enable and work with manager.

00:08:18.980 --> 00:08:21.300
You don't have to worry about it anymore.

00:08:23.430 --> 00:08:26.160
So the real network home directories.

00:08:26.160 --> 00:08:30.660
To enable network home directories
we have to have an automount record.

00:08:30.660 --> 00:08:33.610
It stays the same from Tiger to Leopard.

00:08:33.610 --> 00:08:35.350
We still have to generate the automount record.

00:08:35.350 --> 00:08:41.310
It moved from Workgroup Manager into server admin,
in case you're looking for it on the developer seed.

00:08:41.309 --> 00:08:46.209
Most people forget to create the automount
record, everything else set up, Open Directory,

00:08:46.210 --> 00:08:52.930
but they didn't create the automount entry for the user's
directory and then network home directories won't work.

00:08:52.929 --> 00:09:01.319
If you're using a system other than Open Directory
or an Xserve you have to create that manually.

00:09:02.399 --> 00:09:07.169
Then you get the option in Workgroup Manager
under the home tab where the home directory

00:09:07.169 --> 00:09:12.039
of the user actually lives and you can log in.

00:09:12.039 --> 00:09:14.179
We introduced something new and
that was a big deal last year.

00:09:14.179 --> 00:09:19.079
I remember being at the session where they introduced
they were moving away from automount to auto FS.

00:09:19.080 --> 00:09:22.759
And now I'm standing up here saying use automount.

00:09:22.759 --> 00:09:25.169
We have both in Leopard.

00:09:25.169 --> 00:09:29.809
We have to keep automount for backwards compatibility.

00:09:29.809 --> 00:09:32.289
There was a question in the earlier session where,

00:09:32.289 --> 00:09:36.469
how's the support if I have Tiger clients
with Leopard server or vice versa?

00:09:36.470 --> 00:09:39.250
We need to remain, keep automount around for that.

00:09:39.250 --> 00:09:41.929
We still generate the same automount records.

00:09:41.929 --> 00:09:48.599
So if you have entirely Leopard deployment with
our Leopard clients you could move to auto FS

00:09:48.600 --> 00:09:52.720
if you have a non-Apple deployment
with some other operating systems

00:09:52.720 --> 00:09:57.580
and are already using auto FS,
that's definitely the way to go.

00:09:57.580 --> 00:09:59.440
If you have a mixed environment with Panther

00:09:59.440 --> 00:10:05.070
or Tiger clients then automount is
still there and is still the default.

00:10:06.620 --> 00:10:11.009
Automount is especially troublesome if
you have a large number of automounts.

00:10:11.009 --> 00:10:16.069
Large number being more than 12,
depends on the usage pattern.

00:10:16.070 --> 00:10:21.170
So be careful in what you, just don't go
crazy and create lots of automount records.

00:10:21.169 --> 00:10:28.179
And for NFS our recommendation, the best
practice seems to be to not use automount

00:10:28.179 --> 00:10:32.219
but to somehow mount the NFS share using a start-up script.

00:10:32.220 --> 00:10:34.360
That works much better.

00:10:37.690 --> 00:10:42.320
The templates for the user, they
live in the system library folder.

00:10:42.320 --> 00:10:47.800
They actually quite well down, they're in system library
user templates, and this is the one exception to the rule

00:10:47.799 --> 00:10:51.479
that you should never modify anything in the system folder.

00:10:51.480 --> 00:10:54.170
You're supposed to modify the user templates in this folder.

00:10:54.169 --> 00:11:01.849
There's a lot of folders in this user templates
folder and they follow the usual localization process.

00:11:01.850 --> 00:11:10.790
So most people will probably want to modify the English
dot LPROJ folder in this user templates folder.

00:11:10.789 --> 00:11:16.659
It depends on the language of the
admin who set up the machine.

00:11:16.659 --> 00:11:25.360
So if you set it up in German or Japanese then you
have to modify the Japanese or Deutsch dot LPROJ.

00:11:25.360 --> 00:11:30.800
Once you've created your template the template will
be used to create the home folder either very lazily,

00:11:30.799 --> 00:11:35.159
as soon as the user logs in for the first time,
and the server notices there's no home folder

00:11:35.159 --> 00:11:38.110
at the spot where it's expecting it to be.

00:11:38.110 --> 00:11:41.169
You can force that in server admin
using the create home now button.

00:11:41.169 --> 00:11:44.299
Or there's a command line tool
if you want to mass create those.

00:11:44.299 --> 00:11:46.059
Look at the create home dir tool.

00:11:46.059 --> 00:11:52.039
It's very easy to create home dir dash A,
will create all folders that aren't existing yet.

00:11:52.039 --> 00:11:54.759
Or you can use it specifically for a user.

00:11:56.259 --> 00:11:58.929
We have three protocols as choice.

00:11:58.929 --> 00:12:02.259
Generally for file serving you can use NFS, AFP or SMB.

00:12:02.259 --> 00:12:07.059
You can also use each of those for home directories.

00:12:07.059 --> 00:12:12.649
We only support Samba for home directories in
conjunction with the Active Directory plug-in.

00:12:14.529 --> 00:12:18.029
NFS, one of the pros is Kerberos.

00:12:18.029 --> 00:12:23.360
At least with Leopard we get Kerberized as NFS,
which makes it really nice and easy to use.

00:12:23.360 --> 00:12:24.970
You get authentication over NFS.

00:12:24.970 --> 00:12:27.120
And it's easily provided.

00:12:27.120 --> 00:12:29.259
NFS is probably the most common denominator,

00:12:29.259 --> 00:12:36.330
especially in education environments there's always some
Linux machines standing somewhere serving NFS home shares.

00:12:36.330 --> 00:12:44.800
The nice thing about NFS is it allows for fast
user switching between several network home users.

00:12:44.799 --> 00:12:50.439
We can't do that with AFP or SMB because we
can only keep one authenticated AFP connection

00:12:50.440 --> 00:12:53.310
to the user share at the same time.

00:12:53.309 --> 00:12:57.139
So I can have local users and one
network home user with one AFP.

00:12:57.139 --> 00:13:03.000
With NFS I can switch between multiple
users with fast user switching.

00:13:04.629 --> 00:13:08.389
Disadvantages of NFS, extended attributes, must be emulated.

00:13:08.389 --> 00:13:13.779
You get the dot underscore files on the NFS, which
might be ugly if you use it for different Unix systems.

00:13:13.779 --> 00:13:16.259
The case sends it to file system.

00:13:16.259 --> 00:13:20.189
Most applications are Ok with that but not everyone.

00:13:20.190 --> 00:13:23.390
So test your applications.

00:13:23.389 --> 00:13:28.840
And obviously NFS, there's some security
considerations because it's before Leopard

00:13:28.840 --> 00:13:33.370
with coberus NFS, it's not an authenticated file system.

00:13:33.370 --> 00:13:37.889
If you have NFS running you're probably beyond that.

00:13:37.889 --> 00:13:43.720
If these are native default, obviously
we have the full HFS plus feature support,

00:13:43.720 --> 00:13:46.050
resource forks and extended attributes will just work.

00:13:46.049 --> 00:13:49.539
It's Kerberized in Tiger and
Leopard, which is really nice.

00:13:49.539 --> 00:13:52.000
It's a good user experience and also very secure.

00:13:52.000 --> 00:13:56.500
It can be easily served from Mac servers, obviously.

00:13:56.500 --> 00:13:59.970
Windows servers usually have good AFP support.

00:13:59.970 --> 00:14:06.970
Not all of the features are on most Windows servers,
depending on which solution you use to add AFP to Windows

00:14:06.970 --> 00:14:11.100
It's probably the best performance you can get.

00:14:11.100 --> 00:14:18.320
And AFP supports auto reconnect so if the client goes to
sleep, wakes back up there's certain protocols it does

00:14:18.320 --> 00:14:24.320
to try to reconnect, try to find
the server, rebuild the connection.

00:14:24.320 --> 00:14:31.460
Again, the mobile laptops, they move around,
change their networks, they will try to reconnect.

00:14:31.460 --> 00:14:40.610
Disadvantages of Mac OS X is scalability of Mac OS
X could be improved, will be improved in Leopard.

00:14:40.610 --> 00:14:48.550
If you're working on Tiger AFP is probably not
something you might introduce into a non-Apple network,

00:14:48.549 --> 00:14:52.139
might want to use one of the other solutions there.

00:14:52.139 --> 00:14:54.250
SMB is Kerberized as well.

00:14:54.250 --> 00:14:57.539
It is also easily served for Mac, Windows and Linux servers.

00:14:57.539 --> 00:14:59.659
SMB is really common on Linux as well.

00:14:59.659 --> 00:15:04.879
Also gives you a good perform, not
quite as good as AFP but very close.

00:15:04.879 --> 00:15:12.259
With Leopard we will gain auto reconnect support for SMB
so same features as in, or similar features as in Tiger.

00:15:12.259 --> 00:15:14.620
With Tiger we don't have that yet.

00:15:14.620 --> 00:15:19.610
And it is probably the most friendly solution
if you're in a Window centric environment.

00:15:21.149 --> 00:15:25.220
With Tiger you might run into problems,
not everything is as nice.

00:15:25.220 --> 00:15:30.810
I think with ten, for nine and ten we
probably have most of the issues out.

00:15:30.809 --> 00:15:33.229
And it is only supported if you use the AD plug-in.

00:15:33.230 --> 00:15:38.769
So if you want to use some other
directory system in SMB it will work

00:15:38.769 --> 00:15:43.259
but don't come running to me or AppleCare for any support.

00:15:43.259 --> 00:15:50.769
The extended attributes have to be emulated on Windows
but then again you could probably use ACL's and Windows

00:15:50.769 --> 00:15:55.620
if you wanted to use that resource forks,
again, will generate dot nsco files.

00:15:57.659 --> 00:16:00.049
The thing with the network home directory is great.

00:16:00.049 --> 00:16:05.120
I log in, everything I do in Mac OS X goes into
my home directory because that's the one place

00:16:05.120 --> 00:16:07.710
where the operating system knows that I have privileges.

00:16:07.710 --> 00:16:09.629
I can write into that.

00:16:09.629 --> 00:16:13.689
So I write everything into there including the caches.

00:16:13.690 --> 00:16:16.550
That's not something you want to
send over the network back and forth.

00:16:16.549 --> 00:16:21.919
Safari uses caches so then can use the
local fast disk and not use the network

00:16:21.919 --> 00:16:24.199
and then I'm sending it over the network again.

00:16:24.200 --> 00:16:27.780
The local network might be faster but
it's not really something you want to do.

00:16:27.779 --> 00:16:30.829
So you can redirect those folders.

00:16:30.830 --> 00:16:33.940
I'm doing this with the example of the caches folder.

00:16:33.940 --> 00:16:37.880
You could basically pick any folder you want.

00:16:37.879 --> 00:16:44.309
Theoretically it should be Ok if you did this once but
just to be safe we usually put it in a log in hook.

00:16:44.309 --> 00:16:50.119
You delete the caches folder or back it up, rename
it and then replace it with a symbolic link.

00:16:50.120 --> 00:16:56.490
We usually put the actual caches folder
direct symbolic link into the temp folder.

00:16:56.490 --> 00:17:01.310
Temp folder obviously has the advantage
of being cleaned at restart.

00:17:01.309 --> 00:17:03.869
So you don't really have to worry about that.

00:17:03.870 --> 00:17:11.099
But you could put it elsewhere if you were worried about
that if you wanted manual or wanted to keep it around.

00:17:11.099 --> 00:17:14.039
You could do this with other folders as well.

00:17:15.349 --> 00:17:19.439
There's some challenges with network home
directories especially over wireless.

00:17:19.440 --> 00:17:27.390
Imagine a mobile card, 25 laptops, one Airport base station
and you have 25 students logging in at the same time

00:17:27.390 --> 00:17:32.050
over Airport B. That's obviously a challenge.

00:17:32.049 --> 00:17:36.589
Yeah, the log in takes about five to ten minutes.

00:17:36.589 --> 00:17:36.889
Yes.

00:17:36.890 --> 00:17:37.710
( Laughs )

00:17:37.710 --> 00:17:42.460
And one of the Airport base stations
freaks out, doesn't want to do anything.

00:17:42.460 --> 00:17:47.470
Then we have to log in again, the machines might
freeze because the network share just disappeared.

00:17:47.470 --> 00:17:54.390
Or even if it doesn't freeze we'll get the spinning
wheel because it waits for the server to come back.

00:17:54.390 --> 00:17:57.610
We have a reconnection in Tiger for AFP.

00:17:57.609 --> 00:17:59.229
We'll get it for SMB and Leopard.

00:17:59.230 --> 00:18:02.289
NFS will just freak out.

00:18:02.289 --> 00:18:05.789
You will get time-outs over a slow network.

00:18:05.789 --> 00:18:07.930
Again, the mobility thing.

00:18:07.930 --> 00:18:11.650
What if I want to take my laptop home,
on the road, what would sales people

00:18:11.650 --> 00:18:16.680
or teachers want to work everywhere, at Starbucks?

00:18:16.680 --> 00:18:18.810
So that's why we introduced portable home directories.

00:18:18.809 --> 00:18:24.529
They were introduced in Tiger, which is two years
ago and they've served us really, really well.

00:18:24.529 --> 00:18:27.269
Depending where you look they may be called mobile accounts.

00:18:27.269 --> 00:18:33.200
There's a probably a slight different, mobile accounts
are just synchronizing the user account information.

00:18:33.200 --> 00:18:40.360
Portable home directories is everything but not
everybody really makes much of a difference.

00:18:40.359 --> 00:18:41.779
And you turn it on in Workgroup Manager.

00:18:41.779 --> 00:18:46.220
This is a snapshot from Leopard
where you have a few more features.

00:18:46.220 --> 00:18:49.700
So when the user logs in he gets a prompt or not.

00:18:49.700 --> 00:18:51.779
You can suppress that if you want to as the admin.

00:18:51.779 --> 00:18:55.000
Do you want to create a local home directory?

00:18:55.000 --> 00:19:01.210
And if you suppress that but want to create the dialogue
for some reason, hold down the option key at log in.

00:19:01.210 --> 00:19:04.100
As usual that reverts all your settings.

00:19:04.099 --> 00:19:10.889
Then the user's account information is copied from the
directory service into the local directory service,

00:19:10.890 --> 00:19:16.880
net info on Tiger, the local database
on Leopard and then it will copy more.

00:19:16.880 --> 00:19:26.780
In Tiger it will actually try to gather all the groups,
all the groups into the local database, which might be fun.

00:19:26.779 --> 00:19:29.079
So take care of that.

00:19:29.079 --> 00:19:32.939
In Leopard it'll be a little smarter and it'll
only gather the groups that the user belongs

00:19:32.940 --> 00:19:39.799
to into the local directory service because
those are probably those that I might need.

00:19:39.799 --> 00:19:43.339
And then the home directory synchronize
between the client and the server.

00:19:43.339 --> 00:19:51.299
So basically on the first try it is copied downwards toward
the client according to the sync rules that you set up.

00:19:51.299 --> 00:19:53.659
So this is the dialogue of the sync rules.

00:19:53.660 --> 00:20:01.120
You can set folders and wild cards and
individual files that are synchronized.

00:20:01.119 --> 00:20:04.939
You can exclude folders and files that aren't synchronized.

00:20:04.940 --> 00:20:10.690
And Mac OS X server comes with a list
of stuff that you probably want to do

00:20:10.690 --> 00:20:14.799
and that you certainly shouldn't do
and these are the defaults in Leopard.

00:20:14.799 --> 00:20:18.779
They're a little extended over what we have in Tiger.

00:20:18.779 --> 00:20:23.700
And you can set synchronization rules
for log in and log out, they're the same.

00:20:23.700 --> 00:20:27.680
And they're probably more specific.

00:20:27.680 --> 00:20:29.900
The one thing that comes to mind is the library folder.

00:20:29.900 --> 00:20:31.190
That's just up here.

00:20:31.190 --> 00:20:37.870
We can't synchronize the library folder in the
background because there's dozens and hundreds of files

00:20:37.869 --> 00:20:42.969
in the library folder that will probably
be open while the user is logged in.

00:20:42.970 --> 00:20:45.589
So we don't synchronize that in the background.

00:20:45.589 --> 00:20:49.990
So we want to synchronize it at log in.

00:20:49.990 --> 00:20:56.829
And then there's a background sync
which will happen at certain intervals

00:20:56.829 --> 00:20:59.059
in the background while the user is working.

00:20:59.059 --> 00:21:02.970
You can add inclusion and exclusion rules.

00:21:02.970 --> 00:21:09.319
So one of the best practices after two
years of doing this that we've sorted out is

00:21:09.319 --> 00:21:13.419
if you have a wonderful big Xserve RAID
or you're going to buy one, please,

00:21:13.420 --> 00:21:16.740
( Laughs )
You can synchronize everything.

00:21:16.740 --> 00:21:17.200
That's great.

00:21:17.200 --> 00:21:22.670
The users will be happy and your Apple salesperson
will be happy and you can keep just buying storage.

00:21:22.670 --> 00:21:28.900
But if you want to somewhat control that the best approach
probably is to synchronize the desktop because, honestly,

00:21:28.900 --> 00:21:32.900
everybody stores everything on the desktop,
nobody goes to the documents folder.

00:21:32.900 --> 00:21:37.269
And even if you try to teach them
to and the documents folder,

00:21:37.269 --> 00:21:42.309
because that is sometimes the default,
sometimes things end up in there.

00:21:42.309 --> 00:21:48.409
If you're concerned about storage you probably don't want
to synchronize the movies, pictures and music folder.

00:21:48.410 --> 00:21:53.019
We don't want everybody's iTunes library
and photo library on the server.

00:21:53.019 --> 00:21:55.660
But if you do that, tell them so.

00:21:55.660 --> 00:22:01.130
They will be very unhappy if they use their iPhotos
and weren't aware that it wasn't synchronized.

00:22:01.130 --> 00:22:04.290
It's really easy to write a small Automator applet.

00:22:04.289 --> 00:22:10.200
Go visit the Automator session which says take the
movies, picture and music folder and burn it onto DVD.

00:22:10.200 --> 00:22:12.759
Hand that out, they will be happy.

00:22:12.759 --> 00:22:17.329
But just teach your, train your users to what you are doing.

00:22:17.329 --> 00:22:19.769
You can't put wild cards in the synchronization rules.

00:22:19.769 --> 00:22:26.879
And everybody says, Oh, that's great, because eventually the
users will figure out that they can move the iTunes library

00:22:26.880 --> 00:22:31.030
and put it in the documents folder and
then it ends up on the server again and,

00:22:31.029 --> 00:22:32.769
and so you as the admin say, This is great.

00:22:32.769 --> 00:22:39.339
I'll just exclude star dot mp3 and
m4a and all the other flavors of audio

00:22:39.339 --> 00:22:44.059
that are out there and things like startup mauve.

00:22:44.059 --> 00:22:51.440
It might work for awhile but think about applications
such as Keynote or iMovie or OmniGraffle or all the others

00:22:51.440 --> 00:22:56.559
that don't have binary files as their
documents but they're actually packages

00:22:56.559 --> 00:22:59.849
and in the package folder you can find all the resources.

00:22:59.849 --> 00:23:06.609
So if somebody adds a dot mauve file to the
presentation it won't be synchronized to the server.

00:23:06.609 --> 00:23:10.659
The Keynote will be synchronized
but not the one movie in there.

00:23:10.660 --> 00:23:18.400
And when we have to synchronize back and forth and move
to another machine the Keynote file will be broken.

00:23:18.400 --> 00:23:25.860
So it's very...Be very careful with generic
wild card inclusions and exclusions.

00:23:29.000 --> 00:23:35.460
It's kind of paradoxical and you have to think about
for awhile but especially in classroom environments

00:23:35.460 --> 00:23:41.759
where I have a really good rhythm, every hour lots
of students log in or wake their machines from sleep

00:23:41.759 --> 00:23:49.529
and then they close it after 45 minutes and
move somewhere else, shorter background cycles,

00:23:49.529 --> 00:23:53.629
background synchronization cycles will
actually lessen the load on the server.

00:23:53.630 --> 00:23:58.940
You will get this background noise of trickle
synchronizations and because it was only four

00:23:58.940 --> 00:24:03.730
or five minutes since last synchronization
nothing much will be moved back and forth.

00:24:03.730 --> 00:24:10.210
If I set that to an hour or two I will get huge peaks on
the server because everybody turns it on at the same time.

00:24:10.210 --> 00:24:16.500
If you're in a business environment where it's more spread
out when people log in and log out you'll probably do fine

00:24:16.500 --> 00:24:21.369
with longer cycles but it really
depends on how we deploy that.

00:24:21.369 --> 00:24:28.319
And, then again, train the users, tell them what you are
doing so they know what gets synchronized and what doesn't.

00:24:28.319 --> 00:24:31.149
There's a few extra sync defaults.

00:24:31.150 --> 00:24:34.890
Sometimes it happens if users move between machines.

00:24:34.890 --> 00:24:41.400
And you can actually have multiple mobile accounts on
different machines and move back and forth in between them

00:24:41.400 --> 00:24:46.680
and if you take care to log out before you leave one
machine you will actually get the most recent data

00:24:46.680 --> 00:24:47.640
on the next machine.

00:24:47.640 --> 00:24:49.470
That works quite well.

00:24:49.470 --> 00:24:55.759
But if you logged in at the same time with two machines
or you didn't really do the log out synchronization

00:24:55.759 --> 00:25:00.009
because you just slept the machine, you
will get conflicts and dialogue pops up

00:25:00.009 --> 00:25:02.819
and it will show this two files conflict.

00:25:02.819 --> 00:25:06.950
Do you want to keep the one on the server or the local one?

00:25:06.950 --> 00:25:08.650
Some users will be challenged by this.

00:25:08.650 --> 00:25:10.150
They will be, What do I do now?

00:25:10.150 --> 00:25:13.160
So you can set default rules.

00:25:13.160 --> 00:25:16.230
How do I resolve a log in conflict?

00:25:16.230 --> 00:25:20.599
And you have two choices, the server
always wins or the home always wins.

00:25:21.789 --> 00:25:27.069
And how do I resolve the background or
the periodic synchronization conflict?

00:25:27.069 --> 00:25:28.599
And then we have a third choice.

00:25:28.599 --> 00:25:31.769
We can show a conflict dialogue that's the default.

00:25:31.769 --> 00:25:33.400
You can set it back to that.

00:25:33.400 --> 00:25:37.540
So if you have users where you want
to, In a real one to one environment

00:25:37.539 --> 00:25:45.740
where most users use one machine all the time setting it to
the local machine always wins, is probably a good choice.

00:25:47.500 --> 00:25:49.660
Or you can suppress the errors entirely.

00:25:49.660 --> 00:25:51.230
This isn't the conflicts.

00:25:51.230 --> 00:25:56.809
Sometimes things can't be synchronized
usually because it's some weird dot FS temp.

00:25:56.809 --> 00:25:57.679
Anybody ever seen that?

00:25:57.680 --> 00:25:59.150
They appear sometimes.

00:25:59.150 --> 00:26:05.370
You should exclude those generally,
exclude dot FS temp star helps a lot.

00:26:05.369 --> 00:26:12.329
Sometimes locked files or some privileges will keep the
machine from synchronizing, then an error will pop up.

00:26:12.329 --> 00:26:18.210
If you want to suppress those don't stress
the user, This is how you can suppress those.

00:26:18.210 --> 00:26:24.220
If you're having issues with the entire
synchronization process the usual things apply.

00:26:24.220 --> 00:26:28.329
Check DNS, check Open Directory, check the file server.

00:26:28.329 --> 00:26:34.929
If you think it's the synchronization process
you can and able the synchronization debugging

00:26:34.930 --> 00:26:42.000
with the following command, zero is the
default, which is very minimal logging.

00:26:42.000 --> 00:26:46.990
The mirror agent will log to this log
what, when it starts and when it stopped

00:26:46.990 --> 00:26:50.569
and some errors, but one to four is increasing detail.

00:26:50.569 --> 00:26:53.349
Probably want to start it too.

00:26:53.349 --> 00:27:03.649
And probably want to combine that with directory service
debugging because usually that's the cause of most evils.

00:27:05.329 --> 00:27:12.819
But the one thing with PHDs especially in a very
mobile environment where people move around from machine

00:27:12.819 --> 00:27:16.879
to machine is, I leave a home directory everywhere I log in.

00:27:16.880 --> 00:27:20.220
We call that the rabbit droppings problem.

00:27:20.220 --> 00:27:20.980
( Laughter )

00:27:20.980 --> 00:27:25.240
Depending how large your home directories
are that might be a problem or not.

00:27:25.240 --> 00:27:26.849
There's two solutions to this.

00:27:26.849 --> 00:27:36.389
One is devise some kind of strategy that one person
gets more or less the same machine all the time,

00:27:36.390 --> 00:27:41.660
seating arrangement in education,
sometimes that's not possible.

00:27:41.660 --> 00:27:45.750
And well, you can just go in and
manually delete the user's account.

00:27:45.750 --> 00:27:50.740
Go into the accounts pane, the user will pop up
there as a mobile user, you can just delete it

00:27:50.740 --> 00:27:53.079
and it will be restored the next time the user logs in.

00:27:53.079 --> 00:27:54.269
That's very easy.

00:27:54.269 --> 00:27:56.379
You want to script that.

00:27:56.380 --> 00:28:00.800
Remove the home directory and remove the user information,

00:28:00.799 --> 00:28:05.079
the directory using DS scale because
nickel will go away in Leopard.

00:28:05.079 --> 00:28:12.789
Yes! So you could script that and either run
it as a launched job or blast it out with ARD

00:28:12.789 --> 00:28:16.369
or make it part of your update cycle or whatever.

00:28:16.369 --> 00:28:21.849
Well applet has added something really nice to that
and we have expiring portable home directories.

00:28:21.849 --> 00:28:25.269
And I put up the dialogue for that.

00:28:25.269 --> 00:28:31.289
And basically you can set a certain amount of days and if
the user hasn't logged in in the last five days, ten days,

00:28:31.289 --> 00:28:40.210
120 days, whatever, the system will delete the portable
home directory and the user account to free up space.

00:28:40.210 --> 00:28:40.940
This is really nice.

00:28:40.940 --> 00:28:51.130
If you set this to zero it will delete the portable home
account at log out, which seems kind of counterproductive

00:28:51.130 --> 00:28:58.210
but if you use applications like Final Cut Studio
or iMovie, which are really disk intensive,

00:28:58.210 --> 00:29:03.049
you don't want to work over the network you want
to work locally and then this kind of makes sense.

00:29:03.049 --> 00:29:07.519
It would be nice if you could keep
it a little longer but it works.

00:29:09.960 --> 00:29:16.980
External accounts are also new in Leopard and they're
an extension to the portable home directory idea.

00:29:16.980 --> 00:29:23.420
And basically it is a portable home directory but
the user folder is stored on an external hard drive,

00:29:23.420 --> 00:29:30.430
probably one that can be removed easily such
as a USB or FireWire drive or a USB key.

00:29:30.430 --> 00:29:36.570
And if I take that key and go to a different machine,
which is connected to the same Open Directory server,

00:29:36.569 --> 00:29:42.929
the user will pop up as an account on the
user list, the machine has cross referenced

00:29:42.930 --> 00:29:46.299
with the Open Directory server whether it's
actually Ok that the user can log in there.

00:29:46.299 --> 00:29:51.909
And then I can log in and work
on my USB key or my USB drive.

00:29:51.910 --> 00:29:55.529
This is another solution for not filling up
the local hard drives with all the user data

00:29:55.529 --> 00:30:00.099
because the user has it in his or her pocket.

00:30:00.099 --> 00:30:01.179
So this is really new in Leopard.

00:30:01.180 --> 00:30:04.500
We haven't really tested this but
I'm kind of excited about this.

00:30:04.500 --> 00:30:05.940
( Laughter )

00:30:05.940 --> 00:30:11.370
We've tested it in Leopard obviously but we
haven't tested it in any large field employment.

00:30:11.369 --> 00:30:14.819
I'm kind of curious how people are going to use this.

00:30:14.819 --> 00:30:15.929
So, Oh, wait.

00:30:15.930 --> 00:30:21.960
This brings me to the demo.

00:30:21.960 --> 00:30:25.269
So here we are in Workgroup Manager
and when using Workgroup Manager,

00:30:25.269 --> 00:30:29.359
I don't know if you noticed, is
that we added one tab up here.

00:30:29.359 --> 00:30:32.069
We can now manage preferences.

00:30:32.069 --> 00:30:36.529
We've always been able to do it on the
user, the groups and a computer list level.

00:30:36.529 --> 00:30:40.190
We've now added one more level,
which is individual computers.

00:30:40.190 --> 00:30:44.450
I don't think that will be used
a lot but it will be interesting.

00:30:44.450 --> 00:30:47.009
Right now I'm working on the computer level.

00:30:47.009 --> 00:30:51.420
Mobile home directories are something you
want to manage on a computer list level

00:30:51.420 --> 00:30:54.509
or a computer level because it's pretty hardware bound.

00:30:54.509 --> 00:30:58.680
The classroom with the iMacs which are tethered

00:30:58.680 --> 00:31:02.840
to the network probably don't want
to use portable home directories.

00:31:02.839 --> 00:31:05.970
The mobile computers you probably want to do.

00:31:05.970 --> 00:31:09.940
You can turn on this setting on the user level as well.

00:31:09.940 --> 00:31:16.330
I can have a group of users or an individual user who can
use portable home directories but then the dialogue will pop

00:31:16.329 --> 00:31:22.639
up every time he or she logs in
anywhere, which might be annoying.

00:31:22.640 --> 00:31:35.730
So first of all in the, in the log in panel I have the
choice, And this has been available in Tiger up here.

00:31:35.730 --> 00:31:42.650
This will show me a nice green blob at the log in
window, which will show me that my network server

00:31:42.650 --> 00:31:45.470
and my Open Directory server is actually available.

00:31:45.470 --> 00:31:50.390
It was a default command hidden in Tiger and
it's now in the graphical interface in Leopard.

00:31:50.390 --> 00:31:51.420
They're kind of like that.

00:31:51.420 --> 00:31:58.860
Directory status is probably the most useful but
you could display other kinds of information there,

00:31:58.859 --> 00:32:02.490
which you might find or the user might find interesting.

00:32:02.490 --> 00:32:07.849
Then under the options tab in Leopard,
down here I get the option

00:32:07.849 --> 00:32:11.569
of enabling external accounts and
enabling the guest accounts.

00:32:11.569 --> 00:32:16.829
And this is for a computer list or
for a certain piece of hardware.

00:32:16.829 --> 00:32:31.460
And then I can go into the mobility part and, I have
to select my - So here it says the user will be prompted

00:32:31.460 --> 00:32:36.829
to create a mobile account and it will
require confirmation, will show the dialogue.

00:32:36.829 --> 00:32:42.789
I can even disable the functionality that the
user says don't ask me again, because then,

00:32:42.789 --> 00:32:46.190
obviously, the dialogue won't ever pop up again.

00:32:46.190 --> 00:32:52.160
And I can, either I can preset the sync settings, I guess
that's the most common, but I can also leave the choice

00:32:52.160 --> 00:32:56.150
to the user what gets synchronized and what doesn't.

00:32:57.529 --> 00:33:00.509
Firewall, did it mention that in the slides?

00:33:00.509 --> 00:33:05.000
Firewall doesn't really work well with
portable home directories in Tiger.

00:33:05.000 --> 00:33:09.319
We now support it and you can enable
it in Workgroup Manager with Leopard.

00:33:09.319 --> 00:33:17.740
( Applause )
And if you use Firewall you can restrict
the size of the user home directory

00:33:17.740 --> 00:33:21.490
in conjunction with quotas on the server.

00:33:21.490 --> 00:33:24.279
So that's a really nice solution.

00:33:24.279 --> 00:33:27.410
And down here I can set the home folder location.

00:33:27.410 --> 00:33:29.980
So by default it should be the startup volume.

00:33:29.980 --> 00:33:37.880
If I want to use external accounts I can give the user
the choice and move it to an internal or external volume

00:33:37.880 --> 00:33:40.400
or I can preset the path on where it belongs too.

00:33:40.400 --> 00:33:48.280
So if I have partitioned all of my machines I can
set the home directory to be on a certain partition.

00:33:49.319 --> 00:33:56.849
And here is the account expiry and that's
when the mobile accounts get deleted.

00:33:56.849 --> 00:34:03.279
Now if you set this once and you set it to always and
it's been pushed out to several machines and then later

00:34:03.279 --> 00:34:09.139
on you say, well, portable home directories, I don't
want it in that classroom anymore and set it to never,

00:34:09.139 --> 00:34:14.940
all the portable mobile users that already
exist on that machine won't magically go away.

00:34:14.940 --> 00:34:18.300
They will stay on that machine and they will
continue to work as portable home accounts.

00:34:18.300 --> 00:34:27.140
So you will, in addition to disabling in Workgroup Manager,
you will have to remove the accounts in the local machines,

00:34:27.139 --> 00:34:29.579
otherwise they will just remain portable home directories.

00:34:29.579 --> 00:34:36.489
And if you just switch it to never in here the preferences
on the machines actually won't be affected because all

00:34:36.489 --> 00:34:41.669
that you changed is I switched
it from enforcing that preference

00:34:41.670 --> 00:34:45.000
to the Open Directory doesn't really
worry what happens there.

00:34:45.000 --> 00:34:47.579
So it remains the setting on the client.

00:34:47.579 --> 00:34:54.599
If you want to disable it on the machine you have to keep
this on always and actually go in and disable it here.

00:34:54.599 --> 00:34:58.799
That way you are really disabling part of home directories.

00:34:58.800 --> 00:35:01.230
That leads to some confusion.

00:35:01.230 --> 00:35:03.510
Can I go back to the slides?

00:35:03.510 --> 00:35:09.040
( Silence )

00:35:09.039 --> 00:35:15.119
One thing that really supports network home directories,
portable home directories, any kind, is group folders

00:35:15.119 --> 00:35:17.819
and it's been built into Mac OS X for awhile.

00:35:17.820 --> 00:35:21.600
But I know that several admins aren't really aware of that.

00:35:21.599 --> 00:35:27.279
Group folders are home directories for groups
and I can set them in the Workgroup Manager UI

00:35:27.280 --> 00:35:35.070
and I can also have an option of saying provide
links to all of these groups in the doc.

00:35:35.070 --> 00:35:42.019
So all of the groups that a user belongs to, when he or
she logs in, a link to them will be provided in the doc.

00:35:42.019 --> 00:35:44.920
They won't be mounted automatically.

00:35:44.920 --> 00:35:50.329
I will just get the link and as soon as you click
on the folder it will actually do the mounting.

00:35:50.329 --> 00:35:52.829
And this is really great for Workgroup Manager.

00:35:52.829 --> 00:35:57.059
In Leopard we have the new directory
app so the users, if you allow them to,

00:35:57.059 --> 00:36:00.650
can actually create ad hoc workgroups by themselves

00:36:00.650 --> 00:36:06.050
and then they will get their own group
folder and then can share the workflow.

00:36:06.050 --> 00:36:12.380
Some things like drop boxes might be a little
challenging in a group environment so use ACL's.

00:36:12.380 --> 00:36:18.460
There was a session today, if you missed it you
can go see it on the videos when they come out.

00:36:18.460 --> 00:36:25.230
Use ACL's for really good permission control
here otherwise you will get confused users.

00:36:25.230 --> 00:36:30.969
And in a large deployment you want a
dedicated server for the group folders.

00:36:33.190 --> 00:36:42.389
So one of the questions I get a lot is I have 700
users I want to provide network home directories,

00:36:42.389 --> 00:36:45.059
portable home directories, group folders.

00:36:45.059 --> 00:36:46.269
How much servers do I need?

00:36:46.269 --> 00:36:47.719
How do I scale that?

00:36:47.719 --> 00:36:51.869
And over the past years we have built some rules of thumb.

00:36:51.869 --> 00:36:56.809
But before I show them, these are
very conservative estimates.

00:36:56.809 --> 00:37:02.000
These heavily depend on the actual
user profile that you have.

00:37:02.000 --> 00:37:04.440
Are you doing Final Cut Studio?

00:37:04.440 --> 00:37:07.110
Are you doing just Word and Excel?

00:37:07.110 --> 00:37:11.940
Nothing against Word and Excel but the files
are much, much smaller than Final Cut Studio.

00:37:11.940 --> 00:37:13.940
That will obviously impact your server.

00:37:13.940 --> 00:37:19.429
How often does a user log in, once a week, every day?

00:37:19.429 --> 00:37:25.609
So these are conservative but they are very good
and they have served as well as rules of thumb.

00:37:25.610 --> 00:37:30.940
So first of all I need an Open Directory
unless there's a directory server present.

00:37:30.940 --> 00:37:36.570
And there's a limit Open Directory can
handle 1000 concurrent connections.

00:37:36.570 --> 00:37:40.700
And using network home directory's managed
clients and portable home directories,

00:37:40.699 --> 00:37:47.829
the client will actually send a few requests,
not only at log in, to the Open Directory server.

00:37:47.829 --> 00:37:51.239
So you want to have a little bit of area there.

00:37:51.239 --> 00:37:54.469
You want about 900 concurrent users per replica.

00:37:54.469 --> 00:37:58.609
If you have manually connected clients for group folder

00:37:58.610 --> 00:38:04.680
or if you're just manually mounting the network
home you can connect a server or some alias or link.

00:38:04.679 --> 00:38:10.009
450 concurrent users seems to be a good, good number.

00:38:10.010 --> 00:38:18.800
If you do network home directories that's obvious the most
load on the server, about 150 concurrent home directories.

00:38:18.800 --> 00:38:22.930
You can alleviate this a little for the
server using the cache free direction

00:38:22.929 --> 00:38:28.219
and some other tricks but this seems to work well.

00:38:28.219 --> 00:38:32.209
And portable home directories are better on
the user because it's just the synchronization.

00:38:32.210 --> 00:38:38.150
Nevertheless the server has to do a lot for the
synchronization because it's comparing files back and forth.

00:38:38.150 --> 00:38:42.349
So you can probably double the number of network home users.

00:38:42.349 --> 00:38:45.199
These are Tiger numbers.

00:38:45.199 --> 00:38:51.559
We all saw the slide in the IT state of the union.

00:38:51.559 --> 00:38:58.299
AFP performance has improved a lot in Leopard
so I expect these numbers to change in Leopard.

00:38:58.300 --> 00:39:01.030
And this is for an Xserve.

00:39:01.030 --> 00:39:06.540
Xserve G5 or Intel Xserve, doesn't
really seem to make much of a difference.

00:39:09.619 --> 00:39:12.789
So for about 100 users I'd recommend two servers.

00:39:12.789 --> 00:39:15.449
One of them will be running Open Directory.

00:39:15.449 --> 00:39:17.339
The other one can be the Open Directory replica.

00:39:17.340 --> 00:39:20.410
You want to have that just for security reasons.

00:39:20.409 --> 00:39:24.449
Open Directory is a very important vital.

00:39:24.449 --> 00:39:28.349
One can handle the group shares and the
other can handle the home directories.

00:39:28.349 --> 00:39:30.659
And you'll probably be fine with this setup.

00:39:30.659 --> 00:39:36.710
If you have about 300 users I'd recommend
splitting out Open Directory and the file servers.

00:39:36.710 --> 00:39:44.539
Use one server for the group shares and two servers,
spread out the home directories among the two servers.

00:39:44.539 --> 00:39:51.849
If you need lots of storage you can attach a RAID
either directly or through a fiber channel switch.

00:39:51.849 --> 00:39:55.009
And don't forget backup.

00:39:55.010 --> 00:40:02.410
Portable home directory is great because I have a kind
of automatic mirror between the client and the server

00:40:02.409 --> 00:40:08.420
and if the client gets lost for some reason because
it was stolen, lost, the hard drive failed,

00:40:08.420 --> 00:40:11.639
the data is still on the server at
least up to the last synchronization.

00:40:11.639 --> 00:40:14.089
But it doesn't replace a backup because obviously

00:40:14.090 --> 00:40:20.809
if the user accidentally deletes the important Keynote file
it will be gone on the next synchronization on the server

00:40:20.809 --> 00:40:26.349
and it's really tough to manipulate the
mirror agent that runs automatically

00:40:26.349 --> 00:40:31.069
to not delete accidental deletions on the server.

00:40:32.190 --> 00:40:35.159
So don't forget the backup solution for this.

00:40:35.159 --> 00:40:39.359
You've centralized everything, it's really
easy to backup all the home directories.

00:40:39.360 --> 00:40:44.140
Of course, in this slide I put up
everything with Xserve and Xserve RAID.

00:40:44.139 --> 00:40:45.710
Please go out and buy this.

00:40:45.710 --> 00:40:55.210
But basically you can replace any piece of this
with something else, though we don't like that.

00:40:55.210 --> 00:40:58.380
If you want to scale out even further Xsan comes to mind.

00:40:58.380 --> 00:41:02.010
The advantage of Xsan is its clustered file system.

00:41:02.010 --> 00:41:08.480
I can combine a large number of Xserve RAIDs or just a
small number of Xserve RAIDs into a clustered file system

00:41:08.480 --> 00:41:11.909
that is accessible by several file servers at the same time.

00:41:11.909 --> 00:41:15.289
They can see the same file system, it's file level locking.

00:41:15.289 --> 00:41:18.980
And I can store all my home directories
in one place and I can scale

00:41:18.980 --> 00:41:22.539
out with the servers depending on how many users I have.

00:41:22.539 --> 00:41:27.619
And if you use a content switch for the DNS
load balancing, one that is session aware

00:41:27.619 --> 00:41:35.969
and probably pulls the file servers on how much they're
doing and distributes that, it actually works really well.

00:41:35.969 --> 00:41:39.269
Don't try portable home directories though.

00:41:39.269 --> 00:41:44.550
As I mentioned portable home directories will
compare all the files and decide what to synchronize

00:41:44.550 --> 00:41:50.440
and with an Xsan setup I have one metadata controller,
one server who handles all the metadata requests.

00:41:50.440 --> 00:41:56.780
And, I don't know, check your home directory,
I have 220,000 files in my home directory.

00:41:56.780 --> 00:42:05.120
And if you have several hundred users hammering one metadata
controller with 200,000 files each it won't be happy.

00:42:05.119 --> 00:42:13.389
So don't try portable home directories on an Xsan or if
you do don't come complaining about the performance.

00:42:13.389 --> 00:42:15.920
Go to the Xsan 2 session and ask them.

00:42:15.920 --> 00:42:17.260
Please give them feedback about this.

00:42:17.260 --> 00:42:18.350
( Laughter )

00:42:18.349 --> 00:42:24.219
I'm curious about what they will say.

00:42:24.219 --> 00:42:28.219
And Xsan, again, it will scale storage very well,

00:42:28.219 --> 00:42:34.169
it's a very performant file system but
it hasn't any redundancy in storage.

00:42:34.170 --> 00:42:37.760
So don't forget the backup.

00:42:37.760 --> 00:42:39.040
Ok, I'm the Apple guy.

00:42:39.039 --> 00:42:41.869
I can tell you a lot about the theory.

00:42:41.869 --> 00:42:46.909
I'm out there a lot actually deploying it but
you would probably trust someone else better.

00:42:46.909 --> 00:42:52.649
And with this I welcome Greg Nagel from
the Disney Animation Studios up on stage

00:42:52.650 --> 00:42:56.510
who will talk about his real world experiences.

00:42:56.510 --> 00:43:01.800
( Applause )

00:43:01.800 --> 00:43:02.910
>> Thank you.

00:43:02.909 --> 00:43:10.059
My name is Greg Neagle, Senior Systems Engineer for
Walt Disney Animation Studios and the lead of the Mac

00:43:10.059 --> 00:43:14.049
and PC deployment and engineering for the studios.

00:43:14.050 --> 00:43:17.650
So we're located in Burbank, California.

00:43:17.650 --> 00:43:20.660
We have about 800 artists and technicians.

00:43:20.659 --> 00:43:32.589
We use Linux, Mac OS X, Windows, Mac
OS 9, Solaris and lots of other things.

00:43:32.590 --> 00:43:35.510
We're a very heterogeneous environment.

00:43:35.510 --> 00:43:40.230
So we need to integrate with what's already there.

00:43:40.230 --> 00:43:42.530
So at the core we're a Unix shop.

00:43:42.530 --> 00:43:45.590
At the backend there's mostly Solaris and Linux.

00:43:45.590 --> 00:43:47.470
Our directory is an LDAP directory.

00:43:47.469 --> 00:43:50.849
It's currently running on Red Hat directory server.

00:43:50.849 --> 00:43:53.699
It's run on Open LDAP in the past.

00:43:53.699 --> 00:43:58.739
Network storage, we have a variety of
different types of network storage but the one

00:43:58.739 --> 00:44:03.750
that our network homes are served
on, is served up via net app.

00:44:03.750 --> 00:44:12.940
And that's via NFS to most of our clients and via CIFS to
that poor client that doesn't really talk NFS very well.

00:44:12.940 --> 00:44:15.139
They make it in Redmond.

00:44:15.139 --> 00:44:21.559
So we needed to make OS X client
integrate with the existing environment.

00:44:21.559 --> 00:44:26.420
We weren't going to bring in a bunch of Apple
equipment to replace perfectly good home directories

00:44:26.420 --> 00:44:29.409
and the LDAP infrastructure that was already there.

00:44:29.409 --> 00:44:31.789
Fortunately Apple makes it really easy.

00:44:31.789 --> 00:44:39.469
So for LDAP you open up directory access, you add your LDAP
server and we were fortunate enough that we could choose one

00:44:39.469 --> 00:44:46.919
of the presets, which is the RFC 2307
schema and now our OS X clients can log

00:44:46.920 --> 00:44:52.519
in with the exact same user name and
password that our Linux clients use.

00:44:52.519 --> 00:44:56.860
Now I'm cheating a little bit because that's how we
started and then we went back in and tweaked stuff

00:44:56.860 --> 00:44:58.660
to make things work really the way we want to.

00:44:58.659 --> 00:45:02.250
But it's a good starting point for
anyone, try one of the existing presets

00:45:02.250 --> 00:45:04.920
and see if it works for you if you have an existing server.

00:45:04.920 --> 00:45:07.130
So that's half the equation.

00:45:07.130 --> 00:45:12.880
The other half is you've got to have access to
network storage and, as I said, that was NFS for us.

00:45:12.880 --> 00:45:16.470
Apple doesn't make that quite as easy.

00:45:16.469 --> 00:45:23.529
The automount from Tiger and previous
revs of the OS is really strange.

00:45:23.530 --> 00:45:29.390
It doesn't act like the automounter in
any other Unix or Linux operating system.

00:45:29.389 --> 00:45:35.569
So, again, we have an existing Unix, Linux infrastructure.

00:45:35.570 --> 00:45:38.990
We keep our auto FS mount maps up on LDAP

00:45:38.989 --> 00:45:42.739
but the OS X Automator doesn't know
anything about them, doesn't know what to do.

00:45:42.739 --> 00:45:50.179
So we had to write a custom script that queried LDAP, grabs
those automount records, rewrites them out in the format

00:45:50.179 --> 00:45:53.409
that the OS X automounter likes,
writes them to the local disk

00:45:53.409 --> 00:45:58.899
and then manually calls Tiger's automount
for each of those automount maps.

00:45:58.900 --> 00:46:06.720
And now we finally have our NFS directories mounted
the same place the Unix clients have it as well.

00:46:06.719 --> 00:46:12.209
And that works pretty well, works
great for our desktop bound machines.

00:46:12.210 --> 00:46:16.320
Our laptops, a little bit harder because
laptops aren't always on the network.

00:46:16.320 --> 00:46:22.260
People, they, they take them home, they
unplug them, they use them on wireless,

00:46:22.260 --> 00:46:28.040
they have the audacity to restart them while they're
at home and they can't get to the NFS shares.

00:46:28.039 --> 00:46:33.809
So we had to come up with a solution for those people
and then we had to write yet another custom script.

00:46:33.809 --> 00:46:35.710
This one watches for network transitions.

00:46:35.710 --> 00:46:43.159
So we've unplugged the network, we plugged in the network,
we've connected via 802 dot 1X, we've connected via VPN.

00:46:43.159 --> 00:46:47.719
Looks for those transitions, then it goes
out and sees, Can I see the Disney Network?

00:46:47.719 --> 00:46:49.139
Can I see the NFS servers?

00:46:49.139 --> 00:46:53.799
Oh, good. I'll bring up the automounts
or not as the case may be.

00:46:53.800 --> 00:46:56.240
That's a lot of custom scripting.

00:46:56.239 --> 00:47:03.379
Every time the OS changed or we changed the backend somewhat
or they move from one LDAP server to another I had to go in

00:47:03.380 --> 00:47:06.150
and tweak those scripts and that's kind of a pain.

00:47:06.150 --> 00:47:09.000
So there's hope in Leopard.

00:47:09.000 --> 00:47:17.159
As Armin mentioned they're moving to auto FS as
the standard or the new automount daemon in Leopard

00:47:17.159 --> 00:47:24.609
and that's the same daemon that's used on Linux and
Solaris and most importantly it's used on the Linux for us.

00:47:24.610 --> 00:47:29.740
At Disney Animation our LDAP servers
already have those auto FS mounts.

00:47:29.739 --> 00:47:36.799
So our hope is we'll be able to point Tiger's, I mean
Leopard's auto FS at our LDAP server and it'll bring

00:47:36.800 --> 00:47:41.170
down those maps and it'll just work, no custom scripting.

00:47:41.170 --> 00:47:47.119
So next week I'll be testing that really having.

00:47:47.119 --> 00:47:52.250
( Laughter )
Go. Alright, so I have to admit
our situation is kind of weird.

00:47:52.250 --> 00:47:57.409
I mean most people probably out
there are not running NFS homes.

00:47:57.409 --> 00:47:59.579
They maybe aren't using the LDAP directory.

00:47:59.579 --> 00:48:05.639
They may be using Apple's stuff, which is great or they
may be using Microsoft's Active Directory and SMB homes.

00:48:05.639 --> 00:48:10.730
No matter what kind of network home you have
you're going to face certain challenges.

00:48:10.730 --> 00:48:12.710
I'm going to go over a few we faced.

00:48:12.710 --> 00:48:18.909
I think some of these will apply to you, many of them may
apply to you, and what we figured out to do about them.

00:48:18.909 --> 00:48:23.920
So the key ones you'll see is you'll have, you
may have challenges managing the configurations

00:48:23.920 --> 00:48:30.970
and the default preferences, quotas, caches, certain
badly behaved apps and then we'll talk a little bit

00:48:30.969 --> 00:48:34.519
about home, or portable home directories.

00:48:34.519 --> 00:48:39.570
So if you have a local account and you
create, or if you create a local account

00:48:39.570 --> 00:48:43.220
on the machine the OS prepopulates the home directory.

00:48:43.219 --> 00:48:47.529
It puts in all the folder structure and puts
in default preferences in library preferences.

00:48:47.530 --> 00:48:51.590
You get the default doc and you
get the experience that you expect.

00:48:51.590 --> 00:48:54.630
And I'm sure many admins have customized the user default

00:48:54.630 --> 00:48:59.619
so that they get the user expect
that they want the users to have.

00:48:59.619 --> 00:49:02.469
If you're fortunate enough to have OS X server

00:49:02.469 --> 00:49:07.709
and Open Directory you can get the same
effect by doing that on the server.

00:49:07.710 --> 00:49:10.960
And when the user logs in they
get your customized environment.

00:49:10.960 --> 00:49:16.329
If you're using Active Directory or a
third party LDAP server you don't get that.

00:49:16.329 --> 00:49:22.699
You log in and it's just sometimes an empty home
directory maybe it's just whatever was on there

00:49:22.699 --> 00:49:26.849
from when it was being used by
a Linux user or a Windows user.

00:49:26.849 --> 00:49:32.769
And so now you've got to go down there and help them setup
all their applications and that becomes a pain really fast.

00:49:32.769 --> 00:49:35.139
So what we did is we wrote a custom application.

00:49:35.139 --> 00:49:36.759
We used AppleScript Studio to do this.

00:49:36.760 --> 00:49:39.070
It's almost entirely AppleScript.

00:49:39.070 --> 00:49:45.080
And what it does is there's a little script that
launches at log in for every user and it looks to see

00:49:45.079 --> 00:49:47.179
if there's a file in their home directory.

00:49:47.179 --> 00:49:51.679
It's a file that starts with a dot so it's
invisible to the users and the finder.

00:49:51.679 --> 00:49:56.769
If it doesn't find that file it goes, Oh, this must be the
first time this user has logged into this home directory.

00:49:56.769 --> 00:50:01.619
So I'm going to open up the Disney Animation setup
assistant and walk them through configuring their account.

00:50:01.619 --> 00:50:07.579
And this behaves a lot like the OS X setup
assistant in that it setups the default doc.

00:50:07.579 --> 00:50:11.949
It helps them setup their mail and
all the other kind of, you know,

00:50:11.949 --> 00:50:16.039
hand holding the user through setting
up their account for a first time use.

00:50:19.340 --> 00:50:21.730
The next thing, quotas.

00:50:22.889 --> 00:50:27.599
Unless you have infinite storage on the
network you're going to run into this.

00:50:27.599 --> 00:50:35.079
Most machines today have 80 gigabyte,
100 gigabyte, 250 gigabyte hard drives.

00:50:35.079 --> 00:50:40.739
If you have 1000 users multiply that
by how much space you have to have

00:50:40.739 --> 00:50:43.689
on the server to give them the same amount of space.

00:50:43.690 --> 00:50:48.599
You're probably not going to do that,
especially since you have to back that stuff up.

00:50:48.599 --> 00:50:55.559
So commonly your users are given a quota
and that's actually for two reasons.

00:50:55.559 --> 00:51:00.269
One, so they don't use tons of space but also
so that one user doesn't hog all the space

00:51:00.269 --> 00:51:03.679
on the network storage and crowd everybody else out.

00:51:03.679 --> 00:51:08.079
The problem is the finder doesn't
know anything about quotas.

00:51:08.079 --> 00:51:11.059
It doesn't tell the user anything about what their space is.

00:51:11.059 --> 00:51:12.679
It definitely doesn't do it on NFS.

00:51:12.679 --> 00:51:16.940
I'm pretty sure it doesn't do it on AFP and SMB.

00:51:16.940 --> 00:51:20.889
So what happens is the users work away with
their network home and they're saving documents

00:51:20.889 --> 00:51:25.619
and they're downloading trailers from the internet and
leaving them on their desktop and they're putting stuff

00:51:25.619 --> 00:51:31.019
in the trash and never emptying the trash and slowly
their network home is getting fuller and fuller and fuller

00:51:31.019 --> 00:51:32.630
and finally the server says, You know what?

00:51:32.630 --> 00:51:33.960
You're done.

00:51:33.960 --> 00:51:34.420
It's full.

00:51:34.420 --> 00:51:36.309
We're not going to let you write anymore.

00:51:36.309 --> 00:51:43.099
So then they log out and all their applications that were
running try to write out their preferences and they can't.

00:51:43.099 --> 00:51:44.730
So now we've got zero length files.

00:51:44.730 --> 00:51:50.500
And then they log back in and, Hey, what
happened to my doc, my applications?

00:51:50.500 --> 00:51:52.639
They forgot how to connect to the mail server.

00:51:52.639 --> 00:51:53.989
My bookmarks are all gone.

00:51:53.989 --> 00:51:56.329
And they call us and complain.

00:51:56.329 --> 00:51:59.369
So we look, Oh, yeah, you filled up your home directory.

00:51:59.369 --> 00:52:00.559
They didn't know.

00:52:00.559 --> 00:52:02.219
They got no feedback at all.

00:52:02.219 --> 00:52:05.439
So what did we have to do about that?

00:52:05.440 --> 00:52:09.480
That's right, you add another custom application.

00:52:09.480 --> 00:52:15.960
So we wrote a little thing that sits down in the lower
right corner, they can, or actually the lower left corner.

00:52:15.960 --> 00:52:19.179
They can move it around anywhere they
want but that's where it is by default.

00:52:19.179 --> 00:52:25.329
And it's green when they have a reasonable
amount of space left and then it turns yellow

00:52:25.329 --> 00:52:30.340
if their home directory gets a little fuller and
it turns red when it gets up about 90 percent

00:52:30.340 --> 00:52:33.829
And if they click it, that little twisty triangle,

00:52:33.829 --> 00:52:40.329
they get a little bit more information telling them how
close they are to being full, why that's a bad thing,

00:52:40.329 --> 00:52:43.049
what they should do about it and
who they should call for help.

00:52:43.050 --> 00:52:47.930
And you'll see that, that number up there, I don't know
if you can, it's kind of fuzzy, a thousand megabytes.

00:52:47.929 --> 00:52:51.649
That's a standard quota we have at Disney Animation.

00:52:51.650 --> 00:52:54.300
So it doesn't take much to fill that up.

00:52:54.300 --> 00:53:01.110
So now they've got some feedback and they can
actually do something about managing their disk space.

00:53:01.110 --> 00:53:04.870
Now I wrote this app and frankly it's a nasty hack.

00:53:04.869 --> 00:53:08.170
So I wouldn't really want to give
it to anybody but if you want it,

00:53:08.170 --> 00:53:14.860
if you want something like this you can either bug me to
fix mine and make it prettier, you could write your own

00:53:14.860 --> 00:53:19.250
or you could take a look at Quota
Monitor Menu by Adam Gerson.

00:53:19.250 --> 00:53:20.989
There's a URL up there.

00:53:20.989 --> 00:53:22.949
I'm sure you could also Google for it.

00:53:22.949 --> 00:53:26.889
It does a similar thing to the thing I wrote
it just happens to be up in the menu bar

00:53:26.889 --> 00:53:31.679
and it shows how much disk space is
left and, again, the user can click it

00:53:31.679 --> 00:53:34.299
and get a little bit more information, empty their trash.

00:53:34.300 --> 00:53:40.830
And he's done a fair amount of work
to let you customize it for your site.

00:53:42.079 --> 00:53:44.539
Next challenge, caches.

00:53:44.539 --> 00:53:48.300
I'll gloss over this really quickly
because Armin talked about it.

00:53:48.300 --> 00:53:53.930
We did the same thing, we redirected caches to
the local hard disk, rewrote our own script.

00:53:53.929 --> 00:53:58.019
You could write your own or if you're
lazy, like I would be if this had come

00:53:58.019 --> 00:54:02.190
out before I wrote my own, see the network home director.

00:54:02.190 --> 00:54:05.340
This'll set that log in hook script
for you and redirect the caches.

00:54:05.340 --> 00:54:10.450
It can optionally also redirect certain other directories.

00:54:10.449 --> 00:54:12.989
Badly behaved apps.

00:54:12.989 --> 00:54:16.149
Now the nice thing is is that as time has gone by a lot

00:54:16.150 --> 00:54:20.990
of the vendors have gotten really good,
the vendors have gotten much better.

00:54:20.989 --> 00:54:25.789
They've, they've forgotten a lot of their
assumptions that they had in the OS 9 days

00:54:25.789 --> 00:54:29.909
and they're actually writing their apps
to be better behaved on a multi-user OS

00:54:29.909 --> 00:54:34.940
that actually has POSIX permissions and the
network might, the home directory might not live

00:54:34.940 --> 00:54:37.500
under slash users, it might be out on the network.

00:54:37.500 --> 00:54:39.949
But not all apps behave really well.

00:54:39.949 --> 00:54:43.429
There's one that rhymes with Ruhdobee Shmotopop.

00:54:43.429 --> 00:54:53.769
If you work for a company whose first name rhymes for
Ruhdobee, I'm sorry, but so for us the solution was,

00:54:53.769 --> 00:54:58.650
for these heavy users of this program, is we just move them
to portable home directories even if they were on a desktop.

00:54:58.650 --> 00:55:02.090
These are users that have, you
know, maybe a G5 or a MacPro.

00:55:02.090 --> 00:55:09.850
And we're using portable home directories for
them so that from Shmotopop's point of view,

00:55:09.849 --> 00:55:11.339
( Laughter )

00:55:11.340 --> 00:55:13.110
It's working on a local file system.

00:55:13.110 --> 00:55:15.900
It doesn't know anything about the network file system.

00:55:15.900 --> 00:55:23.160
So it, it runs smoother, faster and the users
are much happier because photo , Shmotopop,

00:55:23.159 --> 00:55:25.279
( Laughter )

00:55:25.280 --> 00:55:27.400
( Applause )

00:55:27.400 --> 00:55:30.250
Is, is just much snappier.

00:55:30.250 --> 00:55:34.000
So portable home directories, I just mentioned them.

00:55:34.000 --> 00:55:36.639
Apple obviously designed them with OS X server in mind.

00:55:36.639 --> 00:55:40.509
All the management tools are based in Workgroup Manager.

00:55:40.510 --> 00:55:47.230
They really work best with AFP home
directories but they're not limited to that.

00:55:47.230 --> 00:55:56.639
You can actually use them with Open Directory,
Active Directory, LDAP, SMB, NFS, AFP.

00:55:56.639 --> 00:56:04.319
That wasn't quite as straight forward as I would
have liked to set them up in my environment.

00:56:04.320 --> 00:56:07.640
I probably spent about a week figuring out how to do it.

00:56:07.639 --> 00:56:13.480
And I wrote these really long articles up on this
website that if any of you actually read all the way

00:56:13.480 --> 00:56:16.670
through them I'll be really impressed
because they get really boring.

00:56:16.670 --> 00:56:17.630
( Applause )
Oh, oh Ok.

00:56:17.630 --> 00:56:18.700
Good, good.

00:56:18.699 --> 00:56:23.619
One nice thing though is that going
through that process I learned a lot

00:56:23.619 --> 00:56:26.920
about how portable home directories work behind the covers.

00:56:26.920 --> 00:56:31.300
So if you're interested in learning a little
bit more about that if you check these articles

00:56:31.300 --> 00:56:34.780
out you might, you might learn something.

00:56:34.780 --> 00:56:41.380
So after using portable home directories for a
while in our environment, And we really needed to,

00:56:41.380 --> 00:56:48.800
We moved to these pretty heavily about a year ago
because shortly after Apple introduced the Intel MacBooks

00:56:48.800 --> 00:56:53.230
and the MacBook Pros we bought a bunch of them.

00:56:53.230 --> 00:56:58.849
And people wanted to be able to use all the stuff
they were using on their desktop including access

00:56:58.849 --> 00:57:05.079
to their network homes and that sort of thing but
still be able to use them, you know, portably.

00:57:05.079 --> 00:57:08.019
So we really had to get portable home
directories working in our environment.

00:57:08.019 --> 00:57:12.269
So we, we've discovered some things and made some changes

00:57:12.269 --> 00:57:17.599
to the synchronization rules that
I think you might want to consider.

00:57:17.599 --> 00:57:24.949
And if you look at the new defaults in Leopard I think
Apple thinks some of these things are a good idea too.

00:57:24.949 --> 00:57:27.669
So Armin actually mentioned this one.

00:57:27.670 --> 00:57:34.329
The big top level folders you might think about excluding
them, especially if your business doesn't have anything

00:57:34.329 --> 00:57:39.449
to do with music, movies or pictures, you know,
iTunes, maybe you don't want to back that up.

00:57:39.449 --> 00:57:46.019
Make sure the users understand that's
what you're doing so they don't lose data.

00:57:46.019 --> 00:57:47.340
Mail dot app.

00:57:47.340 --> 00:57:52.620
If you use Mail dot app and Xchange,
Is there anybody here that does that?

00:57:52.619 --> 00:57:53.659
Nobody does that?

00:57:53.659 --> 00:57:54.349
Oh, one person.

00:57:54.349 --> 00:57:54.679
Me too.

00:57:54.679 --> 00:57:59.399
( Laughter )
You might want to add an exclusion here

00:57:59.400 --> 00:58:05.039
so that the synchronization process doesn't
back up your locally cached Xchange mail.

00:58:05.039 --> 00:58:11.009
Now this is a little confusing so for comparison
this is actually part of the Tiger defaults

00:58:11.010 --> 00:58:15.150
in that it doesn't backup, it doesn't
synchronize your iMac and your dot Mac mail

00:58:15.150 --> 00:58:18.269
because the assumption is that's up on the server.

00:58:18.269 --> 00:58:20.500
If you lose it, you know, you just
download it again from the server.

00:58:20.500 --> 00:58:23.409
Well, Xchange is exactly the same way.

00:58:23.409 --> 00:58:27.529
So if you use Xchange you might as well
add that and then you don't have to worry

00:58:27.530 --> 00:58:31.990
about portable home directories synchronizing
your cache change mail back and forth.

00:58:31.989 --> 00:58:40.119
Now if you don't use Mail dot app you
might be using Microsoft Entourage.

00:58:40.119 --> 00:58:44.859
Entourage has some real big challenges when
it comes to, to portable home directories

00:58:44.860 --> 00:58:48.490
because it stores everything in one giant database file.

00:58:48.489 --> 00:58:54.889
And that's usually stored under documents
Microsoft user data Office 2004 identities main,

00:58:54.889 --> 00:58:57.389
you know, several folders deep but it's in there.

00:58:57.389 --> 00:59:02.319
And it's one giant file, it's usually open all the
time because the Microsoft database daemon opens it

00:59:02.320 --> 00:59:06.820
at log in and it's changing all the time.

00:59:06.820 --> 00:59:12.269
So you don't really want to synchronize it when it's open
because it's, You're probably going to get a corrupted file

00:59:12.269 --> 00:59:14.960
because it's being changed while it's being synchronized.

00:59:14.960 --> 00:59:17.929
So it probably should be synchronized
the same way all the stuff in library,

00:59:17.929 --> 00:59:21.149
the folder is and that's at log in and log out.

00:59:21.150 --> 00:59:27.889
So I would recommend that you make some changes
to your default sync rules so that at log in

00:59:27.889 --> 00:59:31.159
and log out you synchronize documents, Microsoft user data.

00:59:31.159 --> 00:59:36.869
And then as a further refinement you might want to
skip synchronizing the Microsoft Entourage temp folder.

00:59:36.869 --> 00:59:42.849
And then on the other side for background
sync, which is also when people do manual sync,

00:59:42.849 --> 00:59:47.529
don't synchronize documents, Microsoft user data.

00:59:47.530 --> 00:59:51.160
So now what happens is that database only
synchronizes when you log in and log out

00:59:51.159 --> 00:59:55.199
and it's left alone during the user's session.

00:59:55.199 --> 01:00:00.049
So that solves the problem but it introduces another one.

01:00:00.050 --> 01:00:06.960
It makes the log ins and log outs take longer and how much
longer depends on how big those Microsoft database is.

01:00:06.960 --> 01:00:13.990
There's really not much you can do about that
because the alternative is corrupted databases.

01:00:13.989 --> 01:00:18.500
I suppose one other approach would just be never
synchronize it and tell the user they're on their own.

01:00:18.500 --> 01:00:22.780
But that might be feedback you want to give you Microsoft.

01:00:22.780 --> 01:00:26.269
There was a session this morning, How many
went to the Time Machine session this morning?

01:00:26.269 --> 01:00:29.840
And again, the Microsoft user database is one
of those things that Time Machine would have

01:00:29.840 --> 01:00:36.350
to backup every single time it ran because it's going
to change all the time and it's a big, big file.

01:00:36.349 --> 01:00:40.719
Quickly, it would quickly consume
all of your backup hard disk space.

01:00:42.619 --> 01:00:45.239
One final thing and I'll turn it back over to Armin.

01:00:45.239 --> 01:00:50.259
If you use Norton Antivirus or Symantec Antivirus, when
it scans your home directory it creates these big files

01:00:50.260 --> 01:00:53.770
in your home directory where it keeps track
of what it scanned all that sort of thing

01:00:53.769 --> 01:00:57.710
so it can scan faster the next time around,
you should probably exclude those as well.

01:00:57.710 --> 01:00:59.559
There's no reason they need to be copied up to the network.

01:00:59.559 --> 01:01:04.139
They're usually fairly big and it would
just slow down the synchronization.

01:01:04.139 --> 01:01:05.349
So that's what we've learned.

01:01:05.349 --> 01:01:09.509
I'll turn it back over to Armin to close
up and then I think we'll have some QA.

01:01:09.510 --> 01:01:14.870
( Applause )

01:01:14.869 --> 01:01:17.059
>> So just a, Greg, you can stay here.

01:01:17.059 --> 01:01:18.049
We'll start anyway.

01:01:18.050 --> 01:01:20.620
Just a quick summary.

01:01:20.619 --> 01:01:22.710
Home directories, there are five types.

01:01:22.710 --> 01:01:23.610
You can't do them.

01:01:23.610 --> 01:01:29.280
Local home directories, generic accounts,
which will be made much easier in Leopard.

01:01:29.280 --> 01:01:32.480
The generic network home directories,
portable home directories,

01:01:32.480 --> 01:01:35.789
which are extremely useful, external accounts and Leopard.

01:01:35.789 --> 01:01:38.159
I'm curious what you're going to do with them.

01:01:38.159 --> 01:01:45.079
And plan and test before you deploy, do lots of
planning especially in the synchronization rules.

01:01:45.079 --> 01:01:46.809
Greg mentioned some of that.

01:01:46.809 --> 01:01:48.779
And there's some assembly required.

01:01:48.780 --> 01:01:52.260
You probably want to play around with
these until they really fit yours.

01:01:52.260 --> 01:01:54.380
But the great thing is you can.

01:01:54.380 --> 01:01:55.390
We encourage you to do that.