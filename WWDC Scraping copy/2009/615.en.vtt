WEBVTT

00:00:12.550 --> 00:00:18.719
>> Hello everyone, and thanks for coming in
to the System Imaging session at WWDC 2009.

00:00:18.719 --> 00:00:22.979
I'm Jussi-Pekka Mentere, I'm the
engineering manager for System Imaging Team.

00:00:22.980 --> 00:00:28.649
Later I'll introduce Brian Nesse who's the lead engineer
on the team, and here's what we're going to cover today.

00:00:28.649 --> 00:00:32.509
So our agenda, we'll talk about what
is system imaging, what do we create.

00:00:32.509 --> 00:00:38.929
So we'll talk about NetInstall images, NetBoot images,
NetRestore images, what's the difference between the three.

00:00:38.929 --> 00:00:43.259
We'll talk about new features in
System Image Utility version 2.

00:00:43.259 --> 00:00:49.439
We'll talk about how to boot into those images, and
we'll look into some under the hood kind of things

00:00:49.439 --> 00:00:55.329
like internal server, NetBoot, how to tweak
things a little bit out of the ordinary.

00:00:55.329 --> 00:00:59.920
So let's go into the image types
that System Image Utility creates.

00:00:59.920 --> 00:01:03.170
So NetInstall, what is a NetInstall image?

00:01:03.170 --> 00:01:11.719
This is an image that installs a Mac OS X from a network
volume, so this is almost as if you had a DVD in hand

00:01:11.719 --> 00:01:18.349
and instead of booting locally from the DVD, you
boot over the network into the installation DVD.

00:01:18.349 --> 00:01:24.280
And this gives you all the flexibility of
installation so you can create NetInstalls from DVDs,

00:01:24.280 --> 00:01:32.049
and the DVD source can be either a
shrink-wrapped DVD or it can be a DVD that came

00:01:32.049 --> 00:01:36.689
with the hardware that you just received or purchased.

00:01:36.689 --> 00:01:42.579
The NetInstall environment allows your users
to customize their installation entirely.

00:01:42.579 --> 00:01:47.120
Your users can choose packages which they want
to install, which they want to opt out of.

00:01:47.120 --> 00:01:53.079
So some people may not want to have the whole set of
printers installed, so NetInstall gives you the option

00:01:53.079 --> 00:01:57.780
to tweak every package selection
for individual installations.

00:01:57.780 --> 00:02:02.650
And NetInstall also allows you to install
custom packages that are site specific.

00:02:02.650 --> 00:02:06.710
So you may have something like third-party
software pieces that you would want to include,

00:02:06.709 --> 00:02:10.469
or even Apple software you would want
to include in the installation set.

00:02:10.469 --> 00:02:16.400
Xsan or Apple Remote Desktop, CS4,
or Microsoft Office or whatnot.

00:02:16.400 --> 00:02:26.689
So anything that's packaged into an Apple
package maker, you can add into NetInstall image.

00:02:26.689 --> 00:02:30.800
The second image type is then NetBoot.

00:02:30.800 --> 00:02:34.370
NetBoot boots a computer into Mac OS X.

00:02:34.370 --> 00:02:39.400
And again, the NetBoot image can
be created from an installation DVD

00:02:39.400 --> 00:02:42.800
or you can use an existing volume
that's already been installed

00:02:42.800 --> 00:02:47.469
and use that as the source to create the NetBoot volume.

00:02:47.469 --> 00:02:53.080
In the NetBoot environment, all the systems boot
into an identical copy of the operating system.

00:02:53.080 --> 00:02:56.350
So if you have two machines, 50 machines, 500 machines,

00:02:56.349 --> 00:03:03.509
they all boot into the same exact copy
of Mac OS X on that NetBoot volume.

00:03:03.509 --> 00:03:09.469
And if the NetBoot system is rebooted, all
local changes will be lost or reverted.

00:03:09.469 --> 00:03:17.210
So no matter what changes happen during the run time of
the NetBoot session, anything that the user has added,

00:03:17.210 --> 00:03:24.330
installed applications or modified any files on the
NetBoot volume, those changes will be reverted back

00:03:24.330 --> 00:03:28.550
to the initial state of when the NetBoot image was created.

00:03:28.550 --> 00:03:34.689
If the user is using network homes, so the user logs
on into an Open Directory/Active Directory account,

00:03:34.689 --> 00:03:38.509
of course the user's data will still
reside on the network directory.

00:03:38.509 --> 00:03:43.500
But any of the system changes will be reverted back.

00:03:43.500 --> 00:03:47.919
And one very special thing about
NetBoot is Diskless NetBoot.

00:03:47.919 --> 00:03:52.519
So what Diskless NetBoot allows you
to do is to unmount local volumes.

00:03:52.520 --> 00:03:54.219
And why is this useful?

00:03:54.219 --> 00:03:59.129
So if you have some issues with let's
say hard drive diagnostics or you need

00:03:59.129 --> 00:04:02.689
to do some other maintenance type
operations against the hard drives

00:04:02.689 --> 00:04:06.650
on your systems or on the target systems you care about.

00:04:06.650 --> 00:04:12.069
Diskless NetBoot allows you to unmount
every single local volume and reformat them.

00:04:12.069 --> 00:04:20.180
So this is effectively booting into an
external hard drive, but over the network.

00:04:20.180 --> 00:04:21.150
NetRestore.

00:04:21.149 --> 00:04:26.469
And this is not Mike's [phonetic] NetRestore.

00:04:26.470 --> 00:04:31.520
NetRestore is what used to be the NetInstall of a volume.

00:04:31.519 --> 00:04:39.849
So this refers to specifically a hard drive volume
copy across the network onto a target drive.

00:04:39.850 --> 00:04:48.450
So NetRestore images can be created from a master volume,
so this is your GUID Mac or your monolithic system image.

00:04:48.449 --> 00:04:56.370
Or you can also create a NetRestore
install set from DVDs plus packages.

00:04:56.370 --> 00:05:02.449
So NetRestore can also use ASR to
transport the packages over the wire.

00:05:02.449 --> 00:05:09.670
So if you do a mass deployment of 50 or 100 machines,
you can reduce the network bandwith by using Multi-Cast.

00:05:09.670 --> 00:05:16.060
You can have some post restore actions
such as setting computer settings

00:05:16.060 --> 00:05:21.410
or doing computer binding to directory systems.

00:05:21.410 --> 00:05:23.460
So when would you use NetInstall?

00:05:23.459 --> 00:05:30.349
NetInstall is at the moment the most flexible way
of deploying Mac OS X in a larger environment.

00:05:30.350 --> 00:05:39.930
This gives the users the option to opt in, opt out of any
packages, and it's effectively booting the system off DVD.

00:05:39.930 --> 00:05:49.110
This supports upgrade installs, so if your users already
are using 10.4 or 10.5, using NetInstall images allows you

00:05:49.110 --> 00:05:57.030
to upgrade the systems as opposed to fully replace
the environment using disk image or asr source.

00:05:57.029 --> 00:06:00.919
So NetInstall is quite flexible, and
NetInstall is created, as I mentioned,

00:06:00.920 --> 00:06:07.120
from an installation DVD either shrink-wrapped
or something that came with the CPU.

00:06:07.120 --> 00:06:11.439
And it can optionally include packages
that are site specific,

00:06:11.439 --> 00:06:15.689
your application packages or other customization packages.

00:06:15.689 --> 00:06:30.500
So a package could also include startup items that run
at first launch or first boot of the target system.

00:06:30.500 --> 00:06:38.019
So NetBoot again, can be created from DVD
plus packages, or a volume plus packages.

00:06:38.019 --> 00:06:40.329
And when would you want to use NetBoot?

00:06:40.329 --> 00:06:48.509
Well if you want to have a very known configuration across
multiple systems, then the easiest way to keep them in sync

00:06:48.509 --> 00:06:54.769
in a live environment or in some corporate environment
is to NetBoot all the clients in a single image,

00:06:54.769 --> 00:06:59.199
and all those clients will always get the
exact same copy of image no matter what.

00:06:59.199 --> 00:07:04.680
When they restart, they get back to the original
image, so there's no delta between what they booted

00:07:04.680 --> 00:07:07.120
into yesterday and what they booted into today.

00:07:07.120 --> 00:07:09.639
And it also allows you to do diagnostics.

00:07:09.639 --> 00:07:18.579
So within Apple, our IS&T department has created
images where you can boot into a diagnostic image

00:07:18.579 --> 00:07:26.719
that includes tools like Disk Utility, Disk Warrior,
other third-party tools for diagnosing the target system.

00:07:26.720 --> 00:07:34.730
So this allows users to boot into a known good
OS image if the hard drive has totally failed,

00:07:34.730 --> 00:07:43.460
so they can recover their logically
corrupt hard drives using an image

00:07:43.459 --> 00:07:47.159
over the network and diagnose the issues there.

00:07:47.160 --> 00:07:51.040
You can also do a remote help in
that kind of environment if the image

00:07:51.040 --> 00:07:54.390
that you've created includes Remote Desktop access.

00:07:54.389 --> 00:08:03.849
So you can create a NetBoot image that allows your help
desktop employees to target the systems that are booted

00:08:03.850 --> 00:08:08.500
into the NetBoot images and then use
ARD to connect to them and figure

00:08:08.500 --> 00:08:12.959
out what may be causing the issues on the user's system.

00:08:12.959 --> 00:08:16.419
So then finally NetRestore.

00:08:16.420 --> 00:08:21.410
NetRestore again can be created from DVD plus packages.

00:08:21.410 --> 00:08:25.810
And commonly, this is now referred as the InstaDMG workflow.

00:08:25.810 --> 00:08:35.690
But this is really just creating an ASR image, a
NetRestore image from an installation disk plus packages.

00:08:35.690 --> 00:08:37.580
So what is the benefit of this

00:08:37.580 --> 00:08:43.129
So assuming that all of your customization for
your site-specific stuff happens in packages,

00:08:43.129 --> 00:08:51.649
no matter what kind of CPU arrives - like you
may have bought the MacBook Pro 2009 summer,

00:08:51.649 --> 00:08:53.899
I don't know, WWDC edition.

00:08:53.899 --> 00:08:59.569
So once those systems start arriving, your older
operating systems will no longer boot those machines.

00:08:59.570 --> 00:09:09.040
So if you had used the workflow to create an
ASR restore volume from a DVD plus packages,

00:09:09.039 --> 00:09:15.809
the first system that arrives, if you apply that same
workflow against the DVD that arrive with those systems,

00:09:15.809 --> 00:09:22.629
you have an up-to-date NetRestore volume ready
to go and restore any MacBook Pro that arrives.

00:09:22.629 --> 00:09:28.110
So it's one-time image create, and then you
can restore very efficiently and very fast

00:09:28.110 --> 00:09:32.810
from that ASR image onto any MacBook Pro that arrives.

00:09:32.809 --> 00:09:37.709
And of course, we still support
creating NetRestore images from volumes.

00:09:37.710 --> 00:09:43.820
But the big thing here is really creating
NetRestores from DVDs and adding packages

00:09:43.820 --> 00:09:48.750
that contain all the type-specific
changes that you have made.

00:09:48.750 --> 00:09:52.299
So a little bit about System Image Utility.

00:09:52.299 --> 00:09:57.279
So SIU is the Apple de facto system image creation tool.

00:09:57.279 --> 00:10:00.819
This is something that stays in
sync with the operating system.

00:10:00.820 --> 00:10:09.930
No matter when, you should always be able to use SIU
against the current OS that you have, so released OS.

00:10:09.929 --> 00:10:13.299
Developed previously may have some issues but still.

00:10:13.299 --> 00:10:16.019
If you have 10.5, you use 10.5 System Image Utility.

00:10:16.019 --> 00:10:18.610
If you have 10.6 you use 10.6.

00:10:18.610 --> 00:10:22.740
And you can always create NetInstall, NetBoot images.

00:10:22.740 --> 00:10:27.480
And now with 10.6 Snow Leopard,
you can create NetRestore images.

00:10:27.480 --> 00:10:35.940
So we go to great lengths to make sure that all the plumbing
that you are not exposed to stays current and working,

00:10:35.940 --> 00:10:40.450
whatever changes happen in the operating system,
SIU is the first to adapt to those changes

00:10:40.450 --> 00:10:44.090
and make sure that image creation continues.

00:10:44.090 --> 00:10:50.810
System Image Utility also integrates with
core OS X technologies such as Automator,

00:10:50.809 --> 00:10:57.159
so we leverage Automator heavily, as in we
built the application out of Automator actions.

00:10:57.159 --> 00:11:00.389
And obviously it's integrated with Mac OS X server.

00:11:00.389 --> 00:11:07.919
So vending images is extremely easy using System
Image Utility when we create the image folders,

00:11:07.919 --> 00:11:15.110
those can be directly copied into Mac OS X servers,
NetBoot share points, and surfed from there.

00:11:15.110 --> 00:11:19.519
What are the new things in Snow Leopard?

00:11:19.519 --> 00:11:21.470
The NetRestore image type.

00:11:21.470 --> 00:11:32.850
This is really the big change, and the major shift of focus
is really the workflow to create NetRestore images, ASR,

00:11:32.850 --> 00:11:41.370
Apple software restore images out of DVDs
and adding packages to that, that's big.

00:11:41.370 --> 00:11:48.919
And we really see that as a huge, huge improvement
over monolithic system imaging where you have a GUID

00:11:48.919 --> 00:11:53.569
that then gets out of sync with
whatever new hardware comes around.

00:11:53.570 --> 00:11:59.670
Also new in Snow Leopard, we improved the directory
binding, so you can still do it by computer.

00:11:59.669 --> 00:12:02.549
But we now also support authenticated binding.

00:12:02.549 --> 00:12:09.669
So if you need to do AD binding for your computers, we
now support authenticated binding where you can plug

00:12:09.669 --> 00:12:15.319
in the directory admin or the computer
record creator account information

00:12:15.320 --> 00:12:17.410
into System Image Utility, and it'll just work.

00:12:17.409 --> 00:12:18.009
Yay.

00:12:18.009 --> 00:12:22.559
[ Applause ]

00:12:22.559 --> 00:12:23.449
>> Thank you.

00:12:23.450 --> 00:12:26.050
We worked hard on that.

00:12:26.049 --> 00:12:27.149
NetRestore sources.

00:12:27.149 --> 00:12:33.699
Not only can you use a system image that includes
the image itself that it's going to restore,

00:12:33.700 --> 00:12:40.240
so this is wrapping an ASR restore
volume into a NetBoot environment.

00:12:40.240 --> 00:12:47.129
So that may be like 6 GB or 10 GB
image that self-contains the image.

00:12:47.129 --> 00:12:53.950
There's also an option to include just the
booting environment and then refer other sources

00:12:53.950 --> 00:12:56.090
where to actually restore the image from.

00:12:56.090 --> 00:13:00.879
So yo can use HTTP sources, you
can use ASR Multi-Cast streams,

00:13:00.879 --> 00:13:04.120
so something that is not embedded into the image itself.

00:13:04.120 --> 00:13:09.679
So using a very lightweight boot environment
that then restores any variety of sources

00:13:09.679 --> 00:13:12.889
and includes also support for Bonjour discovery.

00:13:12.889 --> 00:13:18.569
So if you have images that are transient on the
network or you just want to have one single image

00:13:18.570 --> 00:13:27.720
that contains no images in itself, points to no other
source on the network, you can put up a Bonjour registration

00:13:27.720 --> 00:13:34.519
on the network, and the restore mechanism picks that
up and shows that as an available restore source.

00:13:34.519 --> 00:13:40.110
And when all the system restores have happened,
you can take down the Bonjour registration,

00:13:40.110 --> 00:13:49.220
and if anyone boots into that image again, they'll just
see an empty shell without any images to restore for it.

00:13:49.220 --> 00:13:51.850
So that's Bonjour discovery.

00:13:51.850 --> 00:13:57.019
We've improved the Automator support,
better support for variables.

00:13:57.019 --> 00:14:01.699
So if you use System Image Utility
workflows from the command line,

00:14:01.700 --> 00:14:06.950
now variables are more of a useful
feature than with the way before.

00:14:06.950 --> 00:14:15.070
So now we can actually create an entire disk image with all
the settings for source and target and disk name and index

00:14:15.070 --> 00:14:19.090
and whatnot through variables that
you can plug in from the command line.

00:14:19.090 --> 00:14:24.850
And we've included support for - well we
haven't included, we support Automator services.

00:14:24.850 --> 00:14:30.540
So Automator has now a new workflow type that
integrates with the services featuring OS X

00:14:30.539 --> 00:14:38.360
where if you create an image creation workflow within
the Automator application, you can save that as a service

00:14:38.360 --> 00:14:42.970
and then use that through contextual menus in the OS.

00:14:42.970 --> 00:14:45.350
So let me show you a couple of screenshots.

00:14:45.350 --> 00:14:49.550
Here are some new actions that we built.

00:14:49.549 --> 00:14:57.000
NetRestore basically is a third option now, here
it's shown as using a disk image as the source.

00:14:57.000 --> 00:15:03.740
And as you can see, we can customize the target volume
name and this basically replaces the old feature

00:15:03.740 --> 00:15:08.019
where we created a NetInstall from volume.

00:15:08.019 --> 00:15:12.029
So if this was a volume source, instead
of doing an install from volume,

00:15:12.029 --> 00:15:16.799
we now do a NetRestore image from a source volume.

00:15:16.799 --> 00:15:18.159
Directory binding.

00:15:18.159 --> 00:15:22.600
Here you can plug in the authentication information.

00:15:22.600 --> 00:15:27.960
If the directory that the system is bound to
doesn't require authentication, it's optional.

00:15:27.960 --> 00:15:30.490
If it requires it, it'll be marked as such.

00:15:30.490 --> 00:15:35.950
And Brian will go through this action
in a little more detail in his demo.

00:15:35.950 --> 00:15:37.400
Custom NetRestore sources.

00:15:37.399 --> 00:15:44.929
So here's a way to create a lightweight NetRestore image
that includes just the booting OS and the application

00:15:44.929 --> 00:15:51.370
that we'll perform the ASR restore
without any images in the image itself.

00:15:51.370 --> 00:15:57.340
Here you can plug in HTTP sources or ASR sources,
and you can define whether or not to look

00:15:57.340 --> 00:16:00.300
for Bonjour registrations for these sources.

00:16:00.299 --> 00:16:08.099
And there's also an option for the user to type
in a URL that they know is a valid restore source.

00:16:08.100 --> 00:16:10.560
Automator variables report.

00:16:10.559 --> 00:16:20.219
So here we can plug in variables into the appropriate fields
and then run this from terminal or cron jobs or launchd.

00:16:20.220 --> 00:16:21.779
And here is the Automator services.

00:16:21.779 --> 00:16:26.199
So if you've used Automator in
the latest Snow Leopard builds,

00:16:26.200 --> 00:16:29.850
here's where you'd actually create a service workflow.

00:16:29.850 --> 00:16:34.500
Once the service workflow is defined,
you'll access it using contextual menus,

00:16:34.500 --> 00:16:38.779
so here's a workflow that applies to an installation disk.

00:16:38.779 --> 00:16:47.899
So when I Control-click on that volume, I can now create a
NetRestore image from that without any user intervention.

00:16:47.899 --> 00:16:55.559
So you can probably use it for a way to save this as, or
some other details, but this could be entirely hands off.

00:16:55.559 --> 00:17:01.309
Create the workflow once, save it as a service, and
whatever new disk image you get, apply the workflow

00:17:01.309 --> 00:17:06.700
or apply the service against that disk image
source and you have a new NetRestore image.

00:17:06.700 --> 00:17:09.470
Really powerful stuff here.

00:17:09.470 --> 00:17:15.009
So let me invite Brian Nesse up and
he'll show you some of the new actions.

00:17:15.009 --> 00:17:19.559
[ Applause ]

00:17:19.559 --> 00:17:20.970
>> OK, thanks, Jussi.

00:17:20.970 --> 00:17:30.470
Let me get the demo machine on here and all set up.

00:17:30.470 --> 00:17:41.470
OK, good. Let's see if we can get this to - I
should make this a little bigger for you here.

00:17:41.470 --> 00:17:48.480
OK. So when you launch SIU you're going to
see a screen that looks something like this.

00:17:48.480 --> 00:17:55.299
You see I've got A volume here and it's offering me the
option to make either a NetBoot or a NetRestore image.

00:17:55.299 --> 00:18:05.379
If I select this Install Image here, you'll see it gives
me the option to do NetBoot, NetInstall, or NetRestore.

00:18:05.380 --> 00:18:16.290
Real simple workflow here, you just say continue,
it's going to ask you for some data, the network disk,

00:18:16.289 --> 00:18:19.599
which is what your clients are
going to see in the Startup Disk.

00:18:19.599 --> 00:18:30.149
Description, which is just something that the server
administrator can see in the server admin software.

00:18:30.150 --> 00:18:37.820
It's going to ask you for your account name, so
I'm just going to give it that, give it a password,

00:18:37.819 --> 00:18:42.029
and say create, agree to your software license.

00:18:42.029 --> 00:18:49.410
It's going to ask you whether you what do you want to save
it as, and it's going to ask you where you want to save it.

00:18:49.410 --> 00:18:54.940
Now since I'm doing this on a configured server, it's
gone out and found my share point and said oh, here,

00:18:54.940 --> 00:19:00.880
this is probably where you want to
save it, so why don't you do that?

00:19:00.880 --> 00:19:08.000
You may want to do some customization to your images, and
in that case, what you're going to want to do is instead

00:19:08.000 --> 00:19:12.430
of clicking Continue and taking the easy
route here, you're going to say Customize.

00:19:12.430 --> 00:19:17.610
Again, the software license, and
- oh, that's not going to work.

00:19:19.839 --> 00:19:23.599
All right, let's get that - OK, there we go.

00:19:23.599 --> 00:19:26.719
Now what this is going to do is open up a workflow,

00:19:26.720 --> 00:19:35.009
and you'll notice that these three actions here are
very analogous to what we just did in the assistant.

00:19:35.009 --> 00:19:45.839
We've got our sources, we've got our
place to put in our user and password.

00:19:45.839 --> 00:19:50.359
And then down here we have our selection for
what kind of image we're going to create.

00:19:50.359 --> 00:19:57.719
There's a couple of extra things here, we've got the
installed volume, which if you're doing like a NetRestore

00:19:57.720 --> 00:20:05.100
or in some of the other scenarios as well,
you can give it the name of the target volume

00:20:05.099 --> 00:20:09.299
that you actually want the clients
to see when they boot into it.

00:20:09.299 --> 00:20:16.589
Again, we have the share point here where I want
to save it, the name that I want to save it as.

00:20:16.589 --> 00:20:21.399
Down here we have some stuff that's
pertinent to the image itself,

00:20:21.400 --> 00:20:26.240
so again the name that you're going
to see in the Startup Disk.

00:20:26.240 --> 00:20:32.789
And image index which we randomly assigned in the
assistant, this gives you a little more control if you want

00:20:32.789 --> 00:20:40.529
to try sequencing your images or
something, and then again, the description.

00:20:40.529 --> 00:20:47.119
Now we've gotten some feedback, we heard that some
of you wanted to be able to make install images

00:20:47.119 --> 00:20:54.259
that would simply boot into the setup
assistant, so this action here is now optional.

00:20:54.259 --> 00:21:02.279
You can take this out and this will simply produce
an install that, when it's done installing,

00:21:02.279 --> 00:21:08.049
it will go into Mac Buddy just like it would
if you had had it installed from your CD.

00:21:09.069 --> 00:21:13.879
So let's move on and talk about some customization options.

00:21:13.880 --> 00:21:18.970
The first one we've got is Add Packages.

00:21:18.970 --> 00:21:27.000
Say if you've got internal developers, you might want
to be able to have Xcode preinstalled on your system,

00:21:27.000 --> 00:21:35.150
so you go into your OS Install and
grab the Xcode package and add that.

00:21:35.150 --> 00:21:42.240
Something else you might want to do, if you have
a lab or you need to manage a lot of systems,

00:21:42.240 --> 00:21:49.490
you might want to have something like ARD
installed on it, so we can also add that.

00:21:49.490 --> 00:21:56.130
And once you've installed ARD, the next thing you're
probably going to want to do is to configure it

00:21:56.130 --> 00:22:04.190
so that it is active on startup, and I have a
script that does that, so I'm going to add this too.

00:22:04.190 --> 00:22:11.630
So this is a post-install script that will get
executed after the installation is completed.

00:22:11.630 --> 00:22:20.960
So we've got a bunch of packages now, so now
maybe we don't want the packages installed

00:22:20.960 --> 00:22:23.900
as they are when you boot into the installer.

00:22:23.900 --> 00:22:30.850
So we offer customized package selection, and this takes
a little while to boot up because it's actually reading

00:22:30.849 --> 00:22:35.409
through all these packages and
searching out what they've got in them.

00:22:35.410 --> 00:22:36.509
So you'll see that we've found -

00:22:36.509 --> 00:22:37.750
[ Applause ]

00:22:37.750 --> 00:22:38.710
>> Thanks.

00:22:38.710 --> 00:22:40.910
[ Applause ]

00:22:40.910 --> 00:22:43.900
>> And so you'll see we've found
not only the install disk here,

00:22:43.900 --> 00:22:47.070
but we also found the Xcode package
and the Remote Desktop package.

00:22:47.069 --> 00:22:52.009
I'll open this up here and make this
a little bigger so you can see it.

00:22:52.009 --> 00:22:56.910
[ Applause ]

00:22:56.910 --> 00:23:05.120
>> So you see this is kind of a daunting
interface but there is a reason for it.

00:23:05.119 --> 00:23:13.319
If you've done a system installation, I assume most of
you have, you've probably seen something similar to this,

00:23:13.319 --> 00:23:20.029
you go into the printer support and you're going
to see something like Nearby and Popular Printers

00:23:20.029 --> 00:23:24.029
which is going to be selected by default.

00:23:24.029 --> 00:23:30.639
If the default checkbox here is not selected then
this is an item which is not going to be selected

00:23:30.640 --> 00:23:34.060
in the installer by default when you boot into it.

00:23:34.059 --> 00:23:41.740
So in this case, All Available
Printers is not selected by default.

00:23:41.740 --> 00:23:48.980
If you wanted to edit this image and say by default you
wanted those extra printers enabled, you could turn that on,

00:23:48.980 --> 00:23:54.059
and then when this workflow runs,
when the client boots into it,

00:23:54.059 --> 00:23:59.559
that will be a selected option
when they initially bring it up.

00:23:59.559 --> 00:24:07.470
On the other hand, you may not want that extra gigabyte
worth of printer drivers, so we have this visible option.

00:24:07.470 --> 00:24:17.390
And what this does is defines whether the person running
the installer actually gets to see this option or not.

00:24:17.390 --> 00:24:25.259
So you can completely eliminate their ability to put
in all available printers by simply turning this off.

00:24:25.259 --> 00:24:35.680
What this will do is set it up so that they
aren't getting it and they can't see it.

00:24:35.680 --> 00:24:45.279
And alternatively, if you want to say guarantee that they
can't turn off Nearby and Popular Printers, you can do this.

00:24:45.279 --> 00:24:54.379
So now what this does is it hides the option so they
can't access it, but now it is selected which means

00:24:54.380 --> 00:25:00.300
that it will get installed and
there's nothing they do about it.

00:25:00.299 --> 00:25:07.109
You may have noticed here that we have this Printers
Used by This Mac which is disabled, I can't click on it.

00:25:07.109 --> 00:25:10.229
All that means is that this is a required package.

00:25:10.230 --> 00:25:15.910
So if you want printer support, this is
going to get installed no matter what.

00:25:15.910 --> 00:25:19.830
And you kind of notice here that
it sort of correlates to Nearby

00:25:19.829 --> 00:25:27.480
and Popular Printers, so just in case you missed that.

00:25:27.480 --> 00:25:33.450
And you'll notice Xcode, you can do the same thing,
we have defaults and not defaults, invisible,

00:25:33.450 --> 00:25:38.140
and disabled things that we can't change.

00:25:38.140 --> 00:25:42.500
So that's the install customization.

00:25:42.500 --> 00:25:51.539
The next thing you might want to do is after the install,
you may want to apply some system configurations,

00:25:51.539 --> 00:25:55.089
and we do that with Apply System Configuration settings.

00:25:55.089 --> 00:26:02.889
Here is, Jussi was showing earlier where
we have the AD and OD server bindings.

00:26:02.890 --> 00:26:08.009
If you want to bind a server you simply
check that, add a server to your list.

00:26:08.009 --> 00:26:15.190
You'll see I have an Open Directory server
here, the user and password are optional.

00:26:15.190 --> 00:26:18.650
The Ethernet address here is also sort of optional.

00:26:18.650 --> 00:26:22.050
If you want to - I'm sorry.

00:26:22.049 --> 00:26:27.950
You're going to use this probably in a lab
environment, say you're making a NetBoot image,

00:26:27.950 --> 00:26:31.230
you're going to have a bunch of clients booting off this.

00:26:31.230 --> 00:26:36.579
The Ethernet address, if you have say
three machines that you want bound to this,

00:26:36.579 --> 00:26:43.419
you'd put in their Ethernet addresses in here and then
those three machines would be bound to that server.

00:26:43.420 --> 00:26:51.660
If you just leave that empty, then it will apply that to all
of the computers that get booted from that NetBoot image.

00:26:51.660 --> 00:26:58.310
And then again to refer to something you see mentioned
earlier, if I select my Active Directory server here,

00:26:58.309 --> 00:27:01.919
you'll notice that it hints here
that these are going to be required.

00:27:01.920 --> 00:27:06.860
And if you don't put them in, you're
going to get a non-functional binding.

00:27:07.960 --> 00:27:11.779
The next thing you might want to do,
especially again in a lab environment is

00:27:11.779 --> 00:27:16.539
to apply some sort of computer naming to your systems.

00:27:16.539 --> 00:27:23.599
This is real simple, you just import
a file and you're ready to go.

00:27:23.599 --> 00:27:30.289
So this is the mystical computer naming
file, and it's a very simple file,

00:27:30.289 --> 00:27:35.750
it's just a text file tabbed limited, four fields.

00:27:35.750 --> 00:27:42.319
The Mac address of the computer that you want to
name, a host name that you want to apply to it,

00:27:42.319 --> 00:27:51.029
a computer name that you want to apply to
it, and a Bonjour name or local host name.

00:27:51.029 --> 00:27:56.730
And what that corresponds to, just in case you're not aware,

00:27:56.730 --> 00:28:02.670
is in the sharing panel here, computer
name, this field here.

00:28:02.670 --> 00:28:13.960
And the local host name or the Bonjour
name here, this field on the end.

00:28:13.960 --> 00:28:18.130
The other thing of note about this file is
that these last two fields are optional,

00:28:18.130 --> 00:28:26.040
so you'll see here in this second entry,
this computer is going to be assigned a name,

00:28:26.039 --> 00:28:33.480
but it's going dynamically configure its local
host name, which it will do based on this.

00:28:33.480 --> 00:28:41.870
And on this computer here, we have assigned
nothing, so it is going to simply default

00:28:41.869 --> 00:28:47.759
to whatever the machine might have currently set up on it.

00:28:47.759 --> 00:28:51.500
You'll notice that all of these have host names configured.

00:28:51.500 --> 00:28:55.940
If you're in an environment where you say
have maybe DNS and DHCP servers running

00:28:55.940 --> 00:29:01.799
and you're already assigning host names, you can use
this automatic key, and what that will do is sort

00:29:01.799 --> 00:29:04.589
of allow you to skip the host name field.

00:29:04.589 --> 00:29:11.819
So this will basically tell this machine
go do whatever the servers tell you to do

00:29:11.819 --> 00:29:17.119
and then apply this computer name and this host name to it.

00:29:17.119 --> 00:29:21.209
So that's the structure of that file.

00:29:21.210 --> 00:29:28.860
Let me get this back up here.

00:29:28.859 --> 00:29:37.209
So that's pretty much what we've got for
the options for configuring your install.

00:29:37.210 --> 00:29:47.950
The next thing you probably will want to do is actually
configure your install time, your run time installation.

00:29:47.950 --> 00:29:51.559
And we have a couple of actions to help with that.

00:29:51.559 --> 00:29:54.149
We've enabled automated installation.

00:29:54.150 --> 00:30:02.670
Now what this will do, if you drag this in and run
this as is, when your client boots into the installer,

00:30:02.670 --> 00:30:08.259
what they're going to see is the installer is going to come
up, it's going to say where do you want to install this?

00:30:08.259 --> 00:30:15.569
And they're going to select a volume, and then it's
going to run an installation completely unattended.

00:30:15.569 --> 00:30:22.529
So what that means is that whatever you set up up here in
your defaults, is going to get installed on their system

00:30:22.529 --> 00:30:28.649
with no interaction from the user at all other
than selecting which volume they want it on.

00:30:28.650 --> 00:30:39.030
Now if you want a totally unattended installation,
you'd select this name here and pick a hard drive,

00:30:39.029 --> 00:30:47.920
and what that'll do is now you
have a totally unattended install.

00:30:47.920 --> 00:30:51.470
What's going to happen is it's going out there boot
into the installer, the installer is going to look,

00:30:51.470 --> 00:31:00.890
it's going to find the drive Name/Macintosh/HD,
and it's going to lay the system down on top of it.

00:31:00.890 --> 00:31:08.259
Now you have the option of either doing an upgrade
install or doing an erase, a clean install,

00:31:08.259 --> 00:31:15.539
both work effectively the same way, and then
you can also select the default language

00:31:15.539 --> 00:31:18.730
that you want the system to boot into.

00:31:18.730 --> 00:31:26.519
And if you want to take erasing the hard drive to the
next level, we also have the Partition Disk option.

00:31:26.519 --> 00:31:34.250
And what this will do is present a little app up in
front of the installer which will basically say hey,

00:31:34.250 --> 00:31:43.200
you want to partition your hard drive, please select a
drive and then you can take a single-partition machine

00:31:43.200 --> 00:31:50.630
and give it multiple partitions, or you can take the machine
that has multiple partitions and wipe it back down to one.

00:31:50.630 --> 00:31:56.370
You see this looks kind of familiar, this is
basically ripped off from Disk Utility because we kind

00:31:56.369 --> 00:31:59.629
of figured everybody knew what that looked like.

00:31:59.630 --> 00:32:05.540
So you have a place to put in your volume
name and a place to pick your format.

00:32:05.539 --> 00:32:16.289
Where we differ a little bit is here because what we do is
basically since we don't know what we're about to destroy,

00:32:16.289 --> 00:32:25.599
we sort of give you the opportunity
to just make it do the right thing.

00:32:25.599 --> 00:32:33.709
So we allow you to just say, give me two volumes each
of which are 50 percent of the drive, or you can say,

00:32:33.710 --> 00:32:37.750
make this one 37 percent and t7hat one 62 percent.

00:32:37.750 --> 00:32:44.640
The other thing you can do is make one volume an absolute
size so you can say make this first one 20 gigabytes

00:32:44.640 --> 00:32:50.160
and then make the other volume the rest of the disc.

00:32:50.160 --> 00:32:54.860
And again, this also has a don't disturb me option,

00:32:54.859 --> 00:33:00.759
you can say partition the disk
containing a volume, give it a volume.

00:33:00.759 --> 00:33:09.410
And what this will do is similar to the installer, it'll
boot up, it'll find a volume, it will take whatever drive

00:33:09.410 --> 00:33:14.509
that volume is on, and repartition it as you've dictated.

00:33:14.509 --> 00:33:19.049
Now one thing you've got to be aware of
in is if you're using this in conjunction

00:33:19.049 --> 00:33:25.200
with the enable automated installation, you need to
make sure that you put one of these volumes in here,

00:33:25.200 --> 00:33:30.160
because otherwise your installation will fail.

00:33:30.160 --> 00:33:35.730
Had that happen, it's not good.

00:33:35.730 --> 00:33:46.660
So that's what we've got for customization
for the installation.

00:33:46.660 --> 00:33:53.980
Sorry, lost my train of thought there.

00:33:53.980 --> 00:34:06.289
The next thing that we have is when you're actually in the
user environment, we have a couple of items that we can use

00:34:06.289 --> 00:34:12.090
to help you customize what your user is going
to see, and that is these two filtering actions,

00:34:12.090 --> 00:34:20.640
and these again are real simple, Filter by
Mac Address simply takes a list of addresses

00:34:20.639 --> 00:34:25.960
and makes either a black list or
a white list out of it as to

00:34:25.960 --> 00:34:32.820
which computers either can or cannot
see this particular image.

00:34:32.820 --> 00:34:41.860
You can also import these from a list, or you can just type
them in directly, and it'll give you a little template here.

00:34:41.860 --> 00:34:53.510
And then the Filtered Computer Models down here, this is if
you want to make an image that is specifically for a class

00:34:53.510 --> 00:35:01.560
of machines, say we want to look for MacBooks, I can make
an image that will only be visible to clients who boot

00:35:01.559 --> 00:35:07.269
into my server with a MacBook error for instance.

00:35:07.269 --> 00:35:14.900
So that is pretty much what we have for actions these days.

00:35:17.400 --> 00:35:30.099
You've created a workflow here, this is basically an
automated workflow, you can save it and you get a workflow.

00:35:30.099 --> 00:35:39.690
If you run this, we have logging going on here,
I see we've been selecting a lot of volumes.

00:35:39.690 --> 00:35:45.889
And the logging, our big preference panel
here of two preferences where you want

00:35:45.889 --> 00:35:49.849
to save your workflows, and what level you want the log at.

00:35:49.849 --> 00:35:58.239
And hopefully you don't need any more than verbose
if you're having problems, debugging is useful.

00:35:58.239 --> 00:36:02.689
That's about it.

00:36:02.690 --> 00:36:13.740
Real quick, I'm going to flip over
to Automator here and show you.

00:36:13.739 --> 00:36:26.529
If we want to make an Automator service here real quick,
I don't know if any of you are familiar with Automator.

00:36:26.530 --> 00:36:34.360
This isn't particularly different, you'll see what happens
is you get this little box up here that has a couple

00:36:34.360 --> 00:36:43.510
of options, and what we're going to do is make a
quick one here out of a System Image Utility workflow,

00:36:43.510 --> 00:36:47.700
we're just going to make one that
works in the Finder with folders.

00:36:47.699 --> 00:36:56.889
Go down here and grab some actions, we're going to make
this real simple, we'll just take a Create and a Define.

00:36:58.510 --> 00:37:10.700
And then of course there's the
important part we need to tie in to this.

00:37:10.699 --> 00:37:19.879
So what we're going to do here is take
the input that comes from the Finder,

00:37:19.880 --> 00:37:28.390
we're going to put it into this source volume variable,
and then we're going to put that source volume variable

00:37:28.389 --> 00:37:32.579
and pass that on into our Define Image Source.

00:37:32.579 --> 00:37:38.690
And then we're going to put some say -- get this down.

00:37:38.690 --> 00:37:47.139
And then we're just going to give
it a name, and a Startup Disk name.

00:37:49.349 --> 00:37:51.639
We've got an image index.

00:37:59.550 --> 00:38:08.600
And then we just would simply save this
- I've actually created one ahead of time

00:38:08.599 --> 00:38:12.500
so I'm just going to show you what it looks like here.

00:38:12.500 --> 00:38:20.519
If I Control-click on this volume, you'll see that
I have my service here and I just select that.

00:38:20.519 --> 00:38:24.739
And what it did, I'm not going to run
this because it will take forever.

00:38:24.739 --> 00:38:30.859
But what it did is it basically took Mac OS
Install DVD, passed it into my Create Image action,

00:38:30.860 --> 00:38:39.420
which is now asking me to authenticate as
administrator so that it can go off and build its image.

00:38:39.420 --> 00:38:47.690
And that is what I have to show you, I am going to
pass you back to Jussi here who is going to talk to you

00:38:47.690 --> 00:38:51.010
about what you're going to do with these
images now that you've created them.

00:38:51.010 --> 00:38:58.120
[ Applause ]

00:38:58.119 --> 00:38:59.099
>> Do you want slides?

00:38:59.099 --> 00:38:59.650
>> All right.

00:38:59.650 --> 00:39:01.380
Thank you, Brian.

00:39:01.380 --> 00:39:05.750
So that's SIU 2 in system images of the two in Snow Leopard.

00:39:05.750 --> 00:39:11.730
So significantly improved over
the older version we had in 10.5.

00:39:11.730 --> 00:39:18.400
And again, 10.6, System Image Utility
creates images from 10.6 sources,

00:39:18.400 --> 00:39:23.840
so Snow Leopard tools for Snow Leopard
images, Leopard tools for Leopard images.

00:39:23.840 --> 00:39:25.990
So booting into images.

00:39:25.989 --> 00:39:32.539
I was just doing some math back there and I counted like
how many ways are there to boot into NetBoot images.

00:39:32.539 --> 00:39:34.199
I counted like seven.

00:39:34.199 --> 00:39:35.809
Startup Disk.

00:39:35.809 --> 00:39:41.949
So Startup Disk is by default the easiest
way to get to your NetBoot images obviously.

00:39:41.949 --> 00:39:44.549
So these has a couple of constraints though.

00:39:44.550 --> 00:39:52.030
The NetBoot image has to be on your local network or
you have to have DHCP helpers assigned so that you pass

00:39:52.030 --> 00:39:58.170
on the DHCP packets or requests over to your
NetBoot server that's not local to the network.

00:39:58.170 --> 00:40:06.130
You can also use Option Boot or using the Startup Manager,
so this is holding down Option key while you start

00:40:06.130 --> 00:40:13.440
up your system and on internal hardware you
can also do Option and then holding N key,

00:40:13.440 --> 00:40:20.090
that'll go into a default mode, so basically
we're just rediscovering the image on the network.

00:40:20.090 --> 00:40:29.740
Bootpd(8) relay is an option to basically reroute the DHCP
requests that are not passed on by DHCP helpers and routers.

00:40:29.739 --> 00:40:36.759
So if your ISNT administrators or network admins
are reticent to about setting up DHCP helpers, well,

00:40:36.760 --> 00:40:41.400
more power to you because you have the
option to set up a system on your network.

00:40:41.400 --> 00:40:53.389
Some lowly Mac mini or old PowerBook G4, run Leopard or Snow
Leopard on it and configure a bootpd relay on that system.

00:40:53.389 --> 00:40:59.769
Basically listening on anything that's coming in
on DHCP requests and then forwarding those requests

00:40:59.769 --> 00:41:03.980
onto your NetBoot server on the [inaudible].

00:41:03.980 --> 00:41:12.369
You can also bless systems from the command line, so
you can use bless to opt in for NetBoot through the - -

00:41:12.369 --> 00:41:20.299
service I think, and you can also set explicit
nvram settings to boot over the network.

00:41:20.300 --> 00:41:27.870
And there's also a com.apple.Boot.plist way to do
NetBoot, basically saying that my route device is

00:41:27.869 --> 00:41:31.769
on the network, and knowing where the route path is.

00:41:31.769 --> 00:41:38.039
And on Open Source there's a version of the
boot services discovery protocol client,

00:41:38.039 --> 00:41:47.809
so bsdpc is the boot service discovery protocol
client that also allows you to do similar things

00:41:47.809 --> 00:41:55.279
that you would use Startup Disk for, effectively
selecting any given image that the system has visibility.

00:41:55.280 --> 00:41:57.530
So here's Startup Disk, how it looks like.

00:41:57.530 --> 00:42:03.340
So in the default mode, you have Startup Disk with
a few images and some nomenclature that's changed,

00:42:03.340 --> 00:42:08.670
so the network startup is now called the network disk.

00:42:08.670 --> 00:42:15.530
So this is the new name under Snow Leopard, I
think we called this "network volume" before.

00:42:15.530 --> 00:42:23.680
And if you hover over the image, so what this gives you is
information where this particular network disk is served on.

00:42:23.679 --> 00:42:28.839
So this gives you the server address,
offering this image up on the network.

00:42:28.840 --> 00:42:36.490
And if you happen to find a network disk that
has a name that doesn't fit in the window,

00:42:36.489 --> 00:42:42.009
the name is still shown in the
blurb under the scroll window.

00:42:42.010 --> 00:42:44.860
So you can still tell what the image is actually called.

00:42:44.860 --> 00:42:51.070
And if you have more than six images on the network, like
you have multiple, multiple different choices to install

00:42:51.070 --> 00:42:55.809
or NetBoot or use NetRestore from,
then you will actually get a list view

00:42:55.809 --> 00:43:01.259
where each individual server is identified
and the image types are identified.

00:43:01.260 --> 00:43:08.100
So the image types are effectively either
NetBoot of Mac OS or Mac OS Server,

00:43:08.099 --> 00:43:12.319
or NetInstall of Mac OS or Mac OS X Server.

00:43:12.320 --> 00:43:23.050
And bootpd relay, so this is something that was introduced
in Leopard, and this ships on both client and server.

00:43:23.050 --> 00:43:28.330
So if you ever set up Internet sharing
on your desktop with Leopard or later,

00:43:28.329 --> 00:43:33.650
you've actually used a bootpd service
or bootp service on your system.

00:43:33.650 --> 00:43:39.880
And the bootpd daemon also supports
relaying the DHCP requests.

00:43:39.880 --> 00:43:48.460
So this takes in the NetBoot requests or the bsdp requests
that are coming in on your network and then forwards then

00:43:48.460 --> 00:43:53.530
on to whatever servers on your network
are the actual NetBoot servers.

00:43:53.530 --> 00:44:02.240
And this can be configured on any machine, it doesn't
interfere with your DHCP operation because this only listens

00:44:02.239 --> 00:44:07.949
on DHCP port, but doesn't necessarily
vent out authoritative DHCP information.

00:44:07.949 --> 00:44:14.250
It only passes packets on to some other
servers acting as a gobetween or middleman.

00:44:14.250 --> 00:44:22.110
And to bring up bootpd, you'd use launchctl
to load the bootpd.plist, and that's it.

00:44:22.110 --> 00:44:25.990
And here are the options for doing
NetBoot from the command line.

00:44:25.989 --> 00:44:33.669
So as I mentioned, you can use bless, you can use nvram,
you can also do manual edits of com.apple.Boot.plist,

00:44:33.670 --> 00:44:43.630
or you can use the bsdpc command line interface that's
available for personal compiles through Open Source.

00:44:43.630 --> 00:44:45.110
And a little bit under the hood.

00:44:45.110 --> 00:44:48.829
So how does NetBoot, NetInstall, and
NetRestore, how do these all work?

00:44:48.829 --> 00:44:53.389
If you've ever looked into let's
say the Mac OS X installation DVD,

00:44:53.389 --> 00:44:59.509
you'll find that there are things there
like rc.install or an install config.

00:44:59.510 --> 00:45:02.860
If you've ever looked into images that
System Images Utility has created,

00:45:02.860 --> 00:45:09.070
you will find things like installer's choice
changes, or you'll find install preferences.

00:45:09.070 --> 00:45:14.120
So these are files that basically
determine how that particular image is

00:45:14.119 --> 00:45:17.589
to be treated when a user boots into that.

00:45:17.590 --> 00:45:24.289
So I'll go and show you a little bit
how these actually work all together.

00:45:24.289 --> 00:45:30.619
So let's go to this machine.

00:45:30.619 --> 00:45:37.089
So first off, a little bit about diagnostics.

00:45:37.090 --> 00:45:42.559
So if you've ever tried to diagnose why does NetBoot
not work, so the first thing you'd want to know,

00:45:42.559 --> 00:45:45.769
do your clients actually start up at all?

00:45:45.769 --> 00:45:49.960
You see the blinking icon and like something
goes away, and you figure what the heck,

00:45:49.960 --> 00:45:55.630
like do I need to get a network packet sniffer
or do I need to do a port metering or whatnot.

00:45:55.630 --> 00:46:00.579
The easiest way, the fastest way to quickly
diagnose if NetBoot is working at all

00:46:00.579 --> 00:46:04.819
from the server towards the client,
is look at some of the system logs.

00:46:04.820 --> 00:46:12.970
So what I've done here is I've configured
SysLogConfig to basically log everything.

00:46:12.969 --> 00:46:14.849
So I've added *.

00:46:14.849 --> 00:46:19.589
*, so this means that every single message that's coming

00:46:19.590 --> 00:46:26.440
in through the Apple system log facility will
get in a file, so I've kill -HUPped syslogd.

00:46:26.440 --> 00:46:34.490
So if I was just editing this for the first
time, I do a kill -HUP or kill all -HUP syslogd

00:46:34.489 --> 00:46:42.209
and now I have a debug log, so that's plenty of stuff.

00:46:42.210 --> 00:46:46.559
So now we can look for specifically
what's related to NetBoot.

00:46:46.559 --> 00:47:00.329
NetBoot uses two services, so this would be the
bootpd process, so I egrep bootpd or I will call tftp.

00:47:00.329 --> 00:47:07.949
So on a different system, so I let that
run here and I go to a different machine

00:47:07.949 --> 00:47:11.119
and use Startup Disk, actually I can probably show you this.

00:47:11.119 --> 00:47:15.179
Yes. So I'm on my network, great.

00:47:15.179 --> 00:47:19.929
In Startup Disk I have some network disks.

00:47:19.929 --> 00:47:27.029
So here I've selected the network disk, so if I look back
on the server, I see that there were DHCP requests that came

00:47:27.030 --> 00:47:31.920
into the server and this is as we can tell, Marina demo two.

00:47:31.920 --> 00:47:35.619
So in this package space you could tell that some system

00:47:35.619 --> 00:47:39.920
on the network was trying to discover
which images were available.

00:47:39.920 --> 00:47:49.510
So I'll go and boot this machine into those images,
so restart, and we don't have stream mirroring here

00:47:49.510 --> 00:47:53.140
because we're doing dual ports, so I'll just go back here.

00:47:53.139 --> 00:47:58.699
So now the system is rebooting, it'll come
back on the network in a couple of seconds,

00:47:58.699 --> 00:48:01.210
and I'm still looking at a blank screen here.

00:48:01.210 --> 00:48:06.909
OK, now I heard the tone, so now I
get the screen, I get the globe soon.

00:48:06.909 --> 00:48:08.460
Do I get the globe?

00:48:08.460 --> 00:48:12.750
And we should see this in the slide here
too, so whenever the system is actually live,

00:48:12.750 --> 00:48:18.730
there's going to be a DHCP request and there we go.

00:48:18.730 --> 00:48:22.280
So we get a DHCP offer and we can actually stop there.

00:48:22.280 --> 00:48:24.420
So that's all the interesting bits we saw.

00:48:24.420 --> 00:48:33.590
So we know that there is a client that received a DHCP offer
and that is the boot services discovery protocol offer.

00:48:33.590 --> 00:48:39.570
And that told that hey, here's this image available
for this machine, and go and start booting up from it.

00:48:39.570 --> 00:48:46.180
And for tftpd, we actually some extra logging enabled,

00:48:46.179 --> 00:48:52.829
and this tells tftpd to log every single
file push that goes out from the server.

00:48:52.829 --> 00:48:59.969
So if you see any broken globes in your network
environment, and see like something not booting

00:48:59.969 --> 00:49:06.209
into the NetBoot images properly, and you think that
it might be a different server that's vending images

00:49:06.210 --> 00:49:10.780
or your clients aren't getting the images from the
right server, then here you would be able to tell

00:49:10.780 --> 00:49:17.600
on any given NetBoot server, if you see that tftp traffic
from the server, then you can know that at least the booter

00:49:17.599 --> 00:49:19.980
and the kernel were pushed out to the client.

00:49:19.980 --> 00:49:24.219
So those are the minimum requirements for
anything to work for a system to boot.

00:49:24.219 --> 00:49:30.589
So this is at least some awareness
of a working NetBoot environment.

00:49:30.590 --> 00:49:38.820
If you don't see these requests go out from the
server, then you know that it's time to get EtherPeek

00:49:38.820 --> 00:49:45.120
or Wire Shark or other more involved tools.

00:49:45.119 --> 00:49:48.079
So that's just a quick summary.

00:49:48.079 --> 00:49:57.920
And one thing that caused this tftpd logging to happen is a
configuration in system/library/launch/daemons/tftp.plist.

00:49:57.920 --> 00:50:00.880
So here you can see that this is actually -I.

00:50:00.880 --> 00:50:03.579
Whoops, let me quickly undo that.

00:50:03.579 --> 00:50:12.719
-I. And this is not the running configuration, so
the running configuration would be having -I-L.

00:50:12.719 --> 00:50:22.079
So -L in the tftpd configuration tells the tftp daemon to
log every transaction, and these logs are only applicable

00:50:22.079 --> 00:50:26.019
when the debug login is enabled for the system log.

00:50:26.019 --> 00:50:33.440
So that's quickly a - whoops, there we go.

00:50:33.440 --> 00:50:38.880
Quick recap of how to fast-diagnose NetBoot boot issues.

00:50:38.880 --> 00:50:41.039
So let's go into blessing them.

00:50:41.039 --> 00:50:46.659
So as I mentioned Startup Disk is the
easiest way to select NetBoot images.

00:50:46.659 --> 00:50:54.210
So here I have Startup Disk and I'm going to see the
same images that were shown on the other system already.

00:50:54.210 --> 00:50:58.449
But I can also do most of these
things from the command line.

00:50:58.449 --> 00:51:10.189
So if I bring up terminal in this environment I can use
bless - - NetBoot - - server, and then call bsdp://.

00:51:10.190 --> 00:51:18.500
And I'm going to just use a broadcast address, find me a
server somewhere, or I can also do explicit paths telling

00:51:18.500 --> 00:51:26.829
that use a booter, so - - booter and
then a path to tftp server-path-boot.dfi.

00:51:26.829 --> 00:51:35.069
And I'd need to pass another argument as
well, so if you look for documentation

00:51:35.070 --> 00:51:38.039
on a network you'll find all the
different combinations you have.

00:51:38.039 --> 00:51:45.400
One of the options is called the options, where you'd
tell the route path, and route path equals something

00:51:45.400 --> 00:51:50.360
like NFS;server and path, and then image.dng.

00:51:50.360 --> 00:52:04.360
Actually that's not correct, but we're not
going to boot in, so that doesn't really matter.

00:52:04.360 --> 00:52:09.820
So here's a bless command and you
could also do this using nvram selects.

00:52:09.820 --> 00:52:13.370
So if you do nvram boot-args for example,

00:52:13.369 --> 00:52:29.239
you can say boot-args equals route path
equals NFS;server volumes path image.dng.

00:52:29.239 --> 00:52:36.119
So there are multiple ways in the command line
to have the system boot into NetBoot images.

00:52:36.119 --> 00:52:41.699
And the last one I'm going to show from the command
line is a tool that's embedded, included in the OS,

00:52:41.699 --> 00:52:47.609
available as open source, this is the boot
services discovery protocol command line client.

00:52:47.610 --> 00:52:54.849
So what this does is effectively the same functionality
as Startup Disk, so this sends out a DHCP request

00:52:54.849 --> 00:52:58.860
out to the network and back comes
all the images that are available.

00:52:58.860 --> 00:53:03.530
And from here you can choose which image to boot into.

00:53:03.530 --> 00:53:15.560
The way you actually get access to this is from Open
Source, so this has been part of Darwin for quite a while.

00:53:15.559 --> 00:53:21.610
If you go to opensource.apple.com and
find the project called Bootpd or Bootp,

00:53:21.610 --> 00:53:29.210
in Bootp the application bsdpc is the command
line, Boot Services Discovery Protocol Client.

00:53:29.210 --> 00:53:37.369
So if you compile this binary, then you should
have a command-line version of Startup Disk

00:53:37.369 --> 00:53:43.369
for selecting which network disk to boot from.

00:53:43.369 --> 00:53:47.569
So those are the ways to boot into an image.

00:53:47.570 --> 00:53:54.110
So we've booted in an image, so I've
installed a couple of sample environments here,

00:53:54.110 --> 00:54:03.970
so I have two machines that are now booted into NetInstall,
I call NetInstall target one, and NetInstall target two.

00:54:03.969 --> 00:54:13.849
They're booted into identical images, so I have three images
on the network, NetRestore, NetInstall, and NetInstall Auto.

00:54:13.849 --> 00:54:18.529
I am vending these images from a
library that has just three images.

00:54:18.530 --> 00:54:22.800
So nothing up my sleeves, there are
really just three images out there.

00:54:22.800 --> 00:54:26.460
So what I'm going to show you is
how you can actually customize some

00:54:26.460 --> 00:54:32.050
of these runtime behaviors dynamically
based on how these clients boot up.

00:54:32.050 --> 00:54:39.720
So let's say I wanted to have a single image and
tailor the packages that are available or selected

00:54:39.719 --> 00:54:42.559
by default for each one of these clients.

00:54:42.559 --> 00:54:47.809
So here I see that both of the
clients get identical settings.

00:54:50.130 --> 00:54:51.220
Customize.

00:54:51.219 --> 00:54:56.449
So here are two images, so the package
selections are exactly the same.

00:54:56.449 --> 00:55:13.269
So actually I've built a web server that includes
customizations per these clients and I have choices

00:55:13.269 --> 00:55:19.210
that I've made before, so if I look at my
choices files, these are basically external files

00:55:19.210 --> 00:55:21.820
that are traditionally embedded into those images.

00:55:21.820 --> 00:55:27.900
But if I move them into my web server directory,
these clients will actually pick them up.

00:55:27.900 --> 00:55:33.599
So now they have two files called NetInstall and
this is basically just the Mac address of the client.

00:55:33.599 --> 00:55:39.369
So let's see what happens when
I boot these clients into this.

00:55:39.369 --> 00:55:47.659
So this will restart that one and let's see -
In the meantime we can see this guy come up.

00:55:47.659 --> 00:55:49.329
So if the other machine was still working as well,

00:55:49.329 --> 00:55:54.650
we'd see two machines now booting up
parallel, and on the web server side.

00:55:54.650 --> 00:56:08.809
So if I'm looking at my Apache log, I can see that
there's now been a request for a NetInstall configuration.

00:56:08.809 --> 00:56:16.079
So basically this disk image that just came up went
back to the server and requested a file to be downloaded

00:56:16.079 --> 00:56:21.159
from the server, that then told this
client how to configure this installation.

00:56:26.210 --> 00:56:29.260
So now what's the difference?

00:56:29.260 --> 00:56:40.460
Now when I go into our customization settings,
when I bring up the package selection again.

00:56:40.460 --> 00:56:47.539
I think we're using tired squirrels,
it's already Thursday, so

00:56:47.539 --> 00:56:50.650
They must be working overtime now.

00:56:50.650 --> 00:56:58.840
OK, so we go here, and so this is exactly the
same image as this system was booted to before.

00:56:58.840 --> 00:57:08.120
But now the difference is that
this guy will have custom settings.

00:57:08.119 --> 00:57:12.759
If you notice before, I may still
have this other window open, do I?

00:57:12.760 --> 00:57:16.490
Yes. So if I click Customize - hey, that's a good terminal.

00:57:16.489 --> 00:57:19.159
That's why I left it open there, it was intentional, yes.

00:57:19.159 --> 00:57:23.670
You can tell that there were some changes into the packages.

00:57:23.670 --> 00:57:30.470
So what happened is that the file that was
downloaded here applied some settings into this image,

00:57:30.469 --> 00:57:38.169
so what it applied was a list of choices
that tells this client, tells the installer,

00:57:38.170 --> 00:57:42.039
what packages to include and what packages to exclude.

00:57:42.039 --> 00:57:46.079
And actually I believe in language
translations, we only use Japanese.

00:57:46.079 --> 00:57:54.869
Whereas in the default case, this
would be - OK, can we do this, no.

00:57:54.869 --> 00:57:59.089
This would have been all languages were selected by default.

00:57:59.090 --> 00:58:01.420
So how does this work?

00:58:01.420 --> 00:58:04.329
So we want to get rid of this guy.

00:58:04.329 --> 00:58:07.840
So how did this actually get working?

00:58:07.840 --> 00:58:14.960
So what happened was that when this client came
up on the network, it went back into the server,

00:58:14.960 --> 00:58:17.889
so this was one of the files that
was mentioned on the slides.

00:58:17.889 --> 00:58:25.579
So if I go to etc and look at one
of these files, I see rc.install.

00:58:25.579 --> 00:58:28.489
Now let's use less.

00:58:28.489 --> 00:58:32.259
So this is what gets run when the installation starts.

00:58:32.260 --> 00:58:40.530
And you'll notice that there's a file called
sourceALocalConfigurationScript called rc.cdrom.logo.

00:58:40.530 --> 00:58:43.750
So if that file exists, then let's read it in.

00:58:43.750 --> 00:58:48.000
Let's see what happens in rc.cdrom.logo.

00:58:48.000 --> 00:58:53.469
It looks like we're pulling up a file, so
we're reading this system's Mac address

00:58:53.469 --> 00:58:56.829
and then we're going back to a known HTTP server.

00:58:56.829 --> 00:59:03.090
We're running a CGI and passing
in the Mac address as an argument.

00:59:03.090 --> 00:59:08.410
And apparently we're getting some file
back that we're putting into /var/run.

00:59:08.409 --> 00:59:12.659
And in this install environment, we
actually have writable file systems.

00:59:12.659 --> 00:59:15.569
So if I look at what systems are mounted here,

00:59:15.570 --> 00:59:23.190
I can tell that /private/var/run is actually a
mounted RAM disk that I have write access to.

00:59:23.190 --> 00:59:28.130
So why is it called /var/run Mac OS Installer?

00:59:28.130 --> 00:59:32.590
Well what System Image Utility
built, when this image was built,

00:59:32.590 --> 00:59:37.110
there's a file called Mac OS Installer Choice Changes.

00:59:37.110 --> 00:59:42.220
But it's actually a symbolic link, so this
symbolic link points into the /var/run directory,

00:59:42.219 --> 00:59:48.069
so whatever is put into this location
dynamically at runtime, is the effective settings

00:59:48.070 --> 00:59:53.190
when this machine is booted into that image.

00:59:53.190 --> 01:00:02.510
So that's one way to customize any system on the
network with minor tweaking and this is really

01:00:02.510 --> 01:00:11.180
like propeller-hat time, I forgot my pocket protector and my
beanie cap which would have been totally appropriate here.

01:00:11.179 --> 01:00:15.159
So that's installer configuration.

01:00:15.159 --> 01:00:20.359
Let me show you a little bit about
other image types that we have.

01:00:20.360 --> 01:00:23.349
So let me kill this guy.

01:00:23.349 --> 01:00:26.360
Actually I should have done this here.

01:00:26.360 --> 01:00:34.500
Shut down -h now, and then we get
rid of this, and that system goes away.

01:00:34.500 --> 01:00:39.489
And then we'll try to bring up a couple more images.

01:00:39.489 --> 01:00:42.899
OK, so that's gone.

01:00:42.900 --> 01:00:46.710
Let me bring up a NetRestore image then.

01:00:46.710 --> 01:00:53.780
OK, we don't have a DVD installed
right now, let me bring up another one.

01:00:53.780 --> 01:00:57.440
And again, both of these images are booted identically.

01:00:57.440 --> 01:01:01.980
So these are both booting from the same network disk image.

01:01:01.980 --> 01:01:11.449
And I presume that eventually all this
material may end up with Joe and Josh

01:01:11.449 --> 01:01:15.169
and fp548 or mac.enterprise.org or somewhere.

01:01:15.170 --> 01:01:17.010
I wouldn't be surprised at all.

01:01:17.010 --> 01:01:19.620
[ Laughter ]

01:01:19.619 --> 01:01:32.460
>> And I seem to have lost my mouse now.

01:01:32.460 --> 01:01:42.190
Yep. OK, I believe I was moving too
fast and trying too many things.

01:01:42.190 --> 01:01:48.090
So that's practically how you can take other
image types, and while these are booting,

01:01:48.090 --> 01:01:51.980
maybe we can see the first screen
and then we can give it a go

01:01:51.980 --> 01:01:56.190
So let's see, I think the mouse just moved.

01:01:56.190 --> 01:01:56.690
>> [inaudible]

01:01:56.690 --> 01:02:05.990
>> Yeah. That's what you get for doing demos on a laptop.

01:02:05.989 --> 01:02:11.849
Yeah, it's convenient to carry these around,
but yeah, we lose some performance here.

01:02:11.849 --> 01:02:13.809
OK, great.

01:02:13.809 --> 01:02:16.659
So now we have again two machines booted into an image.

01:02:16.659 --> 01:02:20.609
And again, identical images, no difference between the two.

01:02:20.610 --> 01:02:28.200
So I have a volume that's the Mac OS drive
on this environment and same thing here.

01:02:28.199 --> 01:02:30.079
So no difference in behavior.

01:02:30.079 --> 01:02:34.090
Both are booted from the XX [phonetic]
image and this image is called -

01:02:34.090 --> 01:02:43.570
in my data directory I have NetBootSP0
and there's called NetRestore server.

01:02:43.570 --> 01:02:52.850
So let's see if I do the same thing again here, and move
some settings around so I'm in my data directory there.

01:02:52.849 --> 01:02:58.259
And if I move NetRestore - oops.

01:02:58.260 --> 01:03:13.380
NetRestore and NetRestore stuff on here, and
then restart this, so what will happen here is

01:03:13.380 --> 01:03:17.750
that we'll get similar requests for these NetRestore images.

01:03:17.750 --> 01:03:22.869
And you notice like here the images were
actually already requesting the settings,

01:03:22.869 --> 01:03:25.989
but they were not actually receiving
any responses from the server.

01:03:25.989 --> 01:03:33.849
So if I was really adventurous about this, I would
write a CGI script on the server that had fancy UI

01:03:33.849 --> 01:03:37.250
like Python, PERL, Ruby, pick your poison.

01:03:37.250 --> 01:03:43.030
And basically tailor your target systems
based on whatever requirements you have.

01:03:43.030 --> 01:03:47.680
In Lab X, whenever a system boots into a NetRestore image,

01:03:47.679 --> 01:03:52.739
it will always these streams defined
or these packages installed.

01:03:52.739 --> 01:03:58.569
And if it came from some other environment,
then we'd use a different source.

01:03:58.570 --> 01:04:07.470
And that way you could basically keep a stable
image set that is tailored at runtime based

01:04:07.469 --> 01:04:10.709
on whatever requirements may change over time.

01:04:10.710 --> 01:04:21.289
So this is quite a flexible way of using embedded data into
the images and not having to churn out shell images again,

01:04:21.289 --> 01:04:23.610
but just changing the data that they reference.

01:04:23.610 --> 01:04:30.990
So here we can tell that I now moved into the
NetRestore mode where I can pick from sources.

01:04:30.989 --> 01:04:35.979
So here I have NetRestore images
that are sources on the network,

01:04:35.980 --> 01:04:40.119
and here are settings that are unique to this system.

01:04:40.119 --> 01:04:44.210
So I may have some settings that are applicable
to all the NetRestore systems out there

01:04:44.210 --> 01:04:46.880
and some that are applicable to only this one.

01:04:46.880 --> 01:04:53.760
So using this dynamic data download, you
can have ways of changing the behavior

01:04:53.760 --> 01:04:59.640
of even NetRestore images as your deployment needs change.

01:04:59.639 --> 01:05:05.250
So here we can see like the same image without
any customization applied, how it looks,

01:05:05.250 --> 01:05:09.449
and here's image with the customizations applied.

01:05:09.449 --> 01:05:18.929
So that's the advanced, advanced behind-the-scenes,
how to tweak NetInstall images using tools

01:05:18.929 --> 01:05:26.949
that are already embedded into the OS, and going kind
of above and beyond what's available in any current UI.

01:05:26.949 --> 01:05:29.159
And that's that.

01:05:29.159 --> 01:05:32.629
And let me see if we have time to do one more.

01:05:32.630 --> 01:05:36.320
So let me try to bring up one image here.

01:05:37.340 --> 01:05:47.630
And I'm just going to bring up one and see
if that comes up - and yes, they start.

01:05:47.630 --> 01:05:51.160
And it can't find the disk, OK.

01:05:51.159 --> 01:05:54.480
So here the goal is to do an automated NetInstall.

01:05:54.480 --> 01:05:59.039
And what would happen with an automated
NetInstall is that if you have varying systems

01:05:59.039 --> 01:06:03.759
that may have different requirements, like they
may have different target drive names or whatnot,

01:06:03.760 --> 01:06:11.470
you may not be able to use just a single static
NetInstall image that applies to all your target clients.

01:06:11.469 --> 01:06:20.469
So you can change some of the automated
settings per system at the time when you know

01:06:20.469 --> 01:06:24.419
which systems are actually going to be.

01:06:24.420 --> 01:06:32.970
So I'll just show you what the issue here is that
when you have variable hard drive target names,

01:06:32.969 --> 01:06:40.289
then how do you account for those using one of the
configuration files that are embedded in the system.

01:06:40.289 --> 01:06:49.000
So here I'll bring up a language chooser again, and
let's go and see what the volumes here look like.

01:06:49.000 --> 01:06:57.710
So this is another operating system installation so this
would be using Mac OS X Installer as opposed to ASI restore.

01:06:57.710 --> 01:06:59.630
And I have two target volumes.

01:06:59.630 --> 01:07:05.050
So if I wanted to install an operating
system onto the WWDC target one system,

01:07:05.050 --> 01:07:12.410
and you can tell that they already have a target two volume
here that's going to have WWDC target two as its drive name,

01:07:12.409 --> 01:07:18.449
how would I use a single image to
image both of these using automation?

01:07:18.449 --> 01:07:31.250
So what I have is, if I go to NetInstall 397 I believe.

01:07:31.250 --> 01:07:39.860
So this is a file that tells that on this
particular system, use WWDC target two as the volume,

01:07:39.860 --> 01:07:46.320
and on my other system, this is called target one.

01:07:46.320 --> 01:07:50.940
So I have basically two files that
pass on unique information

01:07:50.940 --> 01:07:54.880
to whichever client is booting at any given time.

01:07:54.880 --> 01:08:04.230
And on my image what I've done is I have a symbolic
link again from the n install XML config file

01:08:04.230 --> 01:08:11.480
which is the trigger for an automated install, and this now
points into the file that was downloaded from the server.

01:08:11.480 --> 01:08:18.460
So those are just three samples of how to tweak
your system images using some customization

01:08:18.460 --> 01:08:20.649
that can be downloaded at runtime.

01:08:20.649 --> 01:08:24.229
So this would be similar to let's say
some services like [inaudible] Studio

01:08:24.229 --> 01:08:27.709
or Mike's [phonetic] NetRestore or other tools.

01:08:27.710 --> 01:08:35.199
But really the only things that I have done here, I've
included two files on the disk and I've set up a web server.

01:08:35.199 --> 01:08:40.229
Everything else is stock Mac OS X
system images or the created images.

01:08:40.229 --> 01:08:44.250
So the support for rccdromlocal, that's built in already.

01:08:44.250 --> 01:08:48.250
The symbolic links you can create into the
disk image because that's read write.

01:08:48.250 --> 01:08:52.140
But everything else is out of the box and working.

01:08:52.140 --> 01:08:58.060
So that concludes the demo, so I can move
back to the slides, and let's do a summary.

01:08:58.060 --> 01:09:01.250
So what have we learned today?

01:09:01.250 --> 01:09:03.500
So System Image Utility 2.

01:09:03.500 --> 01:09:09.810
So big thing there is NetRestore images,
and specifically with NetRestore images,

01:09:09.810 --> 01:09:14.160
creating system images from DVDs
and adding packages to them.

01:09:14.159 --> 01:09:21.909
So getting to an ASR restore volume
from DVD sources and adding packages.

01:09:21.909 --> 01:09:27.159
Automator and Services, so better support
for Automator actions and creating services

01:09:27.159 --> 01:09:34.849
from System Image Utility workflows, and how to boot into
images using either Startup Disk or command line utilities.

01:09:34.850 --> 01:09:39.380
I didn't show you com.Apple.Boot.plist,
you can find that in all your systems

01:09:39.380 --> 01:09:46.810
in Library/Preferences/SystemConfiguration
com.apple.Boot.plist, self-documenting its a plist.

01:09:46.810 --> 01:09:53.180
And above and beyond how to configure
dynamically some install time settings using

01:09:53.180 --> 01:10:02.470
for example installer choice changes and using install
preferences which was used in the NetRestore example.

01:10:02.470 --> 01:10:09.369
So for more information you can go to our Internet
and Server Technologies Evangelist, Mark Malone.

01:10:09.369 --> 01:10:13.590
For OS X server documentation you can go
to the Apple website, Apple training --