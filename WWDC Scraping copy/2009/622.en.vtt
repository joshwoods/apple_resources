WEBVTT

00:00:12.640 --> 00:00:13.410
>> My name is Sean Regan.

00:00:13.410 --> 00:00:15.269
I'm the Provider Development Manager for Apple.

00:00:15.269 --> 00:00:19.800
And joining me today is going to be John
Poynor, Senior Technical Service Consultant.

00:00:19.800 --> 00:00:25.460
He works with me in our group in education, and
Andre LeBranche, he is going to be our demo guy.

00:00:25.460 --> 00:00:28.679
We're going to talk about moving the Snow Leopard Server.

00:00:28.679 --> 00:00:31.039
How many of you are here for the very first time?

00:00:31.039 --> 00:00:36.479
Oh good, welcome, welcome to our little fun week.

00:00:36.479 --> 00:00:43.379
So, how many of you upgraded last year successfully?

00:00:43.380 --> 00:00:45.850
[ Audience Remark: Define success! ]

00:00:45.850 --> 00:00:50.380
>> Define success, fair enough.

00:00:50.380 --> 00:01:00.930
Upgrading from Tiger to Leopard, did the LDAP
database, KDC and Password Server upgrade successfully?

00:01:00.929 --> 00:01:05.489
OK, nuke and pave as an option.

00:01:05.489 --> 00:01:12.229
If you went to Eric's session earlier today,
you've seen that Apple has done a lot of work

00:01:12.230 --> 00:01:15.500
in this area and we're very, very proud of this.

00:01:15.500 --> 00:01:23.319
And so we want to talk about this because upgrading,
migrating is never really an error free process,

00:01:23.319 --> 00:01:27.269
but we worked really, really hard
to make it as smooth as we can.

00:01:27.269 --> 00:01:31.579
So let's talk about this, what are we going to talk about?

00:01:31.579 --> 00:01:38.609
Well, we want to talk about preparing our upgrade,
right, we want to focus on very critical aspects,

00:01:38.609 --> 00:01:46.510
some service configurations, Password Server,
KDC, wiki blogs, Mail, the usual suspects.

00:01:46.510 --> 00:01:50.490
There is a guide available, and remember this is in beta.

00:01:50.489 --> 00:01:54.929
The guide is still in transition as well, and
that's available on the site, the upgrading

00:01:54.930 --> 00:01:57.920
and migration guide that's going
to help you in this process.

00:01:57.920 --> 00:02:03.820
So, what are we going to talk about?

00:02:03.819 --> 00:02:05.389
Well, we've got some terminology.

00:02:05.390 --> 00:02:07.659
We want to get our facts straight.

00:02:07.659 --> 00:02:09.169
Words are important.

00:02:09.169 --> 00:02:12.039
Words only matter when they really matter.

00:02:12.039 --> 00:02:14.299
So we want to talk about some words, get this straight.

00:02:14.300 --> 00:02:17.660
I want to talk about a quick and dirty backup method.

00:02:17.659 --> 00:02:22.729
We have some rules of engagement that we want to talk
about before we get started, then we're going to focus

00:02:22.729 --> 00:02:27.129
on an upgrade and then move over and focus on migration.

00:02:27.129 --> 00:02:30.810
So start with the terms.

00:02:30.810 --> 00:02:41.439
The difference between an upgrade and an update, what's the
difference, 10.5.6 to 10.5.7 I did an update, that's great.

00:02:41.439 --> 00:02:45.539
10.5 to 10.6, I did an upgrade.

00:02:45.539 --> 00:02:48.299
Make sure you use the proper terms, doesn't always happen.

00:02:48.300 --> 00:02:53.800
And what about migrate, moving from one system to another.

00:02:53.800 --> 00:02:56.969
How many of you attended Eric's session this morning?

00:02:56.969 --> 00:03:02.439
OK, so you saw the upgrade assistant, you saw the
migration assistant, and these are going to help us

00:03:02.439 --> 00:03:05.599
in that process and we'll see those today in the demo.

00:03:05.599 --> 00:03:08.889
What versions do we support?

00:03:08.889 --> 00:03:20.579
Well, we support upgrading, migrating
from 10.4.11 or 10.5.6 or later.

00:03:20.580 --> 00:03:26.350
Now, what about a nuke and pave, just a clean
install, we do have customers that have servers.

00:03:26.349 --> 00:03:29.710
They're small business servers, they
don't have one or two accounts on them.

00:03:29.710 --> 00:03:33.400
They have a little bit of data on there.

00:03:33.400 --> 00:03:37.879
The servers may be used as a web server
or a file server or something like that.

00:03:37.879 --> 00:03:43.419
All the user data-- all the user created
data is all backed up, that's great.

00:03:43.419 --> 00:03:46.969
You can easily recreate the small
limited number of users as long

00:03:46.969 --> 00:03:51.500
as you're not using any sort of
access controls, you're fine.

00:03:51.500 --> 00:03:53.810
You don't really need to keep anything
from the older server.

00:03:53.810 --> 00:04:03.009
So what about your deployment, what decisions do you
have, how many users do you have, what is the sever doing,

00:04:03.009 --> 00:04:09.530
what's its role, what's its function, which one of these
makes the most sense to you, an upgrade or a migration?

00:04:09.530 --> 00:04:11.840
If you're buying a new server the choice is clear.

00:04:11.840 --> 00:04:17.980
If you have an old server that you want to keep in place, an
older Xserve, maybe you're going to do an in-place upgrade.

00:04:17.980 --> 00:04:22.780
What tools are necessary, and let's
talk about a little backup procedure.

00:04:22.779 --> 00:04:25.949
And this is easy, you can try this at home, it's very nice.

00:04:25.949 --> 00:04:32.009
How many of you back up, how many of you are lying?

00:04:32.009 --> 00:04:34.009
Thank you!

00:04:34.009 --> 00:04:41.129
[ Laughter ]

00:04:41.129 --> 00:04:49.579
>> Aha. So, Xserve can come with 3 drives, right, stick a
FireWire drive on it, USB drive on it, whatever you want.

00:04:49.579 --> 00:04:53.180
Some nice quick dirty method, we
always like to share this with people.

00:04:53.180 --> 00:05:00.840
Buy another copy of Mac OS X, just want to be legal, install
it on the third drive or install it on that FireWire drive.

00:05:00.839 --> 00:05:08.899
If you don't have physical access to the box, install it
on the machine, create a disk image of it, move it over.

00:05:08.899 --> 00:05:17.509
Use the same administrator name, same password, turn on
ssh, ARD, copy over preferences.plist file, which is what?

00:05:17.509 --> 00:05:20.879
All the networking information, all the
networking information in the machine is

00:05:20.879 --> 00:05:23.219
in the preferences.plist, that
way you don't make any errors.

00:05:23.220 --> 00:05:29.370
If you're using ssh keys, move the ssh keys over as well.

00:05:29.370 --> 00:05:38.209
Why? Well, if you need to, what you
can do is boot from that third disk.

00:05:38.209 --> 00:05:43.169
Once you've booted from the third
disk, you can create a disk image.

00:05:43.170 --> 00:05:48.240
However you want to do it, you can make it
read, write, read only, it doesn't matter.

00:05:48.240 --> 00:05:53.790
Create the disk image and clone the OS X server volume over.

00:05:53.790 --> 00:05:58.300
Boot back into the OS X server volume and you can
set up an rsync script to mount the disk image.

00:05:58.300 --> 00:06:02.870
You can use hdiutil for that rsync
to sync over any of the changes.

00:06:02.870 --> 00:06:10.090
It's a nice, quick, dirty, clean, easy, backup method.

00:06:10.089 --> 00:06:23.909
So we decided on an installation method, we
backed up our server, but we have some rules.

00:06:23.910 --> 00:06:26.210
[ Applause ]

00:06:26.209 --> 00:06:28.509
[ Laughter ]

00:06:28.509 --> 00:06:34.740
[ Pause ]

00:06:34.740 --> 00:06:37.389
>> How many people did this?

00:06:37.389 --> 00:06:41.750
I only say you have the guts to tell the truth, OK.

00:06:41.750 --> 00:06:44.930
We've seen them on the list.

00:06:44.930 --> 00:06:49.110
I upgraded my server and it didn't go well and
then my users are yelling at me, what should I do?

00:06:49.110 --> 00:06:51.000
Update a resume.

00:06:53.839 --> 00:06:56.439
So back it up.

00:06:56.439 --> 00:07:03.600
A lot of us love the fact that Apple
makes configuration files easy to edit.

00:07:03.600 --> 00:07:10.400
Their plist files, we can tweak them, there are
myriad of options at UNIX, it's great, we love it.

00:07:10.399 --> 00:07:14.529
And we get in there and we tweak these
systems and you Google for certain aspects.

00:07:14.529 --> 00:07:16.559
Oh, can I change this, hey what about this key?

00:07:16.560 --> 00:07:19.810
This key really wasn't known, oh,
it's in the developer documentation.

00:07:19.810 --> 00:07:23.939
This key does this certain thing.

00:07:23.939 --> 00:07:31.550
If you have one of those home grown files, when
you go to update, those files may be overwritten.

00:07:31.550 --> 00:07:38.870
It's always a good idea to know which files you've touched,
which files you've modified, system library launch,

00:07:38.870 --> 00:07:45.060
daemons launch, agents configuration files,
anything like that that's important to the system.

00:07:45.060 --> 00:07:49.850
With launchd, system launchd files will be overwritten.

00:07:49.850 --> 00:07:54.570
So if you've edited any system launchd
files, this isn't in the local library.

00:07:54.569 --> 00:07:57.680
This is in system library.

00:07:57.680 --> 00:08:06.509
And if you've heard me talk before, you know that I pushed
DNS on people and I think over the years, you've heard it.

00:08:06.509 --> 00:08:10.480
Steve just talked about it in the last
session downstairs with the split DNS server.

00:08:10.480 --> 00:08:12.580
DNS is the crux of everything.

00:08:12.579 --> 00:08:16.079
Make sure that your DNS is working properly, OK.

00:08:16.079 --> 00:08:19.969
So what about the admin tools?

00:08:19.970 --> 00:08:21.480
You got them, everybody got the beta.

00:08:21.480 --> 00:08:25.870
Tiger admin tools won't work with Snow
Leopard Server don't use them.

00:08:25.870 --> 00:08:29.189
Don't try them, tar them up, Zip them up, if you have a Tiger server, use them.

00:08:29.189 --> 00:08:33.750
If it were up to me I'd say, hey, buy
another MacBook and just run those servers,

00:08:33.750 --> 00:08:35.909
just run those Server Admin tools on MacBook.

00:08:35.909 --> 00:08:39.269
What about NetBoot Images?

00:08:39.269 --> 00:08:43.730
NetBoot Images 10.4 and later will work.

00:08:43.730 --> 00:08:48.360
If you still have NetBoot Images created with earlier
versions of the OS, you're going to have to go

00:08:48.360 --> 00:08:50.629
and you're going to have to recreate those.

00:08:50.629 --> 00:08:54.710
At this time, I'd like to bring up Andre LeBranche.

00:08:54.710 --> 00:08:59.519
Andre is going to give us the coolest working demo.

00:08:59.519 --> 00:08:59.579
[ Applause ]

00:08:59.580 --> 00:09:06.100
>> Okay. So what I'm going to do is
switch my video first, there we go.

00:09:06.100 --> 00:09:08.040
So this is the first of three demos.

00:09:08.039 --> 00:09:10.259
I'm going to show you first of all
where we're starting from, you know,

00:09:10.259 --> 00:09:12.149
the Leopard 10.5 server with a bunch of stuff on it.

00:09:12.149 --> 00:09:16.360
And then the next two demos are going to show you
what happens afterwards after an in-place upgrade

00:09:16.360 --> 00:09:21.389
and then after if you want to do some migration,
getting some of that old data back in to a new server.

00:09:21.389 --> 00:09:24.259
But before I jump in to that, I'm sure
a lot of you have seen this before,

00:09:24.259 --> 00:09:26.840
but I'm just going to show it for
those who have not seen it.

00:09:26.840 --> 00:09:32.110
Disk utility makes it excruciatingly
easy to do backups and restores.

00:09:32.110 --> 00:09:35.860
You just select your server volume, you want to
boot from something else first, not your server.

00:09:35.860 --> 00:09:40.649
You never want to back up a running OS because
there's files that are open and potentially changing

00:09:40.649 --> 00:09:45.329
and then you might end up with a situation where one
of the files changes during the backup and you end

00:09:45.330 --> 00:09:48.080
up with a backup that's not coherent
with itself, and nobody wants that.

00:09:48.080 --> 00:09:53.570
So you boot to something else, maybe your installed DVD,
select your server's volume, click the new image button,

00:09:53.570 --> 00:09:56.720
save it some place, now you've
got an image of your whole server.

00:09:56.720 --> 00:10:01.899
To restore that, you just can select another volume
or partition and drag your disk image into the source.

00:10:01.899 --> 00:10:08.179
Drag your destination target, and the destination, click
arrays destination restore, you know, wait a few minutes

00:10:08.179 --> 00:10:11.729
and then you have a perfect quality backup and restore.

00:10:11.730 --> 00:10:15.379
You can also clone volumes from one to the other
by just dragging the volume and it's the source,

00:10:15.379 --> 00:10:17.529
and then another volume and it's the destination.

00:10:17.529 --> 00:10:19.559
>> Everybody should do that, it's so easy.

00:10:19.559 --> 00:10:20.949
There's no reason not to.

00:10:20.950 --> 00:10:23.980
And it's also nice to have your old server sitting
around in disk image if you have a need to fish

00:10:23.980 --> 00:10:29.360
out an old config file or, you know, some piece
of data or something that maybe didn't migrate

00:10:29.360 --> 00:10:31.370
or you want to check what the old version was like.

00:10:31.370 --> 00:10:34.850
So, next I want to show you just a couple
of brief things that you want to do

00:10:34.850 --> 00:10:37.580
on your server before you actually kick off the upgrade.

00:10:37.580 --> 00:10:41.440
And to do that, I'm just going to sort
of show you what's running on the server.

00:10:41.440 --> 00:10:44.000
Server Admin, we can see we've got some stuff in here.

00:10:44.000 --> 00:10:49.840
We've got, you know, an Open Directory Master, we've got,
you know, LDAP, Password Server, Kerberos all running.

00:10:49.840 --> 00:10:52.990
I can sort of verify that by using Workgroup Manager.

00:10:52.990 --> 00:10:56.980
And I'm just sort of setting the stage for the next demos.

00:10:56.980 --> 00:11:02.350
This is not incredibly fantastic and fun to look at.

00:11:02.350 --> 00:11:06.420
But you see that I've got some, you know, user
accounts in here, I've got some group accounts.

00:11:06.419 --> 00:11:09.079
I've got a mail server.

00:11:09.080 --> 00:11:13.920
I've got a mail client connected to the mail server.

00:11:13.919 --> 00:11:16.199
Hey look at that, we've got some messages in here.

00:11:16.200 --> 00:11:20.500
Two users, yeah I know it's a spam
message, right, my own message.

00:11:20.500 --> 00:11:25.179
So, I've also got a WebServer and this is version 2.2.

00:11:25.179 --> 00:11:26.559
I'm going to speak to that in a minute.

00:11:26.559 --> 00:11:32.539
But I don't have a lot of web content, basically I just have
the wiki setup and so I can go to my web site and I can see

00:11:32.539 --> 00:11:36.889
that I've got, you know, some wiki content
here and there's not really much here.

00:11:36.889 --> 00:11:38.699
This is just sort of a sample, you know.

00:11:38.700 --> 00:11:40.690
There are some wiki content, great, OK.

00:11:40.690 --> 00:11:43.320
So, got all the stuff here, all my server is working.

00:11:43.320 --> 00:11:45.580
I have DNS set up as well.

00:11:45.580 --> 00:11:47.420
I'm providing my own DNS for this server.

00:11:47.419 --> 00:11:51.620
I have a fictitious domain called WWDC and I am server.wwdc.

00:11:51.620 --> 00:11:55.049
I got my firewall going, I've got, you know, home directory,

00:11:55.049 --> 00:11:57.309
a network home directory for my
users and that kind of stuff.

00:11:57.309 --> 00:11:58.759
A couple of other services running.

00:11:58.759 --> 00:12:04.039
I'm pretty much just focusing on mail and web for these
three demos so that's why I showed you those services.

00:12:04.039 --> 00:12:10.980
And they're all configured for Kerberos so if do a klist-A,
lower case a only shows you the current user's credentials.

00:12:10.980 --> 00:12:14.100
Capital A shows you all of the credentials in the cache.

00:12:14.100 --> 00:12:16.230
That's a little terminal command, klist-A.

00:12:16.230 --> 00:12:19.259
And we can see that I have tickets for two users.

00:12:19.259 --> 00:12:22.340
I have net user 1 and net user 2 and
they have various service tickets

00:12:22.340 --> 00:12:24.720
for IMAP and mail and all that kind of stuff.

00:12:24.720 --> 00:12:28.220
So once again, this is just sort of
setting the stage for just proving to you

00:12:28.220 --> 00:12:30.920
that it's all working properly before we start the upgrade.

00:12:30.919 --> 00:12:31.809
Why is that important?

00:12:31.809 --> 00:12:37.599
Well, I've heard in the past people try to use upgrades
as a way to fix mysterious problems with their server.

00:12:37.600 --> 00:12:39.670
Don't do that, don't do that.

00:12:39.669 --> 00:12:44.299
It's probably going to have the opposite, you
know, effect in what you might be hoping for.

00:12:44.299 --> 00:12:48.409
So always make sure that everything is working properly
before you do the upgrade and you do that just by flipping

00:12:48.409 --> 00:12:52.789
through your services, maybe look through your logs, try out
all the client software and make sure everything is working.

00:12:52.789 --> 00:12:55.919
You also want to make sure that
you update to the latest version

00:12:55.919 --> 00:12:59.750
of Mac OS X Server, 10.5.7, run software update for that.

00:12:59.750 --> 00:13:04.799
Also on the services front, there are a couple of services
that have supported in the last two major releases,

00:13:04.799 --> 00:13:08.359
upgrades to their own data formats and service versions.

00:13:08.360 --> 00:13:10.310
Those are the DNS service and the web service.

00:13:10.309 --> 00:13:14.949
It's very easy to upgrade these by just going
to Server Admin, it's like in the DNS service

00:13:14.950 --> 00:13:17.550
and there will be a button in there
that says "hey, upgrade."

00:13:17.549 --> 00:13:18.859
Well, it doesn't say hey, but just says upgrade.

00:13:18.860 --> 00:13:23.750
So you click that and then it upgrades your
DNS service config files to the newer version.

00:13:23.750 --> 00:13:27.299
And the same thing for web, you might have
Apache1.3 if you have an older server.

00:13:27.299 --> 00:13:30.729
You need to bring that up to Apache
2.2 before you do the upgrade.

00:13:30.730 --> 00:13:34.720
So again, this is just sort of in the process of
making sure everything is clean and up to date

00:13:34.720 --> 00:13:37.840
and the newest it possibly can
be before you start your upgrade.

00:13:37.840 --> 00:13:44.170
Because like in the case of some of these things,
it's harder to deal with afterwards so it's good

00:13:44.169 --> 00:13:46.339
to make sure that everything is going well.

00:13:46.340 --> 00:13:50.200
And one final check that we want to do here
is just to make sure that our DNS is good,

00:13:50.200 --> 00:13:52.980
and I know that it is because I set
it up and it's my own DNS server.

00:13:52.980 --> 00:14:00.340
But you can say pseudo change IP, check
hostname, and it will come back and tell me "hey,

00:14:00.340 --> 00:14:02.450
you're an awesome system admin, this DNS is perfect."

00:14:02.450 --> 00:14:05.740
So I don't want anything to change,
there is nothing to change.

00:14:05.740 --> 00:14:07.680
So that's pretty good.

00:14:07.679 --> 00:14:12.479
You can also export some service
config files from Server Admin.

00:14:12.480 --> 00:14:16.019
Now this is an in-place upgrade so we're going
to expect that all this stuff gets maintained.

00:14:16.019 --> 00:14:21.220
But, it's always good to save off a copy of your Server
Admin settings because it's so easy to do it, why not.

00:14:21.220 --> 00:14:26.590
Just go Server Admin, export, service settings, and
then it's going to export all of your service settings

00:14:26.590 --> 00:14:31.980
into a single XML file stashed on USB keychain or something
like that, so that you have it for future reference.

00:14:31.980 --> 00:14:35.550
And also you're going to want to make
a backup copy of your SSL Certificates

00:14:35.549 --> 00:14:38.259
because those need to be reconfigured after the upgrade.

00:14:38.259 --> 00:14:43.799
And so you can do that by just basically
going in the finder to-- and see certificates.

00:14:43.799 --> 00:14:45.729
Now these do get preserved when you do an upgrade.

00:14:45.730 --> 00:14:51.730
But, we have custom SSL Certificates, always have a copy
of those somewhere off of your server especially if there--

00:14:51.730 --> 00:14:54.060
I mean this case are just self science
so they're pretty easy to recreate.

00:14:54.059 --> 00:14:57.189
But if you paid for it, definitely
you know, make a backup copy.

00:14:57.190 --> 00:15:00.710
So at this point, my server is running
well, I'm pretty happy with it.

00:15:00.710 --> 00:15:03.030
So, what I would do is then boot on to the DVD.

00:15:03.029 --> 00:15:04.509
I actually did this last year on stage.

00:15:04.509 --> 00:15:06.669
It did not work out so well because
of the video mirroring and stuff.

00:15:06.669 --> 00:15:10.360
So I'm not going to show that this year but
I would insert the DVD, I would boot from it.

00:15:10.360 --> 00:15:13.610
And as you may have known, if you've
actually tried this yet so far,

00:15:13.610 --> 00:15:17.659
the installation options are actually quite a
bit simpler than they were in previous releases.

00:15:17.659 --> 00:15:22.919
There is no clean install or upgrade install or whatever,
it's just install, and we'll sort of look at kind

00:15:22.919 --> 00:15:27.149
of what's happening under the hood afterwards
and we'll see what actually happened.

00:15:27.149 --> 00:15:28.679
But the point is it's much easier to install.

00:15:28.679 --> 00:15:29.559
It's really hard to mess it up.

00:15:29.559 --> 00:15:32.679
The only thing you can really customize
are the optional packages

00:15:32.679 --> 00:15:35.439
such as languages and, you know, that sort of thing.

00:15:35.440 --> 00:15:36.960
So you can customize it for that.

00:15:36.960 --> 00:15:40.100
After you do the install, you'll
reboot back onto your new system.

00:15:40.100 --> 00:15:43.050
Server Assistant comes in, it tells you
"hey, I found all these whole stuff,

00:15:43.049 --> 00:15:45.279
upgrading it for you," and then you'll end on your desktop.

00:15:45.279 --> 00:15:48.870
And that's where I'm going to pick up in the next demo,
so I'm going to toss it back to Sean now, thank you.

00:15:48.870 --> 00:15:49.879
[ Applause ]

00:15:49.879 --> 00:15:54.629
>> Thanks, Dre.

00:15:54.629 --> 00:16:02.860
Alright, let's go and talk about the upgrade process
itself while Andre prepares it over there, OK.

00:16:02.860 --> 00:16:04.350
Upgrade in-place scenarios.

00:16:04.350 --> 00:16:10.350
Maybe you have a Tiger Local and you're going to upgrade to
Snow Leopard so you just have a local database, it's fine.

00:16:10.350 --> 00:16:17.820
Tiger Master to a Leopard Master, in other words
Open Directory or a Leopard Advanced setup, right,

00:16:17.820 --> 00:16:20.810
which it could be events, could not be an Open Directory.

00:16:20.809 --> 00:16:25.129
Maybe you're just setting up as a file
server or something else to Snow Leopard.

00:16:25.129 --> 00:16:32.470
So the in-place upgrade, boot off the DVD as Andre said.

00:16:32.470 --> 00:16:37.190
We need to meet the specified required
hardware, it's Intel only.

00:16:37.190 --> 00:16:46.580
Have the ready-to-go backup if things go
awry and then reboot the server, right.

00:16:46.580 --> 00:16:51.710
So, what about a live upgrade scenario?

00:16:51.710 --> 00:16:59.450
Upgrade the Master first, then you can
if you wish to upgrade each replica.

00:16:59.450 --> 00:17:04.880
Test with some clients, test with some
more clients then get your groove on.

00:17:04.880 --> 00:17:12.260
But, isn't a replica it's just a
clone of your Open Directory Master?

00:17:12.259 --> 00:17:18.569
So you can go through the upgrade process
but you can also just do a nuke and pave.

00:17:18.569 --> 00:17:22.710
It's up to you, you can decide.

00:17:22.710 --> 00:17:27.670
Essentially when you upgrade the
replica, it's paving a little bit

00:17:27.670 --> 00:17:35.789
of the information inside the Open Directory
architecture anyway, but it's up to you.

00:17:35.789 --> 00:17:38.349
So what about a nuke and pave-- Open Directory?

00:17:38.349 --> 00:17:47.139
We can archive using Server Admin, back up other
configuration files, Directory Service Apples are one.

00:17:47.140 --> 00:17:53.280
In certain cases inside server-- or inside Workgroup
Manager rather, if you've set limited Server Admin

00:17:53.279 --> 00:17:56.210
or you've done any sort of directory
service access control list,

00:17:56.210 --> 00:18:00.090
those may not be preserved if you
do an Open Directory archive.

00:18:00.089 --> 00:18:02.509
You may want to pull those off by hand.

00:18:02.509 --> 00:18:09.629
Perform a clean install of Snow Leopard Server,
update to taste, promote to an Open Directory Master

00:18:09.630 --> 00:18:13.340
and you can use Server Admin to bring
that Open Directory archive back in.

00:18:13.339 --> 00:18:15.839
You get an option button that will say merge.

00:18:15.839 --> 00:18:21.309
You can choose to merge and things should go well.

00:18:21.309 --> 00:18:24.250
So, what about server services?

00:18:24.250 --> 00:18:31.460
As Dre showed you, you have a way that you can
export all the plists for all the services.

00:18:32.789 --> 00:18:39.589
Sometimes we like to customize these again because
Mac OS X is an open architecture built on UNIX,

00:18:39.589 --> 00:18:42.459
we have a lot of configuration files that we can tweak.

00:18:42.460 --> 00:18:45.930
For example the smb.configuration file.

00:18:45.930 --> 00:18:49.930
A lot of us who run SMB on our
servers, there are a lot of parameters

00:18:49.930 --> 00:18:55.519
that Apple doesn't put in there
that I know a lot of you use.

00:18:55.519 --> 00:19:02.720
You want to make sure that you save that file off, back
that file up and compare the new file in 10.6 to yours

00:19:02.720 --> 00:19:08.990
because you may want to copy in those
configuration settings again, OK.

00:19:08.990 --> 00:19:11.799
What about Directory Services?

00:19:11.799 --> 00:19:17.970
LDAP and Kerberos and Binding, well,
we can use the slaptest command

00:19:17.970 --> 00:19:22.490
to note any changes if you've gone and edited your schema.

00:19:22.490 --> 00:19:26.700
And this is important, if you've gone
out there, you've made some changes,

00:19:26.700 --> 00:19:30.940
run the slaptest command, it's right up there, OK.

00:19:30.940 --> 00:19:35.559
It's also documented very, very well in the main pages.

00:19:35.559 --> 00:19:39.179
Alright, what it basically does is convert the configuration

00:19:39.180 --> 00:19:43.000
to a config container inside the
LDAP directory so you can see it.

00:19:43.000 --> 00:19:46.049
Same thing to Workgroup Manager with
the inspector, you can use dscl,

00:19:46.049 --> 00:19:51.619
pop into the config container inside your LDAP directory
and take a look at some of the schema changes that you have.

00:19:51.619 --> 00:20:00.919
And if you're doing a Tiger to Snow upgrade and
you have some legacy groups, you can upgrade those,

00:20:00.920 --> 00:20:05.800
computer lists to computer groups to computer lists.

00:20:05.799 --> 00:20:10.799
If you're upgrading from an older server
and you didn't have GUIDs associated

00:20:10.799 --> 00:20:15.990
with these machines, you now get to take advantage of that.

00:20:15.990 --> 00:20:24.289
>> And if you bound, unbind, upgrade,
rebind, OK, don't try and do it all at once.

00:20:24.289 --> 00:20:29.190
The superman theory is not going to play too well, OK.

00:20:29.190 --> 00:20:31.930
Keep in mind that the bound clients when you're binding

00:20:31.930 --> 00:20:36.410
to another directory system whether it's
Active directory or Open Directory,

00:20:36.410 --> 00:20:43.450
creates a file inside the local config container and
the file was used to create the edu.mit.Kerberos file.

00:20:43.450 --> 00:20:47.069
If you're going to do this manually, rip them both out.

00:20:47.069 --> 00:20:52.769
Take the edu.mit.Kerberos file out, take that file inside
the local config container inside DS local default--

00:20:52.769 --> 00:20:55.680
DS local defaults nodes-- nodes default.

00:20:55.680 --> 00:20:58.980
Sorry. And what about DNS?

00:20:58.980 --> 00:21:00.950
Again, Dre talked about this.

00:21:00.950 --> 00:21:04.850
If you've made some changes in the DNS, you
will get an upgrade button, it's right there.

00:21:04.849 --> 00:21:13.980
And if you have print queues, you want to export
those settings, command line is just fine,

00:21:13.980 --> 00:21:19.319
and reimport those settings for your print queues, OK.

00:21:19.319 --> 00:21:24.819
Now that the server's been churning away
up here, I'm going to bring Dre back up.

00:21:24.819 --> 00:21:30.069
He's going to give us an upgrade
demo, and this one's gonna work too.

00:21:30.069 --> 00:21:33.869
>> So you're all thinking to yourself,
how did you do an upgrade that fast?

00:21:33.869 --> 00:21:35.869
I can't tell you, sorry.

00:21:35.869 --> 00:21:38.419
So here we are in 10.6 server.

00:21:38.420 --> 00:21:41.269
Let me see that it says 10.6, fantastic.

00:21:41.269 --> 00:21:45.900
And so basically, this was an in-place upgrade
from the server that I just showed you.

00:21:45.900 --> 00:21:48.340
Of course this is not-- I didn't do it in real time.

00:21:48.339 --> 00:21:50.859
This is kind of the pre-baked,
you know, cooking show version.

00:21:50.859 --> 00:21:52.849
But it's the same thing, I swear.

00:21:52.849 --> 00:21:57.209
So what we're going to do is just kind of take
a look and see what happened, what do we get.

00:21:57.210 --> 00:22:05.259
So, we'll start in Server Admin and we can see a bunch
of green bullets, that's pretty good except for mail.

00:22:05.259 --> 00:22:10.430
Now it is actually documented that mail does not start after
an in-place upgrade and we'll get into that in a second.

00:22:10.430 --> 00:22:15.460
But Open Directory is running, we got
our Kerberos and stuff all working.

00:22:15.460 --> 00:22:19.769
I could fire up Workgroup Manager and see that
my network users and groups are all preserved.

00:22:19.769 --> 00:22:26.000
I authenticated using my directory administrator
which you can see here, which means that, you know,

00:22:26.000 --> 00:22:32.849
at a fundamental level, the open LDAP stuff is in
good shape, password service is in good shape as well.

00:22:32.849 --> 00:22:39.609
So we could take a look for example to make sure that
our DNS is correct by doing the same thing we did before,

00:22:39.609 --> 00:22:44.009
check hostname, and it's going to come back
and say once again, yes, everything is fine.

00:22:44.009 --> 00:22:48.789
So DNS worked, Open Directory worked,
firewall is looking pretty good.

00:22:48.789 --> 00:22:52.339
I got some active rules in here, AFP, iChat, mail.

00:22:52.339 --> 00:22:56.669
So now let's take a look at some of
the issues that you might run into.

00:22:56.670 --> 00:23:02.850
Anyone who has upgraded a server knows that maybe it doesn't
always work exactly right for everything every single time.

00:23:02.849 --> 00:23:06.339
So what I'm going to do is kind of
walk you through the process of triage

00:23:06.339 --> 00:23:10.019
and then fixing sort of what actually is wrong.

00:23:10.019 --> 00:23:11.859
So we'll start with the mail service.

00:23:11.859 --> 00:23:12.799
It's not actually running.

00:23:12.799 --> 00:23:20.309
Now it is documented that it's not running, but
what I want to show you here is the console utility.

00:23:20.309 --> 00:23:26.240
There is a log that is created in library
logs, it's called set up log, set up that log.

00:23:26.240 --> 00:23:32.099
And this log basically contains all the
information that came out of Server Assistant, yeah,

00:23:32.099 --> 00:23:34.719
when it was sort of upgrading and migrating all your stuff.

00:23:34.720 --> 00:23:37.529
The thing I want to show you is up at the top.

00:23:37.529 --> 00:23:43.430
And see here, I don't know if you can read that but
it says starting migration extras with arguments.

00:23:43.430 --> 00:23:45.820
And the source root is /previous system.

00:23:45.819 --> 00:23:46.720
Well, what's that all about?

00:23:46.720 --> 00:23:47.890
You didn't have a previous system.

00:23:47.890 --> 00:23:54.800
Well, during the in-place upgrade, what happens is the
installer basically takes all of your important service data

00:23:54.799 --> 00:23:57.809
and configuration files, stashes them in previous system.

00:23:57.809 --> 00:24:03.740
And then when all that's finished, the Server Assistant
when you, you know, before you get to your desktop,

00:24:03.740 --> 00:24:10.029
it will just go through and run all the migration
scripts that are in like system library, you now, well,

00:24:10.029 --> 00:24:12.329
there is a path through it right
up there, the migration extras.

00:24:12.329 --> 00:24:18.569
And it will run all these and it's going to pull
from the previous system as your old system basically

00:24:18.569 --> 00:24:21.669
and then the target root is / which
just means the current system.

00:24:21.670 --> 00:24:24.810
You can see source version is 10.5.7 as well.

00:24:24.809 --> 00:24:29.779
And so basically, this is just sort of a
play by play of all these migration scripts.

00:24:29.779 --> 00:24:31.470
I'm not going to drag you through all that now,

00:24:31.470 --> 00:24:35.329
but I do want to look at the mail migration
log because this is kind of a key 1.

00:24:35.329 --> 00:24:37.740
Mail is pretty complicated, it's
not just one service, right?

00:24:37.740 --> 00:24:42.630
You've got IMAP, you know, SMTP, pop, you
got mail, mailing lists, and you know,

00:24:42.630 --> 00:24:44.480
web mails and it's kind of a lot of stuff.

00:24:44.480 --> 00:24:48.000
So the mail migration log is kind
of a good clearing house for finding

00:24:48.000 --> 00:24:52.720
out how this actually worked, or in
this case, if it actually worked.

00:24:52.720 --> 00:24:58.829
So, I can look here and see that uh-oh error:
missing cyrus database, previous system var/imap.

00:24:58.829 --> 00:25:01.199
That's my mail store, that's where all my messages are.

00:25:01.200 --> 00:25:04.940
So, the post config stuff, post
conf, that all might be there.

00:25:04.940 --> 00:25:06.759
But if I don't have mail, that's kind of bad.

00:25:06.759 --> 00:25:10.309
So this is a good time to remind
everybody that this is not GM software.

00:25:10.309 --> 00:25:13.289
But I am going to show you how we fix this.

00:25:13.289 --> 00:25:17.379
Basically, the upgrade or script just looked in
previous system for my MailStore, it wasn't there.

00:25:17.380 --> 00:25:21.030
So what I can do is just take my
MailStore, put it in previous system,

00:25:21.029 --> 00:25:24.329
and run the upgrade script again,
so that's what I'm going to do.

00:25:24.329 --> 00:25:31.849
And I'm going to go to my little USB thumb drive here,
have a little scripts folder, and I'm going to start it

00:25:31.849 --> 00:25:38.429
and then I'm going to explain it
because it takes a second or two to run.

00:25:38.430 --> 00:25:40.180
Let's see.

00:25:40.180 --> 00:25:43.750
[Inaudible] scripts, store.

00:25:43.750 --> 00:25:48.170
So this is just a tiny little shell script and
really, I'm not doing anything special here.

00:25:48.170 --> 00:25:54.940
All I'm doing is I'm taking a backup that I had at
my MailStore which was not found in previous system,

00:25:54.940 --> 00:25:59.130
but I should also point out that it is
actually still on my current server.

00:25:59.130 --> 00:26:04.060
So my Leopard Server mail stuff is actually
sitting at least the MailStore portion.

00:26:04.059 --> 00:26:07.529
It's actually sitting in exact same spot that
it was in, so it's not like gone or anything.

00:26:07.529 --> 00:26:09.990
But I had created a backup of that previously.

00:26:09.990 --> 00:26:12.880
There are 2 folders, var/imap and var/spool/imap.

00:26:12.880 --> 00:26:14.990
Those are actually called out in the documentation.

00:26:14.990 --> 00:26:19.730
And so you can back those up and then what
I'm doing in the script is just simply--

00:26:19.730 --> 00:26:23.809
I think I almost took a screenshot there.

00:26:23.809 --> 00:26:30.049
What I'm doing is just restoring these on top of
previous system using xar in this case,

00:26:30.049 --> 00:26:31.589
and to make sure permissions are correct.

00:26:31.589 --> 00:26:36.329
But really all I'm doing here is running this
migration script which is the same script

00:26:36.329 --> 00:26:38.460
that gets run when you do an in-place upgrade.

00:26:38.460 --> 00:26:43.299
So you might be thinking, well what's the difference
between an in-place upgrade and a migration?

00:26:43.299 --> 00:26:47.669
Well, actually there's not that much of a difference and
we're going to kind of see more of that in the next demo.

00:26:47.670 --> 00:26:54.210
But for now I'm just running the same migration script as
I did before, or that was run by the server automatically.

00:26:54.210 --> 00:26:56.880
I'm targeting previous system as my target root.

00:26:56.880 --> 00:27:00.480
And this script is going to take,
you know, a couple of minutes to run.

00:27:00.480 --> 00:27:04.069
So while that's happening, I'm going to
switch over to mail and take a look at mail.

00:27:04.069 --> 00:27:09.419
So back in Server Admin, I see-- I said mail, I meant web.

00:27:09.420 --> 00:27:11.680
I'm going to take a look at the web service.

00:27:11.680 --> 00:27:16.950
I see that the bullet is green so that means it's
all working, right, end of demo, thank you very much.

00:27:16.950 --> 00:27:19.210
You don't believe me?

00:27:19.210 --> 00:27:28.009
Well, let's take a look, uh-oh, that's not so reassuring,
start time not available, version not available.

00:27:28.009 --> 00:27:31.650
So many of you may have been in this situation
before where Server Admin gives you green light

00:27:31.650 --> 00:27:34.269
but maybe something is not actually correct.

00:27:34.269 --> 00:27:36.680
So, fortunately this is a documented issue.

00:27:36.680 --> 00:27:39.320
I'm just kind of taking you all
the way around the block here.

00:27:39.319 --> 00:27:46.500
So we're going to look in our logs and I'm going to pull
my all messages log here which is like my console log.

00:27:46.500 --> 00:27:47.509
And what do we see here?

00:27:47.509 --> 00:27:52.420
We see a bunch of stuff, but intermixed with all the other
stuff we see Apache starting and stopping and starting

00:27:52.420 --> 00:27:55.830
and stopping and starting and stopping, it's not good.

00:27:55.829 --> 00:27:57.750
So we want to know why that's happening.

00:27:57.750 --> 00:28:00.490
We're going to look at the Apache error log.

00:28:00.490 --> 00:28:05.980
So here comes var log, apache2 error log, and sure enough,

00:28:05.980 --> 00:28:09.039
server should be SSL aware but
has no certificate configured.

00:28:09.039 --> 00:28:13.339
And if you have read the upgrading and migrating document,
which of course you will, you will know that you will have

00:28:13.339 --> 00:28:16.699
to reconfigure your SSL certificates after an update.

00:28:16.700 --> 00:28:18.190
That's why this is not working.

00:28:18.190 --> 00:28:19.870
SSL is not reconfigured.

00:28:19.869 --> 00:28:23.419
So I'm going to pop back in the Server Admin.

00:28:23.420 --> 00:28:31.269
I'm going to go to certificates, I'm going to delete
this old one, and confirm that and then I'm going

00:28:31.269 --> 00:28:35.730
to import the certificate from my
backup that I had created previously.

00:28:35.730 --> 00:28:41.009
I didn't show you creating the backup, but again
it's all stashed in [inaudible] certificates,

00:28:41.009 --> 00:28:46.690
dragging my key file, dragging my cert file, import that.

00:28:46.690 --> 00:28:49.130
So now we've imported sort of at the system keychain level,

00:28:49.130 --> 00:28:52.220
and now we need to actually reconfigure
it for the service as well.

00:28:52.220 --> 00:29:03.089
So I'll go into web sites and grab my secure site, and
have to re-pick my certificate there and save that.

00:29:03.089 --> 00:29:07.349
And then it will give me the option to restart
the web server which of course I do need to do.

00:29:07.349 --> 00:29:16.609
And as that is happening, I'm going to fire up my
browser and I'm going to get my server's web site.

00:29:16.609 --> 00:29:18.399
That's server.wwdc.

00:29:18.400 --> 00:29:21.880
Now I type so fast that the web
server has not actually started yet,

00:29:21.880 --> 00:29:24.950
but it will be started very shortly, I can assure you.

00:29:24.950 --> 00:29:28.789
So while we're waiting for that, let's take
a look back at my mail migration script.

00:29:28.789 --> 00:29:30.559
Well, the script finished.

00:29:30.559 --> 00:29:33.369
Here I am back at my shell, and we
see a couple of errors in there.

00:29:33.369 --> 00:29:36.849
Well, that's kind of expected, right, because the
script already ran once and did a bunch of stuff.

00:29:36.849 --> 00:29:38.250
We're just kind of picking up the pieces.

00:29:38.250 --> 00:29:40.839
So, all the stuff that it got the first
time is not going to get this time

00:29:40.839 --> 00:29:44.599
because it's not there anymore like,
you know, postfix config files and such.

00:29:44.599 --> 00:29:50.699
But we do want to make sure that our MailStore got
migrated, so we can take a look at the same log we looked

00:29:50.700 --> 00:29:52.930
at before which is the mail migration log.

00:29:52.930 --> 00:29:57.080
And you know, we can scroll around
in here, but really this part of it,

00:29:57.079 --> 00:30:00.849
if you know anything about IMAP mail
stores, that's your mail store right there.

00:30:00.849 --> 00:30:05.809
So the MailStore was found by the script because I
put it in previous system where it wasn't before.

00:30:05.809 --> 00:30:11.179
The script saw it, grabbed it, did what it needs
to do, now it's in DOVEcot format.

00:30:11.180 --> 00:30:15.259
And so, we should be pretty good
to go on the mail server side.

00:30:15.259 --> 00:30:18.009
>> Let's pop back over to our web
site here which is finished loading.

00:30:18.009 --> 00:30:24.539
I'll click my wiki and I see my grouping here,
and here is my wiki content that I had before.

00:30:24.539 --> 00:30:28.309
Now, one thing you might notice, well, you probably
wouldn't notice it because I didn't call it out before

00:30:28.309 --> 00:30:30.869
but this was supposed to be restricted to a group.

00:30:30.869 --> 00:30:34.659
This is in your Seed notes, that
access control entry didn't make it.

00:30:34.660 --> 00:30:43.380
So what we need to do is log in as an administrator
and we can just edit the settings on the wiki

00:30:43.380 --> 00:30:45.810
and we'll see kind of what the problem is here.

00:30:45.809 --> 00:30:50.549
We go to permissions and right here, you can see
that it thinks it's supposed to be restricted

00:30:50.549 --> 00:30:52.849
but there is not actual group or user list here.

00:30:52.849 --> 00:31:00.599
So we just kind of type in our username or our group
name, select it, and then save these settings and then--

00:31:00.599 --> 00:31:10.329
now if I were to log out of the wiki and try to access it
again, we would see that I would actually have to log in.

00:31:10.329 --> 00:31:12.679
There we go, and there is my log in prompt.

00:31:12.680 --> 00:31:18.320
Log in as net user, and so there is the
wiki just like we left it in Leopard.

00:31:18.319 --> 00:31:20.369
So I'll switch back to mail.

00:31:20.369 --> 00:31:27.069
So the mail migration script is finished, we've got all
that stuff going, now we need to double check our SSL config

00:31:27.069 --> 00:31:31.980
in mail as well just like we had to do for Apache,
because we had to reimport our SSL Certificates.

00:31:31.980 --> 00:31:39.809
So we grab our mail settings, go over settings here,
let this load, and those all look pretty much correct.

00:31:39.809 --> 00:31:49.099
So we're going to go over to advanced and flip
this on and we redo our SSL configuration.

00:31:50.240 --> 00:31:54.890
There we go, and then save that.

00:31:54.890 --> 00:32:00.710
Theoretically this should do it, but maybe it won't.

00:32:00.710 --> 00:32:03.029
So we'll see why or why not here.

00:32:03.029 --> 00:32:08.960
But I'm going to wait for the spinner because
you got to wait for the spinner, there we go.

00:32:08.960 --> 00:32:13.350
So, I discovered in testing this that about
half of the time, there is an error that ends

00:32:13.349 --> 00:32:17.459
up in a Dovecot config file, and I'll show it to you now.

00:32:17.460 --> 00:32:25.670
So if I search for SSL_ in the
file etc/dovecot/dovecot.conf.

00:32:25.670 --> 00:32:28.360
Oh good, it happened this time.

00:32:28.359 --> 00:32:33.029
What I will see is right up there-- do you see any problems?

00:32:33.029 --> 00:32:35.589
So that's actually right next to the
lights, let me move that down a little bit.

00:32:35.589 --> 00:32:40.079
So I have my SSL cert file pointing to my WWDC certificate.

00:32:40.079 --> 00:32:43.659
SSL key file, kind of important, directive is commented out.

00:32:43.660 --> 00:32:50.230
So what happens in this case is it tries to use the
compiled and default certificate location which is probably

00:32:50.230 --> 00:32:54.549
for some Linux system or something like-- and
it's totally inappropriate for our system.

00:32:54.549 --> 00:33:01.069
So what we need to do to fix this and again, Server
Admin says everything is cool but everything's not cool.

00:33:01.069 --> 00:33:04.889
So we need to edit that file so we'll sudo.

00:33:04.890 --> 00:33:12.980
I'm going to use VI, you can use whatever editor you like,
etc/dovecot/dovecot.conf, and we're just going to search

00:33:12.980 --> 00:33:19.480
for SSL_key and here is the directive right here
that is commented out, which means that it's not,

00:33:19.480 --> 00:33:21.089
it might as well not even be in the file.

00:33:21.089 --> 00:33:22.659
We need this directive, it's very important.

00:33:22.660 --> 00:33:25.290
So I'm just going to remove the hash mark.

00:33:25.289 --> 00:33:28.069
Again, not GM software, hopefully you won't have to do this.

00:33:28.069 --> 00:33:35.309
But, now I'm ready to start the mail service
so I come back over here, click start.

00:33:35.309 --> 00:33:40.159
While that's starting up, let me grab my mail client.

00:33:40.160 --> 00:33:43.860
Almost, try it again.

00:33:43.859 --> 00:33:44.990
Here comes mail.

00:33:44.990 --> 00:33:49.190
Now remember, this was an in-place upgrade which means
that my client side settings are actually still there,

00:33:49.190 --> 00:33:51.960
which is basically the stuff in my
home directory for the mail client app.

00:33:51.960 --> 00:33:57.960
So it goes through its little, you now,
database upgrade thingy and then it's done.

00:33:57.960 --> 00:34:03.539
And then it's going to log in to the service hopefully.

00:34:03.539 --> 00:34:06.690
Right about now I should get my
Kerberos challenge, there it is.

00:34:06.690 --> 00:34:10.800
So, now I have 2 counts so it's going to prompt me twice.

00:34:10.800 --> 00:34:16.530
I have 2 counts set up, so I plug in my,
you know, credentials there and I can see

00:34:16.530 --> 00:34:19.590
that my MailStore did actually get migrated properly.

00:34:19.590 --> 00:34:23.390
There is the one message from the one user and
there is the other message from the other user.

00:34:23.389 --> 00:34:32.900
I could even, you know, klist-- klist-A, capital A,
and I see that, you know, Kerberos stuff is working.

00:34:32.900 --> 00:34:39.230
So, that gives you sort of a brief idea of
some of the techniques that you might need

00:34:39.230 --> 00:34:41.610
to employ if everything doesn't always just work.

00:34:41.610 --> 00:34:47.539
Basically you start with pulling in your service configs,
look at the upgrade logs if you can, and test it.

00:34:47.539 --> 00:34:50.039
If it's not working, usually the
logs are going to tell you why.

00:34:50.039 --> 00:34:52.460
In this case, we actually have some
documented issues that are kind

00:34:52.460 --> 00:34:55.039
of sitting our way too with the SSL Certificates and such.

00:34:55.039 --> 00:35:00.880
So between the release notes, documentation
and you know, the community resources,

00:35:00.880 --> 00:35:03.190
you can usually figure out what needs to be done.

00:35:03.190 --> 00:35:07.679
But sometimes it's not all automatic so that kind of
gives you a little bit of a sample of some of the things

00:35:07.679 --> 00:35:10.440
that might need to be done on an in-place upgrade.

00:35:10.440 --> 00:35:12.730
And so with that, I'm going to
pass it back to Sean, thank you.

00:35:12.730 --> 00:35:13.639
[ Inaudible Remark ]

00:35:13.639 --> 00:35:14.549
[ Applause ]

00:35:14.550 --> 00:35:15.240
>> Thank you Andre.

00:35:15.239 --> 00:35:24.179
At this time, I'm going to ask John Poynor to come
up and John is going to talk about migration, John.

00:35:24.179 --> 00:35:29.379
>> Thanks Sean, awesome job Andre.

00:35:30.900 --> 00:35:35.920
So, we've covered upgrading.

00:35:35.920 --> 00:35:43.340
It's been mentioned a couple of times if you're
catching it, that the process of upgrading

00:35:43.340 --> 00:35:50.940
and doing the Automated Migration using the Server
Assistant is essentially exactly the same now.

00:35:50.940 --> 00:36:01.230
And Sean has mentioned it, there has been a lot of work put
into it so we certainly hope that as you approach upgrading

00:36:01.230 --> 00:36:08.340
or migrating to Snow Leopard Server, that
you give the Automated Migration a chance.

00:36:08.340 --> 00:36:14.200
There has been a lot of voodoo around
the upgrading and migrating process.

00:36:14.199 --> 00:36:20.359
It almost seems if you go through the list and the
forums and spend time out there reading about the process

00:36:20.360 --> 00:36:25.090
of upgrading that people say not to do it.

00:36:25.090 --> 00:36:28.110
Always do a migration.

00:36:28.110 --> 00:36:35.400
So, we're going to cover the old way of migrating
because people will stick to their tried and trued method

00:36:35.400 --> 00:36:37.990
and we respect that, so we're definitely
going to cover that.

00:36:37.989 --> 00:36:45.049
But I want to call out of course the work that's
been done in the Automated Migration process,

00:36:45.050 --> 00:36:48.390
and essentially to do an Automated Migration.

00:36:48.389 --> 00:36:53.109
And let me back up, so you know, when
do you want to migrate versus upgrade?

00:36:53.110 --> 00:37:00.730
Well, this release of the operating
system is unique in that it's Intel only.

00:37:00.730 --> 00:37:04.780
Who out here has a power PC server running right now?

00:37:04.780 --> 00:37:07.580
Yeah, I know.

00:37:07.579 --> 00:37:15.049
So, I mean migration is pretty much your option.

00:37:15.050 --> 00:37:19.160
I mean the nice thing is of course what I've
been talking about, all the work that's been--

00:37:19.159 --> 00:37:23.639
that's gone into the Automated
Migration using Server Assistant.

00:37:23.639 --> 00:37:27.929
And if you saw the session today, Eric Firestone's session

00:37:27.929 --> 00:37:32.119
on the new Server Assistant and
the Automated Migration process.

00:37:32.119 --> 00:37:33.909
You understand how that works.

00:37:33.909 --> 00:37:42.899
In order to do an automated migration, essentially
all you need to do is have your old server mounted

00:37:42.900 --> 00:37:46.340
on the new server as you run through the Setup Assistant.

00:37:46.340 --> 00:37:50.860
So I know that that first bullet
seems kind of strange, right?

00:37:50.860 --> 00:37:58.730
Yeah, you want to either boot the old server into
target disk mode, or do the disk to disk restoration

00:37:58.730 --> 00:38:06.119
that Andre kind of demoed there and put it on to a FireWire
drive or USB drive if they're not physically close enough

00:38:06.119 --> 00:38:08.880
that you can target disk mode and plug in a cable.

00:38:08.880 --> 00:38:15.980
But have that volume mounted on the system as you go through
the Setup Assistant and it's important to note that it needs

00:38:15.980 --> 00:38:20.800
to be there during the Setup Assistant because you
can't go back later and run through this process.

00:38:20.800 --> 00:38:30.390
You can, but it's basically all by hand using
the scripts that Andre has been showing you.

00:38:30.389 --> 00:38:34.819
And then essentially, as you go into the
Setup Assistant, you got that volume mounted.

00:38:34.820 --> 00:38:41.350
You come to a screen which will be shown to you here in
a second where you have the option to set up your server

00:38:41.349 --> 00:38:45.000
or transfer information from your previous system.

00:38:45.000 --> 00:38:51.230
So if you select the option to move information from
your previous system, it takes you to another screen

00:38:51.230 --> 00:38:53.539
where it says pick the volume with your previous system.

00:38:53.539 --> 00:39:00.380
It will show you any in all volumes that have a supported
operating system to upgrade, 10.4.11 or 10.5.6 or later.

00:39:00.380 --> 00:39:02.530
You pick your volume, you hit next.

00:39:02.530 --> 00:39:05.269
In the background, all the scripts are running.

00:39:05.269 --> 00:39:11.690
It migrates your data in the exact same way that
your data is being moved in an in-place upgrade.

00:39:11.690 --> 00:39:14.909
It's exactly the same.

00:39:14.909 --> 00:39:18.759
There you go, and of course we'll show you how that works.

00:39:18.760 --> 00:39:24.300
Now, if you choose to go the Manual Migration process--

00:39:24.300 --> 00:39:28.019
Well, who has been through a Manual
Migration process before?

00:39:28.019 --> 00:39:34.130
OK, this process looks very exactly
the same as it did in Leopard Server.

00:39:34.130 --> 00:39:35.610
I mean it is identical.

00:39:35.610 --> 00:39:38.970
It's the same steps that you're going to be going through.

00:39:38.969 --> 00:39:40.779
The tools have changed a little bit.

00:39:40.780 --> 00:39:44.870
There is, you know, special note that needs
to be made for the services that have changed.

00:39:44.869 --> 00:39:50.339
For instance mail where we moved to Dovecot
instead of the other tools we had before.

00:39:50.340 --> 00:39:58.090
So, yeah, this is what it looks like, export your
information, users groups, authentication information,

00:39:58.090 --> 00:40:03.000
your services configuration and data files.

00:40:03.000 --> 00:40:09.409
Move them over to the new server, run all the scripts
that have been placed there for you to pull the data in

00:40:09.409 --> 00:40:18.839
and then set it all up for home directories, verify
that your user accounts work, test everything out.

00:40:18.840 --> 00:40:23.380
>> This note is exactly the same as
the note as during the upgrade process.

00:40:23.380 --> 00:40:29.250
You want to do your master first, leave your replicas online
so that your clients don't have a service interruption.

00:40:29.250 --> 00:40:33.079
And then once your master is up, you
verify that everything is working.

00:40:33.079 --> 00:40:38.299
Go ahead and upgrade your replicas
and reestablish those replicas.

00:40:38.300 --> 00:40:51.170
So exporting settings, you've got kind of the usual
suspects as far as tools for exporting your user

00:40:51.170 --> 00:40:57.079
and group information, service settings, and creating
archives of files for, you know, your user data.

00:40:57.079 --> 00:41:00.750
There is GUI tools, there is command line tools.

00:41:00.750 --> 00:41:06.849
I'll call out specifically the Open Directory information.

00:41:06.849 --> 00:41:18.139
If you choose to use Workgroup Manager or the dsexport
command which is here, passwords don't come with that.

00:41:18.139 --> 00:41:23.819
So when you export your users and groups and reimport
them on the new server, you've got to work out some way

00:41:23.820 --> 00:41:29.950
to get their passwords back whether that be
editing the export file to include passwords,

00:41:29.949 --> 00:41:36.089
or assigning everybody a generic password and forcing
them to change on the next log in, my personal favorite.

00:41:36.090 --> 00:41:39.320
You've got to work that out.

00:41:39.320 --> 00:41:46.420
So if you choose instead to do an Open Directory archive
using Server Admin, all that information is brought over.

00:41:46.420 --> 00:41:50.269
You merge that data in and it all works, we hope.

00:41:50.269 --> 00:42:00.210
Yeah, and then of course for your services settings,
you've got the Server Admin GUI which Andre showed you,

00:42:00.210 --> 00:42:06.210
you've also got the Server Admin command line
tool which is your interface to Server Admin.

00:42:06.210 --> 00:42:09.740
It's exactly the same.

00:42:09.739 --> 00:42:13.679
Next step, import all your data, and
the process looks something like this.

00:42:13.679 --> 00:42:16.529
Copy all your archive files that
you made in the first two steps

00:42:16.530 --> 00:42:21.870
over to the new server, reimport
the service settings and data.

00:42:21.869 --> 00:42:26.219
Configure home directories for the user,
that structure, bring in all that data,

00:42:26.219 --> 00:42:29.309
about the service data and the user data.

00:42:29.309 --> 00:42:36.860
Set it all up, run migration scripts as needed, check
permissions and then verify that everything works.

00:42:36.860 --> 00:42:45.730
Your tools for importing data into Snow Leopard Server
are exactly what they look like in Leopard Server.

00:42:45.730 --> 00:42:51.010
Workgroup Manager for users and groups,
computer lists, Server Admin for services,

00:42:51.010 --> 00:42:55.610
and then of course if you do the Open Directory
archive, Server Admin is your tool for merging

00:42:55.610 --> 00:42:59.940
that data into the new Open Directory database.

00:42:59.940 --> 00:43:04.360
And then command line, you got dsimport and serveradmin.

00:43:04.360 --> 00:43:15.470
When you get to the point in the process that
you've imported user information and you've worked

00:43:15.469 --> 00:43:20.730
out the passwords whether you did the OD archive or
imported with Workgroup Manager and set passwords,

00:43:20.730 --> 00:43:26.309
you want to verify that that works
and there are GUI ways to do this.

00:43:26.309 --> 00:43:31.590
I've called out the command line ways because as
IT administrators, this will save you tons of time

00:43:31.590 --> 00:43:35.309
over digging around trying to find the Kerberos app.

00:43:35.309 --> 00:43:44.349
Kadmin.local, the list of principles, kinit to
get a service principle for a user, or TGT rather,

00:43:44.349 --> 00:43:49.739
verify that your Password Server database
actually contains the users that you brought over

00:43:49.739 --> 00:43:52.549
and things should have entries
in the Password Server database.

00:43:52.550 --> 00:43:59.110
You won't see the passwords but you'll only see the user
in plain text in this output, and then you can verify

00:43:59.110 --> 00:44:04.059
that Password Server authentication works using dscl.

00:44:04.059 --> 00:44:06.259
Andre already called this out.

00:44:06.260 --> 00:44:10.300
This is the location where all of the migration extras live.

00:44:10.300 --> 00:44:12.130
This location hasn't changed either.

00:44:12.130 --> 00:44:16.250
This was the same in Leopard as it
is in Snow Leopard although the files

00:44:16.250 --> 00:44:21.329
and the numbering prefix has changed on a lot of them.

00:44:21.329 --> 00:44:26.380
And their usages is called out regularly in the
documentation so it can't be stressed enough

00:44:26.380 --> 00:44:31.990
that you really need to be following the
documentation when you're going through this process.

00:44:31.989 --> 00:44:34.509
What services can be migrated?

00:44:34.510 --> 00:44:36.130
All of them, there they are.

00:44:36.130 --> 00:44:39.780
I mean there is a couple like LDAP server settings.

00:44:39.780 --> 00:44:47.500
Yeah, if you have extended your schema or
have a custom directory access control lists,

00:44:47.500 --> 00:44:54.139
that type of stuff can be migrated although
by hand but everything can be migrated.

00:44:54.139 --> 00:45:04.549
The next few slides are a dizzying array
of paths to service configuration and data.

00:45:04.550 --> 00:45:06.210
You don't need to know all these.

00:45:06.210 --> 00:45:07.849
It's all in the documentation.

00:45:07.849 --> 00:45:13.860
Again, we can't stress it enough, follow the
documentation, things will go well for you.

00:45:13.860 --> 00:45:19.230
And with that I'm going to bring Andre up.

00:45:19.230 --> 00:45:24.420
>> So this is the clean-- this is the migration demo,
and I'm not going to show you the actual migrate

00:45:24.420 --> 00:45:27.680
from volume thing, because actually
very similar to the in-place upgrade.

00:45:27.679 --> 00:45:31.909
So I'm going to skip to the clean server
and I want to manually migrate some data

00:45:31.909 --> 00:45:35.149
and service configs from my old server into the new one.

00:45:35.150 --> 00:45:40.079
So here I am on a fresh-- freshly
installed Snow Leopard Server.

00:45:40.079 --> 00:45:45.279
Pretty much all that I've done here is just, you know,
create the admin account and I flagged a few services here

00:45:45.280 --> 00:45:49.070
for configuration so that they show up in the
list, but I haven't actually configured them yet.

00:45:49.070 --> 00:45:52.070
So, I want to bring back mail and web.

00:45:52.070 --> 00:45:57.860
In order to do that, I need an Open Directory Master because
I need my users and groups, and particularly the GUIDs

00:45:57.860 --> 00:46:01.870
from the users and groups to match what
they were before, otherwise the wiki data

00:46:01.869 --> 00:46:04.059
and stuff won't work right, and mail as well.

00:46:04.059 --> 00:46:09.279
So if I need an Open Directory Master, then
what service do I have to start with, anybody?

00:46:09.280 --> 00:46:10.620
DNS, thank you, yes.

00:46:10.619 --> 00:46:17.099
So I can import the DNS config files but before I do
that even, I'm going to start with the SSL Certificates

00:46:17.099 --> 00:46:19.289
because some of the config files that I'm going to import,

00:46:19.289 --> 00:46:21.800
I'm going to import them all at
once for the different services.

00:46:21.800 --> 00:46:27.289
Some of those are going to be referring to my
SSL Certificates like my web config and such.

00:46:27.289 --> 00:46:31.429
So I want to pull in my SSL Certificate
first, and again I'm just sort

00:46:31.429 --> 00:46:34.739
of pulling these in from the backup that I have created.

00:46:34.739 --> 00:46:38.229
And so there is my SSL cert.

00:46:38.230 --> 00:46:45.369
And now I'm ready to pull in my DNS settings and
others, so I'm just going to import service settings

00:46:45.369 --> 00:46:50.759
and navigate to my little USB thumb drive here.

00:46:50.760 --> 00:46:54.110
Under configs, here is my service data, and this is

00:46:54.110 --> 00:46:58.030
that one big XML file that's got all those
service configs just stacked up inside of it.

00:46:58.030 --> 00:47:01.180
And I'm not going to get everything
just for the sake of brevity here.

00:47:01.179 --> 00:47:03.269
And in fact I really couldn't import everything.

00:47:03.269 --> 00:47:07.159
For example if I try to import my file sharing settings,
well there's an amount of stuff that's not going to work

00:47:07.159 --> 00:47:09.059
yet because I don't have an Open Directory Server yet.

00:47:09.059 --> 00:47:13.460
So I'm just going to import-- I'm not going to import
mail because I'm going to migrate all that stuff manually.

00:47:13.460 --> 00:47:18.940
I'm not going to import my OD settings or server, but I am
going to get web and we'll just pull these other ones off

00:47:18.940 --> 00:47:20.659
as well because I'm not going to show them.

00:47:20.659 --> 00:47:24.629
But pretty much just DNS and web, pretty straightforward.

00:47:24.630 --> 00:47:25.910
So that comes in.

00:47:25.909 --> 00:47:29.750
So now I've got a DNS server and
let's make sure my zones are in there,

00:47:29.750 --> 00:47:33.429
and there is my WWDC zone, so now I can start my DNS server.

00:47:33.429 --> 00:47:39.429
And then I can go and you know, set my DNS
client settings because we need those to--

00:47:39.429 --> 00:47:47.289
and grab my IP here, just throw that in
my DNS server and add my search domain.

00:47:47.289 --> 00:47:51.829
So now I've got DNS client and server.

00:47:51.829 --> 00:47:58.099
So we should check our work here,
sudo changeip, check hostname.

00:47:58.099 --> 00:48:04.079
There we go, nothing to change.

00:48:04.079 --> 00:48:07.119
So now I'm ready for my Open Directory Master.

00:48:07.119 --> 00:48:10.319
And before we can restore the archive,
we actually have to clone it to a Master.

00:48:10.320 --> 00:48:16.480
So I'm just going to go through the Open Directory
Assistant and choose Open Directory Master.

00:48:16.480 --> 00:48:19.889
And throw the stuff in here.

00:48:19.889 --> 00:48:24.109
Now this screen is actually kind of important because
if it doesn't suggest to you a good Kerberos realm

00:48:24.110 --> 00:48:27.960
in LDAP search base based on your actual fully
qualified domain name, that is a sign of trouble.

00:48:27.960 --> 00:48:29.929
You should check your DNS.

00:48:29.929 --> 00:48:34.449
But in this case, since I already did that,
and this is correct, we will continue.

00:48:34.449 --> 00:48:42.039
And the Open Directory, any time you change the Open
Directory role of a server, you can examine that stuff,

00:48:42.039 --> 00:48:45.769
the things that are happening there
using the console utility and the log--

00:48:45.769 --> 00:48:49.679
the relevant log file is library logs slapconfig.log.

00:48:49.679 --> 00:48:55.219
I always though that was kind of a funny word, slapconfig.

00:48:55.219 --> 00:49:00.639
So here it is and it's doing stuff, and so that will be done
in just a second but basically it's setting up my, you know,

00:49:00.639 --> 00:49:05.509
LDAP master, it's setting in my Password Server,
setting up a KDC, creating a bunch of service key tabs

00:49:05.510 --> 00:49:10.950
for all my services, and basically doing a bunch of
other stuff that we're going to kind of overwrite here

00:49:10.949 --> 00:49:14.629
in just a second as I pull in my archive.

00:49:14.630 --> 00:49:18.590
So we'll switch back to Server
Admin and this is almost done.

00:49:18.590 --> 00:49:20.820
There we go.

00:49:20.820 --> 00:49:24.780
So, now I have an Open Directory Master,
click the overview tab, I can see my LDAP

00:49:24.780 --> 00:49:26.710
and Password Server the Kerberos stuff is running.

00:49:26.710 --> 00:49:32.070
That's awesome, so now I go to my archive that I
created previously and I'm going to restore that.

00:49:32.070 --> 00:49:40.500
So I choose from my USB thumb drive, from the
data directory, my Leopard Open Directory back

00:49:40.500 --> 00:49:43.389
up and I restore that, supply the password.

00:49:43.389 --> 00:49:48.509
You also get the chance to merge or
overwrite, so if you have a bunch of records

00:49:48.510 --> 00:49:50.180
that you didn't want to lose, you could merge.

00:49:50.179 --> 00:49:53.289
I'm just going to merge, it doesn't really matter
because I really don't have a whole lot of stuff

00:49:53.289 --> 00:49:57.079
in this Open Directory Master because I just created it.

00:49:57.079 --> 00:50:00.860
So we're going to restore the backup
and this is actually pretty quick.

00:50:00.860 --> 00:50:14.789
So here comes the Open Directory stuff and now we can verify
this by firing up Workgroup Manager and just logging in.

00:50:14.789 --> 00:50:21.009
>> And once, twice, 3 times, 4 times, this is going to work.

00:50:21.010 --> 00:50:22.790
There it goes.

00:50:22.789 --> 00:50:27.989
[Laughter] That's how fast of a typer I am.

00:50:27.989 --> 00:50:31.329
I was really going for 3 times a
charm so I went too fast, I'm sorry.

00:50:31.329 --> 00:50:34.000
So here are my users and my groups.

00:50:34.000 --> 00:50:38.610
So my Open Directory restore worked, and of course I
logged in with my directory administrator credential,

00:50:38.610 --> 00:50:41.110
which means my authentication is working as well.

00:50:41.110 --> 00:50:43.960
So now I have an Open Directory server, I have DNS server,

00:50:43.960 --> 00:50:47.360
now I can actually start looking
at my service configurations.

00:50:47.360 --> 00:50:50.970
So we'll start with mail and what
we're going to do is we're just going

00:50:50.969 --> 00:50:54.379
to use the migration script that
is called out in the documentation.

00:50:54.380 --> 00:50:59.470
So I'm just going to kind of go to my other script that
I had and just sort of crib from that a little bit.

00:50:59.469 --> 00:51:03.889
Let's see, scripts, got mail, restore.

00:51:03.889 --> 00:51:08.559
I'm just going to grab this last line here which
actually fires off the upgrade script itself.

00:51:08.559 --> 00:51:16.809
And sure I got my clipboard contents
proper and there, doing this with a track

00:51:16.809 --> 00:51:18.679
that is quite an adventure, I'm going to tell you.

00:51:18.679 --> 00:51:23.039
So, I'm going to use this command
which is in the documentation.

00:51:23.039 --> 00:51:26.940
But what I'm not going to do is
specify a source of previous system.

00:51:26.940 --> 00:51:28.389
Cause I don't have previous system.

00:51:28.389 --> 00:51:34.170
What I do have is my old server
mounted at Volumes/MacintoshHD1.

00:51:34.170 --> 00:51:37.380
Now remember, finder is going to pull
a little smoke and mirrors on you here,

00:51:37.380 --> 00:51:40.300
and it's going to say, no, they're both called Macintosh HD.

00:51:40.300 --> 00:51:42.370
Not true, you can't actually, it's illegal.

00:51:42.369 --> 00:51:45.429
You have to have, you know, unique
directory names for all your down points.

00:51:45.429 --> 00:51:50.909
So if you have dragged with the same name,
go in the terminal or perhaps use the go

00:51:50.909 --> 00:51:53.839
to folder and find there, just go to /volumes.

00:51:53.840 --> 00:51:55.420
It's called Volumes/MacintoshHD1.

00:51:55.420 --> 00:52:02.650
That's what we need to use as our source root, so I'm
just going to change that right here, volumes, Macintosh,

00:52:02.650 --> 00:52:07.889
/macintoshhd1 and that looks all correct.

00:52:07.889 --> 00:52:11.639
So let me kick that off and that's going to run.

00:52:11.639 --> 00:52:14.309
We're going to pull up the mail migration log.

00:52:14.309 --> 00:52:15.409
We'll do it on time.

00:52:15.409 --> 00:52:16.659
OK, so that's going to go.

00:52:16.659 --> 00:52:19.289
And now let's switch to web.

00:52:19.289 --> 00:52:21.849
So I'd already pulled in my web settings.

00:52:21.849 --> 00:52:25.380
We need to make sure that the SSL is configured properly.

00:52:25.380 --> 00:52:32.519
So we'll go back in and reconfigure my SSL settings because
again I had to reimport my SSL certificates, save that.

00:52:32.519 --> 00:52:38.509
Now we don't have any other document roots like
normal web stuff, we just have in this case wiki data

00:52:38.510 --> 00:52:41.200
so that is all stored in library collaboration.

00:52:41.199 --> 00:52:47.529
So what we're going to do is just go to library
and see here is collaboration and it's empty.

00:52:47.530 --> 00:52:48.610
There's nothing in there.

00:52:48.610 --> 00:52:50.140
This is the new one basically.

00:52:50.139 --> 00:52:54.099
I'm just going to delete that folder and authenticate.

00:52:54.099 --> 00:53:02.909
And I happen to have on my little USB keychain,
a collaboration.tgg archive or just a use finder

00:53:02.909 --> 00:53:05.369
to make a compressed archive from my Leopard server.

00:53:05.369 --> 00:53:09.369
And if you're saying "Oh, I forgot to do that"
well you have a backup of your server disk images.

00:53:09.369 --> 00:53:11.029
Go in and you know, do it.

00:53:11.030 --> 00:53:18.650
So I will paste that in and I will decompress it and
finally I have to make sure the permissions are correct.

00:53:18.650 --> 00:53:24.400
They need to be owned by the team server
and you can do this in finder if you wanted to as well,

00:53:24.400 --> 00:53:35.139
but it's _team server, teams, server,
user and group library collaboration.

00:53:35.139 --> 00:53:39.730
OK, so in the case of just the wiki, that's
actually all you have to do, kind of neat.

00:53:39.730 --> 00:53:51.769
So we'll start the web service and we'll find our browser,
and here comes a browser and we'll go to yes server.wwdc.

00:53:51.769 --> 00:53:56.929
And we get the certificate warning
because this is a fresh server.

00:53:56.929 --> 00:54:01.399
We've never encountered this custom self signed
certificate before so we get the warning, we expect that.

00:54:01.400 --> 00:54:08.950
We click show certificate and we click the check box
to always trust it, and plug in our admin credentials.

00:54:08.949 --> 00:54:14.539
So then hopefully our server page will load.

00:54:14.539 --> 00:54:23.199
It's coming, so we'll take a look at the mail
script which is not done yet but it's close.

00:54:23.199 --> 00:54:25.809
Let's see here.

00:54:25.809 --> 00:54:28.279
Yup, there it is still running, but it's getting close.

00:54:28.280 --> 00:54:34.120
And I think the web server is done
there so we can then go into our wiki,

00:54:34.119 --> 00:54:36.009
and the wiki part of it is still starting up too.

00:54:36.010 --> 00:54:40.390
Apache starts first and then you get team
server in the background and that stuff.

00:54:40.389 --> 00:54:50.379
So then we can log in as my network user and
password, and then we see our wiki content,

00:54:50.380 --> 00:54:52.030
pretty easy to migrate in the case of the wiki data.

00:54:52.030 --> 00:54:55.220
You just, you know, collect that
library collaboration folder.

00:54:55.219 --> 00:55:01.239
The key though is you need to have the users and group
records with the same GUIDs that they had from the backup

00:55:01.239 --> 00:55:05.500
which we took care of because I
reimported my Open Directory archive.

00:55:05.500 --> 00:55:08.719
But if you just do something like recreate
users and groups with the same names,

00:55:08.719 --> 00:55:11.709
it's not going to work because the
GUIDs are going to be totally different.

00:55:11.710 --> 00:55:16.220
This is why you want to use either a Workgroup Manager
backup and restore, or if you want the passwords to go too,

00:55:16.219 --> 00:55:18.389
you want to use the Open Directory backup and restore.

00:55:18.389 --> 00:55:20.879
OK, so let's switch back to mail.

00:55:20.880 --> 00:55:22.920
The mail script is finished running.

00:55:22.920 --> 00:55:28.430
I can flip back over here to my mail
migration log and scroll up and see,

00:55:28.429 --> 00:55:32.349
yes in fact it was able to migrate
my MailStore and everything.

00:55:32.349 --> 00:55:37.049
So the last thing to do at this point is to
make sure that mail is configured properly

00:55:37.050 --> 00:55:40.870
for SSL before we actually start the mail client.

00:55:40.869 --> 00:55:55.059
Wait for the spinner, there it is, advanced, use and views,
pick my certificate, save that, and we're going to go ahead

00:55:55.059 --> 00:55:58.719
and check the config file to make
sure that it gets written properly.

00:55:58.719 --> 00:56:00.949
Usually in this case in my experience, it does.

00:56:00.949 --> 00:56:03.189
But we're going to check anyway.

00:56:03.190 --> 00:56:13.789
So waiting for the spinner and let's just
graph for SSL_ in etc/dovecot/dovecot.conf.

00:56:13.789 --> 00:56:19.849
And we see that in this case, in fact it did
write these two config entries correctly.

00:56:19.849 --> 00:56:22.969
We have SSL cert file and SSL key file.

00:56:22.969 --> 00:56:24.769
Both of those are not commented, they're active,

00:56:24.769 --> 00:56:28.360
they're pointing to the right cert,
which means that this is likely to work.

00:56:28.360 --> 00:56:35.519
So now I can flip back over here, start my mail service,
and as that's starting up we'll flip over to mail client

00:56:35.519 --> 00:56:39.780
which I've sort of prefilled a little bit
with some of the config data for this account.

00:56:39.780 --> 00:56:45.310
So when I click continue, I believe it's
looking for like MX records and stuff right now.

00:56:45.309 --> 00:56:47.360
So I'm just going to cancel that and manually continue.

00:56:47.360 --> 00:56:50.220
I didn't set up any MX records in my DNS server, sorry.

00:56:50.219 --> 00:56:55.609
So mail exchange records are used for mail.

00:56:55.610 --> 00:57:05.579
So net user 1, and we'll say server.wwdc
and the user1 and my password.

00:57:05.579 --> 00:57:13.549
And if all goes well-- and right about now,
you should get my Kerberos prompt which we did.

00:57:13.550 --> 00:57:18.340
And while we're waiting for mail to advance to
the SNTP screen, let's go ahead and just look

00:57:18.340 --> 00:57:21.650
at my Kerberos keys or my Kerberos tickets rather.

00:57:21.650 --> 00:57:27.410
We see that I got a TGT and I've got an
IMAP service ticket for the net user 1 user.

00:57:27.409 --> 00:57:36.159
And the next thing we're going to see from mail after it
finishes showing this pizza is going to be the SNTP screen.

00:57:36.159 --> 00:57:43.639
And what we'll see there is, once I plug in my
information, that there we go, net user 1, server.wwdc,

00:57:43.639 --> 00:57:47.420
and we will authenticate here with the same credentials.

00:57:47.420 --> 00:57:53.659
And as I continue, I've now logged in my accounts
created and I'm going to flip back here one more time,

00:57:53.659 --> 00:58:00.879
do another klist and sure enough we have an
SNTP ticket now as well, so that's awesome.

00:58:00.880 --> 00:58:06.680
And there is my mail and I even
preserved the red status, the message.

00:58:06.679 --> 00:58:09.489
So that's just kind of a brief whirlwind tour.

00:58:09.489 --> 00:58:14.799
Normally you go slower than this
in a production environment.

00:58:14.800 --> 00:58:19.000
[Laughter] But you know, for onstage that works out alright,
so thank you very much, let me toss you back to John.

00:58:19.000 --> 00:58:24.900
[ Applause ]

00:58:24.900 --> 00:58:27.639
>> So again, let's talk about the replicas.

00:58:27.639 --> 00:58:34.039
Unless nonstop operation is critical, you can do
a clean install of Snow Leopard Server, right,

00:58:34.039 --> 00:58:37.639
and that become a replica of the new Master.

00:58:37.639 --> 00:58:42.500
When you're talking about migrating just like John showed
you, take the home directory, zip them up, move them over,

00:58:42.500 --> 00:58:45.730
unzip them, go and have a beer, that would be fine.

00:58:45.730 --> 00:58:48.990
So depending on the path, where are we?

00:58:48.989 --> 00:58:50.859
NetInfo, gone.

00:58:50.860 --> 00:58:54.960
If you have a Tiger Server and
you upgrade it, it's now gone.

00:58:54.960 --> 00:58:57.760
We're now 100 percent LDAP for the Open Directory Masters.

00:58:57.760 --> 00:59:02.870
We have a Password Server running fine, we have our
KDC running fine, our home directories are there,

00:59:02.869 --> 00:59:06.960
wikis have migrated over, mails have been migrated over.

00:59:06.960 --> 00:59:13.980
And regardless of our path, and I can't
stress this enough, we did a plain vanilla.

00:59:13.980 --> 00:59:16.829
We did it live again because the slides are static.

00:59:16.829 --> 00:59:19.940
It's not as much fun, you don't set on your
edge of your seat waiting for us to fail

00:59:19.940 --> 00:59:22.240
so you can take a photo and post it to fail blog.

00:59:22.239 --> 00:59:24.189
Now that's not how it works.

00:59:24.190 --> 00:59:33.179
So, if you have these customized files, you really
need to remember where they are and back them up.

00:59:33.179 --> 00:59:38.829
Generally, the problems that we see, some in system
admin has come in, changed something very minor

00:59:38.829 --> 00:59:42.940
in a configuration file, didn't write it
down, didn't tell anybody, forgot about it,

00:59:42.940 --> 00:59:49.730
may have moved on if they are consultant or whatever,
somebody else upgrades it and they have a problem, OK.

00:59:49.730 --> 00:59:51.429
So, what do you do?

00:59:51.429 --> 00:59:53.889
Well, you attend this session.

00:59:53.889 --> 01:00:02.719
Back up at least once, set up a private test
environment, right, test the upgrade, test the migration,

01:00:02.719 --> 01:00:05.309
test them on the server, test them with the clients, OK.

01:00:05.309 --> 01:00:15.630
And like I said at the beginning, it's not and
it's never been a totally error free process.

01:00:15.630 --> 01:00:24.280
But Apple engineers have worked very, very
hard to make it as smooth as possible.

01:00:24.280 --> 01:00:31.560
And while the GUI has the Migration Assistant
in it and that's great and it's really easy,

01:00:31.559 --> 01:00:36.150
our job was to show you the behind the scenes, OK.

01:00:36.150 --> 01:00:45.230
So, what other sessions, if you have attended them or
you can get them on iTunes, right, when they come out,

01:00:45.230 --> 01:00:48.619
and the Directory Services lab which was earlier today.

01:00:48.619 --> 01:00:52.670
For more information, you can get a
hold of Mark, get a hold of one of us.