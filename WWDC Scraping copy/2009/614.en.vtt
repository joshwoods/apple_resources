WEBVTT

00:00:12.550 --> 00:00:17.710
>> Welcome everybody to the What's
New in Directory Services session.

00:00:17.710 --> 00:00:23.190
I'm Nicole Jacque and I'm an engineer
with the Directory Server Team at Apple.

00:00:23.190 --> 00:00:28.679
And what we're going to talk about today is we're
going to talk about what's new in Directory Services,

00:00:28.679 --> 00:00:32.500
both on the client side and on the server side.

00:00:32.500 --> 00:00:38.090
And we're going to get started with just
a quick overview of Directory Services

00:00:38.090 --> 00:00:40.530
in general, for those of you that are, maybe new.

00:00:40.530 --> 00:00:43.630
And then we're going to talk about
Directory Services on the client.

00:00:43.630 --> 00:00:48.760
We're going to spend a little time,
particularly on the Active Directory plug in,

00:00:48.759 --> 00:00:51.390
because this is a very popular plug in with customers.

00:00:51.390 --> 00:00:53.990
How many people here use Active Directory?

00:00:53.990 --> 00:01:01.630
Like a whole forest of arms here, alright
that's why we're spending a little time on it.

00:01:01.630 --> 00:01:08.900
Then we're going to talk about Open Directory, which
is the server side of OS X's Directory Services.

00:01:08.900 --> 00:01:15.760
And then we're going to wrap up with some best practices,
because I always like to leave you guys with a little bit

00:01:15.760 --> 00:01:22.090
of practical information, stuff that you can take
back with you to either use right away with Leopard,

00:01:22.090 --> 00:01:27.230
or to help with your plans for
Snow Leopard deployments and so on.

00:01:27.230 --> 00:01:31.040
So let's get started with an overview of Directory Services.

00:01:31.040 --> 00:01:36.460
So we're going to start by talking about
Directory Service on the client side.

00:01:36.459 --> 00:01:46.089
Directory Services, basically its main job is
to be the translator between the OS, Mac OS X,

00:01:46.090 --> 00:01:52.189
and some data store somewhere that has records
- things like users and groups and computers,

00:01:52.189 --> 00:01:56.009
and other types of data that you might need to use.

00:01:56.010 --> 00:02:04.020
And the way that it does this is it sits as this
layer that the operating system can call into,

00:02:04.019 --> 00:02:10.609
either through different API's like the LIB
system API's, the Directory Service API,

00:02:10.610 --> 00:02:14.420
there's a new API on the Open Directory framework.

00:02:14.419 --> 00:02:22.149
And Directory Service itself is a daemon that runs,
and so all these API's talk to Directory Service.

00:02:22.150 --> 00:02:28.090
But Directory Service still has to get all this information
out of these data stores that are out there somewhere,

00:02:28.090 --> 00:02:35.400
and these data stores can be flat files sitting on
your computer, they could be some directory server

00:02:35.400 --> 00:02:39.390
out there somewhere, either an LDAP
server, an active Directory Server,

00:02:39.389 --> 00:02:43.750
maybe eDirectory, iPlanet, something like that.

00:02:43.750 --> 00:02:47.120
So because there's so many different possibilities out there

00:02:47.120 --> 00:02:52.490
for where this directory data could
be, we have a plug-in architecture.

00:02:52.490 --> 00:02:58.750
So Apple provides plug-ins for a lot
of really popular directory storage.

00:02:58.750 --> 00:03:03.740
So for example, we have DS Local
which is our own local flat files.

00:03:03.740 --> 00:03:09.290
We also have a plug-in for the traditional UNIX flat
files, so the files that you would normally find

00:03:09.289 --> 00:03:16.229
in etc. We have an LDAP plug-in and that
talks to both our own Open Directory Server,

00:03:16.229 --> 00:03:20.179
but also at any third party LDAP servers that are out there.

00:03:20.180 --> 00:03:24.849
We have an NIS plug-in, and we also
have Active Directory which is,

00:03:24.849 --> 00:03:28.889
you all saw from the hands before, is really popular.

00:03:28.889 --> 00:03:36.849
Now if all of these plug-ins aren't enough, we also have
the option for third parties to create their own plug-in,

00:03:36.849 --> 00:03:46.669
and there's a number of third parties that have done
that; things like the Kanaka plug-in for eDirectory,

00:03:46.669 --> 00:03:50.359
Thursby's ADmitMac for Active Directory and so on.

00:03:50.360 --> 00:03:57.400
So that's the client, but now in the server we have an app,

00:03:57.400 --> 00:04:02.330
what we call the Open Directory server,
and this is Apple's Directory Server.

00:04:02.330 --> 00:04:05.410
And it's really made up of several parts.

00:04:05.409 --> 00:04:12.819
We have an LDAP server, we have the
password server, and we have an MIT KDC.

00:04:12.819 --> 00:04:16.889
We also have a Radius server that can talk to these.

00:04:16.889 --> 00:04:23.990
And to talk to the Directory Server, you
can use our Directory Service client...

00:04:23.990 --> 00:04:31.769
which is great, but just in case you have other clients out
there for example, a Windows machine or something like that,

00:04:31.769 --> 00:04:38.289
because we have a standards based Directory
Server, you can talk directly to the server

00:04:38.290 --> 00:04:39.990
through any of these standards that we support.

00:04:39.990 --> 00:04:42.800
So you can talk to the LDAP server over LDAP,

00:04:42.800 --> 00:04:46.850
you can talk to the Password server
for authentication using SASL methods.

00:04:46.850 --> 00:04:52.710
You can talk to the KDC using Kerberos, and
you talk to the Radius server using radius.

00:04:52.709 --> 00:04:57.139
So it's very standards based.

00:05:00.120 --> 00:05:09.019
OK, so that's our quick overview and now we're going to go
ahead, we're going to dive into what's new in Snow Leopard.

00:05:09.019 --> 00:05:13.969
So starting with the client, the Directory Service client...

00:05:13.970 --> 00:05:22.410
what we've done for Snow Leopard is basically you
heard Bertrand say we weren't focusing on new features.

00:05:22.410 --> 00:05:32.530
This was a chance for us to do sort of,
clean up to do evolution of our code.

00:05:32.529 --> 00:05:39.509
So our changes for Directory Service are basically we did
a lot of clean up of our code, got rid of some old stuff

00:05:39.509 --> 00:05:45.060
that had been sitting around for a while, but we also
did a lot of work on making things more efficient;

00:05:45.060 --> 00:05:50.780
working on data structures, working on
things that maybe could be made faster,

00:05:50.779 --> 00:05:55.349
or things that could be just made more efficient in general.

00:05:55.350 --> 00:05:59.680
And we want to basically improve
our performance for Snow Leopard.

00:05:59.680 --> 00:06:06.019
And we also wanted to work on fixing
any bugs that had been sitting around.

00:06:07.889 --> 00:06:11.579
We do have some other changes that
you'll notice right off the bat.

00:06:11.579 --> 00:06:15.589
So how many people are familiar with Directory
Utility, which is how you always configure directory...

00:06:15.589 --> 00:06:17.799
yep, OK everybody's seen that.

00:06:17.800 --> 00:06:24.329
So you may have tried to look for it in Snow
Leopard, and you said huh - it's not there anymore.

00:06:24.329 --> 00:06:29.430
It used to live in applications,
utilities, and it's not there.

00:06:29.430 --> 00:06:36.280
So what we've actually done is, because Directory Services
is now such an important part of the operating system,

00:06:36.279 --> 00:06:42.679
we've moved into system preferences like all of the
other important preferences for the operating system.

00:06:42.680 --> 00:06:51.069
So if you go to the Accounts pane under Login Options,
we now have the option to join a network account server.

00:06:51.069 --> 00:06:57.639
And if you click that, you'll get the option to enter
the name of a server, and we added some cool logic

00:06:57.639 --> 00:07:02.259
so as you type, we will actually
detect what type of server this is.

00:07:02.259 --> 00:07:09.259
So if it's an Open Directory server, or an Active
Directory server, we'll give you the right panel depending

00:07:09.259 --> 00:07:13.279
on if you need to provide credentials
in order to bind to it.

00:07:13.279 --> 00:07:19.989
And then once you've bound to it, you'll get a little
status display that gives you the green or the red

00:07:19.990 --> 00:07:23.040
to tell you whether or not that node is working.

00:07:23.040 --> 00:07:29.870
Now some of you may have some very complex
servers that you need to connect to

00:07:29.870 --> 00:07:31.790
You may have complex configs.

00:07:31.790 --> 00:07:38.439
You can still use directory utility, it's actually still
around, it now lives in /System/Library/CoreServices.

00:07:38.439 --> 00:07:45.350
You can either go directly to it or there's
a button inside of system preferences

00:07:45.350 --> 00:07:48.890
that will take you right to directory utility.

00:07:51.350 --> 00:07:57.060
We also have some changes that we've made under the
hood, things that you're not going to see in the UI.

00:07:57.060 --> 00:08:02.610
And the first thing, this was actually a pretty major
undertaking, is you may have heard in the keynote

00:08:02.610 --> 00:08:09.800
or in Bertrand's state of the union, some talk about
something called GCD, or Grand Central Dispatch.

00:08:09.800 --> 00:08:15.410
And Directory Services has actually
completely adapted Grand Central Dispatch.

00:08:15.410 --> 00:08:21.010
Directory Services has a lot of different threads,
it has a lot of stuff going on at any given time.

00:08:21.009 --> 00:08:26.659
And Grand Central Dispatch was the perfect
technology to help us really sort some of that out,

00:08:26.660 --> 00:08:29.939
make it more efficient with how
all of our threads were working.

00:08:29.939 --> 00:08:36.090
So not only does Directory Service use Grand
Central Dispatch, it uses pretty much every part,

00:08:36.090 --> 00:08:39.250
every part of the Grand Central Dispatch API.

00:08:39.250 --> 00:08:45.720
So this is really an example of
us eating our own dog food here.

00:08:45.720 --> 00:08:51.340
Another change, how many developers
here remember the Directory Service API?

00:08:51.340 --> 00:08:53.570
Any developers?

00:08:53.570 --> 00:08:58.970
OK, it's deprecated now.

00:08:58.970 --> 00:09:00.529
No cheers?

00:09:01.850 --> 00:09:03.190
OK.

00:09:03.190 --> 00:09:08.100
So if we take that away, we've got to
give you something else to use right?

00:09:08.100 --> 00:09:13.509
So we've introduced a new API which is the Open
Directory framework, and if you're interested

00:09:13.509 --> 00:09:23.230
in this I have a session tomorrow morning on this,
and it's really a very nice, easy to use API;

00:09:23.230 --> 00:09:29.269
something that even if you're not a hard core developer,
maybe you are a system admin that's sort of getting

00:09:29.269 --> 00:09:31.990
into programming, it's something that you can use.

00:09:31.990 --> 00:09:36.110
So I would encourage anybody that is
even slightly interested in programming

00:09:36.110 --> 00:09:39.159
with Directory Services, come to
my session tomorrow morning.

00:09:39.159 --> 00:09:42.389
Unfortunately again, it's in the morning but...

00:09:42.389 --> 00:09:44.470
come take a look at the Open Directory framework.

00:09:44.470 --> 00:09:51.759
And another change that we wanted to make
for Snow Leopard was to improve our caching,

00:09:51.759 --> 00:09:58.590
because we have a lot of things going on and performance
wise, something that takes a big hit is if we have

00:09:58.590 --> 00:10:02.990
to keep going out to the server, keep
reading flat files and stuff like that.

00:10:02.990 --> 00:10:09.220
So we've put a lot of work into improving how
we cache information in Directory Services.

00:10:09.220 --> 00:10:21.120
And finally, previously Directory Services handled not
just Directory Service records and stuff like that,

00:10:21.120 --> 00:10:24.669
it also handled all of the DNS look-ups on the client.

00:10:24.669 --> 00:10:32.370
It made more sense though, when we looked at it, to
actually just let MDNS responder handle all of this.

00:10:32.370 --> 00:10:40.710
There was really no need for DS to be involved,
so that has all been moved over to mDNSResponder.

00:10:43.960 --> 00:10:50.170
OK, so those were the changes for
Directory Services in general.

00:10:50.169 --> 00:10:57.870
But again, since there's a lot of people using the Active
Directory plug-in, let's talk about what's new with that.

00:10:57.870 --> 00:11:02.970
So first of all, one thing that
we wanted to do was fix bugs.

00:11:02.970 --> 00:11:07.580
But beyond just bug fixes, we wanted to make sure

00:11:07.580 --> 00:11:12.820
that we were supporting common configurations
that our Active Directory customers use.

00:11:12.820 --> 00:11:19.480
There's a lot of really complex forest configurations out
there that people can have, things like disjoint forests,

00:11:19.480 --> 00:11:24.200
non hierarchical forests, and all
kinds of things in between.

00:11:24.200 --> 00:11:29.720
So we wanted to try to make sure that we were
supporting the configurations that were most common

00:11:29.720 --> 00:11:33.050
with our customers, and we'll talk about a few of these.

00:11:33.049 --> 00:11:38.039
Also Microsoft has a new server version
out there, so Window Server 2008.

00:11:38.039 --> 00:11:40.889
We needed to add a little bit of support for that.

00:11:40.889 --> 00:11:44.830
And then we also wanted to, just in general,

00:11:44.830 --> 00:11:48.560
work on stability across the board
with the Active Directory plug-in.

00:11:48.559 --> 00:11:54.549
And because we have a lot of laptop users, people
that use the Active Directory plug-in and use it

00:11:54.549 --> 00:11:59.779
with mobile accounts, portable home directories
where they're going on the network, off the network.

00:11:59.779 --> 00:12:06.600
We wanted to make sure that their experience was as
good as somebody that was on the network all the time.

00:12:06.600 --> 00:12:08.009
So we really worked on it...

00:12:08.009 --> 00:12:12.120
[ Applause ]

00:12:12.120 --> 00:12:13.299
Apparently that's important.

00:12:13.299 --> 00:12:18.469
So let's talk about...

00:12:18.470 --> 00:12:23.029
oh, I gave it away!

00:12:24.100 --> 00:12:29.009
OK, so 1 big change, and judging from the applause here

00:12:29.009 --> 00:12:34.289
[ Applause ]

00:12:34.289 --> 00:12:37.709
... we now have password expiration notices at login.

00:12:37.710 --> 00:12:45.650
So 1 thing that we had a lot of requests for is people
wanted to be able to know, hey my password is going

00:12:45.649 --> 00:12:50.439
to expire in a certain number of days, and I
don't even want to know that it's going to expire,

00:12:50.440 --> 00:12:53.030
you want to be able to maybe go and change it.

00:12:53.029 --> 00:12:57.740
That sort of made sense to us too, so we've
actually put that all in login window,

00:12:57.740 --> 00:13:03.710
so as soon as the user authenticates
they will get this notification.

00:13:03.710 --> 00:13:06.250
They can change their password
right there, or they can change,

00:13:06.250 --> 00:13:12.639
or they can opt to bypass it and just continue logging in.

00:13:12.639 --> 00:13:19.379
So another change that we've made, and this falls under
the category of supporting some common configurations.

00:13:19.379 --> 00:13:26.080
Turns out we have a lot of customers that are in what
we call a disjointed Active Directory configuration.

00:13:26.080 --> 00:13:34.509
So this is where your DNS name for your host name
doesn't match the DNS of your Active Directory domain.

00:13:34.509 --> 00:13:39.639
Turns out a lot of people had this, so we
actually have built in support for this.

00:13:39.639 --> 00:13:45.000
We will actually detect that you're in
this configuration, and we'll say oh -

00:13:45.000 --> 00:13:49.919
hey your host name doesn't match your Active
Directory domain name, we're going to go ahead,

00:13:49.919 --> 00:13:53.519
build your key tab with service principles for both.

00:13:53.519 --> 00:14:01.889
So you will actually get a key tab with service
principles with your host name, both what it is currently,

00:14:01.889 --> 00:14:06.009
and what it would be if it was
in the Active Directory domain.

00:14:06.009 --> 00:14:09.549
[ Applause ]

00:14:09.549 --> 00:14:14.279
And again, no fancy configuration required,
it will just do this automatically.

00:14:14.279 --> 00:14:22.470
And finally, we've improved our support in Workgroup
Manager for editing things back to Active Directory.

00:14:22.470 --> 00:14:29.470
So if you've extended the schema and you have admin
access to Active Directory, we've made the behavior

00:14:29.470 --> 00:14:34.110
of Workgroup Manager better for editing
these records that already exist.

00:14:34.110 --> 00:14:38.620
We've also added support for editing
group information in Workgroup Manager,

00:14:38.620 --> 00:14:43.009
so you can now add people or take people out of an AD group.

00:14:43.009 --> 00:14:45.539
[ Applause ]

00:14:45.539 --> 00:14:47.179
OK, I guess a few of you wanted that.

00:14:47.179 --> 00:14:50.529
And then also support for creating computer lists.

00:14:50.529 --> 00:14:58.819
And we have a few other changes I
just want to go through real briefly.

00:14:58.820 --> 00:15:04.300
You've heard me talk, if you've been to 1 of my
previous sessions, one of the best practices that I had

00:15:04.299 --> 00:15:11.979
to tell you was, if you are using Windows 2003
R2 or greater on your Active Directory domain,

00:15:11.980 --> 00:15:20.029
I said well you should go get either you or get your Active
Directory admin to go and index the Mac address attribute,

00:15:20.029 --> 00:15:26.659
because it's present in the schema, but
it's not in the computer object class.

00:15:26.659 --> 00:15:31.990
And so we would say oh, we're going to bind to the
domain, let's see if the computer count is there,

00:15:31.990 --> 00:15:36.600
let's check for the Mac address,
and we'd send the query out...

00:15:36.600 --> 00:15:45.290
and instead of the Active Directory coming back and saying
oh - we don't know anything about Mac address, it says oh -

00:15:45.289 --> 00:15:52.209
I do have an attribute called Mac address, I'd
better search every single object in the directory.

00:15:52.210 --> 00:15:56.210
That's a little expensive if you have a few million records.

00:15:56.210 --> 00:15:59.720
So you had some very slow buying time things going on.

00:15:59.720 --> 00:16:03.320
So we now have added logic to the binding process.

00:16:03.320 --> 00:16:10.810
We will actually detect whether or not the Mac address
attribute is present, and whether or not it is part

00:16:10.809 --> 00:16:13.039
of the computer object class; because it could be.

00:16:13.039 --> 00:16:17.049
If you've extended your Active
Directory schema with our attributes,

00:16:17.049 --> 00:16:19.909
then Mac address will be in the computer object class.

00:16:19.909 --> 00:16:22.589
So it will detect if that's the case.

00:16:22.590 --> 00:16:25.810
If it is in the object class, we'll
go ahead and do the query.

00:16:25.809 --> 00:16:30.989
If it's not we skip that query, and you
don't have to worry about it bogging down

00:16:30.990 --> 00:16:35.950
and creating all these expensive
searches on your Active Directory domain.

00:16:35.950 --> 00:16:43.190
Another change that we've made is we've added
differentiation for user and contact records.

00:16:43.190 --> 00:16:49.780
So people that had exchange for example, you had
maybe a lot of contact information in your directory.

00:16:49.779 --> 00:16:54.990
Previously we could confuse that with user accounts,
and so sometimes you'd get conflicts between users

00:16:54.990 --> 00:16:59.000
and contacts, so now we know the difference.

00:16:59.000 --> 00:17:03.480
We've also added support for IPv6Active Directory domain.

00:17:03.480 --> 00:17:09.610
So if you're a fully IPv6 AD environment,
the AD plug-in now works for you.

00:17:09.609 --> 00:17:17.289
We've added some more support for hierarchical
domains, in particular domains that have more

00:17:17.289 --> 00:17:20.109
than 3 levels of hierarchy, so you can now...

00:17:20.109 --> 00:17:25.429
previously you only have like at 2
levels of hierarchy, now you can do 3.

00:17:25.430 --> 00:17:35.210
And we've added support for Windows 2008 domains, and
this is primarily an area where we had to get some support

00:17:35.210 --> 00:17:45.759
from the MIT Kerberos libraries, so that has all been
worked out so it's all compatible with Windows 2008.

00:17:47.900 --> 00:17:53.640
And a few changes that aren't in the
plug-in itself but are in OS X server.

00:17:53.640 --> 00:17:56.870
We had 1 to make in OS X server.

00:17:56.869 --> 00:18:03.469
We know you might be using Active Directory, but still
want to provide services to all of these AD users.

00:18:03.470 --> 00:18:08.079
OK, so we thought we should try to make
this a more smooth user experience.

00:18:08.079 --> 00:18:16.710
So 1 thing is when we first shipped Leopard, I spent
a long, long time in my session talking about how

00:18:16.710 --> 00:18:23.690
to create augment records, because there was this
attribute called Services Locator that you needed to have

00:18:23.690 --> 00:18:27.920
if you are going to use the Wiki server or the iCal server.

00:18:27.920 --> 00:18:29.710
And AD users didn't have it.

00:18:29.710 --> 00:18:34.809
So the way to do this was you had to create an
augment record for every user that you wanted

00:18:34.809 --> 00:18:37.009
to be able to use the Wiki server or iCal server.

00:18:37.009 --> 00:18:43.900
So it worked, but it really wasn't a lot
of fun to have to do that for every user.

00:18:43.900 --> 00:18:51.780
So for server, for the Wiki server and the iCal server,
we have totally eliminated the need for Services Locator,

00:18:51.779 --> 00:18:54.009
so you do not need to create augment records.

00:18:54.009 --> 00:18:58.879
[ Applause ]

00:18:58.880 --> 00:19:01.140
Augment records by the way, do still work.

00:19:01.140 --> 00:19:04.890
You can still create them if you
have other reasons for using them,

00:19:04.890 --> 00:19:08.680
however there's no need to do this
just right out of the box.

00:19:08.680 --> 00:19:12.460
You can turn on Wiki server or iCal
server and use it with AD users.

00:19:12.460 --> 00:19:17.870
And then another thing that we've
added is we had some services

00:19:17.869 --> 00:19:26.759
where their authentication methods were basically either
Kerberos, or cleartext for Active Directory users.

00:19:26.759 --> 00:19:32.379
This was because of the authentication
methods that Active Directory supported

00:19:32.380 --> 00:19:39.080
And we've actually added another option for a
couple of these for Podcast Producer and iChat.

00:19:39.079 --> 00:19:47.409
You now, instead of using cleartext, can
use a specially proxy version of Digest 75.

00:19:47.410 --> 00:19:53.410
So basically you don't have to be sending these
passwords in the clear if you're not using Kerberos.

00:19:56.650 --> 00:20:02.650
OK, so we've talked about the client side
and we talked about Active Directory

00:20:02.650 --> 00:20:04.400
we're going to switch gears a little bit.

00:20:04.400 --> 00:20:08.250
We're going to talk about the Open Directory server.

00:20:10.230 --> 00:20:16.440
So you may have heard, how many went to
the state of the union address for server?

00:20:16.440 --> 00:20:23.320
OK, you guys may have heard for server we
weren't limited by the "no new features".

00:20:23.319 --> 00:20:26.009
We actually went ahead, we put a bunch of new features in.

00:20:26.009 --> 00:20:30.549
[ Applause ]

00:20:30.549 --> 00:20:36.619
So we have a couple new features to talk
about, but we also had as a focus...

00:20:36.619 --> 00:20:39.379
performance and scalability.

00:20:39.380 --> 00:20:46.120
We wanted to really increase the way
that you could use our Directory Server

00:20:46.119 --> 00:20:50.729
with large numbers of clients, lots of connections.

00:20:50.730 --> 00:20:57.019
And then we also wanted to have better support
for working with other directory servers,

00:20:57.019 --> 00:21:01.819
because we know a lot of people want
to integrate with Active Directory,

00:21:01.819 --> 00:21:06.049
and so they use a configuration we call
the Magic Triangle and we're going to talk

00:21:06.049 --> 00:21:10.389
about this more later during the Best Practices session.

00:21:10.390 --> 00:21:17.370
But basically we've added better support, and we kind
of considered this to be sort of a more standard config

00:21:17.369 --> 00:21:26.079
that we consider as a common config that
customers use, and that we test with.

00:21:26.079 --> 00:21:31.480
So 1 change that you're going to notice
right off the bat, is during server set up.

00:21:31.480 --> 00:21:39.630
So you install server, you go into server set up,
and you'll notice that we've changed the options

00:21:39.630 --> 00:21:42.010
that you have regarding Directory Services.

00:21:42.009 --> 00:21:46.210
[ Applause ]

00:21:46.210 --> 00:21:47.559
You're welcome.

00:21:47.559 --> 00:21:54.339
Whereas before we had some configurations that
were called standard, workgroup, and advanced...

00:21:54.339 --> 00:21:58.500
and Xsan, thank you OK we don't want to forget Xsan.

00:21:58.500 --> 00:22:02.930
And these kind of lock you into
kind of what we called silos.

00:22:02.930 --> 00:22:07.519
They kind of locked you into particular
set of services and configurations,

00:22:07.519 --> 00:22:14.359
so we kind of removed those connections to these set ups.

00:22:14.359 --> 00:22:18.669
But we've retained these 3 basic Directory Service set ups.

00:22:18.670 --> 00:22:23.810
So Create users and Groups just sets
up a basic Open Directory master.

00:22:23.809 --> 00:22:28.190
Import Users and Groups, is going
to set up an Open Directory master

00:22:28.190 --> 00:22:32.900
but also give you the opportunity to
bind to some other directory server.

00:22:32.900 --> 00:22:39.690
And then you're going to get your users from that directory
server, and you're going to use the Open Directory server

00:22:39.690 --> 00:22:45.690
for things like non-user records, maybe
groups add users from another directory

00:22:45.690 --> 00:22:48.289
to those groups in your Open Directory master.

00:22:48.289 --> 00:22:53.379
Or just config records that are used by different services.

00:22:53.380 --> 00:22:55.310
And finally, Cconfigure Manually...

00:22:55.309 --> 00:23:00.129
well pretty much as you'd expect, you manually configure it.

00:23:00.130 --> 00:23:03.570
That seemed to make sense.

00:23:03.569 --> 00:23:08.649
Another change is with SACLs, or
Service Access Control Lists.

00:23:08.650 --> 00:23:17.970
This is something that we added in Leopard I
believe, but we've changed where you configure this.

00:23:17.970 --> 00:23:24.630
This is so important and we really want people to
adopt using SACLs, that not only do we turn them on now

00:23:24.630 --> 00:23:31.870
when you set up the Open Directory master during service set
up, but we want to make it more prominent in server admin.

00:23:31.869 --> 00:23:35.629
So it's now right up there on the top menu bar.

00:23:38.309 --> 00:23:45.269
And this is something that in testing and
in people using Snow Leopard server, so far,

00:23:45.269 --> 00:23:50.119
something that has occasionally caught people
by surprise because it was the same way

00:23:50.119 --> 00:23:53.469
in Leopard, but they kind of forgot this.

00:23:53.470 --> 00:24:02.110
By default, unless you do the manual configuration
for Directory Services, SACLs are turned on.

00:24:02.109 --> 00:24:10.139
And so users, if you create them in server preferences,
they get automatically added to the SACL lists

00:24:10.140 --> 00:24:13.780
for whatever services you enable them for.

00:24:13.779 --> 00:24:19.839
Where people get caught though, is if you use
Workgroup Manager because this is considered sort

00:24:19.839 --> 00:24:26.439
of a more advanced configuration tool, it
doesn't automatically add the users to the SACLs,

00:24:26.440 --> 00:24:30.250
you're going to want to set up some custom configure.

00:24:30.250 --> 00:24:34.910
So just keep in mind that if you
add users through Workgroup Manager,

00:24:34.910 --> 00:24:39.380
you still manually need to add
the users to the SACLs yourself.

00:24:39.380 --> 00:24:46.300
And we've actually added a little warning panel in
Workgroup Manager just to sort of remind you of this,

00:24:46.299 --> 00:24:50.740
because this was a common thing that people would just,
they'd forget and they'd be like why aren't my users able

00:24:50.740 --> 00:24:55.180
to log in, and it was just they hadn't been added to SACLs.

00:24:55.180 --> 00:25:04.549
We also, if you choose the custom config, we now give
you the option to opt in or out of turning on SACLs.

00:25:04.549 --> 00:25:09.730
You can always turn SACLs on manually
yourself at any time, or turn them off,

00:25:09.730 --> 00:25:16.240
but we actually give you that option
during server set up now.

00:25:16.240 --> 00:25:24.950
Another server set up change, in Leopard you may
remember that the admin account that you're asked to set

00:25:24.950 --> 00:25:30.910
up during server set up, well that would
get created in the Open Directory node.

00:25:30.910 --> 00:25:39.750
And then we would create sort of a backup admin account
called locadmin, or Local Administrator, in the local node.

00:25:39.750 --> 00:25:46.609
The problem with this is that if something
went wrong with your Open Directory master,

00:25:46.609 --> 00:25:50.599
you suddenly lost your main admin
account and you had to remember,

00:25:50.599 --> 00:25:55.009
oh yeah there's this backup account
that I can use and login.

00:25:55.009 --> 00:25:57.950
So we reversed this for Snow Leopard.

00:25:57.950 --> 00:26:07.569
The account that you create during server set up gets
created in the local Directory Service directory,

00:26:07.569 --> 00:26:12.500
and then we create a user called
diradmin, or Directory Administrator,

00:26:12.500 --> 00:26:16.069
with the same password in the Open Directory master.

00:26:16.069 --> 00:26:18.659
So it's just the other way around.

00:26:22.180 --> 00:26:27.430
Alright so now let's get into sort of
the "meat" of the Directory Server.

00:26:27.430 --> 00:26:32.519
And as we talked about before, there's
3 main portions of our Directory Server,

00:26:32.519 --> 00:26:36.789
and one of the most important ones is LDAP, the LDAP server.

00:26:36.789 --> 00:26:45.089
So one of the changes that we made for Snow Leopard is we've
upgraded to a new version of open LDAP, we're not at 2.4.11.

00:26:45.089 --> 00:26:52.679
And between our upgrade to the new version of open
LDAP, plus a lot of optimization and performance work

00:26:52.680 --> 00:26:58.110
that we've done, things like optimizing our
data structures and just cleaning up code,

00:26:58.109 --> 00:27:02.439
we've gotten a 2X read performance improvement.

00:27:02.440 --> 00:27:06.820
So your reads to LDAP, which is
something like 99 percent of all

00:27:06.819 --> 00:27:12.809
of your LDAP traffic is reads,
are now going to be twice as fast.

00:27:12.809 --> 00:27:20.450
We've also switched from using slurpd to syncrepl
for handling all of the LDAP replication.

00:27:21.670 --> 00:27:28.490
But the modern way of doing the LDAP replication.

00:27:28.490 --> 00:27:36.819
Also previously in Leopard and before, you're
always hard coded to a limit of 1,000 connections.

00:27:36.819 --> 00:27:39.319
This was hard coded, that was it.

00:27:39.319 --> 00:27:42.529
You got to 1,000 connections, you hit the wall.

00:27:42.529 --> 00:27:49.670
And like I said, one of our focuses for Snow Leopard was
we wanted to increase our performance and scalability,

00:27:49.670 --> 00:27:55.460
and lots of people out there have more than 1,000
clients that they need to be able to talk to the server.

00:27:55.460 --> 00:28:05.920
So we've actually removed that 1,000 connection limit,
and in fact we've tested with over 8,000 connections,

00:28:05.920 --> 00:28:12.980
and the server basically handled them very
well, hardly even noticed all the connections.

00:28:12.980 --> 00:28:17.710
Of course depending on what kind of queries
you're doing, your mileage may vary,

00:28:17.710 --> 00:28:23.360
but basically it can handle 8,000 connections or more.

00:28:23.359 --> 00:28:29.829
The limitation here really is just based on
how many file handles you want to have open.

00:28:29.829 --> 00:28:35.539
And your rule of thumb here is that
each LDAP connection is 1 file.

00:28:35.539 --> 00:28:47.700
So we actually let you set this, so if you want to
change this value by default, we have it set to 8,192...

00:28:47.700 --> 00:28:49.120
files open.

00:28:49.119 --> 00:28:54.569
And keep in mind there's a little bit of overhead here,
slapd needs to have a few files open for connections

00:28:54.569 --> 00:28:57.919
to the database, and just things that it's doing internally.

00:28:57.920 --> 00:29:03.060
So the number of files is just not
exactly equal to the number of connections

00:29:03.059 --> 00:29:06.240
that you're going to allow, but it's very close.

00:29:06.240 --> 00:29:13.250
So by default we have this set to 8,192, but you
can go ahead and change it to whatever you want.

00:29:13.250 --> 00:29:21.200
You just need to change the slapd plist that
launchd uses, so in system library launch daemons.

00:29:21.200 --> 00:29:26.059
And you can configure this to be
basically whatever you want,

00:29:26.059 --> 00:29:32.730
depending on how much of your server's
resources you want allocated to LDAP.

00:29:32.730 --> 00:29:36.839
This really gives you a lot of options for scaling

00:29:36.839 --> 00:29:43.269
up your Open Directory server, to
support a larger number of clients.

00:29:43.269 --> 00:29:51.150
But we also wanted to make some improvements in the
area, and not just the performance but reliability.

00:29:51.150 --> 00:29:58.560
And when we are talking about reliability with LDAP, we're
basically talking about what's going on, on the backend.

00:29:58.559 --> 00:30:10.069
And our back end database for LDAP is based on BDB,
and so we've updated our version of Berkeley DB.

00:30:10.069 --> 00:30:12.319
Thank you.

00:30:12.319 --> 00:30:18.710
We've also done a bunch of toning to get better
performance and to get better reliability

00:30:18.710 --> 00:30:25.900
out of the Berkeley DB database, and
we've also started using f_fullsync.

00:30:25.900 --> 00:30:32.920
So when you make a change to the LDAP database,
not only does it get flushed out to disk,

00:30:32.920 --> 00:30:37.390
it gets flushed out to stable storage which
means it's not sitting just cached somewhere,

00:30:37.390 --> 00:30:44.009
it's actually written out on the disk, it's
there so if something happens it's recoverable.

00:30:44.009 --> 00:30:48.629
[ Applause ]

00:30:48.630 --> 00:30:55.330
Now the problem is you always have this fight
between reliability and performance right?

00:30:55.329 --> 00:30:58.629
Things that are reliable are usually not quite as fast.

00:30:58.630 --> 00:31:01.520
And again, we have that here.

00:31:01.519 --> 00:31:05.420
So f_fullsync, it's great for database reliability.

00:31:05.420 --> 00:31:07.259
It's great.

00:31:07.259 --> 00:31:11.170
But the problem is, because you have to do
all of this flushing all the way out to disk,

00:31:11.170 --> 00:31:16.350
well it's going to be a little slower
and that's pretty much to be expected.

00:31:16.349 --> 00:31:21.219
The good news here is that most of the
time with LDAP, you're just reading.

00:31:21.220 --> 00:31:23.870
So there is no performance hit.

00:31:23.869 --> 00:31:27.239
Your only performance hit is when you are actually writing.

00:31:27.240 --> 00:31:31.900
So most of the time it's not a big deal.

00:31:31.900 --> 00:31:36.920
But there are times when not only are you
going to do some writing to your LDAP database,

00:31:36.920 --> 00:31:41.740
but maybe you're going to do a lot
of writing to your LDAP database.

00:31:41.740 --> 00:31:47.730
And this is something like you're importing all of
your users, or you're importing a lot of records,

00:31:47.730 --> 00:31:52.940
making a lot of changes, some bulk
user changes or bulk record changes.

00:31:52.940 --> 00:32:00.480
And for cases like that, it'd be handy to
be able to control this fullsync behavior.

00:32:00.480 --> 00:32:05.230
So we actually give you this ability in
the slap config command line utility.

00:32:05.230 --> 00:32:13.380
So we have a new option, slap config set fullsync
mode, which you can set to either yes or no.

00:32:13.380 --> 00:32:23.250
Yes is basically normal operation mode, so fullsync is on,
this is your best setting for the best BDB reliability.

00:32:23.250 --> 00:32:29.880
You can also set it to "no" which means
that fullsync is going to be turned off.

00:32:29.880 --> 00:32:36.780
This will make your imports faster, but you don't
want to run for any great length of time other

00:32:36.779 --> 00:32:43.269
than when you're actually doing your imports, you
don't want to run with this set to have fullsync off,

00:32:43.269 --> 00:32:50.789
because then you lose all of your database reliability
improvements that you got with the fullsync.

00:32:50.789 --> 00:32:57.789
So just keep in mind, go ahead, use this
option when you're doing your bulk imports;

00:32:57.789 --> 00:33:06.349
but then don't forget after you're done doing
your imports, go back, turn the fullsync back on.

00:33:06.349 --> 00:33:12.679
And it really does not give you any benefit to be running
under normal circumstances with the fullsyncs off,

00:33:12.680 --> 00:33:20.480
because there's really no performance benefit, because like
we said, most of the time you're just doing reads to LDAP.

00:33:20.480 --> 00:33:23.980
So you're not going to see the performance benefit.

00:33:23.980 --> 00:33:31.950
And if you run with fullsync off, you're putting
your data at risk, and nobody wants to do that.

00:33:31.950 --> 00:33:39.120
So just keep in mind if you turn fullsyncs off, turn them
back on again when you're done with your bulk imports.

00:33:41.200 --> 00:33:43.970
OK, we've talked about the LDAP server.

00:33:43.970 --> 00:33:51.610
Now let's talk about Password server, and this is an
area where we have actually added some new features.

00:33:51.609 --> 00:33:58.859
And these are features that we added based
on requests from customers like you guys.

00:33:58.859 --> 00:34:06.139
And the main feature that we got
requests for was actually 2 parts.

00:34:06.140 --> 00:34:10.780
Had to do with users changing their passwords.

00:34:10.780 --> 00:34:16.990
The first thing that people wanted was they wanted
to be able to, when a user changed their password

00:34:16.989 --> 00:34:22.319
in Open Directory, be able to sync
that to some other directory server;

00:34:22.320 --> 00:34:27.860
maybe a Novell eDirectory server or
some other third party LDAP server.

00:34:27.860 --> 00:34:31.430
The other thing that people wanted
to do was they wanted to be able

00:34:31.429 --> 00:34:35.730
to filter the password that the user was changing it to.

00:34:35.730 --> 00:34:42.119
Now we do provide a number of policies in
Password server that let you control, for example,

00:34:42.119 --> 00:34:46.619
how many characters the password has to
be, whether it has to require a letter

00:34:46.619 --> 00:34:52.029
or number or special symbol, things like that.

00:34:52.030 --> 00:35:00.100
But some people have some very specific requirements,
especially customers in the government space;

00:35:00.099 --> 00:35:08.299
people that have very, very exact requirements, and
if they don't follow them they get people in places

00:35:08.300 --> 00:35:13.970
like the CIA a little irritated
with them, and they don't want that.

00:35:13.969 --> 00:35:21.509
So they want the ability to create password
filters that are whatever they want them to be.

00:35:21.510 --> 00:35:25.010
So we said, sounds like a good idea.

00:35:25.010 --> 00:35:29.820
[ Applause ]

00:35:29.820 --> 00:35:39.610
Now as part of this, like I said, you're going to create
a password filter that's whatever you want it to be.

00:35:39.610 --> 00:35:42.780
Well that means you're going to have
to do a little bit of work here.

00:35:42.780 --> 00:35:48.970
We're going to provide you the hook, but you're
going to have to provide and do a little work

00:35:48.969 --> 00:35:55.549
to actually implement some sort of logic that
says what password policies that you want.

00:35:55.550 --> 00:36:02.519
So there will be some work required on your part,
basically you're going to have to build a little tool

00:36:02.519 --> 00:36:05.130
which could be a script, or could be just some...

00:36:05.130 --> 00:36:08.690
a binary, however you want to write it.

00:36:08.690 --> 00:36:18.599
Basically you're going to write a script, could be as simple
as a shell script, could be whatever type of tool you want,

00:36:18.599 --> 00:36:23.750
you could do it full blown little
binary in C or shell script.

00:36:23.750 --> 00:36:27.039
You just need to install it in
Library/Password Server Filters.

00:36:27.039 --> 00:36:37.059
And what this tool needs to do is basically be able to
handle 2 different arguments that could be passed to it

00:36:37.059 --> 00:36:42.259
So the first argument is the preflight argument.

00:36:42.260 --> 00:36:47.760
So this would be called, your tool
will be called with -p and this means

00:36:47.760 --> 00:36:51.310
that a user is attempting to change their password.

00:36:51.309 --> 00:37:01.889
In that case, what you're going to get is an XML, sort
of a plist basically, that's going to have the user name,

00:37:01.889 --> 00:37:08.440
the password that the user wants to change
to, and then what type of a user they are.

00:37:08.440 --> 00:37:14.010
So whether they're an admin user or a standard
user, this is going to get passed to your tool

00:37:14.010 --> 00:37:18.830
on standard in, and so then you can say hmmm...

00:37:18.829 --> 00:37:22.659
you can apply whatever logic you want to it.

00:37:22.659 --> 00:37:27.259
If you like the password and you
think it's OK for them to change it,

00:37:27.260 --> 00:37:32.930
just exit 0 and Password server will go
ahead and let them change their password.

00:37:32.929 --> 00:37:38.589
Now if you want to reject this password
change, just exit with anything other than 0.

00:37:38.590 --> 00:37:43.850
Password server will see this and say oh -
I'm going to reject this password change,

00:37:43.849 --> 00:37:47.639
and the user will get the rejected password change...

00:37:47.639 --> 00:37:56.849
little blurb that they get when they say, you know, your
password does not meet the requirements set by your admin,

00:37:56.849 --> 00:38:01.369
please talk to your administrator
for more information, and so on.

00:38:01.369 --> 00:38:09.750
You can also use this to synchronize the password
out to other directory servers, or other places,

00:38:09.750 --> 00:38:19.480
because once the change has actually taken place, will
call your tool with the -C or the change argument,

00:38:19.480 --> 00:38:25.929
and you'll get the same piece of XML - the user name,
the password, and the standard or admin user type.

00:38:25.929 --> 00:38:28.259
And then you can do whatever you want.

00:38:28.260 --> 00:38:36.010
So you could pass this information off to some other
directory server somewhere, wherever you want to send it.

00:38:36.010 --> 00:38:41.450
Just keep in mind you're dealing
with user's passwords here, OK?

00:38:41.449 --> 00:38:45.839
So whatever you do, just do it securely.

00:38:45.840 --> 00:38:53.250
Use SSL, use Kerberos, please don't send
user's passwords around the network in clear.

00:38:55.519 --> 00:38:59.969
OK, so that's our feature for Password server.

00:39:01.349 --> 00:39:09.519
We also have a radius server, and we've upgraded this
to the new version of FreeRadius, so we're at 2.1.3 now.

00:39:09.519 --> 00:39:14.349
And we've added as a feature, we've added the ability

00:39:14.349 --> 00:39:18.819
to authenticate Active Directory
users through the Radius server.

00:39:18.820 --> 00:39:22.830
And this is actually something you don't
need to do any special configuration for.

00:39:22.829 --> 00:39:28.000
If you're bound to Active Directory, your
Radius server will actually change it's config

00:39:28.000 --> 00:39:32.599
so that it can actually do the authentication
against, not just any open directories

00:39:32.599 --> 00:39:37.190
that you might have, but also any Active Directory users.

00:39:42.090 --> 00:39:51.000
And a final thing that we've added as a feature in
Snow Leopard, is we have a lot of cases where you set

00:39:51.000 --> 00:39:56.800
up your server, you think everything's good, and you're
never going to change the IP number or the host name,

00:39:56.800 --> 00:40:02.550
and somewhere down the line your network
changes, maybe your company changes.

00:40:02.550 --> 00:40:06.210
You need to change that host name or the IP number.

00:40:06.210 --> 00:40:14.619
So server wide we've put a lot of work into
making the server very resilient in the face of IP

00:40:14.619 --> 00:40:18.789
and host name changes, and actually I'm going to...

00:40:18.789 --> 00:40:25.570
in our Best Practices section, I'm going to talk
about the exact process that you would want to go

00:40:25.570 --> 00:40:31.490
through for an Open Directory master if you
need to change its host name or IP number.

00:40:31.489 --> 00:40:40.739
But after you've done all of that, you've got this whole
directory full of data - user records, mount records,

00:40:40.739 --> 00:40:46.849
all kinds of data that might still
have references to the old host name.

00:40:46.849 --> 00:40:54.789
And it could be a real pain to actually sort through and
find all these records, change them over to, for example,

00:40:54.789 --> 00:40:58.269
change them over to a new home directory server and so on.

00:40:58.269 --> 00:41:05.559
And this can happen, even if you're not changing that host
name or IP number on the Open Directory server itself.

00:41:05.559 --> 00:41:11.070
Maybe you've just changed the host name of your home
directory server, or maybe you've added a new one.

00:41:11.070 --> 00:41:19.130
And so all the users that used to have
home1.domain.com are now going to be home2.domain.com.

00:41:19.130 --> 00:41:22.690
So we've actually given you a new tool.

00:41:22.690 --> 00:41:31.289
It's called ChangeDirData, it's a PERL script,
and basically think of this as like SED for LDAP.

00:41:31.289 --> 00:41:34.460
OK, it's basically find and replace.

00:41:34.460 --> 00:41:40.300
So you can say specify server, and you can
specify credentials for a directory admin,

00:41:40.300 --> 00:41:45.660
but then basically you're just going to say OK
the old value, for example, oldhost.domain.com.

00:41:45.659 --> 00:41:50.519
And then what you want to change
it to, so newhost.domain.com.

00:41:50.519 --> 00:41:55.750
And you can also specify what record types you want to edit.

00:41:55.750 --> 00:42:03.059
So maybe you only want to change information in user
records, or maybe you only want to change mount records.

00:42:03.059 --> 00:42:07.559
You can restrict it to any set of records that you want,

00:42:07.559 --> 00:42:13.420
or you can just say change anything in
the data, in the directory, any data.

00:42:13.420 --> 00:42:17.900
And if you read the man page you can
get the full set of information here,

00:42:17.900 --> 00:42:21.430
but basically just think of it as find and replace for LDAP.

00:42:21.429 --> 00:42:26.319
So once you've gone through all
of your hosting or IP changes,

00:42:26.320 --> 00:42:31.010
you now have a tool for doing bulk
find and replace on your LDAP data.

00:42:31.010 --> 00:42:36.850
[ Silence ]

00:42:36.849 --> 00:42:44.219
OK, so we've talked about all the things that are
new in Snow Leopard for Directory Service client,

00:42:44.219 --> 00:42:50.259
new things for the Active Directory plug-in,
and new things for the Open Directory server.

00:42:50.260 --> 00:42:53.580
And how many people have been to 1 of my sessions before?

00:42:53.579 --> 00:42:56.130
OK, got a few here.

00:42:56.130 --> 00:43:03.390
You know I always like to leave you guys with either
some Best Practices, some troubleshooting information,

00:43:03.389 --> 00:43:09.679
some practical information that you can
take back with you, and use every day.

00:43:09.679 --> 00:43:15.779
So what we're going to do today is we're going
to cover Best Practices for 4 different areas.

00:43:15.780 --> 00:43:22.030
We're going to talk about a new way of
extending the Active Directory schema

00:43:22.030 --> 00:43:26.900
that actually even uses Microsoft's own tools to do it.

00:43:26.900 --> 00:43:31.539
We're going to talk about Best Practices
for setting up your Open Directory topology.

00:43:31.539 --> 00:43:38.409
So when you have an Open Directory master and
replicas, what's the best way to connect them?

00:43:38.409 --> 00:43:44.639
Then we're going to talk about, because the
Magic Triangle configuration is so popular,

00:43:44.639 --> 00:43:49.670
we're going to talk about some specifics for
Best Practices with the Magic Triangle set up.

00:43:49.670 --> 00:43:57.430
And then finally we're going to talk about the Best
Practices for how you should go about changing your IP

00:43:57.429 --> 00:43:59.710
or host name on an Open Directory server.

00:43:59.710 --> 00:44:07.769
So we're going to start by talking about extending the
Active Directory schema, and for this rather than a bunch

00:44:07.769 --> 00:44:13.340
of boring slides, I figured let's do a demo.

00:44:13.340 --> 00:44:19.530
Well it's hard to do a demo with Active Directory
schema without actually using a Windows machine.

00:44:19.530 --> 00:44:25.470
Alright so, we have our Active Directory server here.

00:44:25.469 --> 00:44:28.230
Actually I'm kind of cheating, it's running in VM.

00:44:28.230 --> 00:44:38.159
But basically this is a 2008 Windows server, and
you can do this with 2003 R2 using the ADAM tools,

00:44:38.159 --> 00:44:44.139
which stands for Active Directory Application Mode.

00:44:44.139 --> 00:44:49.359
In 2008 server, you have basically the
same thing only Microsoft renamed it.

00:44:49.360 --> 00:44:53.539
It's now the Active Directory Lightweight
Directory Services.

00:44:53.539 --> 00:44:59.949
So this is a role that you can install on
your server, it's all very fancy sounding.

00:44:59.949 --> 00:45:05.889
But basically whether you're using ADAM or the
Active Directory Lightweight Directory Services,

00:45:05.889 --> 00:45:10.519
the first thing that you want to do is...

00:45:10.519 --> 00:45:15.190
first of all you're going to need an Open
Directory master somewhere out there,

00:45:15.190 --> 00:45:21.130
because we need to know what the schema
looks like that we're going to try and copy.

00:45:21.130 --> 00:45:26.640
So we're not going to do a whole lot with it
other than, we're basically going to just suck all

00:45:26.639 --> 00:45:29.489
of the schema from this Open Directory master.

00:45:29.489 --> 00:45:32.799
So we're just kind of going to
duplicate this in Active Directory.

00:45:32.800 --> 00:45:41.539
So the tool that we use to do that is
the Active Directory Schema Analyzer.

00:45:41.539 --> 00:45:43.920
Which is a lovely UI here...

00:45:46.530 --> 00:45:49.220
and, make this a little bigger.

00:45:49.219 --> 00:45:54.959
Alright, so the first thing you want to
do is you want to load the target schema,

00:45:54.960 --> 00:45:58.730
the target schema is your Open Directory master.

00:45:58.730 --> 00:46:01.010
So in this case, that's...

00:46:01.010 --> 00:46:08.220
[ Silence ]

00:46:08.219 --> 00:46:13.599
And we don't need to authenticate, just going to say OK.

00:46:13.599 --> 00:46:16.309
And hey presto, we have our schema.

00:46:16.309 --> 00:46:18.420
Well that was pretty easy.

00:46:18.420 --> 00:46:23.720
Problem is, some of these attributes
and classes already exist

00:46:23.719 --> 00:46:27.399
in Active Directory, so we don't want to duplicate things.

00:46:27.400 --> 00:46:32.599
So what we've got to do next is actually
load what they call the base schema.

00:46:32.599 --> 00:46:36.119
So this is a schema of Active Directory as it is now.

00:46:36.119 --> 00:46:40.009
So for that we're going to connect to Active Directory.

00:46:40.010 --> 00:46:47.940
[ Silence ]

00:46:47.940 --> 00:46:52.179
And for this we actually need to make a connection.

00:46:52.179 --> 00:46:58.059
By the way, anybody that is, if you're like furiously
trying to scribble down notes, I actually have a white paper

00:46:58.059 --> 00:47:02.009
that I'm going to give you a link to
at the end here, so you can relax.

00:47:02.010 --> 00:47:05.900
[ Applause ]

00:47:05.900 --> 00:47:08.829
Saw a few people going a little crazy there, so...

00:47:08.829 --> 00:47:13.449
You can see there, oh - it just pulled
in a whole bunch of information.

00:47:13.449 --> 00:47:21.759
So what it's done here, and if we take a look, you
can it's got a whole list of classes and attributes,

00:47:21.760 --> 00:47:27.730
and some of these came from Active Directory,
some of these came from Open Directory.

00:47:27.730 --> 00:47:32.940
And so now what we want to do is, everything that's
already in Active Directory, we don't want to see.

00:47:32.940 --> 00:47:34.630
So we're going to hide those.

00:47:34.630 --> 00:47:39.130
And now if we look, now we're looking
at just things that came

00:47:39.130 --> 00:47:42.820
from Open Directory; things that we might possibly need.

00:47:42.820 --> 00:47:52.800
So in the white paper, it's going to cover a whole
list of different object classes and attributes

00:47:52.800 --> 00:47:55.370
that you could possibly add to the schema.

00:47:55.369 --> 00:47:59.940
Under normal circumstances, you don't need all of these.

00:47:59.940 --> 00:48:03.179
So what we're going to do is we're
just going to add 4 classes.

00:48:03.179 --> 00:48:11.609
We're going to add the computer classes, the computer
lists class, the group, and the user classes,

00:48:11.610 --> 00:48:14.250
and then all the attributes that are associated with those.

00:48:14.250 --> 00:48:18.860
Because generally when you extend the schema in Active
Directory, mostly what you're doing it for is you want

00:48:18.860 --> 00:48:25.010
to maybe add manage client information to a
user, or to a group, or add a computer list.

00:48:25.010 --> 00:48:27.850
So we're just going to worry about those object classes.

00:48:27.849 --> 00:48:39.199
So that's the Apple computer, Apple
computer list, Apple group, and Apple user.

00:48:39.199 --> 00:48:41.849
Now of course it can't be quite this simple.

00:48:41.849 --> 00:48:48.089
If you expand these you can see oh -
there's a whole lot of attributes on there.

00:48:48.090 --> 00:48:55.670
And some of these attributes actually can interfere with
attributes that already exist in Active Directory schema.

00:48:55.670 --> 00:49:04.690
So in general, what you want to do is pick out
just the ones that come from the Apple schema.

00:49:04.690 --> 00:49:08.119
We're going to take out possible superior,
because we're going to deal with that later.

00:49:08.119 --> 00:49:14.779
Then let's see, so basically you want to look at
all the ones that have Apple in front of their name,

00:49:14.780 --> 00:49:18.160
that's kind of a good clue that it's an Apple attribute.

00:49:18.159 --> 00:49:24.699
So OK, I count flags as not, and we're
going to get rid of a bunch of these.

00:49:24.699 --> 00:49:27.399
The X's by the way means that we're excluding them.

00:49:27.400 --> 00:49:32.539
It's kind of an odd interface here.

00:49:32.539 --> 00:49:33.440
A lot of clicking.

00:49:33.440 --> 00:49:38.730
Now one attribute that we are going to keep is Mac address,
even though it doesn't have Apple in front of its name.

00:49:38.730 --> 00:49:43.690
Mac address is required for computer attributes
for us to recognize that it is a computer

00:49:43.690 --> 00:49:47.740
that might have managed client information attached to it.

00:49:47.739 --> 00:49:50.399
So we need to keep Mac address.

00:49:50.400 --> 00:49:58.519
And then the other one that does not have Apple
in front of its name is TTL, or Time To Live.

00:49:58.519 --> 00:50:01.219
We're going to keep that one.

00:50:05.510 --> 00:50:09.480
That one's easy, let's see.

00:50:09.480 --> 00:50:12.010
Group has a whole bunch of attributes here.

00:50:12.010 --> 00:50:16.540
[ Silence ]

00:50:16.539 --> 00:50:21.630
Again we're getting rid of everything except the ones
that have Apple in front of them, and Time To Live.

00:50:21.630 --> 00:50:29.519
And for user we're going to get rid of again,
everything that's not an Apple attribute.

00:50:29.519 --> 00:50:32.009
A lot of clicking.

00:50:32.010 --> 00:50:36.700
[ Silence ]

00:50:36.699 --> 00:50:45.569
All of this is detailed in the white paper, so
don't worry too much about the specifics here.

00:50:45.570 --> 00:50:51.070
OK, so now we've picked all of the object
classes and then the attributes that are part

00:50:51.070 --> 00:50:55.010
of the object classes, that we
want to add to Active Directory

00:50:55.010 --> 00:51:01.810
So now we're ready to actually write this out as an
LDAP file that we can import into Active Directory.

00:51:01.809 --> 00:51:07.009
So we're going to say create an LDAP file,
let's go ahead and put it in the desktop.

00:51:07.010 --> 00:51:16.100
[ Silence ]

00:51:16.099 --> 00:51:17.710
Alright...

00:51:20.750 --> 00:51:29.409
so here is the LDAP file we just created, and we
actually have to make a couple of little edits to it.

00:51:29.409 --> 00:51:31.009
So we're going to open it up in Notepad...

00:51:31.010 --> 00:51:38.550
and what we need to change is we need to make
a couple of changes to the object classes.

00:51:38.550 --> 00:51:45.800
And the reason we need to do that is that some of these
object classes, well we don't want to create these separate,

00:51:45.800 --> 00:51:49.890
for example, Apple computer objects or Apple user objects.

00:51:49.889 --> 00:51:54.739
We want to use the user and group and computer
objects that already exist in Active Directory.

00:51:54.739 --> 00:51:59.729
So we're going to piggyback on top of
those objects that are already there.

00:51:59.730 --> 00:52:05.039
So instead of making a structural object
class, we're going to make them auxiliary.

00:52:05.039 --> 00:52:11.710
So to do that, we need to edit this object class category.

00:52:11.710 --> 00:52:19.659
There's 2 numbers here that are important, there is 1 which
means structural, and there's 3 which means auxiliary.

00:52:19.659 --> 00:52:23.779
So Apple computer, well there's already
computer objects in the directory,

00:52:23.780 --> 00:52:26.330
so we're going to make that an auxiliary class.

00:52:29.139 --> 00:52:32.759
Now Apple computer lists...

00:52:32.760 --> 00:52:35.330
that's something that doesn't already
exist in Active Directory.

00:52:35.329 --> 00:52:38.440
So that's going to be structural, so that's a 1.

00:52:38.440 --> 00:52:46.559
The other thing that we need to add for a structural class
is we need to be able to say, oh we might be creating these,

00:52:46.559 --> 00:52:50.409
so we need to say what the possible
superiors are for this object.

00:52:50.409 --> 00:52:54.339
So where could it possibly be created?

00:52:54.340 --> 00:52:58.920
So it could be in an OU, it could be in a CN.

00:52:58.920 --> 00:53:01.710
So we just add that to the bottom of the list here.

00:53:03.010 --> 00:53:05.150
And fix up the formatting...

00:53:05.150 --> 00:53:12.820
OK, and then a group again, this is an auxiliary class
because there's already groups in Active Directory.

00:53:15.550 --> 00:53:19.550
And user, there's already users in Active
Directory, so that's also auxiliary.

00:53:19.550 --> 00:53:29.530
The last thing we need to do is we need to be able to
say OK, so we said we want auxiliary classes for the user

00:53:29.530 --> 00:53:35.440
and the group and the computers, well we didn't tell Active
Directory what these other objects are that we're going

00:53:35.440 --> 00:53:40.010
to piggyback on top of, because I
really don't want to have to type them.

00:53:40.010 --> 00:53:44.030
I've cheated and created a little text
file with this information already.

00:53:44.030 --> 00:53:48.460
And again, this is all in the white paper.

00:53:48.460 --> 00:53:52.769
But basically we're going to add
this to the bottom of the LDAP file.

00:53:52.769 --> 00:53:59.559
And we can see here is, basically
we're saying the Apple user...

00:53:59.559 --> 00:54:06.920
class that we're adding, is going to match up with user
class that already exists in Active Directory and so on.

00:54:06.920 --> 00:54:14.210
So Apple computer goes to computer,
Apple group goes with group.

00:54:14.210 --> 00:54:21.010
OK, so now we're going to go ahead, save.

00:54:21.010 --> 00:54:25.980
[ Silence ]

00:54:25.980 --> 00:54:32.019
And then the last step is just actually go ahead
and import this all into Active Directory itself,

00:54:32.019 --> 00:54:39.800
and to do that we actually use the LDIFDE
command that exists in Active Directory.

00:54:39.800 --> 00:54:43.030
This is what you do anytime you're going to import a LDIF.

00:54:43.030 --> 00:54:47.610
So let's find our file.

00:54:47.610 --> 00:54:50.010
So weird typing DOS commands.

00:54:50.010 --> 00:55:01.710
[ Silence ]

00:55:01.710 --> 00:55:04.599
OK, got a few switches to add here.

00:55:04.599 --> 00:55:08.210
Just a few.

00:55:08.210 --> 00:55:12.590
Basically what we're telling it here is
that we want to pull things from this file,

00:55:12.590 --> 00:55:19.130
and if you look at the schema file itself, or the LDIF
file itself, you'll see that we've kind of cheated -

00:55:19.130 --> 00:55:25.470
we've put in DC = X instead of the
actual search base for the server.

00:55:25.469 --> 00:55:33.909
So what we're saying is oh, we're going to
substitute everywhere that it says DC = X is going

00:55:33.909 --> 00:55:44.009
to be actually DC = our actual search
base, which in this case is WWDC.com.

00:55:44.010 --> 00:55:49.840
[ Silence ]

00:55:49.840 --> 00:55:53.940
Alright, and if I haven't mistyped anything...

00:55:53.940 --> 00:55:55.010
oh!

00:55:55.010 --> 00:56:03.850
[ Silence ]

00:56:03.849 --> 00:56:04.670
Yeah, that's...

00:56:04.670 --> 00:56:13.010
usually if you get an error, that means
that there is some sort of spacing issue.

00:56:13.010 --> 00:56:37.030
[ Silence ]

00:56:37.030 --> 00:56:44.390
Oh, so it's a problem with where
I added possible superiors here.

00:56:44.389 --> 00:56:47.009
I think there's an extra space in there somewhere.

00:56:47.010 --> 00:57:18.510
[ Silence ]

00:57:18.510 --> 00:57:26.510
[ Audience laughing ]

00:57:26.510 --> 00:57:34.010
What was that old Apple commercial, was like
people yelling out - at your config.sys and...

00:57:34.010 --> 00:57:39.510
[ Background discussions ]

00:57:39.510 --> 00:57:45.010
[ Applause ]

00:57:45.010 --> 00:57:50.650
[ Silence ]

00:57:50.650 --> 00:57:54.010
Well there's still a space in there somewhere then.

00:57:54.010 --> 00:57:59.840
[ Silence ]

00:57:59.840 --> 00:58:06.450
I highly recommend when you do this yourself,
that you don't do it in front of a large audience.

00:58:06.449 --> 00:58:11.009
Unless of course that is your thing.

00:58:11.010 --> 00:58:27.120
[ Background discussions ]

00:58:27.119 --> 00:58:30.009
OK, I'm not seeing it, but...

00:58:30.010 --> 00:58:44.700
[ Silence ]

00:58:44.699 --> 00:58:47.009
OK we'll try it 1 more time.

00:58:47.010 --> 00:58:51.540
[ Silence ]

00:58:51.539 --> 00:58:56.009
Oh, failed on line 762, last token starts with D.

00:58:56.010 --> 00:58:59.580
[ Silence ]

00:58:59.579 --> 00:59:08.360
OK. Alright we're going to look at line 762
real quick and then we're going to move on if...

00:59:08.360 --> 00:59:14.010
It's very sensitive to little typos like this unfortunately.

00:59:14.010 --> 00:59:27.880
[ Silence ]

00:59:27.880 --> 00:59:30.010
No, that's correct.

00:59:30.010 --> 00:59:42.540
[ Silence ]

00:59:42.539 --> 00:59:47.009
Something in my copy paste, because this is
the line that it's complaining about, so...

00:59:47.010 --> 00:59:58.610
[ Silence ]

00:59:58.610 --> 00:59:59.789
No, alright.

00:59:59.789 --> 01:00:09.719
But anyway, that was the last step in this, so basically if
you type correctly you would actually get this back saying,

01:00:09.719 --> 01:00:14.129
hey it's all done, there were no errors, and you're done.

01:00:14.130 --> 01:00:24.010
And the advantage to doing your schema updates this way,
is that rather than before where you had to kind of either

01:00:24.010 --> 01:00:30.240
by hand go through the reference information for
Open Directory, pull out all the OID information,

01:00:30.239 --> 01:00:37.789
try to build your own LDIF file, you actually now have a way
of doing this that is basically using all Microsoft tools

01:00:37.789 --> 01:00:42.929
that you can give to your Active Directory
administrator and say, here you go.

01:00:42.929 --> 01:00:49.899
OK, so like I said, as I promised,
there is a white paper for this.

01:00:49.900 --> 01:00:53.990
So seminars, say Apple.com, seminars online.

01:00:53.989 --> 01:00:55.979
Modifying an Apple.

01:00:55.980 --> 01:01:01.010
There's also documentation from
Microsoft site on ADAM itself.

01:01:01.010 --> 01:01:06.540
[ Silence ]

01:01:06.539 --> 01:01:07.869
I'll just give you guys a couple of seconds.

01:01:07.869 --> 01:01:11.009
I see people writing furiously.

01:01:11.010 --> 01:01:19.580
[ Silence ]

01:01:19.579 --> 01:01:21.969
OK, so moving on.

01:01:21.969 --> 01:01:25.759
We'll talk very quickly about Open Directory topology.

01:01:28.710 --> 01:01:36.440
So with Open Directory you have a lot of
different ways that you can lay out your topology.

01:01:36.440 --> 01:01:44.200
You have a master, that master can have 32
replicas, and each replica can have 32 replicas.2

01:01:44.199 --> 01:01:50.989
So you've got a lot of different replicas to play with,
and you have 3 levels of hierarchy that you can have.

01:01:50.989 --> 01:01:55.059
And you can kind of play with this, mix and match.

01:01:55.059 --> 01:01:58.590
You use replicas, for example, to...

01:01:58.590 --> 01:02:04.090
you can have a replica close to a site for
example, so that each site does not have to go

01:02:04.090 --> 01:02:07.070
out over maybe a slow link to get to the master.

01:02:07.070 --> 01:02:12.890
You might also use it for load balancing,
a lot of different reasons to use replicas.

01:02:12.889 --> 01:02:16.629
But 1 thing that trips people up is after they set these up,

01:02:16.630 --> 01:02:21.920
they sometimes run into replication
issues; particularly slow replication.

01:02:21.920 --> 01:02:28.780
And the key to understanding why you see this is
in understanding how Open Directory replicates.

01:02:28.780 --> 01:02:33.910
The important thing to remember is that
Open Directory replication is serial.

01:02:33.909 --> 01:02:37.420
So replication starts at the master, let's say.

01:02:37.420 --> 01:02:44.590
First it goes out to each of the replicas that are connected
to the master, so it does 1 first, then the next one,

01:02:44.590 --> 01:02:47.130
and so it doesn't do all of them at once.

01:02:47.130 --> 01:02:48.990
It does each one individually.

01:02:48.989 --> 01:02:55.029
Then each of those replicas replicate serially
to any replicas that it might be connected to.

01:02:55.030 --> 01:03:03.080
So basically if you have 1 slow replica, that slows
down all of the other replicas that are behind it.

01:03:03.079 --> 01:03:08.869
So they can kind of basically stack up and be
waiting, and then replication can take forever to get

01:03:08.869 --> 01:03:13.889
to the last one, if there's one slow link in the middle.

01:03:13.889 --> 01:03:20.480
So the way to get around this is to make
sure that you have all of your replicas

01:03:20.480 --> 01:03:24.039
that have slow connections, at
your lowest level of the hierarchy.

01:03:24.039 --> 01:03:29.579
So they should be connected to a relay
rather than to the OD master itself.

01:03:29.579 --> 01:03:35.739
And also, if you have a lot of replicas connected
to relays, you probably don't want to have a lot

01:03:35.739 --> 01:03:41.559
of other replicas connected to a relay if
you have any slow connections in there.

01:03:41.559 --> 01:03:47.250
So maybe keep all of your slow
connections on 1 particular relay.

01:03:47.250 --> 01:03:51.489
When I talk about slow connections here also,
I'm not talking about any absolute speed,

01:03:51.489 --> 01:03:58.119
I'm talking relative so slow-er than any of
your other connections between your replicas.

01:03:58.119 --> 01:04:05.210
So just as an example, if you have an Open Directory
that's set up here in North America, you've got a master,

01:04:05.210 --> 01:04:08.849
got a few replicas, now you're going
to add a replica over in Europe.

01:04:08.849 --> 01:04:11.130
That's a slow link.

01:04:11.130 --> 01:04:19.510
Don't connect it directly to your OD master, instead
connect it to one of the other replicas making it a relay,

01:04:19.510 --> 01:04:26.080
and now the other replicas don't have to wait
for this replication all the way over to Europe.

01:04:27.739 --> 01:04:30.389
OK, we're going to talk about Magic Triangle.

01:04:30.389 --> 01:04:34.199
So how many people have heard of Magic Triangle?

01:04:34.199 --> 01:04:39.969
OK, it has a few other names you know,
people got a little creative with this.

01:04:39.969 --> 01:04:45.719
So there's the Magic Triangle, there's the
Golden Triangle; there's the Dual Directory

01:04:45.719 --> 01:04:47.839
because you're connected to more than 1 directory.

01:04:47.840 --> 01:04:53.079
That doesn't sound quite as interesting though,
so somebody came up with the Cylinder of Destiny,

01:04:53.079 --> 01:04:58.690
and I think I've heard Pyramid of Doom, or maybe
that's an Indiana Jones movie, I'm not sure which.

01:04:58.690 --> 01:05:08.820
So lots of exciting names for it, but basically what they
all mean is that you have OD clients and an OD master.

01:05:08.820 --> 01:05:16.160
The OD master is bound to itself and to
Active Directory, and the clients are bound

01:05:16.159 --> 01:05:20.489
to Active Directory and the Open Directory master.

01:05:20.489 --> 01:05:27.549
And this is how we normally talk about the Magic Triangle,
because usually we're talking about Active Directory.

01:05:27.550 --> 01:05:32.250
But the Magic Triangle configuration
really isn't specific to Active Directory

01:05:32.250 --> 01:05:36.389
So you could actually instead of Active Directory,
you could have another Open Directory server.

01:05:36.389 --> 01:05:43.309
You could have some other third party server like
say, a Sun LDAP or eDirectory, something like that.

01:05:43.309 --> 01:05:48.920
The main thing to keep in mind here with the
Magic Triangle set up, is that we set it up.

01:05:48.920 --> 01:05:51.550
The order you do things is important.

01:05:51.550 --> 01:05:52.510
So how many...

01:05:52.510 --> 01:05:55.990
so a lot of you were here in other sessions that I've done?

01:05:55.989 --> 01:05:59.339
When I talk about troubleshooting, what's
the first thing I tell everybody to do?

01:05:59.340 --> 01:06:01.970
Yeah. Check your ENS.

01:06:01.969 --> 01:06:07.819
OK, this is going to save you a lot of
pain down the road, so do that first.

01:06:07.820 --> 01:06:15.710
Once you've done that, you've got forward and reverse for
your server, you want to bind to Active Directory first,

01:06:15.710 --> 01:06:22.139
Kerberize any services against Active
Directory, or if it's some other directory.

01:06:22.139 --> 01:06:28.139
And last you want to set up the OD master, because the
OD master, when you go through the creation process,

01:06:28.139 --> 01:06:32.129
is actually going to detect that hey
- you're bound to something else.

01:06:32.130 --> 01:06:38.369
It has a Kerberos KDC already and I don't
need to set one up on the OD master.

01:06:38.369 --> 01:06:45.279
So you'll actually notice in server admin, in the Open
Directory panel, it'll show Kerberos being stopped.

01:06:45.280 --> 01:06:47.519
This is totally normal, this is the way you want it.

01:06:47.519 --> 01:06:55.860
Doesn't mean Kerberos isn't working, it means
you are not running a KDC on the master.

01:06:55.860 --> 01:07:03.050
And another Best Practice - because you're dealing with
having multiple directory servers that you're bound to,

01:07:03.050 --> 01:07:07.700
it's real easy to have duplication of
user accounts or other record names.

01:07:07.699 --> 01:07:11.879
You want to try to make sure you don't have
duplication, especially for your admin users.

01:07:11.880 --> 01:07:18.630
Because of course, the first record that Directory
Services finds is the one it's going to go with.

01:07:18.630 --> 01:07:25.450
And our last set of Best Practices is, I just want
to give you a quick overview of what you need to do

01:07:25.449 --> 01:07:29.429
to change the IP number or host name on an OD master.

01:07:29.429 --> 01:07:34.559
Because before this required a lot of voodoo, and you
had to sort of hope you were doing the right thing,

01:07:34.559 --> 01:07:38.119
so now I'm going to give you a concrete set of steps.

01:07:38.119 --> 01:07:43.170
So the first thing you're going to do is go
ahead and make a change in system preferences.

01:07:43.170 --> 01:07:47.579
So go ahead, change you IP number,
make the host name change.

01:07:47.579 --> 01:07:53.139
And then those of you that have been to my sessions before,
what are you going to do before you do anything else?

01:07:53.139 --> 01:07:55.230
Yeah, check the DNS.

01:07:55.230 --> 01:08:01.210
Because it really is bad to find out you've kind of
changed your host name to something you didn't intend.

01:08:01.210 --> 01:08:04.869
So check your DNS.

01:08:04.869 --> 01:08:12.400
Once you've done that, you can run the changeip
tool, to change your host name and or IP number.

01:08:12.400 --> 01:08:14.590
Then go ahead, reboot...

01:08:14.590 --> 01:08:24.880
next if you're on an OD master, your OD master's Kerberos
KDC is still going to be set to your old host name.

01:08:24.880 --> 01:08:30.270
So you need to re-Kerberize your server, and
you do this by running slapconfig -kerberize.

01:08:30.270 --> 01:08:37.130
This will set up a new Kerberos realm, and
create Kerberos principles for all of your users.

01:08:37.130 --> 01:08:43.010
And then finally, you can update any data in
the directory using the change dirdata tool.

01:08:43.010 --> 01:08:47.610
[ Silence ]

01:08:47.609 --> 01:08:53.539
OK, so we're going to wrap it up now and try to
get to some Q and A, but if you have some questions

01:08:53.539 --> 01:08:58.590
or you want more information, you can talk to
Mark or go to our training and certification site.