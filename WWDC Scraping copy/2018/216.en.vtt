WEBVTT

00:00:07.516 --> 00:00:20.516
[ Music ]

00:00:21.246 --> 00:00:23.246
[ Applause ]

00:00:23.476 --> 00:00:23.976
>> Good morning.

00:00:25.526 --> 00:00:27.136
Good morning, and welcome to

00:00:27.136 --> 00:00:29.306
Managing Documents In Your iOS

00:00:29.306 --> 00:00:29.756
Apps.

00:00:30.836 --> 00:00:32.436
I'm Brandon Tennant, a software

00:00:32.436 --> 00:00:33.446
engineer here at Apple and the

00:00:33.446 --> 00:00:34.736
Document Management team.

00:00:35.156 --> 00:00:36.276
And, later I'll be joined by my

00:00:36.276 --> 00:00:38.206
colleagues Thomas Deniau and

00:00:38.206 --> 00:00:38.786
Rony Fadel.

00:00:39.386 --> 00:00:41.476
So, today we're going to give

00:00:41.476 --> 00:00:43.316
you an overview of what document

00:00:43.316 --> 00:00:45.076
management on iOS is.

00:00:45.106 --> 00:00:46.286
And, then we'll share a few new

00:00:46.286 --> 00:00:47.246
things in this area.

00:00:48.376 --> 00:00:49.576
Then, Thomas will come up on

00:00:49.576 --> 00:00:51.966
stage to show you how to use the

00:00:51.966 --> 00:00:53.806
Document Management API in your

00:00:53.806 --> 00:00:54.236
apps.

00:00:55.056 --> 00:00:56.886
And, finally, Rony will join us

00:00:56.886 --> 00:00:58.576
onstage to show you a few tips

00:00:58.576 --> 00:01:00.136
and tricks for raising the bar

00:01:00.326 --> 00:01:01.256
in your application.

00:01:02.436 --> 00:01:04.385
So, let's get started with a

00:01:04.385 --> 00:01:05.686
refresher about what document

00:01:05.686 --> 00:01:07.026
management on iOS is.

00:01:08.486 --> 00:01:09.206
It's a collection of

00:01:09.206 --> 00:01:10.096
technologies.

00:01:10.416 --> 00:01:11.846
First, there's an API for

00:01:11.846 --> 00:01:13.056
application developers.

00:01:13.946 --> 00:01:15.206
For cloud vendors, there's also

00:01:15.206 --> 00:01:16.286
the File Provider API.

00:01:16.286 --> 00:01:19.406
And, there's also the Files app.

00:01:20.796 --> 00:01:22.976
In iOS 11, we introduced

00:01:23.046 --> 00:01:24.766
UIDocumentBrowserViewController.

00:01:25.046 --> 00:01:26.686
And, also significantly revamped

00:01:26.756 --> 00:01:28.266
UIDocumentPickerViewController.

00:01:30.166 --> 00:01:31.406
Using this new controller in

00:01:31.406 --> 00:01:33.776
your app, your customers will be

00:01:33.776 --> 00:01:35.186
able to manage and browse their

00:01:35.186 --> 00:01:36.716
files from all of their favorite

00:01:36.716 --> 00:01:37.466
cloud vendors.

00:01:38.396 --> 00:01:39.836
There's also powerful Search

00:01:39.836 --> 00:01:41.146
that searches across all of

00:01:41.146 --> 00:01:42.046
these cloud vendors.

00:01:43.276 --> 00:01:44.236
They'll be able to favorite

00:01:45.096 --> 00:01:46.276
Folders, and those favorite

00:01:46.276 --> 00:01:47.036
Folders will appear in the

00:01:47.036 --> 00:01:47.586
sidebar.

00:01:48.636 --> 00:01:49.966
And, they'll be able to organize

00:01:49.966 --> 00:01:51.946
their files using Tags.

00:01:53.006 --> 00:01:55.196
Recently used files also appear

00:01:55.286 --> 00:01:55.946
in the Recents tab.

00:02:00.186 --> 00:02:01.316
So, by using

00:02:01.316 --> 00:02:02.826
UIDocumentBrowserViewController

00:02:02.896 --> 00:02:04.276
in your app, you'll be giving

00:02:04.276 --> 00:02:05.796
your customers a consistent

00:02:05.796 --> 00:02:07.166
experience, by bringing all of

00:02:07.166 --> 00:02:08.726
the power of Files into your

00:02:08.726 --> 00:02:08.925
app.

00:02:09.425 --> 00:02:11.026
It eliminates the need for you

00:02:11.026 --> 00:02:12.036
to write your own document

00:02:12.036 --> 00:02:12.416
browser.

00:02:14.406 --> 00:02:15.686
This allows you to focus on

00:02:15.686 --> 00:02:16.846
perfecting the experience your

00:02:16.846 --> 00:02:18.966
customers will have when viewing

00:02:18.966 --> 00:02:20.226
or editing documents in your

00:02:20.496 --> 00:02:20.566
app.

00:02:21.716 --> 00:02:23.516
To get started with this, see

00:02:23.516 --> 00:02:24.916
last year's session, "Building

00:02:24.916 --> 00:02:27.636
Great Document-based Apps in

00:02:28.436 --> 00:02:28.566
iOS."

00:02:29.876 --> 00:02:31.556
There's also API for cloud

00:02:31.556 --> 00:02:32.096
vendors.

00:02:33.786 --> 00:02:35.016
This is called the File Provider

00:02:35.016 --> 00:02:35.306
API.

00:02:36.076 --> 00:02:37.506
You use this to write file

00:02:37.506 --> 00:02:39.576
provider extensions, and also

00:02:39.796 --> 00:02:42.196
custom UI actions, including the

00:02:42.196 --> 00:02:43.656
account sign-in screen.

00:02:45.766 --> 00:02:47.466
For application developers, you

00:02:47.466 --> 00:02:48.826
don't need to use this API for

00:02:48.826 --> 00:02:50.246
people to access your files.

00:02:50.246 --> 00:02:53.586
So, when you write a file

00:02:53.996 --> 00:02:56.086
provider extension, it will

00:02:56.086 --> 00:02:57.336
appear in the Files app, and in

00:02:57.336 --> 00:02:58.296
UIDocumentBrowserView

00:02:58.296 --> 00:03:00.256
Controllers, under the Locations

00:03:00.256 --> 00:03:01.616
tab-- under the Locations

00:03:01.616 --> 00:03:01.896
section.

00:03:03.946 --> 00:03:06.526
Also, because sign-in is

00:03:06.526 --> 00:03:07.746
implemented using FPUI

00:03:07.816 --> 00:03:09.596
ActionExtensionViewController,

00:03:10.376 --> 00:03:11.646
you'll want to use this so you

00:03:11.646 --> 00:03:12.646
can reduce friction for your

00:03:12.646 --> 00:03:14.306
customers by making logging into

00:03:14.306 --> 00:03:15.206
your service easier.

00:03:16.096 --> 00:03:17.206
Let's go through a few examples

00:03:18.076 --> 00:03:19.696
of that.

00:03:19.916 --> 00:03:23.126
First, in this example, what you

00:03:23.126 --> 00:03:24.136
can do-- or, what the user is

00:03:24.136 --> 00:03:25.796
able to do, is sign into their

00:03:25.796 --> 00:03:27.016
service, without being

00:03:27.016 --> 00:03:28.286
interrupted from their workflow.

00:03:28.366 --> 00:03:29.196
They don't have to leave the

00:03:29.196 --> 00:03:29.456
app.

00:03:29.676 --> 00:03:30.566
They can just sign in and

00:03:30.566 --> 00:03:31.616
continue going along their

00:03:31.786 --> 00:03:32.326
business.

00:03:32.866 --> 00:03:35.056
An example of what to try and

00:03:35.056 --> 00:03:37.066
avoid, would be something like

00:03:37.066 --> 00:03:39.096
this, where there's redundant UI

00:03:39.096 --> 00:03:40.576
elements or branding onscreen.

00:03:40.726 --> 00:03:41.766
You can see the example of two

00:03:41.766 --> 00:03:43.516
nav bars, or two Cancel buttons.

00:03:44.386 --> 00:03:46.216
And, another example to try and

00:03:46.216 --> 00:03:48.906
avoid, is having a simple Sign

00:03:48.906 --> 00:03:50.616
In button, where all it does is

00:03:50.616 --> 00:03:52.186
launch to your application.

00:03:53.046 --> 00:03:54.116
This interrupts the customer's

00:03:54.156 --> 00:03:54.656
workflow.

00:03:55.036 --> 00:03:58.256
So, try to avoid doing that.

00:03:58.876 --> 00:04:00.136
Lastly, we've seen great

00:04:00.136 --> 00:04:01.186
adoption from all of you

00:04:01.186 --> 00:04:02.996
developers and cloud vendors

00:04:02.996 --> 00:04:04.046
over the course of the last

00:04:04.046 --> 00:04:04.246
year.

00:04:05.026 --> 00:04:05.996
So, there's a lot of

00:04:05.996 --> 00:04:06.966
applications that use this

00:04:06.966 --> 00:04:07.826
technology already.

00:04:08.706 --> 00:04:10.166
So, now is a great time to try

00:04:10.166 --> 00:04:10.686
adopting

00:04:10.686 --> 00:04:12.236
UIDocumentBrowserViewController

00:04:12.236 --> 00:04:13.536
in your application today.

00:04:14.426 --> 00:04:15.516
And, if you're a cloud vendor

00:04:15.516 --> 00:04:17.396
that hasn't yet already provided

00:04:17.476 --> 00:04:18.946
a file provider extension, now's

00:04:18.946 --> 00:04:19.805
the time to do so.

00:04:20.696 --> 00:04:23.036
So, let's talk about a few new

00:04:23.696 --> 00:04:23.836
things.

00:04:24.616 --> 00:04:26.636
First, for cloud vendors, we've

00:04:26.636 --> 00:04:28.956
seen some of the difficulties in

00:04:28.956 --> 00:04:29.956
making a file provider

00:04:29.956 --> 00:04:30.586
extension.

00:04:31.316 --> 00:04:32.056
And, what we're happy to

00:04:32.056 --> 00:04:33.396
announce today is there's a new

00:04:33.396 --> 00:04:34.036
tool for you.

00:04:34.446 --> 00:04:35.126
It's called the File

00:04:35.126 --> 00:04:36.586
Provider-Validation tool.

00:04:37.756 --> 00:04:39.486
This tool will guide you-- will

00:04:39.486 --> 00:04:41.376
help-- will run tests, and show

00:04:41.376 --> 00:04:42.376
you the issues with your file

00:04:42.376 --> 00:04:43.606
provider extension, and guide

00:04:43.606 --> 00:04:44.836
you towards fixing those.

00:04:45.496 --> 00:04:46.466
It's available for download

00:04:46.466 --> 00:04:48.206
today from developer.apple.com.

00:04:48.336 --> 00:04:49.886
And, when you download it,

00:04:50.666 --> 00:04:51.876
you'll get a couple of things.

00:04:52.706 --> 00:04:53.746
You're going to get a set of

00:04:53.746 --> 00:04:55.056
source files that you'll need to

00:04:55.056 --> 00:04:56.196
add to your file provider

00:04:56.196 --> 00:04:58.666
extension project, and an iOS

00:04:58.666 --> 00:05:00.426
application to install and run

00:05:00.656 --> 00:05:01.306
on your iPad.

00:05:03.046 --> 00:05:04.506
Once you've modified your file

00:05:04.506 --> 00:05:07.076
provider project, installed the

00:05:07.076 --> 00:05:08.486
app on your iPad, and run it,

00:05:08.946 --> 00:05:09.876
you'll be greeted with a screen

00:05:09.876 --> 00:05:11.446
that looks like this.

00:05:11.866 --> 00:05:13.056
Your file provider will be

00:05:13.056 --> 00:05:14.106
listed-- will be shown on the

00:05:14.106 --> 00:05:15.566
left side, and when you tap

00:05:15.626 --> 00:05:16.886
that, there'a Run button that

00:05:16.886 --> 00:05:18.676
you can press to run our full

00:05:18.676 --> 00:05:20.346
suite of tests against your file

00:05:20.346 --> 00:05:21.136
provider extension.

00:05:22.246 --> 00:05:23.106
When you've done that, you'll

00:05:23.106 --> 00:05:24.786
see a list of successes and

00:05:24.786 --> 00:05:25.466
failures.

00:05:26.066 --> 00:05:26.846
You'll want to tap on the

00:05:26.846 --> 00:05:29.446
failure to dig deeper, and find

00:05:29.446 --> 00:05:30.376
the issues in your code.

00:05:31.186 --> 00:05:32.056
We'll be able to help you

00:05:32.056 --> 00:05:33.676
through this at the labs on

00:05:33.676 --> 00:05:36.956
Thursday and Friday.

00:05:38.516 --> 00:05:40.656
Also, an exciting new thing this

00:05:40.656 --> 00:05:42.286
year announced was Siri

00:05:42.286 --> 00:05:43.096
shortcuts.

00:05:43.126 --> 00:05:43.996
And, we're happy to say that

00:05:43.996 --> 00:05:45.946
Siri shortcuts are coming to

00:05:45.946 --> 00:05:47.386
file provider extensions.

00:05:48.266 --> 00:05:50.136
What this does, is it surfaces

00:05:50.196 --> 00:05:52.306
recently used documents that

00:05:52.306 --> 00:05:54.116
were opened or created, and it

00:05:54.116 --> 00:05:55.326
makes them visible either in

00:05:55.326 --> 00:05:57.896
Search or on the Lock Screen.

00:05:58.986 --> 00:06:00.736
You'll also be able to-- your

00:06:00.736 --> 00:06:01.796
customer will also be able to

00:06:01.796 --> 00:06:04.076
make shortcuts that are synced

00:06:04.076 --> 00:06:05.096
across devices.

00:06:05.566 --> 00:06:06.436
And, it's important to note that

00:06:06.436 --> 00:06:07.686
they're synced across devices,

00:06:08.666 --> 00:06:10.526
because in order to support

00:06:10.526 --> 00:06:12.396
this, your file provider will

00:06:12.396 --> 00:06:14.376
need to use unique identifiers

00:06:14.486 --> 00:06:16.656
for each file across all of the

00:06:16.656 --> 00:06:18.616
devices for a given customer.

00:06:19.426 --> 00:06:21.266
If this is true, or you can make

00:06:21.316 --> 00:06:22.976
this happen, all you need to do

00:06:22.976 --> 00:06:24.456
to support Siri shortcuts in

00:06:24.456 --> 00:06:26.366
your file provider extension is

00:06:26.366 --> 00:06:27.986
to add NSFileProvider

00:06:28.116 --> 00:06:30.136
UsesUniqueItemIdentifiers

00:06:30.136 --> 00:06:32.296
AcrossDevices to your file

00:06:32.296 --> 00:06:34.076
provider extension's info.plist

00:06:34.076 --> 00:06:34.406
file.

00:06:35.126 --> 00:06:36.026
Once you've done that, and

00:06:36.026 --> 00:06:37.646
submitted to the Store, you're

00:06:37.646 --> 00:06:37.846
done.

00:06:38.726 --> 00:06:40.476
For application developers,

00:06:40.476 --> 00:06:41.416
there's nothing you need to do.

00:06:42.616 --> 00:06:44.196
For information about Siri

00:06:44.196 --> 00:06:45.736
shortcuts, check out yesterday's

00:06:45.736 --> 00:06:47.246
session, "Introduction to Siri

00:06:47.246 --> 00:06:47.836
Shortcuts."

00:06:50.596 --> 00:06:54.176
Also this year, we're happy to

00:06:54.176 --> 00:06:55.256
announce that we're releasing

00:06:55.256 --> 00:06:56.426
the Particle Sample app.

00:06:57.206 --> 00:06:58.196
This was sample code that we

00:06:58.196 --> 00:06:59.516
used in last year's session to

00:06:59.516 --> 00:07:00.516
demonstrate how to use

00:07:00.516 --> 00:07:01.916
UIDocumentBrowserViewController

00:07:01.916 --> 00:07:03.056
in your app.

00:07:03.056 --> 00:07:05.826
It looks like this, and it uses

00:07:06.366 --> 00:07:07.836
UIDocumentBrowserViewController

00:07:08.206 --> 00:07:09.416
as its main viewController.

00:07:09.806 --> 00:07:12.546
It defines a file format.

00:07:13.296 --> 00:07:17.046
It implements state restoration,

00:07:17.606 --> 00:07:20.056
and imports assets using

00:07:20.056 --> 00:07:21.796
UIDocumentPickerViewController.

00:07:23.406 --> 00:07:24.326
You'll be able to download this

00:07:24.326 --> 00:07:24.676
today.

00:07:25.336 --> 00:07:27.266
The link is available in the WW

00:07:27.266 --> 00:07:28.436
app, and you'll also be able to

00:07:28.436 --> 00:07:29.226
search for it online.

00:07:29.786 --> 00:07:31.656
And, that's Particles.

00:07:33.356 --> 00:07:34.636
So, with that, I'd like to

00:07:34.636 --> 00:07:35.976
introduce Thomas onto the stage.

00:07:36.516 --> 00:07:41.546
[ Applause ]

00:07:42.046 --> 00:07:42.676
>> Hello, everyone.

00:07:43.286 --> 00:07:44.856
I'm Thomas, a software engineer

00:07:44.856 --> 00:07:45.916
on the Documents Management

00:07:45.916 --> 00:07:46.136
team.

00:07:46.526 --> 00:07:47.796
And, I'm going to take you

00:07:47.796 --> 00:07:49.806
through how you can leverage the

00:07:49.806 --> 00:07:51.706
document management features of

00:07:51.706 --> 00:07:54.026
iOS in your app.

00:07:54.616 --> 00:07:56.836
Together, we're going to discuss

00:07:56.946 --> 00:07:58.536
what the Document Picker and

00:07:58.536 --> 00:08:01.686
Document Browser are, when and

00:08:01.686 --> 00:08:02.476
how to use them.

00:08:03.566 --> 00:08:05.356
Then, we'll add a document

00:08:05.356 --> 00:08:06.786
picker to our demo app,

00:08:07.206 --> 00:08:07.676
Particles.

00:08:08.696 --> 00:08:11.266
And, finally, we talk about

00:08:11.356 --> 00:08:13.016
document types, and how to

00:08:13.016 --> 00:08:14.376
configure them properly in

00:08:14.376 --> 00:08:14.696
Xcode.

00:08:17.256 --> 00:08:18.936
So, what does interacting with

00:08:18.936 --> 00:08:21.146
documents mean nowadays?

00:08:21.626 --> 00:08:24.766
Of course, it means that you

00:08:24.766 --> 00:08:26.926
need to provide UI to let your

00:08:26.926 --> 00:08:28.816
customers organize their

00:08:28.816 --> 00:08:29.356
documents.

00:08:29.816 --> 00:08:31.816
Starting with the ones in your

00:08:31.816 --> 00:08:32.246
app container.

00:08:32.846 --> 00:08:35.846
But, because most documents are

00:08:35.846 --> 00:08:38.265
in the cloud nowadays, it means

00:08:38.426 --> 00:08:39.556
that you need to let them access

00:08:39.556 --> 00:08:41.246
documents stored in the cloud,

00:08:41.936 --> 00:08:43.946
and in other apps.

00:08:44.876 --> 00:08:47.346
How do you do this?

00:08:47.546 --> 00:08:50.026
Well, we have two solutions for

00:08:50.026 --> 00:08:50.196
you.

00:08:50.966 --> 00:08:53.336
The Document Picker and the

00:08:53.336 --> 00:08:55.136
Document Browser.

00:08:55.246 --> 00:08:56.936
What are the differences between

00:08:56.936 --> 00:08:57.936
these two?

00:08:59.636 --> 00:09:02.956
Well, both let you browse files

00:09:02.956 --> 00:09:04.606
stored locally on your iOS

00:09:04.606 --> 00:09:06.466
device, and in various cloud

00:09:06.466 --> 00:09:06.946
services.

00:09:07.426 --> 00:09:10.166
And, both let you access files

00:09:10.166 --> 00:09:11.796
from other apps.

00:09:13.616 --> 00:09:15.746
However, they have different use

00:09:15.746 --> 00:09:16.076
cases.

00:09:16.656 --> 00:09:19.186
You [inaudible] Document Picker

00:09:19.416 --> 00:09:21.286
shortly, for a short period of

00:09:21.286 --> 00:09:23.496
time, for a quick user

00:09:23.496 --> 00:09:25.906
interaction with the files you

00:09:25.906 --> 00:09:26.566
want to reach.

00:09:27.096 --> 00:09:29.906
The Document Browser, on the

00:09:29.906 --> 00:09:32.636
other hand, is supposed to be

00:09:32.636 --> 00:09:34.846
the main document browsing UI of

00:09:34.846 --> 00:09:35.906
your app.

00:09:38.616 --> 00:09:40.916
Let's start with the Document

00:09:40.916 --> 00:09:41.146
Browser.

00:09:44.936 --> 00:09:46.986
As Brandon mentioned, the

00:09:46.986 --> 00:09:48.536
document browser is what you see

00:09:48.646 --> 00:09:49.956
when you launch any of the UI

00:09:49.956 --> 00:09:50.876
applications.

00:09:50.876 --> 00:09:54.136
If your app is document-based,

00:09:54.696 --> 00:09:56.206
you should probably use a

00:09:56.236 --> 00:09:58.126
document browser to display

00:09:58.126 --> 00:09:58.786
these documents.

00:10:00.316 --> 00:10:01.686
And, if you choose to do so,

00:10:02.596 --> 00:10:04.026
this is what your customers will

00:10:04.026 --> 00:10:06.266
see when they launch your app.

00:10:06.936 --> 00:10:08.796
They immediately get to the

00:10:08.796 --> 00:10:11.796
files, which is what matters.

00:10:13.176 --> 00:10:14.756
The Document Browser is full

00:10:14.756 --> 00:10:17.236
screen, and it lets your

00:10:17.236 --> 00:10:19.506
customers open and organize the

00:10:19.506 --> 00:10:21.496
documents that your app handles.

00:10:25.076 --> 00:10:26.966
As Brandon mentioned, it has all

00:10:26.966 --> 00:10:28.206
the features of the Files app.

00:10:29.556 --> 00:10:32.326
So, Search, Tags, Favorites,

00:10:32.456 --> 00:10:34.546
Recents, all of this comes for

00:10:34.546 --> 00:10:36.226
free, and we do all of the

00:10:36.226 --> 00:10:36.976
editing for you.

00:10:41.046 --> 00:10:43.966
It can be customized with your

00:10:43.966 --> 00:10:46.096
own buttons, such as the

00:10:46.096 --> 00:10:47.116
[inaudible] button in the top

00:10:47.116 --> 00:10:50.696
right corner, or to match your

00:10:50.696 --> 00:10:51.486
application's look.

00:10:52.316 --> 00:10:53.986
As you can see, numbers and

00:10:53.986 --> 00:10:56.106
keynote look very different, yet

00:10:56.106 --> 00:10:58.206
both are based on the Document

00:10:58.206 --> 00:10:59.036
Browser controller.

00:11:00.616 --> 00:11:02.856
Of course, once your customer

00:11:02.856 --> 00:11:05.096
opens a document, you get to

00:11:05.096 --> 00:11:08.186
present your own UI on top of

00:11:08.356 --> 00:11:10.076
the browser to present your

00:11:10.076 --> 00:11:11.576
documentation UI for example.

00:11:12.146 --> 00:11:13.866
Now, because the Document

00:11:13.866 --> 00:11:15.466
Browser is the entry point of

00:11:15.466 --> 00:11:17.996
your app, it is best to make it

00:11:18.116 --> 00:11:18.916
the root view controller.

00:11:18.916 --> 00:11:21.996
However, we got a lot of

00:11:21.996 --> 00:11:23.616
feedback over the last year from

00:11:23.616 --> 00:11:25.696
you, saying it was not always

00:11:25.696 --> 00:11:27.216
easy to make it the root view

00:11:27.216 --> 00:11:27.626
controller.

00:11:28.156 --> 00:11:31.116
If that is the case, we want to

00:11:31.116 --> 00:11:32.786
clarify the guideline we gave

00:11:32.786 --> 00:11:33.246
last year.

00:11:33.776 --> 00:11:36.556
The Document Browser can also be

00:11:36.556 --> 00:11:38.016
presented [inaudible] full

00:11:38.016 --> 00:11:41.736
screen, likely shortly after

00:11:41.736 --> 00:11:41.976
launch.

00:11:43.496 --> 00:11:45.956
However, it is still meant to be

00:11:45.956 --> 00:11:48.466
the starting point of your app.

00:11:48.466 --> 00:11:50.806
In document-based apps, what we

00:11:50.806 --> 00:11:52.506
should see first are the

00:11:52.506 --> 00:11:52.976
documents.

00:11:55.956 --> 00:11:58.286
So, we do not recommend making

00:11:58.286 --> 00:12:01.366
it possible to get out of the

00:12:01.816 --> 00:12:01.996
browser.

00:12:02.636 --> 00:12:04.686
If you think you need to hide

00:12:04.866 --> 00:12:07.816
the browser, maybe what you

00:12:07.816 --> 00:12:09.586
might be looking for is Document

00:12:09.586 --> 00:12:10.506
Picker, which we are going to

00:12:10.506 --> 00:12:11.686
discuss next.

00:12:14.056 --> 00:12:16.156
How to get started with a new

00:12:16.226 --> 00:12:18.296
Document Browser controller.

00:12:18.626 --> 00:12:19.806
You can start a new app in

00:12:19.806 --> 00:12:21.676
Xcode, and use the

00:12:21.676 --> 00:12:23.006
document-based app template.

00:12:24.446 --> 00:12:26.016
And, this template gives you

00:12:26.106 --> 00:12:27.496
Document Browser [inaudible]

00:12:27.496 --> 00:12:28.116
based app.

00:12:29.226 --> 00:12:31.286
If you have an existing app, and

00:12:31.286 --> 00:12:32.576
want to add a

00:12:32.576 --> 00:12:34.226
DocumentBrowserViewController to

00:12:34.226 --> 00:12:36.946
it, you can drag a Document

00:12:36.946 --> 00:12:39.336
Browser to your storyboard, and

00:12:39.336 --> 00:12:41.266
use the Initial View Controller

00:12:41.266 --> 00:12:41.976
checkbox in Xcode.

00:12:47.606 --> 00:12:48.966
Once you have the Document

00:12:48.966 --> 00:12:50.326
Browser controller, you can

00:12:50.326 --> 00:12:50.846
customize it.

00:12:52.216 --> 00:12:54.096
You can add your own buttons to

00:12:54.096 --> 00:12:55.496
the bars and menus.

00:12:56.036 --> 00:12:58.966
And, you can set your own colors

00:12:58.966 --> 00:12:59.876
and themes to match your app's

00:12:59.876 --> 00:12:59.966
look.

00:13:04.536 --> 00:13:07.356
You can also customize the open

00:13:07.356 --> 00:13:08.796
and close document animations so

00:13:09.186 --> 00:13:10.436
that you get a nice zoom-in

00:13:10.436 --> 00:13:12.016
transition from your document's

00:13:12.016 --> 00:13:13.786
[inaudible] to your own document

00:13:13.786 --> 00:13:14.376
addition UI.

00:13:14.376 --> 00:13:16.136
To learn all about this, please

00:13:16.136 --> 00:13:18.196
watch last year's session, where

00:13:18.196 --> 00:13:19.986
we have covered this in detail.

00:13:22.046 --> 00:13:24.776
And, as Brandon mentioned, we

00:13:24.776 --> 00:13:26.906
have made the sample app that

00:13:26.906 --> 00:13:28.816
session last year, available as

00:13:28.846 --> 00:13:30.356
sample code today.

00:13:32.766 --> 00:13:34.816
Now, the Document Picker is a

00:13:34.816 --> 00:13:36.606
different thing.

00:13:36.656 --> 00:13:40.896
You use it to let your customers

00:13:41.016 --> 00:13:42.986
open documents or assets stored

00:13:43.046 --> 00:13:45.046
in the cloud, or stored in other

00:13:45.046 --> 00:13:47.886
apps, but it is only shown to

00:13:47.886 --> 00:13:49.626
let them choose a file, and then

00:13:49.626 --> 00:13:50.226
it goes away.

00:13:51.556 --> 00:13:53.576
The Document Picker is what we

00:13:53.576 --> 00:13:54.236
use in Mail.

00:13:55.776 --> 00:13:57.686
When you want to attach a file

00:13:57.686 --> 00:14:00.316
to an email, you tap the Add

00:14:00.316 --> 00:14:02.816
Attachment button, and this

00:14:02.816 --> 00:14:03.526
sheet pops up.

00:14:04.576 --> 00:14:05.976
This is a document picker.

00:14:06.986 --> 00:14:09.416
You choose a file to attach, and

00:14:10.206 --> 00:14:11.236
the sheet goes away.

00:14:11.806 --> 00:14:15.086
Same thing in iWork.

00:14:15.976 --> 00:14:18.056
If you want to attach a PDF,

00:14:18.376 --> 00:14:20.096
insert the PDF in your Pages

00:14:20.096 --> 00:14:20.516
document.

00:14:22.066 --> 00:14:23.736
You're going to tap this Insert

00:14:23.736 --> 00:14:25.486
From button, and the same sheet

00:14:25.776 --> 00:14:26.226
pops up.

00:14:26.866 --> 00:14:28.506
You choose a file, it goes away.

00:14:29.856 --> 00:14:31.436
So, if you need to display user

00:14:31.436 --> 00:14:33.676
interface to let your customers

00:14:34.556 --> 00:14:36.406
open-- view things from the

00:14:36.406 --> 00:14:39.176
cloud, and then hide it once the

00:14:39.176 --> 00:14:41.136
file is chosen, the Document

00:14:41.136 --> 00:14:42.576
Picker is a great option for

00:14:42.576 --> 00:14:42.726
you.

00:14:45.336 --> 00:14:47.876
Why do we need to give you the

00:14:48.086 --> 00:14:48.746
Document Picker?

00:14:50.066 --> 00:14:52.156
Because as we have said,

00:14:52.426 --> 00:14:54.096
documents might be in multiple

00:14:54.096 --> 00:14:54.696
locations.

00:14:55.276 --> 00:14:57.386
They can be in the cloud, or in

00:14:57.386 --> 00:14:58.316
other app containers.

00:14:59.106 --> 00:15:01.056
And, by default, you do not add

00:15:01.056 --> 00:15:03.576
access to these.

00:15:03.796 --> 00:15:06.226
So, you need something to let

00:15:06.256 --> 00:15:08.586
you access, copy, and move

00:15:08.586 --> 00:15:10.236
documents between these

00:15:10.236 --> 00:15:13.186
locations, and this is what the

00:15:13.186 --> 00:15:16.986
Document Picker does.

00:15:17.636 --> 00:15:19.676
It goes away once the files get

00:15:19.676 --> 00:15:21.756
chosen, so if you want something

00:15:21.866 --> 00:15:23.566
which stays onscreen for a long

00:15:23.566 --> 00:15:24.986
time, you should check out

00:15:24.986 --> 00:15:25.916
Document Browser instead.

00:15:31.406 --> 00:15:32.916
What can you do with Document

00:15:32.916 --> 00:15:33.136
Picker?

00:15:33.996 --> 00:15:35.156
You can use it for multiple

00:15:35.156 --> 00:15:35.466
things.

00:15:36.346 --> 00:15:38.216
You can use it to access files

00:15:38.316 --> 00:15:39.466
in the cloud directly.

00:15:42.536 --> 00:15:45.646
Now, creating copies, you can

00:15:45.786 --> 00:15:50.106
use it to move files to the

00:15:50.106 --> 00:15:52.366
cloud to implement a safety

00:15:52.366 --> 00:15:52.956
cloud feature.

00:15:53.456 --> 00:15:56.556
And, getting copies of documents

00:15:56.676 --> 00:15:59.106
is often confusing, but if you

00:15:59.106 --> 00:16:00.896
really want to, you can use it

00:16:01.366 --> 00:16:04.536
to copy things from and to the

00:16:04.536 --> 00:16:04.796
cloud.

00:16:09.336 --> 00:16:12.506
So, let's say we want to let our

00:16:12.506 --> 00:16:14.646
customers access a movie they've

00:16:14.646 --> 00:16:15.646
stored in the cloud.

00:16:16.506 --> 00:16:18.076
This is a great use of Document

00:16:18.076 --> 00:16:18.746
Picker controller.

00:16:20.116 --> 00:16:21.626
You create a Document Picker

00:16:21.626 --> 00:16:23.426
controller, and you specify the

00:16:23.426 --> 00:16:25.566
types of file you want your

00:16:25.566 --> 00:16:26.776
users to choose as a first

00:16:26.776 --> 00:16:27.306
document.

00:16:28.166 --> 00:16:29.666
And, the second document is one

00:16:29.666 --> 00:16:30.806
of the constants we have

00:16:30.806 --> 00:16:34.276
described on the previous slide.

00:16:34.366 --> 00:16:36.046
Then, you set the Document

00:16:36.046 --> 00:16:38.026
Picker delegate, because this is

00:16:38.026 --> 00:16:41.446
how we get notified that your

00:16:41.706 --> 00:16:43.106
customer has chosen their file,

00:16:43.106 --> 00:16:45.866
and you present it.

00:16:47.016 --> 00:16:49.376
Once the file is chosen, you're

00:16:49.376 --> 00:16:51.296
going to get called back at this

00:16:51.516 --> 00:16:53.976
delegate method.

00:16:54.136 --> 00:16:55.296
You get [inaudible] of your

00:16:55.296 --> 00:16:56.766
files in this method.

00:16:57.426 --> 00:16:58.586
You can use them directly.

00:17:00.076 --> 00:17:03.196
And, [inaudible] single URL,

00:17:03.636 --> 00:17:05.236
because there's a property you

00:17:05.236 --> 00:17:07.646
can set in the Picker to let

00:17:07.646 --> 00:17:09.566
your customer choose multiple

00:17:09.566 --> 00:17:11.185
files at once.

00:17:15.386 --> 00:17:17.156
So, let's go ahead and add a

00:17:17.286 --> 00:17:20.286
Document Picker to our demo app,

00:17:20.286 --> 00:17:21.886
Particles, from last year.

00:17:26.455 --> 00:17:28.516
This is the app [inaudible] last

00:17:28.516 --> 00:17:28.626
year.

00:17:28.986 --> 00:17:30.316
It is based on the Document

00:17:30.316 --> 00:17:32.066
Browser to let me choose a file

00:17:32.066 --> 00:17:32.486
to open.

00:17:33.496 --> 00:17:35.116
As you can see, I have Recents,

00:17:35.116 --> 00:17:36.876
I have Tags, I have Search, I

00:17:36.876 --> 00:17:38.866
have Browse to list all my

00:17:38.866 --> 00:17:39.276
sources.

00:17:39.796 --> 00:17:41.136
All of this comes for free.

00:17:42.506 --> 00:17:44.976
Now, I can go ahead and open

00:17:44.976 --> 00:17:48.006
this file, and I can tweak this

00:17:48.006 --> 00:17:49.536
nice particle system.

00:17:50.076 --> 00:17:53.586
Now, my customers love this app.

00:17:54.436 --> 00:17:56.546
But, they would like to make the

00:17:56.546 --> 00:17:59.906
particles a little nicer.

00:18:00.086 --> 00:18:02.386
So, they've asked the designers

00:18:02.426 --> 00:18:03.926
to design some better-looking

00:18:03.976 --> 00:18:05.586
particle images, and the

00:18:05.586 --> 00:18:07.336
designers have shared these

00:18:07.336 --> 00:18:08.476
images over iCloud.

00:18:09.346 --> 00:18:11.456
So, how do we get these images

00:18:11.746 --> 00:18:12.496
to customize them?

00:18:13.246 --> 00:18:15.726
What we're going to do, is add a

00:18:15.726 --> 00:18:17.146
Choose Image button in the

00:18:17.146 --> 00:18:19.866
navigation bar here to pick a

00:18:19.866 --> 00:18:22.546
file from iCloud, and customize

00:18:22.816 --> 00:18:23.496
these particles.

00:18:25.196 --> 00:18:26.476
So, you can open your

00:18:26.476 --> 00:18:29.246
storyboard, and here I am

00:18:29.246 --> 00:18:29.946
[inaudible] the controller.

00:18:30.836 --> 00:18:32.306
I'm going to drag a new bar

00:18:32.306 --> 00:18:34.966
button item to that editor.

00:18:40.616 --> 00:18:43.896
And, I'm going to animate Choose

00:18:44.656 --> 00:18:44.846
Image.

00:18:51.156 --> 00:18:51.526
[inaudible] Choose Image.

00:18:51.526 --> 00:18:54.586
OK. Now, I get to write some

00:18:55.066 --> 00:18:59.206
code to present to the document

00:18:59.206 --> 00:19:00.696
picker of the controller.

00:19:01.116 --> 00:19:05.956
So, I can drag an action from my

00:19:06.786 --> 00:19:10.036
button to the source code, and I

00:19:10.036 --> 00:19:11.996
agree to call it Choose Image,

00:19:12.556 --> 00:19:13.976
and [inaudible].

00:19:14.666 --> 00:19:14.986
Connect.

00:19:16.386 --> 00:19:17.546
And, now I have twice my code.

00:19:17.886 --> 00:19:20.406
So, let me display this in a

00:19:21.156 --> 00:19:21.976
bigger window.

00:19:26.076 --> 00:19:27.976
Here I am in my chooseImage

00:19:28.196 --> 00:19:28.556
method.

00:19:28.996 --> 00:19:31.396
I'm going first to create a

00:19:31.486 --> 00:19:32.696
Document Picker controller.

00:19:32.776 --> 00:19:34.826
And, I specify the type of files

00:19:34.826 --> 00:19:36.006
I want my customers to choose.

00:19:36.396 --> 00:19:38.426
So, here this is UTTypeImage,

00:19:38.766 --> 00:19:40.666
and the mode.

00:19:40.966 --> 00:19:42.306
I'm using .import here because I

00:19:42.306 --> 00:19:44.896
want to embed the particle image

00:19:44.896 --> 00:19:45.536
in my document.

00:19:46.236 --> 00:19:48.696
But, in many cases, you will use

00:19:48.696 --> 00:19:49.316
[inaudible] here instead.

00:19:51.536 --> 00:19:54.256
You set your document picker

00:19:54.796 --> 00:19:56.056
delegate, and you present it.

00:19:57.406 --> 00:19:59.986
When the Document Picker gets

00:19:59.986 --> 00:20:02.796
invoked, and the file is chosen,

00:20:02.796 --> 00:20:03.976
it going to call you back.

00:20:04.046 --> 00:20:06.296
So, we need to implement the

00:20:06.296 --> 00:20:07.106
document picker [inaudible] at

00:20:07.106 --> 00:20:07.436
method.

00:20:08.136 --> 00:20:10.516
I don't know if you noticed, but

00:20:10.986 --> 00:20:14.136
I have not set a property to

00:20:14.446 --> 00:20:16.416
choose document files.

00:20:17.716 --> 00:20:20.006
So, I'm going to check I have

00:20:20.006 --> 00:20:22.046
only one URL here.

00:20:24.296 --> 00:20:27.016
Get the first URL, and create an

00:20:27.076 --> 00:20:28.306
image from it.

00:20:29.296 --> 00:20:31.756
And, set it in our particle

00:20:31.756 --> 00:20:32.976
system, which is [inaudible].

00:20:34.396 --> 00:20:36.156
Let's run this again.

00:20:37.836 --> 00:20:39.796
It [inaudible] my app and will

00:20:39.796 --> 00:20:40.976
open my simulator shortly.

00:20:47.776 --> 00:20:48.566
So, here I am.

00:20:48.636 --> 00:20:49.976
I am in my simulator.

00:20:50.026 --> 00:20:51.076
I can open my file.

00:20:51.076 --> 00:20:52.716
And, I have this new Choose

00:20:52.716 --> 00:20:55.216
Image button in my navigation

00:20:55.216 --> 00:20:55.426
bar.

00:20:55.426 --> 00:20:58.236
I can tap it, and my Document

00:20:58.236 --> 00:20:59.446
Picker comes up.

00:20:59.446 --> 00:21:01.136
And, as you see, again, we have

00:21:01.166 --> 00:21:02.006
all the pictures of the Files

00:21:02.006 --> 00:21:02.296
app.

00:21:02.296 --> 00:21:03.286
We can search our files, you

00:21:03.286 --> 00:21:03.926
have Tags.

00:21:04.256 --> 00:21:06.476
You can browse.

00:21:06.476 --> 00:21:07.696
All of this comes for free.

00:21:09.266 --> 00:21:12.146
Now, my particle image is

00:21:12.146 --> 00:21:13.066
[inaudible] shared to me over

00:21:13.066 --> 00:21:14.576
iCloud, so they show up in

00:21:14.576 --> 00:21:15.536
[inaudible].

00:21:15.536 --> 00:21:17.686
And, again, use this little star

00:21:17.686 --> 00:21:18.166
image here.

00:21:18.866 --> 00:21:21.376
Pick it, and my particles are

00:21:21.376 --> 00:21:21.976
little stars.

00:21:22.516 --> 00:21:28.616
[ Applause ]

00:21:29.116 --> 00:21:30.126
This was easy.

00:21:30.736 --> 00:21:32.646
And, when you are back at work,

00:21:32.646 --> 00:21:33.816
you will be able to add a

00:21:33.816 --> 00:21:36.136
Document Picker to your app in

00:21:36.136 --> 00:21:36.796
no time.

00:21:37.386 --> 00:21:39.836
It simply has very little code,

00:21:39.836 --> 00:21:41.806
and does not depend on any

00:21:41.806 --> 00:21:42.736
third-party library.

00:21:43.576 --> 00:21:45.416
Your customers simply get access

00:21:45.416 --> 00:21:47.356
to their files, no matter where

00:21:47.356 --> 00:21:47.916
they are stored.

00:21:48.446 --> 00:21:51.116
Now, you noticed that during the

00:21:51.116 --> 00:21:52.996
demo, we have again talked about

00:21:52.996 --> 00:21:53.536
file types.

00:21:53.866 --> 00:21:55.596
And, many among you probably

00:21:55.596 --> 00:21:56.866
don't know what these are.

00:21:57.246 --> 00:22:01.296
So, let's talk about file types.

00:22:02.186 --> 00:22:04.126
Document Types let the system

00:22:04.126 --> 00:22:05.706
know which files your

00:22:05.706 --> 00:22:07.516
application knows how to handle.

00:22:08.036 --> 00:22:12.176
And, they're important because

00:22:12.366 --> 00:22:16.376
they let iOS open your app when

00:22:16.376 --> 00:22:17.706
the file is tapped in the Files

00:22:17.706 --> 00:22:17.916
app.

00:22:19.096 --> 00:22:21.456
They also let it show your app

00:22:21.596 --> 00:22:22.406
in the Share sheet.

00:22:23.016 --> 00:22:26.436
And, finally it lets iOS choose

00:22:26.436 --> 00:22:27.476
the proper icon for your

00:22:27.476 --> 00:22:27.976
documents.

00:22:29.126 --> 00:22:30.626
So, if I configure my types

00:22:30.626 --> 00:22:32.336
properly, and if I want to

00:22:32.336 --> 00:22:34.236
[inaudible] extension, I'm going

00:22:34.236 --> 00:22:35.406
to see this when browsing

00:22:35.406 --> 00:22:36.586
particles files in the Files

00:22:37.336 --> 00:22:37.426
app.

00:22:37.906 --> 00:22:40.606
If I don't, I'm going to see

00:22:40.606 --> 00:22:42.456
this instead, which is not too

00:22:42.456 --> 00:22:44.236
good, and my customers won't be

00:22:44.236 --> 00:22:45.646
able to open my files from the

00:22:45.646 --> 00:22:46.056
Files app.

00:22:47.256 --> 00:22:48.386
So, let's configure this

00:22:48.516 --> 00:22:48.856
together.

00:22:51.376 --> 00:22:53.006
There are two steps when you

00:22:53.006 --> 00:22:54.666
want to configure document

00:22:54.666 --> 00:22:55.036
types.

00:22:55.966 --> 00:22:57.376
You need to declare the type

00:22:57.376 --> 00:22:58.986
first, if it is not declared by

00:22:58.986 --> 00:23:00.936
iOS already, and then you need

00:23:00.936 --> 00:23:04.216
to claim it to tell iOS you can

00:23:04.216 --> 00:23:06.486
view or edit files of this type.

00:23:07.136 --> 00:23:09.726
Let's start with type

00:23:09.726 --> 00:23:10.326
declaration.

00:23:10.836 --> 00:23:13.056
The first question you need to

00:23:13.056 --> 00:23:15.106
ask yourself is, do you need to

00:23:15.106 --> 00:23:15.616
declare it?

00:23:16.486 --> 00:23:19.146
Because in most cases, you'll be

00:23:19.146 --> 00:23:20.666
dealing with common file types,

00:23:21.176 --> 00:23:23.316
such as videos, images, PDFs,

00:23:23.366 --> 00:23:24.896
presentations, spreadsheets.

00:23:25.966 --> 00:23:28.226
If that is the case, iOS most

00:23:28.226 --> 00:23:30.276
likely already declared this for

00:23:30.276 --> 00:23:30.416
you.

00:23:31.266 --> 00:23:32.626
And, to know if this is the

00:23:32.626 --> 00:23:35.056
case, you can check out the

00:23:35.056 --> 00:23:37.846
documentation at this short URL.

00:23:40.536 --> 00:23:42.996
If that is the case, great, you

00:23:42.996 --> 00:23:45.386
do not have anything to do, and

00:23:45.386 --> 00:23:47.106
you can jump to claiming the

00:23:47.646 --> 00:23:47.746
type.

00:23:50.496 --> 00:23:53.276
The other common case, is when

00:23:53.276 --> 00:23:55.326
you wrote an app which defines

00:23:55.446 --> 00:23:56.756
its own file format.

00:23:57.856 --> 00:23:58.996
You invented your own file

00:23:58.996 --> 00:24:00.716
format, and you get to define

00:24:00.716 --> 00:24:01.546
what that type is.

00:24:02.466 --> 00:24:03.716
Then you should declare your

00:24:03.716 --> 00:24:06.406
type as exported, which tells

00:24:06.406 --> 00:24:08.986
iOS you are the authority for

00:24:08.986 --> 00:24:10.166
this file type.

00:24:12.216 --> 00:24:14.316
This is a situation I'm in, in

00:24:14.316 --> 00:24:17.536
the Files app-- in the Particles

00:24:18.016 --> 00:24:18.816
app, sorry.

00:24:19.236 --> 00:24:21.676
My particles file format is my

00:24:21.676 --> 00:24:21.956
own.

00:24:21.996 --> 00:24:25.976
So, I can open Xcode to

00:24:25.976 --> 00:24:29.346
configure this type.

00:24:29.536 --> 00:24:31.996
And, in this exported UI

00:24:31.996 --> 00:24:34.346
section, which lets me edit my

00:24:34.346 --> 00:24:37.176
info.plist, I specify the type

00:24:37.176 --> 00:24:39.516
identifier, which is a

00:24:39.516 --> 00:24:40.446
[inaudible] string that I

00:24:40.446 --> 00:24:40.846
choose.

00:24:41.516 --> 00:24:42.696
So, [inaudible] comes the

00:24:42.696 --> 00:24:44.766
example that [inaudible] sample

00:24:44.766 --> 00:24:50.026
code, the particles, and I need

00:24:50.026 --> 00:24:51.276
to declare a list of parent

00:24:51.276 --> 00:24:53.186
types in the Conforms To field.

00:24:54.396 --> 00:24:58.356
What are parent types?

00:24:58.536 --> 00:25:01.406
Well, types form a tree, which

00:25:01.406 --> 00:25:02.946
we call the [inaudible] tree,

00:25:03.906 --> 00:25:08.276
and you can think of it like a

00:25:08.276 --> 00:25:09.196
[inaudible], like Swift.

00:25:10.546 --> 00:25:13.856
For example, JPEG images and

00:25:14.256 --> 00:25:17.006
HEIF images are both kinds of

00:25:17.156 --> 00:25:17.556
images.

00:25:18.626 --> 00:25:21.116
And, .image conforms to our root

00:25:21.116 --> 00:25:23.536
type for user-created, or

00:25:23.536 --> 00:25:26.156
user-visible, documents, which

00:25:26.156 --> 00:25:29.976
is called public.content.

00:25:30.076 --> 00:25:31.416
Now, public.content has other

00:25:31.416 --> 00:25:33.366
children, like, for example,

00:25:33.366 --> 00:25:34.166
public.spreadsheet.

00:25:35.996 --> 00:25:38.666
You can find this list of types

00:25:38.786 --> 00:25:41.566
in the documentation I pointed

00:25:42.256 --> 00:25:42.586
to earlier.

00:25:42.586 --> 00:25:43.776
Now, we need to find a spot in

00:25:43.776 --> 00:25:44.866
this tree for my type,

00:25:45.136 --> 00:25:45.706
Particles.

00:25:46.956 --> 00:25:49.186
Since the particle system is not

00:25:49.296 --> 00:25:51.916
a common file category, there is

00:25:51.916 --> 00:25:53.516
no [inaudible] category for me.

00:25:54.076 --> 00:25:55.736
So, I can't just make it conform

00:25:55.736 --> 00:25:58.786
to public.content directly.

00:25:58.876 --> 00:26:00.226
And, I need to conform to

00:26:00.226 --> 00:26:02.196
public.content either directly,

00:26:02.506 --> 00:26:03.786
or indirectly through

00:26:03.786 --> 00:26:06.326
public.spreadsheet or .image if

00:26:06.326 --> 00:26:07.956
I want my files to show up in

00:26:07.956 --> 00:26:11.616
Recents and in Search.

00:26:12.456 --> 00:26:13.766
Then you have a second tree,

00:26:14.166 --> 00:26:15.446
which we call the physical tree,

00:26:16.046 --> 00:26:17.706
which lets iOS know how the

00:26:17.706 --> 00:26:19.316
files are represented on-disk.

00:26:20.216 --> 00:26:21.706
And, here this is much simpler,

00:26:22.036 --> 00:26:23.556
because you only have two

00:26:23.556 --> 00:26:23.926
choices.

00:26:25.406 --> 00:26:27.556
In most cases, you will be

00:26:27.556 --> 00:26:29.286
dealing with a single file on

00:26:29.286 --> 00:26:31.496
disk for your document.

00:26:32.136 --> 00:26:35.956
If you need to group multiple

00:26:35.956 --> 00:26:38.446
resources together, and you have

00:26:38.446 --> 00:26:40.446
the file package, you're going

00:26:40.446 --> 00:26:42.006
to use com.apple.package.

00:26:42.466 --> 00:26:43.536
But, in most cases, you have a

00:26:43.536 --> 00:26:44.576
single file disk, so it's

00:26:44.576 --> 00:26:45.926
public.data.

00:26:47.656 --> 00:26:49.146
This is because I am in with

00:26:49.186 --> 00:26:50.846
particles, so I'm going to

00:26:50.846 --> 00:26:52.156
conform to public.data.

00:26:52.746 --> 00:26:55.936
Now, because this is a tree,

00:26:56.346 --> 00:26:58.666
.data and .package both iterate

00:26:58.666 --> 00:27:00.786
from our root type from the

00:27:00.786 --> 00:27:03.206
physical hierarchy, which is

00:27:03.296 --> 00:27:04.366
public.item.

00:27:04.816 --> 00:27:06.566
But, you don't care about this,

00:27:06.616 --> 00:27:08.476
you just need to choose between

00:27:08.476 --> 00:27:10.546
.data and .package.

00:27:11.026 --> 00:27:12.126
Therefore, you have two parents,

00:27:12.726 --> 00:27:14.536
public.data and public.content.

00:27:15.586 --> 00:27:17.756
So, in my Xcode UI, I'm going to

00:27:17.756 --> 00:27:20.266
write, Conforms To public.data,

00:27:20.266 --> 00:27:21.726
public.content.

00:27:22.196 --> 00:27:26.336
The last thing I need to do is

00:27:26.456 --> 00:27:28.966
tell iOS which file extensions

00:27:29.026 --> 00:27:31.786
are associated with my type.

00:27:33.016 --> 00:27:35.046
This is how iOS will know that

00:27:35.046 --> 00:27:37.086
.particles files are of the type

00:27:37.086 --> 00:27:37.796
[inaudible] defined.

00:27:38.336 --> 00:27:41.326
To do this, I add a UTType

00:27:41.386 --> 00:27:44.836
classification property to my

00:27:44.836 --> 00:27:45.786
[inaudible] properties.

00:27:46.776 --> 00:27:50.036
In this dictionary, I add a key

00:27:50.076 --> 00:27:50.316
called

00:27:50.416 --> 00:27:53.436
public.filename-extension, and

00:27:53.436 --> 00:27:55.286
[inaudible] file extension that

00:27:55.286 --> 00:27:57.466
you want to associate with your

00:27:58.756 --> 00:27:58.926
type.

00:27:59.066 --> 00:28:01.516
So, here I have a new item, of

00:28:01.576 --> 00:28:01.996
particles.

00:28:02.656 --> 00:28:06.396
And, with this, our declaration

00:28:06.886 --> 00:28:07.286
is done.

00:28:08.856 --> 00:28:11.176
There's just one more thing I

00:28:11.176 --> 00:28:11.876
didn't mention.

00:28:12.406 --> 00:28:15.786
It is if you-- if this was the

00:28:15.786 --> 00:28:18.466
case where we were declaring our

00:28:18.466 --> 00:28:19.056
own type.

00:28:19.746 --> 00:28:21.026
But, you might also want to use

00:28:21.026 --> 00:28:22.306
type defined by another

00:28:22.306 --> 00:28:22.926
application.

00:28:23.476 --> 00:28:26.286
If that is the case, you also

00:28:26.286 --> 00:28:28.616
need to declare the type so that

00:28:28.616 --> 00:28:30.706
iOS knows about it, in case that

00:28:30.706 --> 00:28:31.596
app is not [inaudible].

00:28:32.486 --> 00:28:34.486
And, because this is an imported

00:28:34.636 --> 00:28:39.096
type declaration, this means

00:28:39.486 --> 00:28:41.856
that if iOS finds an extra

00:28:41.856 --> 00:28:42.956
definition of that type

00:28:43.006 --> 00:28:44.856
somewhere else, it will prefer

00:28:44.856 --> 00:28:46.366
that definition over yours.

00:28:47.476 --> 00:28:48.826
This is also what you need to do

00:28:49.236 --> 00:28:50.606
if you want to use a common file

00:28:50.606 --> 00:28:52.456
type which is not declared by

00:28:52.456 --> 00:28:53.396
iOS yet.

00:28:54.536 --> 00:28:55.736
Now, do not freak out, it is the

00:28:55.736 --> 00:28:58.976
same UI as what we've just went

00:28:58.976 --> 00:29:02.136
through, except that it is in

00:29:02.136 --> 00:29:03.606
the imported section instead of

00:29:03.606 --> 00:29:03.946
exported.

00:29:08.046 --> 00:29:09.696
Once you have your type defined,

00:29:10.066 --> 00:29:11.846
you can claim support for it,

00:29:12.256 --> 00:29:14.306
still in your info.plist, or the

00:29:14.306 --> 00:29:14.966
Xcode UI.

00:29:15.596 --> 00:29:19.996
To do this, you specify the type

00:29:19.996 --> 00:29:21.336
identifier that you have

00:29:21.336 --> 00:29:23.586
defined, and the only other

00:29:23.836 --> 00:29:26.176
thing that you need to do is

00:29:26.276 --> 00:29:27.276
define a rank.

00:29:28.016 --> 00:29:30.596
And, this lets iOS know what to

00:29:30.596 --> 00:29:32.476
do when you tap on the file and

00:29:32.526 --> 00:29:34.276
multiple apps can open this

00:29:34.926 --> 00:29:35.026
file.

00:29:36.796 --> 00:29:38.606
For this, you have three

00:29:38.606 --> 00:29:39.046
choices.

00:29:42.316 --> 00:29:44.206
The first is if it is your own

00:29:44.206 --> 00:29:44.646
file type.

00:29:45.716 --> 00:29:46.496
You choose "owner."

00:29:47.026 --> 00:29:48.316
And, to be clear, this should

00:29:48.316 --> 00:29:50.396
only be used if you happen to

00:29:50.396 --> 00:29:51.746
have invented your own file

00:29:52.486 --> 00:29:52.586
type.

00:29:53.896 --> 00:29:56.346
In most cases, you want to use

00:29:56.426 --> 00:30:00.386
"default," if you can edit files

00:30:00.386 --> 00:30:02.466
of this type, or "alternate" if

00:30:02.586 --> 00:30:03.996
you can read files of this type,

00:30:03.996 --> 00:30:04.976
but not edit them.

00:30:05.876 --> 00:30:09.786
And a list of [inaudible], rules

00:30:09.786 --> 00:30:12.946
are different on macOS, so if

00:30:12.946 --> 00:30:14.936
[inaudible] macOS up, please

00:30:14.936 --> 00:30:17.166
check out this other short link.

00:30:20.616 --> 00:30:21.756
When claiming support for a

00:30:21.756 --> 00:30:23.716
type, please be as specific as

00:30:23.716 --> 00:30:24.156
possible.

00:30:25.086 --> 00:30:26.666
We have just claimed support for

00:30:26.666 --> 00:30:28.076
a very specific file type, so

00:30:28.076 --> 00:30:28.986
.particles file type.

00:30:29.616 --> 00:30:30.656
But you can also claim support

00:30:30.656 --> 00:30:32.346
for categories, such as any

00:30:32.346 --> 00:30:34.206
image using public.image.

00:30:35.336 --> 00:30:37.396
This is fine, but you need to be

00:30:37.396 --> 00:30:39.106
as specific as possible to make

00:30:39.106 --> 00:30:41.106
your app show up exactly what it

00:30:41.106 --> 00:30:41.826
needs to show up.

00:30:42.926 --> 00:30:44.646
Do not claim support for

00:30:44.646 --> 00:30:46.156
[inaudible] types such as

00:30:46.156 --> 00:30:48.086
public.data or public.content,

00:30:49.766 --> 00:30:51.076
because this will make your app

00:30:51.076 --> 00:30:52.696
show up in places where your

00:30:52.696 --> 00:30:54.596
customers do not expect to see

00:30:54.596 --> 00:30:55.946
it, and it will confuse them.

00:31:00.246 --> 00:31:01.366
So, what can you do with all of

00:31:01.366 --> 00:31:02.006
this information?

00:31:02.506 --> 00:31:05.866
Well, first, if you have a need

00:31:05.936 --> 00:31:07.566
to access files in the cloud,

00:31:07.906 --> 00:31:09.106
you should use the Document

00:31:09.106 --> 00:31:10.336
Browser or Document Picker to

00:31:10.626 --> 00:31:11.676
access these documents.

00:31:12.646 --> 00:31:15.216
Most cloud vendors have adopted

00:31:15.836 --> 00:31:18.836
our API's, so if you use one of

00:31:18.836 --> 00:31:20.206
these viewControllers, your

00:31:20.206 --> 00:31:21.976
customers will be able to access

00:31:21.976 --> 00:31:23.866
their files no matter where they

00:31:23.866 --> 00:31:24.186
are.

00:31:24.546 --> 00:31:26.136
And, you do not have to write

00:31:26.136 --> 00:31:28.256
code for each cloud vendor.

00:31:29.896 --> 00:31:32.736
If you wrote your own custom

00:31:32.816 --> 00:31:35.356
document browsing UI before iOS

00:31:35.356 --> 00:31:37.666
11, now's a great time to switch

00:31:37.956 --> 00:31:38.216
to

00:31:38.216 --> 00:31:39.556
UIDocumentBrowserViewController.

00:31:40.896 --> 00:31:42.856
It is packed with features--

00:31:43.996 --> 00:31:47.316
it's packed with features, so

00:31:47.316 --> 00:31:49.336
please let us do the hard work,

00:31:49.336 --> 00:31:50.626
and just get all the features in

00:31:50.626 --> 00:31:51.996
your app for free.

00:31:54.196 --> 00:31:55.626
Finally, please make sure your

00:31:55.626 --> 00:31:57.226
document types are configured in

00:31:57.226 --> 00:31:59.276
Xcode properly so that your app

00:31:59.276 --> 00:32:02.386
shows up exactly where it needs

00:32:02.386 --> 00:32:05.556
to be, and help customers find

00:32:05.556 --> 00:32:05.676
it.

00:32:05.676 --> 00:32:08.676
And with this, I'm going to hand

00:32:08.676 --> 00:32:09.776
the stage over to my colleague

00:32:09.776 --> 00:32:09.976
Ronny.

00:32:10.516 --> 00:32:15.576
[ Applause ]

00:32:16.076 --> 00:32:16.846
>> Thank you, Thomas.

00:32:17.336 --> 00:32:18.136
Hello, everyone.

00:32:18.516 --> 00:32:20.026
I am Rony Fadel, a software

00:32:20.026 --> 00:32:21.346
engineer on the Documents

00:32:21.346 --> 00:32:22.836
Management team.

00:32:23.356 --> 00:32:25.306
So, Thomas has explained how

00:32:25.306 --> 00:32:27.256
easy it is to adopt a document

00:32:27.486 --> 00:32:29.486
browser and document picker

00:32:29.486 --> 00:32:30.946
API's in your app.

00:32:31.426 --> 00:32:32.826
Now, that you've adopted these

00:32:32.826 --> 00:32:34.586
API's, we'd like to cover some

00:32:34.586 --> 00:32:36.526
best practices to make sure that

00:32:36.526 --> 00:32:38.066
your app is a well-behaved

00:32:38.126 --> 00:32:40.736
citizen on the iOS ecosystem,

00:32:41.196 --> 00:32:44.186
the day you submit it to the App

00:32:44.456 --> 00:32:44.856
Store.

00:32:44.856 --> 00:32:46.906
So, now that we've implemented a

00:32:46.906 --> 00:32:48.986
document browser-based app, or

00:32:48.986 --> 00:32:51.596
added picker support, now we're

00:32:51.596 --> 00:32:52.806
ready finally to pick some

00:32:52.806 --> 00:32:53.366
documents.

00:32:54.446 --> 00:32:56.146
Your app might want to access

00:32:56.146 --> 00:32:58.816
documents directly, avoiding the

00:32:58.816 --> 00:33:00.906
copies in import mode that

00:33:00.906 --> 00:33:03.236
Thomas has described, or if you

00:33:03.296 --> 00:33:04.506
want to edit your document

00:33:04.506 --> 00:33:04.956
directly.

00:33:05.376 --> 00:33:06.816
For this you'd need to invoke

00:33:06.816 --> 00:33:08.076
the Picker in Open Mode.

00:33:09.536 --> 00:33:11.096
In this example, we're in the

00:33:11.096 --> 00:33:13.476
Particles app, and we've created

00:33:13.476 --> 00:33:15.476
and presented a Picker in Open

00:33:15.476 --> 00:33:15.726
Mode.

00:33:16.366 --> 00:33:17.616
We're going to pick an image

00:33:17.616 --> 00:33:19.146
file to change our particle

00:33:19.146 --> 00:33:19.936
system's image.

00:33:21.436 --> 00:33:23.936
Once we've picked a document, we

00:33:23.936 --> 00:33:25.406
receive a callback at one of

00:33:25.436 --> 00:33:26.686
these two delegate methods.

00:33:27.566 --> 00:33:29.616
The first one, if we're picking

00:33:29.616 --> 00:33:32.126
our document in the Browser, or

00:33:32.346 --> 00:33:34.216
the second one if we're picking

00:33:34.216 --> 00:33:35.916
it in the Picker, like our

00:33:35.916 --> 00:33:36.326
example.

00:33:36.326 --> 00:33:40.716
We see the document here, and we

00:33:40.936 --> 00:33:43.466
see actually the Document Picker

00:33:43.466 --> 00:33:46.076
here, serving our app the URL

00:33:46.076 --> 00:33:46.956
that we've just picked.

00:33:48.066 --> 00:33:50.036
If we attempt to access the

00:33:50.036 --> 00:33:52.536
document directly, we risk

00:33:52.536 --> 00:33:53.756
running into a permissions

00:33:53.756 --> 00:33:53.976
error.

00:33:55.356 --> 00:33:57.036
Let's try to understand why this

00:33:57.036 --> 00:33:57.546
could happen.

00:33:58.546 --> 00:34:00.376
As you may know, your apps on

00:34:00.506 --> 00:34:01.966
iOS are Sandbox.

00:34:02.816 --> 00:34:04.666
The App Sandbox is a security

00:34:04.666 --> 00:34:07.286
feature, whereas every app has

00:34:07.356 --> 00:34:09.426
unrestricted access to documents

00:34:09.426 --> 00:34:12.126
in its own app container, and by

00:34:12.126 --> 00:34:14.896
default, access is restricted to

00:34:14.896 --> 00:34:16.775
documents in other containers,

00:34:17.085 --> 00:34:18.735
namely in other app containers

00:34:18.735 --> 00:34:20.196
and in cloud service containers.

00:34:21.466 --> 00:34:23.636
So, this is a security feature

00:34:23.906 --> 00:34:25.585
that guarantees that other apps

00:34:25.585 --> 00:34:27.426
and processes don't just go

00:34:27.426 --> 00:34:29.036
snooping around in your app

00:34:29.036 --> 00:34:30.366
container, accessing your

00:34:30.366 --> 00:34:31.016
documents.

00:34:31.356 --> 00:34:33.166
And, always make sure that if

00:34:33.166 --> 00:34:35.076
they do access them, access

00:34:35.076 --> 00:34:37.815
these documents, that is done

00:34:37.906 --> 00:34:39.126
with user consent.

00:34:40.636 --> 00:34:43.916
So, since access to documents in

00:34:43.916 --> 00:34:45.656
other containers is restricted,

00:34:46.106 --> 00:34:48.065
how can your app gain access to

00:34:48.065 --> 00:34:49.466
these documents that your

00:34:49.466 --> 00:34:50.485
customer has picked?

00:34:51.585 --> 00:34:53.666
What we have to do, is to extend

00:34:53.666 --> 00:34:55.476
our App Sandbox to include these

00:34:55.476 --> 00:34:56.065
documents.

00:34:56.775 --> 00:34:59.246
Here's again the URL returned by

00:34:59.246 --> 00:35:00.266
the Browser or the Picker.

00:35:01.716 --> 00:35:03.896
This URL has a security scoped

00:35:03.896 --> 00:35:06.026
resource attached to it.

00:35:06.326 --> 00:35:07.676
You can think of this resource

00:35:07.676 --> 00:35:09.426
as a permissions token granted

00:35:09.426 --> 00:35:11.246
to you by the system, and

00:35:11.306 --> 00:35:13.126
accessing this token would allow

00:35:13.126 --> 00:35:15.436
your app to access this

00:35:15.436 --> 00:35:15.936
document.

00:35:16.356 --> 00:35:19.446
We can start accessing this

00:35:19.446 --> 00:35:21.096
document using the following URL

00:35:21.096 --> 00:35:21.646
API's.

00:35:22.846 --> 00:35:23.666
When we call

00:35:23.836 --> 00:35:25.826
startAccessingSecurityScoped

00:35:25.826 --> 00:35:28.576
Resource, your app gets access

00:35:28.576 --> 00:35:30.206
to this document, and so you can

00:35:30.206 --> 00:35:31.676
start displaying or editing the

00:35:31.676 --> 00:35:32.166
document.

00:35:32.896 --> 00:35:34.386
And, once you're done using it,

00:35:34.386 --> 00:35:36.796
the document, you should call

00:35:36.796 --> 00:35:38.806
the stopAccessingSecurityScoped

00:35:38.806 --> 00:35:40.516
Resource API on that URL.

00:35:41.026 --> 00:35:42.856
And, as you can see here, access

00:35:42.856 --> 00:35:44.686
is again restricted to that

00:35:44.686 --> 00:35:45.196
document.

00:35:47.676 --> 00:35:50.546
So, here's a simple recipe to

00:35:50.546 --> 00:35:51.866
guarantee that you will always

00:35:51.866 --> 00:35:53.366
interact successfully with

00:35:53.416 --> 00:35:54.596
Sandbox documents.

00:35:55.136 --> 00:35:57.556
We walked through this example

00:35:57.626 --> 00:35:58.716
where we make these calls.

00:35:59.996 --> 00:36:01.586
First, we make the

00:36:01.586 --> 00:36:03.716
startAccessing call on that URL,

00:36:04.256 --> 00:36:05.706
and so we can start interacting

00:36:05.706 --> 00:36:06.376
with that document.

00:36:07.386 --> 00:36:09.036
And, you notice in the defer

00:36:09.036 --> 00:36:10.856
block, we make the stopAccessing

00:36:10.856 --> 00:36:12.416
call once we're done using the

00:36:12.416 --> 00:36:12.886
document.

00:36:14.546 --> 00:36:16.576
You notice that these calls are

00:36:16.576 --> 00:36:19.476
balanced, and that we only call

00:36:19.476 --> 00:36:21.946
stopAccessing if startAccessing

00:36:21.946 --> 00:36:25.116
returns "true."

00:36:25.336 --> 00:36:27.166
We keep resource access time as

00:36:27.166 --> 00:36:29.426
small as possible, because when

00:36:29.426 --> 00:36:30.826
we make this startAccessing

00:36:30.826 --> 00:36:33.196
call, we consume limited system

00:36:33.196 --> 00:36:34.916
resources, reserved just for

00:36:34.916 --> 00:36:35.266
your app.

00:36:35.806 --> 00:36:37.276
And so, we need to relinquish

00:36:37.276 --> 00:36:39.136
these resources once we're done

00:36:39.136 --> 00:36:40.696
using that document to make sure

00:36:40.696 --> 00:36:43.066
that we can access additional

00:36:43.066 --> 00:36:45.496
documents within our process.

00:36:47.376 --> 00:36:49.116
If you know for sure that this

00:36:49.116 --> 00:36:50.906
document exists inside of your

00:36:50.906 --> 00:36:52.626
app container, you do not need

00:36:52.626 --> 00:36:53.436
to make these calls.

00:36:54.206 --> 00:36:56.376
But, in case of doubt, make

00:36:56.376 --> 00:36:57.036
these calls.

00:36:57.736 --> 00:36:59.196
If they're not actually needed,

00:36:59.366 --> 00:37:01.126
they'll simply be a no-op.

00:37:03.176 --> 00:37:05.336
Great. Now, we know how to gain

00:37:05.336 --> 00:37:06.626
access to our documents.

00:37:06.766 --> 00:37:08.816
We can go ahead and pick that

00:37:08.816 --> 00:37:10.396
document, like the particle

00:37:10.396 --> 00:37:11.386
image in our example.

00:37:11.666 --> 00:37:14.466
And, start accessing it.

00:37:14.466 --> 00:37:16.316
As you can see here, the cloud

00:37:16.316 --> 00:37:17.726
service that is hosting this

00:37:17.726 --> 00:37:19.706
document, as well as other apps

00:37:20.046 --> 00:37:21.606
also can access this document,

00:37:21.746 --> 00:37:23.716
and sometimes concurrently with

00:37:23.716 --> 00:37:24.966
your app.

00:37:25.236 --> 00:37:26.746
What we need here is a

00:37:26.746 --> 00:37:29.046
system-wide mechanism to make

00:37:29.046 --> 00:37:30.396
sure that access to this

00:37:30.396 --> 00:37:32.166
document is always coordinated,

00:37:32.656 --> 00:37:34.326
so that processes don't go

00:37:34.326 --> 00:37:35.666
stepping on each other's feet,

00:37:36.076 --> 00:37:38.236
accessing, reading, and writing

00:37:38.236 --> 00:37:39.466
to this document.

00:37:40.916 --> 00:37:43.806
On iOS, this mechanism is called

00:37:43.986 --> 00:37:46.076
file coordination, and it is

00:37:46.076 --> 00:37:47.276
exposed via the

00:37:47.456 --> 00:37:48.956
NSFileCoordinator and

00:37:49.046 --> 00:37:50.486
NSFilePresenter API's.

00:37:51.616 --> 00:37:53.316
It acts as a system-wide

00:37:53.486 --> 00:37:55.166
multiple reader/single writer

00:37:55.166 --> 00:37:58.546
lock, and it's also the way for

00:37:58.546 --> 00:38:00.506
your app to instruct the system

00:38:00.586 --> 00:38:02.576
to download this document if

00:38:02.576 --> 00:38:03.886
it's not available locally.

00:38:04.146 --> 00:38:05.856
Because as you may know, a lot

00:38:05.856 --> 00:38:07.306
of these documents could be in

00:38:07.306 --> 00:38:08.606
the cloud, and not on the

00:38:08.606 --> 00:38:09.136
device.

00:38:10.896 --> 00:38:12.566
So, you might find yourself

00:38:12.566 --> 00:38:14.496
writing a lot of boilerplate and

00:38:14.496 --> 00:38:16.056
error-prone code to handle

00:38:16.056 --> 00:38:17.896
sandboxing, to handle file

00:38:17.896 --> 00:38:18.756
coordination.

00:38:19.846 --> 00:38:21.556
If you're simply interested in

00:38:21.976 --> 00:38:23.456
displaying and editing your

00:38:23.456 --> 00:38:25.456
documents, the solution is much

00:38:25.456 --> 00:38:25.936
simpler.

00:38:26.176 --> 00:38:27.986
And, on iOS, it comes in the

00:38:27.986 --> 00:38:29.376
form of UIDocument.

00:38:30.346 --> 00:38:32.006
UIDocument has been available

00:38:32.006 --> 00:38:32.956
since iOS 5.

00:38:33.946 --> 00:38:36.016
It is the recommended way for

00:38:36.016 --> 00:38:37.576
your app to display and edit

00:38:37.576 --> 00:38:38.246
documents.

00:38:39.256 --> 00:38:40.946
It handles sandboxing for you,

00:38:41.256 --> 00:38:42.666
so there's no need to make the

00:38:42.666 --> 00:38:44.466
start- and stopAccessing calls.

00:38:45.336 --> 00:38:46.696
And, it handles file

00:38:46.696 --> 00:38:47.736
coordination for you.

00:38:47.986 --> 00:38:49.246
So, there's no need for you to

00:38:49.286 --> 00:38:50.896
manually coordinate access to

00:38:50.896 --> 00:38:51.706
these documents.

00:38:53.256 --> 00:38:55.646
For more information on file

00:38:55.646 --> 00:38:58.186
coordination and UIDocument, we

00:38:58.186 --> 00:38:59.386
invite you to check out the

00:38:59.386 --> 00:39:02.176
"Building Document-Based Apps"

00:39:02.176 --> 00:39:06.056
session from WWDC 2015, which

00:39:06.056 --> 00:39:07.626
covers these topics in great

00:39:09.376 --> 00:39:09.526
detail.

00:39:10.036 --> 00:39:11.976
Alright. We can now access our

00:39:11.976 --> 00:39:13.466
documents, and we are sure to

00:39:13.466 --> 00:39:14.696
read and write to them in a

00:39:14.696 --> 00:39:15.586
consistent state.

00:39:16.446 --> 00:39:18.026
We can edit our particle system.

00:39:18.316 --> 00:39:19.526
And now, what we're going to do

00:39:19.526 --> 00:39:21.106
is just switch apps for just a

00:39:21.106 --> 00:39:22.716
second, check out the WWDC

00:39:22.716 --> 00:39:24.646
webpage, and just jump back to

00:39:24.646 --> 00:39:25.566
our app.

00:39:26.136 --> 00:39:28.526
Hmm. As you can see here, we

00:39:28.526 --> 00:39:30.236
were in the editor, but now we

00:39:30.236 --> 00:39:31.576
went back to the browser.

00:39:32.366 --> 00:39:34.016
Your customer always expects to

00:39:34.016 --> 00:39:35.576
be brought back to where they

00:39:35.576 --> 00:39:37.416
were when they were using your

00:39:38.656 --> 00:39:38.726
app.

00:39:39.076 --> 00:39:40.426
Let's try to understand what

00:39:40.426 --> 00:39:41.726
happened in our previous

00:39:41.726 --> 00:39:42.166
example.

00:39:42.976 --> 00:39:45.186
Here's a diagram of our app's

00:39:45.186 --> 00:39:45.796
lifecycle.

00:39:47.196 --> 00:39:48.586
We started off in the foreground

00:39:48.846 --> 00:39:49.946
while we were editing the app

00:39:49.946 --> 00:39:52.436
particle system, and we then

00:39:52.806 --> 00:39:54.286
were taken to the background

00:39:54.466 --> 00:39:56.726
when we used the App Switcher to

00:39:56.846 --> 00:39:57.726
switch to Safari.

00:39:59.096 --> 00:40:00.816
The system suspended our app

00:40:00.816 --> 00:40:01.906
while it was in the background.

00:40:02.716 --> 00:40:04.486
It turns out that at the time,

00:40:04.716 --> 00:40:06.236
our system was under some memory

00:40:06.236 --> 00:40:08.126
pressure, and so the system

00:40:08.586 --> 00:40:09.566
terminated our app.

00:40:10.776 --> 00:40:12.866
When we used the App Switcher to

00:40:12.866 --> 00:40:14.866
switch back to our app, our app

00:40:14.866 --> 00:40:15.546
was relaunched.

00:40:16.246 --> 00:40:18.046
What we failed to do here was

00:40:18.046 --> 00:40:19.176
restore the UI state.

00:40:19.726 --> 00:40:21.196
And, that time was a good time

00:40:21.196 --> 00:40:22.956
to restore the UI state, to

00:40:22.956 --> 00:40:24.386
bring back our customer to where

00:40:24.386 --> 00:40:24.736
they were.

00:40:26.206 --> 00:40:28.116
So, how do we implement state

00:40:28.116 --> 00:40:28.736
restoration?

00:40:29.136 --> 00:40:31.266
A simple and easy way would be

00:40:31.266 --> 00:40:32.686
to persist the URL we've

00:40:32.726 --> 00:40:34.146
received from the Document

00:40:34.146 --> 00:40:35.726
Browser, or the Document Picker,

00:40:36.166 --> 00:40:37.856
and restore it at app relaunch.

00:40:39.246 --> 00:40:40.846
That wouldn't work though, for

00:40:40.846 --> 00:40:41.586
two reasons.

00:40:42.236 --> 00:40:44.856
First, the document that the URL

00:40:44.926 --> 00:40:46.726
points to could have been moved

00:40:46.726 --> 00:40:47.306
or renamed.

00:40:47.586 --> 00:40:48.826
And so, we'd end up with a

00:40:48.826 --> 00:40:50.406
broken link at app relaunch.

00:40:51.266 --> 00:40:53.286
And second, the security scoped

00:40:53.286 --> 00:40:55.436
resource that is attached to our

00:40:55.436 --> 00:40:58.436
URL is not encoded when that URL

00:40:58.436 --> 00:40:59.166
is persistent.

00:40:59.866 --> 00:41:01.446
And so, when we relaunch our

00:41:01.446 --> 00:41:03.886
app, we again lose access to

00:41:03.886 --> 00:41:05.986
this document, even if that

00:41:05.986 --> 00:41:07.216
document wasn't moved or

00:41:07.216 --> 00:41:07.646
renamed.

00:41:08.076 --> 00:41:12.026
The correct solution is to use a

00:41:12.026 --> 00:41:13.886
security scoped bookmark, that

00:41:13.886 --> 00:41:15.176
we get from our URL.

00:41:15.556 --> 00:41:17.376
And, as you can see, the

00:41:17.376 --> 00:41:18.886
bookmark correctly references

00:41:18.886 --> 00:41:20.906
the document, even if it has

00:41:20.906 --> 00:41:21.966
been moved or renamed.

00:41:27.316 --> 00:41:29.206
To save the security scoped

00:41:29.206 --> 00:41:31.326
bookmark, we must first get it

00:41:31.326 --> 00:41:33.166
from the URL, using the

00:41:33.166 --> 00:41:35.356
bookmarkData API on the URL.

00:41:35.676 --> 00:41:37.226
And, we will then persist it to

00:41:37.226 --> 00:41:37.566
disk.

00:41:38.636 --> 00:41:40.596
Once our app is relaunched, we

00:41:40.596 --> 00:41:42.386
can restore the original URL

00:41:42.736 --> 00:41:44.516
using the URL resulting

00:41:44.516 --> 00:41:47.546
bookmarkData call.

00:41:47.746 --> 00:41:49.636
Alright. Now that we have all

00:41:49.636 --> 00:41:51.036
the ingredients to save and

00:41:51.036 --> 00:41:53.076
restore UI state, let's jump to

00:41:53.076 --> 00:41:53.776
a quick demo to see it in

00:41:53.776 --> 00:41:53.926
action.

00:42:02.046 --> 00:42:04.296
So, here we are in the

00:42:04.366 --> 00:42:07.266
simulator, running the Particles

00:42:07.266 --> 00:42:08.736
app as seen previously.

00:42:10.286 --> 00:42:11.556
And, what we're going to do is

00:42:11.556 --> 00:42:12.506
just take our app to the

00:42:12.506 --> 00:42:13.056
background.

00:42:13.546 --> 00:42:14.606
And now, we are going to

00:42:14.606 --> 00:42:15.966
simulate the fact that the

00:42:15.966 --> 00:42:17.596
system is killing our app, by

00:42:17.636 --> 00:42:18.976
killing it in Xcode.

00:42:23.056 --> 00:42:25.596
If we launch our app again, we

00:42:25.596 --> 00:42:26.886
see that we jump back to the

00:42:26.886 --> 00:42:27.336
browser.

00:42:28.086 --> 00:42:29.276
So, now what we're going to do

00:42:29.276 --> 00:42:31.646
is implement state preservation

00:42:31.686 --> 00:42:33.336
and restoration, to be able to

00:42:33.336 --> 00:42:34.456
jump back to where we were.

00:42:35.776 --> 00:42:37.536
So, I'll move to Xcode.

00:42:38.086 --> 00:42:39.716
First of all, in our app

00:42:39.716 --> 00:42:41.096
delegate, we'll declare to our

00:42:41.096 --> 00:42:42.546
app that we're interested in

00:42:42.546 --> 00:42:44.056
state preservation, and then

00:42:44.056 --> 00:42:44.706
restoration.

00:42:45.206 --> 00:42:48.936
And, to do that we first return

00:42:48.936 --> 00:42:49.946
"true" in application

00:42:49.946 --> 00:42:51.746
shouldSaveApplicationState.

00:42:52.466 --> 00:42:53.706
And also, return "true" in

00:42:53.706 --> 00:42:54.306
application

00:42:54.306 --> 00:42:55.896
shouldRestoreApplicationState.

00:42:57.716 --> 00:42:59.536
Second, we'll go to our

00:42:59.536 --> 00:43:01.406
storyboard, and give our

00:43:01.406 --> 00:43:02.886
DocumentBrowserViewController

00:43:02.886 --> 00:43:05.296
subclass a restoration ID, so

00:43:05.296 --> 00:43:08.516
that the system restores this

00:43:08.516 --> 00:43:08.926
object.

00:43:09.846 --> 00:43:11.366
And in this example, we'll

00:43:11.366 --> 00:43:16.306
simply use the storyboard ID.

00:43:16.566 --> 00:43:18.326
Next, we're going to implement

00:43:18.376 --> 00:43:19.716
state preservation and

00:43:19.716 --> 00:43:21.256
restoration in this

00:43:21.256 --> 00:43:22.726
documentBrowserViewController

00:43:22.726 --> 00:43:23.316
subclass.

00:43:25.996 --> 00:43:28.236
So, first I start by

00:43:28.236 --> 00:43:28.846
implementing

00:43:28.846 --> 00:43:30.166
encodeRestorableState.

00:43:31.436 --> 00:43:35.036
We get the editorViewController,

00:43:35.086 --> 00:43:36.856
if it exists, and get the

00:43:36.856 --> 00:43:39.366
document URL from it.

00:43:39.736 --> 00:43:40.716
Once we have that URL-- I'm

00:43:40.716 --> 00:43:42.856
going to make this a bit bigger.

00:43:43.376 --> 00:43:45.976
Once we have this URL, we start

00:43:45.976 --> 00:43:47.276
accessing it to extend our

00:43:47.276 --> 00:43:49.176
Sandbox as described previously.

00:43:50.626 --> 00:43:52.596
And, the defer block, we stop

00:43:52.596 --> 00:43:58.306
accessing once we are done using

00:43:58.816 --> 00:43:58.886
it.

00:43:59.836 --> 00:44:01.606
If we can start accessing this

00:44:01.606 --> 00:44:04.826
document, we simply create a

00:44:04.826 --> 00:44:06.666
bookmarkData block from this

00:44:06.666 --> 00:44:08.076
document, and encode it.

00:44:08.576 --> 00:44:11.986
And, finally, we don't forget to

00:44:11.986 --> 00:44:12.556
call super.

00:44:13.816 --> 00:44:16.116
Alright. Now that we know how to

00:44:16.116 --> 00:44:17.506
encode our restorable state,

00:44:17.846 --> 00:44:19.926
we'll implement restorable state

00:44:19.926 --> 00:44:20.486
decoding.

00:44:21.146 --> 00:44:23.366
And, to do this, we start

00:44:23.366 --> 00:44:23.916
implementing

00:44:23.916 --> 00:44:25.126
decodeRestorableState.

00:44:25.686 --> 00:44:27.266
And, we'll do the inverse steps.

00:44:28.036 --> 00:44:29.506
So, first we get the

00:44:29.506 --> 00:44:30.896
bookmarkData from the coder.

00:44:31.526 --> 00:44:34.396
And, if it exists, create that

00:44:34.396 --> 00:44:36.166
document URL using the URL

00:44:36.166 --> 00:44:38.346
resolvingBookmarkData call.

00:44:38.886 --> 00:44:42.556
And, we simply present the

00:44:42.556 --> 00:44:45.506
document at that URL.

00:44:45.506 --> 00:44:47.956
And, last but not least, we

00:44:47.956 --> 00:44:49.106
don't forget to call super.

00:44:50.496 --> 00:44:51.916
Alright. So, let's run our app.

00:44:57.646 --> 00:44:59.156
And so, our app will now be

00:44:59.156 --> 00:45:00.686
launched in the simulator.

00:45:02.116 --> 00:45:03.916
As you can see, we can start

00:45:04.786 --> 00:45:05.726
using our document.

00:45:06.616 --> 00:45:08.586
And, again, going to take our

00:45:08.586 --> 00:45:09.556
app to the background.

00:45:09.886 --> 00:45:11.676
Simulate the system killing our

00:45:11.676 --> 00:45:11.886
app.

00:45:16.156 --> 00:45:18.186
And, we're going to relaunch our

00:45:18.886 --> 00:45:19.926
app, and as you can see here,

00:45:20.246 --> 00:45:20.976
we're back to our editor.

00:45:21.516 --> 00:45:28.546
[ Applause ]

00:45:29.046 --> 00:45:31.046
Awesome. We can now access

00:45:31.046 --> 00:45:32.936
documents, read and write to

00:45:32.936 --> 00:45:34.306
them without risking data

00:45:34.306 --> 00:45:36.336
corruption, and we can now even

00:45:36.336 --> 00:45:37.776
restore state and bring our

00:45:37.776 --> 00:45:39.406
customer back to where they were

00:45:39.716 --> 00:45:40.886
when they were using our app.

00:45:41.386 --> 00:45:42.896
Even if our app was killed in

00:45:43.696 --> 00:45:44.946
the background.

00:45:45.286 --> 00:45:47.246
So, if you open the files up,

00:45:47.706 --> 00:45:48.936
and we tap on Share in the

00:45:48.936 --> 00:45:50.956
callout menu, on documents that

00:45:50.956 --> 00:45:52.976
your app can handle, you notice

00:45:52.976 --> 00:45:54.636
that our app is now available in

00:45:54.636 --> 00:45:55.136
the Share sheet.

00:45:56.096 --> 00:45:58.726
However, it says "Copy to"

00:45:58.906 --> 00:45:59.926
instead of "Open in."

00:46:00.856 --> 00:46:03.106
What this means is as soon as we

00:46:03.106 --> 00:46:04.726
tap on our app icon in the Share

00:46:04.726 --> 00:46:06.456
sheet, the system will make a

00:46:06.456 --> 00:46:09.096
copy of this document, and serve

00:46:09.096 --> 00:46:10.986
this copy to our app.

00:46:10.986 --> 00:46:12.596
And, practically this means that

00:46:12.596 --> 00:46:14.326
the customer would start editing

00:46:14.326 --> 00:46:15.616
a copy of the document.

00:46:17.096 --> 00:46:19.056
To allow your customers to open

00:46:19.056 --> 00:46:20.816
and edit the original document

00:46:21.756 --> 00:46:23.696
that we wish to access in your

00:46:23.696 --> 00:46:26.206
app, you need to adopt an iOS

00:46:26.206 --> 00:46:28.106
feature called Open in Place.

00:46:28.636 --> 00:46:32.066
If you do adopt Open in Place,

00:46:32.456 --> 00:46:34.276
you see the "Open in" your app

00:46:34.536 --> 00:46:35.856
in the Share sheet, instead of

00:46:35.856 --> 00:46:38.576
the previous "Copy to."

00:46:38.826 --> 00:46:40.676
Adopting Open in Place is very

00:46:40.676 --> 00:46:41.076
simple.

00:46:41.816 --> 00:46:43.676
If you use the document-based

00:46:43.676 --> 00:46:45.586
app Xcode template, you'll get

00:46:45.586 --> 00:46:47.656
this behavior for free, as Open

00:46:47.656 --> 00:46:49.286
in Place is already enabled by

00:46:49.286 --> 00:46:49.856
default there.

00:46:50.876 --> 00:46:52.676
Otherwise, you'll need to add

00:46:52.756 --> 00:46:52.966
the

00:46:52.966 --> 00:46:55.026
LSSupportsOpeningDocumentInPlace

00:46:55.026 --> 00:46:57.756
to your info.plist.

00:46:57.756 --> 00:46:58.806
Once you've declared to the

00:46:58.806 --> 00:47:00.956
system that your app handles

00:47:00.956 --> 00:47:03.056
Open in Place, we must access

00:47:03.056 --> 00:47:05.076
the document in the following UI

00:47:05.076 --> 00:47:06.356
application delegate method.

00:47:08.076 --> 00:47:09.876
Again, if your app is document

00:47:09.876 --> 00:47:12.996
browser-based, typically in this

00:47:12.996 --> 00:47:14.646
method, you make the

00:47:14.646 --> 00:47:16.646
revealDocument call on the

00:47:16.646 --> 00:47:18.166
documentBrowserViewController.

00:47:19.376 --> 00:47:21.016
Once the completion handler is

00:47:21.016 --> 00:47:22.596
called in this method, you

00:47:22.596 --> 00:47:23.686
present the document in the

00:47:23.686 --> 00:47:24.476
completion handler.

00:47:25.126 --> 00:47:26.926
This is already done for you in

00:47:26.926 --> 00:47:27.676
the Xcode template.

00:47:28.016 --> 00:47:31.246
We can now tap on our app icon

00:47:31.466 --> 00:47:32.806
in the Share sheet, and go

00:47:32.806 --> 00:47:34.506
straight to our app.

00:47:34.506 --> 00:47:36.176
As you see here, we report

00:47:36.246 --> 00:47:38.266
progress in the UI, since the

00:47:38.266 --> 00:47:41.116
document could be in the cloud.

00:47:41.276 --> 00:47:42.866
And, since that download could

00:47:42.866 --> 00:47:44.926
take awhile, we also support

00:47:44.926 --> 00:47:46.626
user cancellation, so we can

00:47:46.666 --> 00:47:48.096
cancel opening this document,

00:47:48.096 --> 00:47:51.116
and jump back to the browser.

00:47:51.596 --> 00:47:52.946
Here's how you can implement

00:47:52.996 --> 00:47:56.186
progress supporting in your app.

00:47:56.456 --> 00:47:57.216
If you call the

00:47:57.216 --> 00:47:58.666
documentBrowserViewController

00:47:58.666 --> 00:48:00.896
revealDocument API that's been

00:48:00.896 --> 00:48:02.736
described previously, you get

00:48:02.736 --> 00:48:03.886
that UI for free.

00:48:04.216 --> 00:48:06.436
So, you'll see a loading UI on

00:48:06.526 --> 00:48:08.426
top of the icon in the browser.

00:48:09.556 --> 00:48:11.646
Otherwise, you may opt to

00:48:11.646 --> 00:48:13.366
display your own progress UI.

00:48:14.336 --> 00:48:16.376
If your app uses UIDocument, you

00:48:16.376 --> 00:48:17.906
should know that UIDocument

00:48:18.256 --> 00:48:20.116
conforms to progressReporting.

00:48:20.876 --> 00:48:22.506
And so, to display your own

00:48:22.506 --> 00:48:24.796
progress UI, you simply access

00:48:24.796 --> 00:48:26.786
the progress property to display

00:48:26.786 --> 00:48:30.326
your own progress.

00:48:30.706 --> 00:48:32.306
Alright. Our app is now awesome.

00:48:32.416 --> 00:48:34.056
And, we're finally ready to ship

00:48:36.496 --> 00:48:36.566
it.

00:48:36.846 --> 00:48:38.946
So, what's the takeaway today to

00:48:38.946 --> 00:48:41.126
make your apps excellent at

00:48:41.126 --> 00:48:43.466
managing documents on iOS?

00:48:45.036 --> 00:48:47.636
Adopt UIDocument when displaying

00:48:47.636 --> 00:48:49.396
and editing documents, as it

00:48:49.536 --> 00:48:51.396
eliminates a lot of boilerplate

00:48:51.396 --> 00:48:52.436
and error-prone code.

00:48:54.786 --> 00:48:56.276
However, if you already have

00:48:56.346 --> 00:48:57.586
document editing code that

00:48:57.586 --> 00:48:59.866
doesn't use UIDocument, adopt

00:48:59.866 --> 00:49:01.436
the start- and stopAccessing

00:49:01.436 --> 00:49:03.696
best practices to make sure that

00:49:03.696 --> 00:49:05.036
you interact successfully with

00:49:05.036 --> 00:49:07.726
Sandbox documents, or Sandbox--

00:49:08.356 --> 00:49:09.576
with the app Sandbox.

00:49:11.096 --> 00:49:13.456
And also, coordinate accesses to

00:49:13.456 --> 00:49:15.346
your documents to make sure that

00:49:15.346 --> 00:49:17.016
you read and write to them in a

00:49:17.016 --> 00:49:19.656
consistent state.

00:49:19.826 --> 00:49:21.476
Implement state restoration to

00:49:21.476 --> 00:49:22.986
always bring back your customer

00:49:22.986 --> 00:49:24.396
to where they were, when they

00:49:24.396 --> 00:49:26.186
were using your app, even if

00:49:26.186 --> 00:49:28.096
your app is killed in the

00:49:28.716 --> 00:49:29.086
background.

00:49:29.086 --> 00:49:31.166
Adopt Open in Place, so that

00:49:31.306 --> 00:49:32.876
your customer always edits the

00:49:32.876 --> 00:49:34.926
original document, and doesn't

00:49:34.926 --> 00:49:37.366
need to start editing copies of

00:49:37.366 --> 00:49:37.986
that document.

00:49:39.046 --> 00:49:40.346
And, also report progress,

00:49:40.466 --> 00:49:42.226
especially in a world where most

00:49:42.226 --> 00:49:43.356
of these documents could be in

00:49:43.356 --> 00:49:44.726
the cloud, and not available

00:49:44.726 --> 00:49:45.116
locally.

00:49:46.816 --> 00:49:49.136
So, what did we cover today?

00:49:49.936 --> 00:49:51.996
We have shown you how easy it is

00:49:52.116 --> 00:49:53.866
to adopt the Document Browser

00:49:53.866 --> 00:49:55.116
and Document Picker API's.

00:49:55.686 --> 00:49:58.006
Give them a try in your app

00:49:58.696 --> 00:49:58.836
today.

00:49:59.016 --> 00:50:02.026
We learned about best practices

00:50:02.166 --> 00:50:03.486
so that our apps become

00:50:03.486 --> 00:50:05.266
excellent at managing documents,

00:50:06.326 --> 00:50:09.296
and for you cloud vendors, we

00:50:09.296 --> 00:50:10.406
talked about the new Siri

00:50:10.406 --> 00:50:12.456
shortcuts, and how they allow

00:50:12.456 --> 00:50:15.276
your app-- sorry, your documents

00:50:15.686 --> 00:50:17.866
that are frequently accessed to

00:50:17.866 --> 00:50:18.946
be available throughout the

00:50:18.946 --> 00:50:20.296
system for your customers.

00:50:20.816 --> 00:50:23.486
And, we talked about the

00:50:23.486 --> 00:50:25.206
fileProvider validation tool,

00:50:26.466 --> 00:50:28.296
and gave guidelines on how to

00:50:28.296 --> 00:50:29.616
implement an effective

00:50:29.616 --> 00:50:31.016
authentication flow in your

00:50:31.016 --> 00:50:32.736
fileProviderUI extensions.

00:50:34.126 --> 00:50:36.056
For more information about this

00:50:36.056 --> 00:50:37.656
session, check out the session

00:50:37.656 --> 00:50:39.356
webpage at the following URL.

00:50:40.016 --> 00:50:41.606
Also make sure to check out this

00:50:41.606 --> 00:50:42.956
year's "Introduction to Siri

00:50:42.956 --> 00:50:43.826
Shortcuts" session.

00:50:44.386 --> 00:50:45.606
Thank you for your time.

00:50:45.946 --> 00:50:47.436
Have a great afternoon, and see

00:50:47.436 --> 00:50:47.796
you at the labs.

00:50:47.796 --> 00:50:47.976
Thank you.

00:50:48.516 --> 00:50:51.500
[ Applause ]