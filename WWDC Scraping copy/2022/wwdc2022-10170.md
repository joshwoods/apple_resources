# Wwdc2022 10170

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Transcript

Code

Implement App Shortcuts with App IntentsDiscover how you can create Shortcuts in your app with zero user setup. We'll show you how App Intents can help you present custom Shortcuts views, and explore how you can add support for parameterized phrases to allow people to quickly express their intent. We'll also share how you can make your App Shortcuts discoverable with a Siri Tip, and Shortcuts links.

To get the most out of this session, we recommend a basic familiarity with SwiftUI.ResourcesApp IntentsHD VideoSD VideoRelated VideosTech TalksMigrate custom intents to App IntentsWhat's new for enterprise developersWWDC22Design App ShortcutsDive into App Intents

Discover how you can create Shortcuts in your app with zero user setup. We'll show you how App Intents can help you present custom Shortcuts views, and explore how you can add support for parameterized phrases to allow people to quickly express their intent. We'll also share how you can make your App Shortcuts discoverable with a Siri Tip, and Shortcuts links.

To get the most out of this session, we recommend a basic familiarity with SwiftUI.

App Intents

HD VideoSD Video

HD Video

SD Video

Migrate custom intents to App Intents

What's new for enterprise developers

Design App Shortcuts

Dive into App Intents

Search this video…♪ (Mellow instrumental hip-hop music) ♪♪Hi, my name is Michael Sumner.I'm a software engineer working on Siri and App Intents.In this session, I want to talk to youabout creating app shortcuts for your app,using the new App Intents framework.I'll start with an overview of what App Shortcuts areand how they relate to App Intents.Then, I'll walk through creating an app shortcut in Swift,and adding a parameter.Finally, I'll cover how to make your app shortcut discoverable,so users can benefit from your hard work.Let's get started with the App Intents frameworkand App Shortcuts.People use shortcuts to create multistep workflowswith your apps that can be used from the Shortcuts appand from Siri.Until now, someone first had to set up a shortcutvia an Add to Siri button or the Shortcuts appbefore they could use your intent.We're excited to introduce App Shortcuts,which require zero user setup.This makes it easier than ever for people to benefitfrom your shortcuts.By integrating with App Shortcuts,intents from your app will be availableas soon as your app is installed.This makes it easy for someone to discover and useyour app's functionality.They no longer need to head to the Shortcuts appor use an Add to Siri button to set anything up.App Shortcuts, like user-built shortcuts,can be run from the Shortcuts app,Spotlight, and Siri.This gives people multiple ways to discover and interactwith your application from various places in the system.For example, when searching in Spotlight,your app shortcut will be displayedright in the search results for easy access.By implementing App Shortcuts,your users will be able to interact with your app in quick,lightweight interactions that make it easier for themto complete their task and be on their way.My team is working on an app -- Meditation --that helps users meditate by guiding themthrough a set of audio prompts and soundsto help them focus on what matters.Today, to start a meditation, users have to launch the app,log in, and find the meditation session that they want to run.By integrating with App Shortcuts,my users can quickly access these features from anywherejust by asking Siri.And by making it faster to start a session,users can integrate meditation into their daily routine,either in the morning before workor in the evening to help wind down after a long day.Alright, let's dive right in to the code neededto create an App Intent and turn it into an app shortcut.Unlike previous shortcuts,App Shortcuts are built with the new App Intents framework.App Intents is a new, Swift-only frameworkbuilt from the ground up to make it fasterand easier to build great intents.With App Intents, everything is definedright in your Swift source code,instead of a separate metadata file.This removes any code generation stepsand allows you to stay focused without switching contextsbetween the source editor and the metadata editor.They're also easier to code reviewand solve merge conflicts.To build App Shortcuts,you'll need to write an AppShortcutsProviderthat lists the phrases and other metadata neededto turn your App Intent into a full-fledged shortcut.And note that because these are set upwithout any user interaction, you'll need to includeyour application's name in the trigger phrase.Intents are defined as Swift structs,that implement the AppIntent protocol.A basic intent has just two requirements --a title, which is used to display your intentin the Shortcuts app, and a method called perform.The perform method is where you run your intent's logicand return a result.Additionally, you can trigger prompts for the userand await their response.In this intent, I'll start the default meditation sessionusing my app's MeditationService.Because the perform method is async,I can run asynchronous code to start my session.Once the session has started,I'll return a dialog that is shown to the user.And if your app is localized,you'll want to localize this string in all of your locales.So far, with what I've built,the StartMeditationIntent will appear in the Shortcuts appwhen authoring a shortcut.A motivated user can take this intentand create a shortcut that will kick off a session.In this shortcut,I've also added a second intent to enable a Focus.By default, my App Intent is rendered using the titleI specified in my source code.To customize the rendering for your action,be sure to add a parameter summary to your App Intent.Parameter summaries allow you to customizethe look of your intent, as well as show values inline.However, this intent works great as a shortcut all by itself.Ideally, someone would be able to run my intentwithout first having to author a shortcut at all.By creating an app shortcut,I can perform this setup step on behalf of the user,so they can start using my intentas soon as the app is installed.Now that I've written an intent,I'll create an app shortcut for it.Similar to an intent,App Shortcuts are defined in Swift code,by implementing the AppShortcutsProvider protocol.To implement the protocol,I'll simply create a single getter that returnsall the app shortcuts I want to set up for the user.Note that in total, your app can have a maximumof 10 app shortcuts.However, most apps only need a few.So I'll create a single AppShortcutfor my StartMeditationIntent.To get started, I'll pass an instance of my intent.If my intent's initializer took parameters,I could specify values here.Second, I'll create an array of spoken phrasesthat will invoke my AppShortcut from Siri.You'll notice that rather than writing my application's namedirectly in the string,I used a special .applicationName token.This allows Siri to insert not only my application's main name,but also any app name synonyms that I've configured.Because users may say different phrases to start meditation,I'll provide a few more alternative phrases here.If your app is localized,you'll need to localize these phrases as well.Great. So now when someone wants to mediate,they just stay to Siri, "Start a meditation."Siri will call the StartMeditationIntentand speak the dialog that I returned.Also, if someone searches for my app in Spotlight,they'll see the first App Shortcut I've listedin my code.When the user taps the result,the shortcut will immediately runwithout launching the application.It's important to note that if your intentdoes trigger an app launch, it won't be shown in Spotlight.So, with just a very small amount of code,I've now made it much, much simpler for my usersto meditate with my app.But right now, Siri shows a default viewwhenever running my intent.This is OK, but I'd really like to show the usermore information when they run my app shortcut.To do this, I'll need to implement a custom viewthat Siri can show whenever my intent is run.Views in the App Intents framework are builtusing SwiftUI and leverage the same view technology as widgets.This means you, as a developer, don't need to builda separate UI extension for your custom view.Instead, you can simply return the viewwhen running your intent.It's important to think about the specific constraintsthis brings for your views.Just like widgets, custom App Intent viewscan't include things like interactivity or animations.Make sure to take this into account when designing your UI.App Intents supports showing custom UI at three phases:value confirmation, intent confirmation,and after the intent is finished.For my app, I'm going to return a custom viewat the end of running my intent.If you're using these other prompts,be sure to think about how you can integrate custom UIat those steps too.Finally, as I mentioned, displaying custom UI is easy.You simply need to return your view from your intent.Alright, time to jump into some code.Adding a custom view is easy.As I mentioned, I'll just return the view alongside my dialog.The App Intents framework will take careof presenting my view inside the Siri snippet.Keep in mind that your views are going to be shownalongside other Siri views,like the snippet title or confirmation buttons.So you'll want your snippet's designto feel at home inside of Siri.Up next, let's check out how I can extend an app shortcutto include parameters.In my previous implementation,I chose to start the default meditation session.But my app includes many great session types,and users will want to start a particular sessionthey have in mind.Ideally, my user would be able to specify the sessionthey want to start when running my intent.To support these use cases,I'll need to extend my intent by adding a parameterthat captures the session the user wants to run.To add a parameter,I first need to define the parameter's type.I'll create a MeditationSession structthat has the relevant information for a session.I'll include a name,and I'll give it an identifier field,which can be a UUID.To use this struct as a parameter for my intent,I also need to implement the AppEntity protocol.Implementing the AppEntity protocoltells the App Intents framework about my typeand lets me specify additional information,like how the entity is displayed.The entity protocol requires that my type has an identifier,which I've already provided.I could use other types as well, like integers or strings.I also need to provide some informationon how to display my entity.This will be used in the Shortcuts appand other places where my entity is shown.Finally, I need to wire up a default query.I'll call my query the MeditationSessionQuery,and I'll implement it next.In order to work with my entity, the App Intents frameworkneeds to be able to look up my entitiesbased on their identifier.To make this possible,the EntityQuery protocol defines just one requirement:a function that takes identifiersand returns matching entities.I'll implement this function by looking up the sessionsin my SessionManager.Next, I'll update my StartMeditationIntentto add a parameter.Parameters are straightforward;they are just a normal property on my struct.But to tell App Intents about my parameter,I also need to add the @Parameter property wrapper.This property wrapper lets App Intents knowthat the session property is part of my intent.I can also specify additional metadatain the Parameter property wrapper, like the display name.Now that I've added a parameter to my intent,I need to ask the user which session they'd like to run.The App Intents framework has robust supportfor asking users follow-up questionsto gather values for my intent's parameters.These prompts will be displayed anywhere my intent is run.When run from Siri, Siri will speak out the questions,and ask the user to speak the answer.In Spotlight and the Shortcuts app,the user will be presented with the same promptin a touch-driven UI.App Intents supports three types of value prompts.Disambiguations asks the user to select from a fixed list.Disambiguations are great to present the userwhen you have small fixed set of optionsfor a parameter in your intent.Value prompts allow you to ask the userfor an open-ended value.These are great for types like strings or integers,which can take any value.Finally, confirmation asks the userto verify a particular value and can be helpfulif you want to double-check with the userthat you understand their intent.Prompting for values is a great way to make intentsmore flexible and allows you to gather more informationfrom the user.But they also slow down the conversation,and can frustrate users if you use them too often.For more insight into designing great intents,check out the session titled"Design App Shortcuts" from Lynn.All right, now that I've added the session parameterto the StartMeditationIntent, I'll go ahead and add logicto my perform method to prompt for this value.In my app, I have a small fixed number of sessionsthe user can run.If the session isn't already specified,I'll retrieve the list from my SessionManagerand present a disambiguation to the user.Using the display representation for each of my sessions,App Intents will format sessions into list itemsand display them to the user.When the user picks one,the selected item will be returned to me.I'll pass the selected session to my MeditationService,which will start the session.I can then return a dialog to let the user knowthat the intent has started.Since the user provided a session,it's a good idea to put the name of the sessionin the dialog so the user knows we understood their request.Great, so now when my users say, "Start a Meditation,"my app can prompt the user for the particular sessionthey want to run.However, as I mentioned before,users prefer Siri interactions that are quick and to the point.Ideally, I'd be able to let my users tell Sirithe session they'd like to run in the initial phrase,rather than in a follow-up question.Well, I have good news.App Shortcuts has support for extending trigger phraseswith predefined parameters.By implementing parameterized phrases,my app can support utterances like"Start a calming meditation" or "Start a walking meditation."Parameters are great when you havea fixed set of well-known parameter valuesthat you can specify to Siri ahead of time.For my app, I'll use my session names.Parameters are not meant for open-ended values.For example, it's not possible to gather an arbitrary stringfrom the user in the initial utterance.So, my app couldn't support a phraselike "Search my diary for X,"where X could be any input from the user.Instead, parameter values are specified ahead of time,when your app is running.Let's implement some parameterized phrases.To implement parameterized phrases in my app,I need to make a few changes.First, I'll update the query for my SessionEntityto implement the suggestedResults() methodto return the list of entities for my parameterized shortcut.Second, I'll need to notify the App Intents frameworkwhen the list of available SessionEntities has changed.This allows the App Intents frameworkto create new shortcut phrases for use in Siri.I'll do this by updating my app's model layerto notify the App Intents frameworkwhenever my session list changes.Finally, I'll add some new phrases to my App Shortcutthat reference the session parameteron my StartMeditationIntent.So first, I'll update the MeditationSessionQueryby implementing the suggestedEntities function.The App Intents framework uses the sessionsreturned from this function to create parameterized shortcuts.It's important to note that while this method is optional,if I don't implement this method,I won't get any parameterized shortcuts at all.Second, I'll need to update my app's model layerto notify the App Intents frameworkwhenever my list of sessions changes.In my app, I infrequently publish new session typesthat I fetch from the server in the background.I'll update my SessionModel to call theupdateAppShortcutParameters() methodany time I receive new sessions.This method is provided by the App Intents framework;you don't need to implement it yourself.When called, App Intents will invoke your entity's queryto gather the list of parameters for your shortcut phrases.Finally, I'll add new phrases for my App Shortcutthat include the session keypath on my intent.The App Intents framework will combine this phrasewith all of the sessions returned from my query.The text used for each value is pulled from the title propertyon the SessionEntity's display representation.Just like before, I'll want to includea few different ways that users might phrase my App Shortcut.This ensures a smoother experienceif the user doesn't remember your preferred phrase.All right, I now have a great, full-featured App Shortcut,and I can't wait for my users to give it a try.But in order for that to happen,I need to do some work to help users discover my new Shortcut.The first thing I want to talk about is picking great phrases.Great phrases for App Shortcuts are short and memorable.Users will have a lot of apps on their phonethat support App Shortcuts;and in practice, users can have a hard timeremembering exactly how to phrase their shortcuts.So where possible, keep your phrases short and to the point.Along these lines, if your app namecan be used as a noun or verb,consider using it that way in your phrase.In my app, I've used Meditation like a noun,so that the phrase can be short and memorable.Finally, app name synonyms can help your users immensely.If users call your appsomething other than your app's display name,you'll want to consider adding an app name synonym for it.iOS 11 added support for app name synonyms.If you haven't created one, now may be a great time to do so.The next thing I want to talk aboutis the Siri Tip and the Shortcuts link.Because App Shortcuts don't require any user setup,discoverability is vital for users to findand use your App Shortcuts.With App Shortcuts, users no longer needthe Add to Siri button to add your Shortcut.It's already added!However, we don't want to lose the discoverability benefitsthat the Add to Siri button provided.With that in mind, we've created a new Siri Tip view.This view works great anywhere you may have usedthe Add To Siri button in the past.The Tip view is available in both SwiftUI and UIKit.And we've provided a number of stylesso that the Tip looks great in any application.Siri Tips are best placed contextually,when they're relevant to the content onscreen.If a user just placed an order in your app,consider showing a Tip for your Shortcutthat provides the order status.Siri Tips should be placed thoughtfully,when you feel a user is likely to engagewith your App Shortcut in the near future.The Siri Tip also supports dismissal.The view includes a dismiss button and will triggera custom closure in your code when tapped.You'll want to remove the view from your layout,and consider not showing it againuntil you feel it's relevant.Finally, we've also included a new ShortcutsLinkthat will launch to a list of Shortcuts from your app.This new element is greatif your app has a lot of App Shortcutsand you want to let users explore all of them.Now, the great thing about App Shortcutsis they're available as soon as your app is installed.Even before the app is first launched,users can see and run your Shortcutsfrom Spotlight, Siri, and the Shortcuts app.You may need to take this into accountwhen building your App Shortcut.For example, if your app requires a log-in flow,the user may not have logged in before running your intent.Your intent should fail gracefully with an error messageexplaining to the user that they need to log in.Second, parameterized phrases for your App Shortcutswon't be available until your app has been launchedand notified the App Intents frameworkthat you have new parameter values.If your App Shortcut doesn't containany non-parameterized phrases, the user won't seeyour App Shortcut at all until they first launch your app.You may consider adding a few non-parameterized phrasesto avoid this issue.Additionally, Siri has added support for phrases like,"What can I do here?" and "What can I do with Meditation?"Siri will automatically gather and recommendany App Shortcut phrases and present them on your behalf.Your app doesn't need to do anything additionalfor this functionality to work.Finally, in both Siri and the Shortcuts app,the order your App Shortcuts are displayed is determinedby the order that you list your App Shortcutsin your source code.You'll want to consider putting your best and most usefulApp Shortcuts first, so that they get the most attention.Similarly, the first phrase you list in the phrase arraywill be considered the primary phrase for that App Shortcut.The primary phrase is used as the label on the Shortcut tile,and it's shown when the user asks Sirifor help with your app.OK, we covered a lot about App Intents frameworkand App Shortcuts.I want to leave you with two key thoughts.First, App Shortcuts make it easy for users to use your appfrom anywhere in the system, so think about the best use casesin your app that fit this more lightweight model.Second, once you've implemented an App Shortcut,users will not know about it unless you tell them!Think hard about how to make your App Shortcut discoverable.Consider places in your app where you can showthe Siri Tip, as well as off-product locations,like a website or a sign in your store.We can't wait to see all the great App Shortcutsthat you create with the new App Intents framework.To dig deeper into design,as well as the App Intents framework,be sure to check out other talks this week.Thanks, and have a great WWDC.♪

♪ (Mellow instrumental hip-hop music) ♪♪Hi, my name is Michael Sumner.I'm a software engineer working on Siri and App Intents.In this session, I want to talk to youabout creating app shortcuts for your app,using the new App Intents framework.I'll start with an overview of what App Shortcuts areand how they relate to App Intents.Then, I'll walk through creating an app shortcut in Swift,and adding a parameter.Finally, I'll cover how to make your app shortcut discoverable,so users can benefit from your hard work.Let's get started with the App Intents frameworkand App Shortcuts.People use shortcuts to create multistep workflowswith your apps that can be used from the Shortcuts appand from Siri.Until now, someone first had to set up a shortcutvia an Add to Siri button or the Shortcuts appbefore they could use your intent.We're excited to introduce App Shortcuts,which require zero user setup.This makes it easier than ever for people to benefitfrom your shortcuts.By integrating with App Shortcuts,intents from your app will be availableas soon as your app is installed.This makes it easy for someone to discover and useyour app's functionality.They no longer need to head to the Shortcuts appor use an Add to Siri button to set anything up.App Shortcuts, like user-built shortcuts,can be run from the Shortcuts app,Spotlight, and Siri.This gives people multiple ways to discover and interactwith your application from various places in the system.For example, when searching in Spotlight,your app shortcut will be displayedright in the search results for easy access.By implementing App Shortcuts,your users will be able to interact with your app in quick,lightweight interactions that make it easier for themto complete their task and be on their way.My team is working on an app -- Meditation --that helps users meditate by guiding themthrough a set of audio prompts and soundsto help them focus on what matters.Today, to start a meditation, users have to launch the app,log in, and find the meditation session that they want to run.By integrating with App Shortcuts,my users can quickly access these features from anywherejust by asking Siri.And by making it faster to start a session,users can integrate meditation into their daily routine,either in the morning before workor in the evening to help wind down after a long day.Alright, let's dive right in to the code neededto create an App Intent and turn it into an app shortcut.Unlike previous shortcuts,App Shortcuts are built with the new App Intents framework.App Intents is a new, Swift-only frameworkbuilt from the ground up to make it fasterand easier to build great intents.With App Intents, everything is definedright in your Swift source code,instead of a separate metadata file.This removes any code generation stepsand allows you to stay focused without switching contextsbetween the source editor and the metadata editor.They're also easier to code reviewand solve merge conflicts.To build App Shortcuts,you'll need to write an AppShortcutsProviderthat lists the phrases and other metadata neededto turn your App Intent into a full-fledged shortcut.And note that because these are set upwithout any user interaction, you'll need to includeyour application's name in the trigger phrase.Intents are defined as Swift structs,that implement the AppIntent protocol.A basic intent has just two requirements --a title, which is used to display your intentin the Shortcuts app, and a method called perform.The perform method is where you run your intent's logicand return a result.Additionally, you can trigger prompts for the userand await their response.In this intent, I'll start the default meditation sessionusing my app's MeditationService.Because the perform method is async,I can run asynchronous code to start my session.Once the session has started,I'll return a dialog that is shown to the user.And if your app is localized,you'll want to localize this string in all of your locales.So far, with what I've built,the StartMeditationIntent will appear in the Shortcuts appwhen authoring a shortcut.A motivated user can take this intentand create a shortcut that will kick off a session.In this shortcut,I've also added a second intent to enable a Focus.By default, my App Intent is rendered using the titleI specified in my source code.To customize the rendering for your action,be sure to add a parameter summary to your App Intent.Parameter summaries allow you to customizethe look of your intent, as well as show values inline.However, this intent works great as a shortcut all by itself.Ideally, someone would be able to run my intentwithout first having to author a shortcut at all.By creating an app shortcut,I can perform this setup step on behalf of the user,so they can start using my intentas soon as the app is installed.Now that I've written an intent,I'll create an app shortcut for it.Similar to an intent,App Shortcuts are defined in Swift code,by implementing the AppShortcutsProvider protocol.To implement the protocol,I'll simply create a single getter that returnsall the app shortcuts I want to set up for the user.Note that in total, your app can have a maximumof 10 app shortcuts.However, most apps only need a few.So I'll create a single AppShortcutfor my StartMeditationIntent.To get started, I'll pass an instance of my intent.If my intent's initializer took parameters,I could specify values here.Second, I'll create an array of spoken phrasesthat will invoke my AppShortcut from Siri.You'll notice that rather than writing my application's namedirectly in the string,I used a special .applicationName token.This allows Siri to insert not only my application's main name,but also any app name synonyms that I've configured.Because users may say different phrases to start meditation,I'll provide a few more alternative phrases here.If your app is localized,you'll need to localize these phrases as well.

Great. So now when someone wants to mediate,they just stay to Siri, "Start a meditation."Siri will call the StartMeditationIntentand speak the dialog that I returned.Also, if someone searches for my app in Spotlight,they'll see the first App Shortcut I've listedin my code.When the user taps the result,the shortcut will immediately runwithout launching the application.It's important to note that if your intentdoes trigger an app launch, it won't be shown in Spotlight.So, with just a very small amount of code,I've now made it much, much simpler for my usersto meditate with my app.But right now, Siri shows a default viewwhenever running my intent.This is OK, but I'd really like to show the usermore information when they run my app shortcut.To do this, I'll need to implement a custom viewthat Siri can show whenever my intent is run.Views in the App Intents framework are builtusing SwiftUI and leverage the same view technology as widgets.This means you, as a developer, don't need to builda separate UI extension for your custom view.Instead, you can simply return the viewwhen running your intent.It's important to think about the specific constraintsthis brings for your views.Just like widgets, custom App Intent viewscan't include things like interactivity or animations.Make sure to take this into account when designing your UI.App Intents supports showing custom UI at three phases:value confirmation, intent confirmation,and after the intent is finished.For my app, I'm going to return a custom viewat the end of running my intent.If you're using these other prompts,be sure to think about how you can integrate custom UIat those steps too.Finally, as I mentioned, displaying custom UI is easy.You simply need to return your view from your intent.Alright, time to jump into some code.Adding a custom view is easy.As I mentioned, I'll just return the view alongside my dialog.The App Intents framework will take careof presenting my view inside the Siri snippet.Keep in mind that your views are going to be shownalongside other Siri views,like the snippet title or confirmation buttons.So you'll want your snippet's designto feel at home inside of Siri.Up next, let's check out how I can extend an app shortcutto include parameters.In my previous implementation,I chose to start the default meditation session.But my app includes many great session types,and users will want to start a particular sessionthey have in mind.Ideally, my user would be able to specify the sessionthey want to start when running my intent.To support these use cases,I'll need to extend my intent by adding a parameterthat captures the session the user wants to run.To add a parameter,I first need to define the parameter's type.I'll create a MeditationSession structthat has the relevant information for a session.I'll include a name,and I'll give it an identifier field,which can be a UUID.To use this struct as a parameter for my intent,I also need to implement the AppEntity protocol.Implementing the AppEntity protocoltells the App Intents framework about my typeand lets me specify additional information,like how the entity is displayed.The entity protocol requires that my type has an identifier,which I've already provided.I could use other types as well, like integers or strings.I also need to provide some informationon how to display my entity.This will be used in the Shortcuts appand other places where my entity is shown.Finally, I need to wire up a default query.I'll call my query the MeditationSessionQuery,and I'll implement it next.In order to work with my entity, the App Intents frameworkneeds to be able to look up my entitiesbased on their identifier.To make this possible,the EntityQuery protocol defines just one requirement:a function that takes identifiersand returns matching entities.I'll implement this function by looking up the sessionsin my SessionManager.Next, I'll update my StartMeditationIntentto add a parameter.Parameters are straightforward;they are just a normal property on my struct.But to tell App Intents about my parameter,I also need to add the @Parameter property wrapper.This property wrapper lets App Intents knowthat the session property is part of my intent.I can also specify additional metadatain the Parameter property wrapper, like the display name.Now that I've added a parameter to my intent,I need to ask the user which session they'd like to run.The App Intents framework has robust supportfor asking users follow-up questionsto gather values for my intent's parameters.These prompts will be displayed anywhere my intent is run.When run from Siri, Siri will speak out the questions,and ask the user to speak the answer.In Spotlight and the Shortcuts app,the user will be presented with the same promptin a touch-driven UI.App Intents supports three types of value prompts.Disambiguations asks the user to select from a fixed list.Disambiguations are great to present the userwhen you have small fixed set of optionsfor a parameter in your intent.Value prompts allow you to ask the userfor an open-ended value.These are great for types like strings or integers,which can take any value.Finally, confirmation asks the userto verify a particular value and can be helpfulif you want to double-check with the userthat you understand their intent.Prompting for values is a great way to make intentsmore flexible and allows you to gather more informationfrom the user.But they also slow down the conversation,and can frustrate users if you use them too often.For more insight into designing great intents,check out the session titled"Design App Shortcuts" from Lynn.All right, now that I've added the session parameterto the StartMeditationIntent, I'll go ahead and add logicto my perform method to prompt for this value.In my app, I have a small fixed number of sessionsthe user can run.If the session isn't already specified,I'll retrieve the list from my SessionManagerand present a disambiguation to the user.Using the display representation for each of my sessions,App Intents will format sessions into list itemsand display them to the user.When the user picks one,the selected item will be returned to me.I'll pass the selected session to my MeditationService,which will start the session.I can then return a dialog to let the user knowthat the intent has started.Since the user provided a session,it's a good idea to put the name of the sessionin the dialog so the user knows we understood their request.Great, so now when my users say, "Start a Meditation,"my app can prompt the user for the particular sessionthey want to run.However, as I mentioned before,users prefer Siri interactions that are quick and to the point.Ideally, I'd be able to let my users tell Sirithe session they'd like to run in the initial phrase,rather than in a follow-up question.Well, I have good news.App Shortcuts has support for extending trigger phraseswith predefined parameters.By implementing parameterized phrases,my app can support utterances like"Start a calming meditation" or "Start a walking meditation."Parameters are great when you havea fixed set of well-known parameter valuesthat you can specify to Siri ahead of time.For my app, I'll use my session names.Parameters are not meant for open-ended values.For example, it's not possible to gather an arbitrary stringfrom the user in the initial utterance.So, my app couldn't support a phraselike "Search my diary for X,"where X could be any input from the user.Instead, parameter values are specified ahead of time,when your app is running.Let's implement some parameterized phrases.To implement parameterized phrases in my app,I need to make a few changes.First, I'll update the query for my SessionEntityto implement the suggestedResults() methodto return the list of entities for my parameterized shortcut.Second, I'll need to notify the App Intents frameworkwhen the list of available SessionEntities has changed.This allows the App Intents frameworkto create new shortcut phrases for use in Siri.I'll do this by updating my app's model layerto notify the App Intents frameworkwhenever my session list changes.Finally, I'll add some new phrases to my App Shortcutthat reference the session parameteron my StartMeditationIntent.So first, I'll update the MeditationSessionQueryby implementing the suggestedEntities function.The App Intents framework uses the sessionsreturned from this function to create parameterized shortcuts.It's important to note that while this method is optional,if I don't implement this method,I won't get any parameterized shortcuts at all.Second, I'll need to update my app's model layerto notify the App Intents frameworkwhenever my list of sessions changes.In my app, I infrequently publish new session typesthat I fetch from the server in the background.I'll update my SessionModel to call theupdateAppShortcutParameters() methodany time I receive new sessions.This method is provided by the App Intents framework;you don't need to implement it yourself.When called, App Intents will invoke your entity's queryto gather the list of parameters for your shortcut phrases.Finally, I'll add new phrases for my App Shortcutthat include the session keypath on my intent.The App Intents framework will combine this phrasewith all of the sessions returned from my query.The text used for each value is pulled from the title propertyon the SessionEntity's display representation.Just like before, I'll want to includea few different ways that users might phrase my App Shortcut.This ensures a smoother experienceif the user doesn't remember your preferred phrase.All right, I now have a great, full-featured App Shortcut,and I can't wait for my users to give it a try.But in order for that to happen,I need to do some work to help users discover my new Shortcut.The first thing I want to talk about is picking great phrases.Great phrases for App Shortcuts are short and memorable.Users will have a lot of apps on their phonethat support App Shortcuts;and in practice, users can have a hard timeremembering exactly how to phrase their shortcuts.So where possible, keep your phrases short and to the point.Along these lines, if your app namecan be used as a noun or verb,consider using it that way in your phrase.In my app, I've used Meditation like a noun,so that the phrase can be short and memorable.Finally, app name synonyms can help your users immensely.If users call your appsomething other than your app's display name,you'll want to consider adding an app name synonym for it.iOS 11 added support for app name synonyms.If you haven't created one, now may be a great time to do so.The next thing I want to talk aboutis the Siri Tip and the Shortcuts link.Because App Shortcuts don't require any user setup,discoverability is vital for users to findand use your App Shortcuts.With App Shortcuts, users no longer needthe Add to Siri button to add your Shortcut.It's already added!However, we don't want to lose the discoverability benefitsthat the Add to Siri button provided.With that in mind, we've created a new Siri Tip view.This view works great anywhere you may have usedthe Add To Siri button in the past.The Tip view is available in both SwiftUI and UIKit.And we've provided a number of stylesso that the Tip looks great in any application.Siri Tips are best placed contextually,when they're relevant to the content onscreen.If a user just placed an order in your app,consider showing a Tip for your Shortcutthat provides the order status.Siri Tips should be placed thoughtfully,when you feel a user is likely to engagewith your App Shortcut in the near future.The Siri Tip also supports dismissal.The view includes a dismiss button and will triggera custom closure in your code when tapped.You'll want to remove the view from your layout,and consider not showing it againuntil you feel it's relevant.Finally, we've also included a new ShortcutsLinkthat will launch to a list of Shortcuts from your app.This new element is greatif your app has a lot of App Shortcutsand you want to let users explore all of them.Now, the great thing about App Shortcutsis they're available as soon as your app is installed.Even before the app is first launched,users can see and run your Shortcutsfrom Spotlight, Siri, and the Shortcuts app.You may need to take this into accountwhen building your App Shortcut.For example, if your app requires a log-in flow,the user may not have logged in before running your intent.Your intent should fail gracefully with an error messageexplaining to the user that they need to log in.Second, parameterized phrases for your App Shortcutswon't be available until your app has been launchedand notified the App Intents frameworkthat you have new parameter values.If your App Shortcut doesn't containany non-parameterized phrases, the user won't seeyour App Shortcut at all until they first launch your app.You may consider adding a few non-parameterized phrasesto avoid this issue.Additionally, Siri has added support for phrases like,"What can I do here?" and "What can I do with Meditation?"Siri will automatically gather and recommendany App Shortcut phrases and present them on your behalf.Your app doesn't need to do anything additionalfor this functionality to work.Finally, in both Siri and the Shortcuts app,the order your App Shortcuts are displayed is determinedby the order that you list your App Shortcutsin your source code.You'll want to consider putting your best and most usefulApp Shortcuts first, so that they get the most attention.Similarly, the first phrase you list in the phrase arraywill be considered the primary phrase for that App Shortcut.The primary phrase is used as the label on the Shortcut tile,and it's shown when the user asks Sirifor help with your app.OK, we covered a lot about App Intents frameworkand App Shortcuts.I want to leave you with two key thoughts.First, App Shortcuts make it easy for users to use your appfrom anywhere in the system, so think about the best use casesin your app that fit this more lightweight model.Second, once you've implemented an App Shortcut,users will not know about it unless you tell them!Think hard about how to make your App Shortcut discoverable.Consider places in your app where you can showthe Siri Tip, as well as off-product locations,like a website or a sign in your store.We can't wait to see all the great App Shortcutsthat you create with the new App Intents framework.To dig deeper into design,as well as the App Intents framework,be sure to check out other talks this week.Thanks, and have a great WWDC.♪

3:43 -Implement an AppIntent

5:31 -Create an AppShortcutsProvider

6:35 -Provide multiple phrases

8:54 -Provide a dialog and snippet view

10:09 -Implement an AppEntity

10:55 -Query for entities

11:16 -Define a parameter

13:15 -Prompt for values

16:11 -Implement suggestedEntities()

16:34 -Update App Shortcut parameters

17:09 -Add parameterized phrases

## Code Samples

```swift
// StartMeditationIntent creates a meditation session.



import
 AppIntents


struct
 
StartMeditationIntent
: 
AppIntent
 {
    
static
 
let
 title: 
LocalizedStringResource
 
=
 
"Start Meditation Session"


    
func
 
perform
() 
async
 
throws
 -> 
some
 
IntentResult
 & 
ProvidesDialog
 {
        
await
 
MeditationService
.startDefaultSession()
        
return
 .result(dialog: 
"Okay, starting a meditation session."
)
    }
}
```

```swift
// An AppShortcut turns an Intent into a full fledged shortcut


// AppShortcuts are returned from a struct that implements the AppShortcuts


// protocol



import
 AppIntents


struct
 
MeditationShortcuts
: 
AppShortcutsProvider
 {
    
static
 
var
 appShortcuts: [
AppShortcut
] {
        
AppShortcut
(
            intent: 
StartMeditationIntent
(),
            phrases: [
"Start a 
\(.applicationName)
"
]
        )
    }
}
```

```swift
// An AppShortcut turns an Intent into a full fledged shortcut


// AppShortcuts are returned from a struct that implements the AppShortcuts


// protocol



import
 AppIntents


struct
 
MeditationShortcuts
: 
AppShortcutsProvider
 {
    
static
 
var
 appShortcuts: [
AppShortcut
] {
        
AppShortcut
(
            intent: 
StartMeditationIntent
(),
            phrases: [
                
"Start a 
\(.applicationName)
"
,
                
"Begin 
\(.applicationName)
"
,
                
"Meditate with 
\(.applicationName)
"
,
                
"Start a session with 
\(.applicationName)
"

            ]
        )
    }
}
```

```swift
// Custom views give your intent more personality


// and can convey more information



func
 
perform
() 
async
 
throws
 -> 
some
 
ProvidesDialog
 & 
ShowsSnippetView
 {
    
await
 
MeditationService
.startDefaultSession()

    
return
 .result(
        dialog: 
"Okay, starting a meditation session."
,
        view: 
MeditationSnippetView
()
    )
}
```

```swift
// An entity is a type that can be used as a parameter


// for an AppIntent.



import
 AppIntents


struct
 
MeditationSession
: 
AppEntity
 {
    
let
 id: 
UUID

    
let
 name: 
LocalizedStringResource


    
static
 
var
 typeDisplayName: 
LocalizedStringResource
 
=
 
"Meditation Session"

    
var
 displayRepresentation: 
AppIntents
.
DisplayRepresentation
 {
        
DisplayRepresentation
(title: name)
    }

    
static
 
var
 defaultQuery 
=
 
MeditationSessionQuery
()
}
```

```swift
// Queries allow the App Intents framework to


// look up your entities by their identifier



struct
 
MeditationSessionQuery
: 
EntityQuery
 {
    
func
 
entities
(
for
 
identifiers
: [
UUID
]) 
async
 
throws
 -> [
MeditationSession
] {
        
return
 identifiers.compactMap { 
SessionManager
.session(for: 
$0
) }
    }
}
```

```swift
// Adding a parameter to an intent allows you to prompt the user


// to provide a value for the parameter



struct
 
StartMeditationIntent
: 
AppIntent
 {

    
@Parameter
(title: 
"Session Type"
)
    
var
 sessionType: 
SessionType
?

    
// ...


}
```

```swift
// Prompting for values can be done by calling methods


// on the property's wrapper type.



func
 
perform
() 
async
 
throws
 -> 
some
 
ProvidesDialog
 {
    
let
 sessionToRun 
=
 
self
.session 
??
 
try
 
await
 
$session
.requestDisambiguation(
           among: 
SessionManager
.allSessions,
           dialog: 
IntentDialog
(
"What session would you like?"
)
       )
    }
    
await
 
MeditationService
.start(session: sessionToRun)
    
return
 .result(
       dialog: 
"Okay, starting a 
\(sessionToRun.name)
 meditation session."

    )
}
```

```swift
// Queries can provide suggested values for your Entity


// that serve as parameters for App Shortcuts



struct
 
MeditationSessionQuery
: 
EntityQuery
 {
    
func
 
entities
(
for
 
identifiers
: [
UUID
]) 
async
 
throws
 -> [
MeditationSession
] {
        
return
 identifiers.compactMap { 
SessionManager
.session(for: 
$0
) }
    }

    
func
 
suggestedEntities
() 
async
 
throws
 -> [
MeditationSession
] {
        
return
 
SessionManager
.allSessions
    }
}
```

```swift
// Your app must notify App Intents when your values change


// This is typically best done in your app’s model layer



class
 
SessionModel
 {
    
@Published

    
var
 sessions: [
MeditationSession
] 
=
 []
    
private
 
var
 cancellable: 
AnyCancellable
?

    
init
() {
        
self
.cancellable 
=
 
$sessions
.sink { 
_
 
in

            
MeditationShortcuts
.updateAppShortcutParameters()
        }
    }

    
// ...


}
```

```swift
// Phrases can also contain a single parameter reference



import
 AppIntents


struct
 
MeditationShortcuts
: 
AppShortcutsProvider
 {
    
static
 
var
 appShortcuts: [
AppShortcut
] {
        
AppShortcut
(
            intent: 
StartMeditationIntent
(),
            phrases: [
                
"Start a 
\(.applicationName)
"
,
                
"Begin 
\(.applicationName)
"
,
                
"Meditate with 
\(.applicationName)
"
,
                
"Start a 
\(\.
$session
)
 session with 
\(.applicationName)
"
,
                
"Begin a 
\(\.
$session
)
 session with 
\(.applicationName)
"
,
                
"Meditate on 
\(\.
$session
)
 with 
\(.applicationName)
"

            ]
        )
    }
}
```

