WEBVTT

00:00:04.100 --> 00:00:08.800
Welcome to the Darwin printing session.

00:00:08.800 --> 00:00:09.800
My name is Richard Blanchard.

00:00:09.800 --> 00:00:12.760
I am the engineering
manager for printing.

00:00:12.970 --> 00:00:16.060
I have a very brief story
for you this afternoon,

00:00:16.200 --> 00:00:18.690
but it's a really good
story and it should warm the

00:00:18.690 --> 00:00:21.090
hearts of all you optimists.

00:00:23.300 --> 00:00:25.380
Oh, there's a few of you.

00:00:25.380 --> 00:00:27.870
The story starts actually with
a definition of serendipity that

00:00:27.870 --> 00:00:29.750
I've always been very fond of.

00:00:29.910 --> 00:00:32.820
And that is serendipity is looking
for a needle in the haystack and

00:00:32.900 --> 00:00:34.940
fighting the farmer's daughter.

00:00:36.830 --> 00:00:39.680
So for us,
our needle was a printing system that

00:00:39.680 --> 00:00:43.230
we could open up and use in Darwin,
but that was also powerful

00:00:43.300 --> 00:00:45.060
enough for us to use in OS X.

00:00:46.430 --> 00:00:49.170
The Haystack we were digging through
had a lot of different options in it.

00:00:49.210 --> 00:00:52.600
We could take our OS X printing system,
open it up, bring it to Darwin.

00:00:52.650 --> 00:00:55.180
We could write a new one from scratch,
we know how to do that.

00:00:55.260 --> 00:00:58.760
Or we could take any one of
the half dozen or so existing

00:00:58.890 --> 00:01:01.270
open source printing systems.

00:01:02.360 --> 00:01:05.150
Well, we found an answer,
and it was a very good answer.

00:01:05.250 --> 00:01:07.160
We found CUPS,
the Common UNIX Printing System,

00:01:07.570 --> 00:01:09.530
from Easy Software Products.

00:01:09.740 --> 00:01:11.800
It's available under the
GNU General Public License,

00:01:12.060 --> 00:01:13.190
so we can use it in Darwin.

00:01:13.190 --> 00:01:18.190
It's incredibly powerful,
so it'll let us do everything

00:01:18.190 --> 00:01:18.190
we wanted to do in OS X.

00:01:18.550 --> 00:01:21.560
It's based upon a few
simple direct concepts,

00:01:21.660 --> 00:01:25.200
in particular IPP,
the Internet Printing Protocol,

00:01:25.270 --> 00:01:27.340
and PostScript printer description files.

00:01:27.400 --> 00:01:30.160
Now our existing OS X printing
system is also based upon IPP.

00:01:30.160 --> 00:01:33.060
It was designed around it,
so we're comfortable with that.

00:01:33.120 --> 00:01:35.120
And we've been using
PostScript printer description

00:01:35.120 --> 00:01:36.740
files on Mac OSes for over a decade.

00:01:36.860 --> 00:01:41.410
So the two simple direct concepts
in CUPS we're very comfortable with.

00:01:41.910 --> 00:01:42.420
But there's more.

00:01:42.560 --> 00:01:43.150
It gets even better.

00:01:43.380 --> 00:01:44.740
The story just keeps improving.

00:01:44.800 --> 00:01:45.560
It's well documented.

00:01:45.560 --> 00:01:50.700
We announced on Monday that we were
going to use CUPS in Darwin and in OS X.

00:01:50.820 --> 00:01:53.530
And on Monday,
there was great documentation available.

00:01:53.530 --> 00:01:55.930
The truth is,
it was available long before Monday,

00:01:55.930 --> 00:01:57.470
and the truth is,
we had nothing to do with it.

00:01:57.610 --> 00:02:01.890
But nonetheless, our printing systems are
incredibly well documented.

00:02:04.580 --> 00:02:07.100
So please, go online, go to CUPS.org.

00:02:07.450 --> 00:02:10.300
You'll find a half dozen or so
documents describing CUPS from

00:02:10.300 --> 00:02:11.580
different vantage points.

00:02:11.670 --> 00:02:14.260
You'll find news groups
and a mailing list.

00:02:14.350 --> 00:02:17.340
But, what you should really do,
and if you want to understand

00:02:17.460 --> 00:02:19.780
the Darwin Printing System,
and you want to understand

00:02:19.890 --> 00:02:22.100
the OS X Printing System,
you need this book.

00:02:22.170 --> 00:02:22.870
This book.

00:02:23.060 --> 00:02:25.110
The book that I have three copies of.

00:02:25.110 --> 00:02:28.120
The books that you can buy
over in the vendor hall.

00:02:28.120 --> 00:02:31.490
The books that you absolutely
must read if you're going to

00:02:31.490 --> 00:02:32.400
understand what we're doing.

00:02:32.400 --> 00:02:32.400
Point made?

00:02:33.880 --> 00:02:36.840
So, that's why we're using CUPS.

00:02:36.880 --> 00:02:39.630
That's how you can find out more
about what we're doing with CUPS.

00:02:39.630 --> 00:02:42.480
That's the really great story I have,
which is that we had some needs,

00:02:42.770 --> 00:02:45.060
and we found an answer that
met all our expectations.

00:02:46.250 --> 00:02:48.820
I want to take a brief moment and
talk about layering in CUPS because

00:02:49.130 --> 00:02:52.360
you can get the CUPS source code
now from a couple different places.

00:02:52.450 --> 00:02:55.030
The pure place, the place you get pure
CUPS is from CUPS.org.

00:02:55.030 --> 00:02:57.890
If you really want to see what
the CUPS source code looks like,

00:02:57.890 --> 00:02:58.560
go there.

00:02:58.660 --> 00:03:00.650
That is the clearinghouse.

00:03:00.770 --> 00:03:03.960
But because we're going to use it
in OS X and it's released under

00:03:03.960 --> 00:03:06.090
the GNU General Public License,
we also need to give you the

00:03:06.090 --> 00:03:09.230
source code that we're using in
OS X and we're doing that through

00:03:09.230 --> 00:03:11.720
Darwin because Darwin's also using CUPS.

00:03:11.860 --> 00:03:15.470
So you can go to Darwin as of Monday and
download the source code that we're using

00:03:15.470 --> 00:03:17.500
in Darwin that we're using in Jaguar.

00:03:17.500 --> 00:03:18.250
It's right there.

00:03:18.250 --> 00:03:21.250
You can download it and see what the
spooling system is that we're using.

00:03:21.450 --> 00:03:23.360
We still have pieces
that are closed in OS X,

00:03:23.450 --> 00:03:25.110
but the spooling system is open.

00:03:25.110 --> 00:03:26.960
You can get that source code.

00:03:26.960 --> 00:03:29.790
That source code that's on Darwin does
remove a few pieces from the

00:03:29.790 --> 00:03:32.340
CUPS distribution you'd find on CUPS.org.

00:03:32.340 --> 00:03:33.380
That's for some legal reasons.

00:03:33.380 --> 00:03:35.070
We're trying to work
through some of those.

00:03:35.200 --> 00:03:38.720
But you can go get those pieces because
they're also under GPL and add them back.

00:03:38.790 --> 00:03:41.280
There's nothing to stop you from that.

00:03:41.280 --> 00:03:43.990
When you get that piece that
we put in Darwin -- again,

00:03:43.990 --> 00:03:47.230
this is -- is this Darwin's -- this
is a CUPS repository that we keep.

00:03:47.330 --> 00:03:47.920
It's live.

00:03:48.020 --> 00:03:50.020
So as we work on Jaguar,
you can see the changes

00:03:50.020 --> 00:03:51.070
we're putting in there.

00:03:51.170 --> 00:03:53.500
When we check something in,
you see it immediately.

00:03:53.580 --> 00:03:56.290
So we take that, we put it in OS X,
and we put a couple pieces back.

00:03:56.460 --> 00:03:58.810
In particular,
we put back some of our Quartz pieces.

00:03:58.810 --> 00:04:02.560
We put in a piece that can convert from
PDF to raster and PDF to PostScript.

00:04:02.610 --> 00:04:04.360
Those pieces right now are closed.

00:04:04.360 --> 00:04:05.990
We have plans to make them open.

00:04:07.270 --> 00:04:08.520
So again, two messages.

00:04:08.560 --> 00:04:10.730
We're very happy and
excited to be using CUPS.

00:04:10.810 --> 00:04:11.360
It's open.

00:04:11.510 --> 00:04:12.570
Here's how you can get it.

00:04:12.650 --> 00:04:14.920
If you want to see pure CUPS,
go to CUPS.org.

00:04:14.920 --> 00:04:16.420
If you want to see what we're doing,
go to Darwin.

00:04:18.330 --> 00:04:20.040
But CUPS is the most interesting.

00:04:20.040 --> 00:04:22.100
It's really what we're
talking about here today.

00:04:22.170 --> 00:04:24.040
Michael Sweet is the architect of CUPS.

00:04:24.320 --> 00:04:27.900
He's also the author of the CUPS book,
which is why it's so good.

00:04:27.990 --> 00:04:32.810
He has graciously flown out here to talk
to you today to describe what CUPS is,

00:04:32.810 --> 00:04:37.060
what you get from CUPS.org and mostly
what you get from CUPS in Darwin.

00:04:37.480 --> 00:04:39.510
So, Michael.

00:04:48.700 --> 00:04:51.300
Hi, as I said, my name is Mike Sweet.

00:04:51.320 --> 00:04:54.570
I'm co-owner of
Easy Software Products and I'm

00:04:54.670 --> 00:04:57.210
the guy responsible for CUPS.

00:04:59.700 --> 00:05:00.560
What is CUPS?

00:05:00.780 --> 00:05:04.400
Well, CUPS is a replacement for all the
existing Unix printing systems

00:05:04.400 --> 00:05:06.670
that you may have seen in the past.

00:05:06.670 --> 00:05:11.230
One of the problems with the traditional
Unix printing systems is they've been

00:05:11.230 --> 00:05:13.290
developed for printing text files.

00:05:13.290 --> 00:05:17.130
LPR and system 5 printing
were developed in the '70s.

00:05:17.340 --> 00:05:20.840
And back then,
all you really had were text printers.

00:05:21.030 --> 00:05:26.160
And it did that job really well,
but it doesn't really work these days.

00:05:26.310 --> 00:05:28.000
CUPS goes away from that.

00:05:28.000 --> 00:05:32.280
Instead of thinking of printing
text files or PostScript files,

00:05:32.380 --> 00:05:34.420
it thinks in terms of printing documents.

00:05:34.420 --> 00:05:37.060
So what we call it is a
complete printing solution.

00:05:39.450 --> 00:05:42.080
Now who's using CUPS besides Apple?

00:05:42.160 --> 00:05:45.050
Well, you'll find that most of the
Linux distributions that are

00:05:45.050 --> 00:05:46.750
out there now include CUPS.

00:05:46.840 --> 00:05:51.660
Now if you have FreeBSD or
OpenBSD or NetBSD,

00:05:51.920 --> 00:05:56.550
those operating systems include
a ports package for CUPS.

00:05:57.000 --> 00:06:00.410
Most of the major printer
manufacturers have CUPS drivers or

00:06:00.410 --> 00:06:03.600
are using CUPS in their products.

00:06:03.600 --> 00:06:07.710
Examples here are Canon and
Okidata licensed CUPS for use

00:06:07.760 --> 00:06:10.190
in their printing products.

00:06:10.330 --> 00:06:13.130
Canon is using it for some
internal R&D stuff right now,

00:06:13.130 --> 00:06:17.120
but Okidata will be shipping
it with their products.

00:06:17.360 --> 00:06:20.480
Absinth,
Genicom and Xerox have funded development

00:06:20.500 --> 00:06:25.820
or provided to us printers and support
to support their products and they're

00:06:25.820 --> 00:06:28.480
very excited about using CUPS as well.

00:06:29.010 --> 00:06:32.040
In the free software arena,
there's GIMP Print,

00:06:32.040 --> 00:06:34.800
which provides some really
high quality printer drivers.

00:06:34.950 --> 00:06:39.080
You can use those directly
in Darwin or in Mac OS X.

00:06:39.090 --> 00:06:42.940
And then the KDE project,
if you're using that with Darwin,

00:06:42.940 --> 00:06:45.950
also includes complete support for CUPS.

00:06:48.490 --> 00:06:51.530
Now as I mentioned before,
CUPS is designed to print

00:06:51.940 --> 00:06:57.500
modern document formats,
PDF, PostScript, image files like TIFF,

00:06:57.670 --> 00:07:01.830
basically anything you're likely
to run into we can support.

00:07:01.900 --> 00:07:04.990
LPD was designed just
to print text files,

00:07:04.990 --> 00:07:07.660
so it's really not up to the task.

00:07:09.510 --> 00:07:12.900
When the user uses CUPS,
instead of dealing with, "Okay,

00:07:12.900 --> 00:07:15.900
I've got a PostScript file,
so I know I can print it to this printer,

00:07:15.900 --> 00:07:17.540
but this other printer
doesn't support it,

00:07:17.540 --> 00:07:20.530
so I can't print that file there,
so I have to run some other program

00:07:20.600 --> 00:07:28.210
to generate the print file,"
CUPS takes care of that for the user,

00:07:28.210 --> 00:07:28.210
so the user never has
to worry about that.

00:07:30.310 --> 00:07:32.940
Instead of using LPD,
we chose to use IPP,

00:07:32.940 --> 00:07:36.360
which was just coming out at
the time we were designing CUPS.

00:07:36.480 --> 00:07:41.750
It's a really good move because
IPP really provides the full range of

00:07:41.760 --> 00:07:45.910
attributes that you need for printing,
and it also provides things like

00:07:46.020 --> 00:07:50.610
authentication and encryption
support that was missing from LPD.

00:07:54.040 --> 00:07:57.000
When you're using CUPS,
you can support PostScript printers

00:07:57.000 --> 00:08:00.910
just by using the PPD files that are
already available for Mac OS or Windows.

00:08:00.980 --> 00:08:03.980
It doesn't require anything different.

00:08:04.620 --> 00:08:08.180
The PPD files naturally describe every
feature that's available on the printer,

00:08:08.200 --> 00:08:11.330
at least as far as the
manufacturer is exposing.

00:08:11.330 --> 00:08:15.600
And you'll be able to print
duplexed or on special media.

00:08:15.600 --> 00:08:20.590
And it'll handle all that
transparently to you and the user.

00:08:21.380 --> 00:08:24.260
If you want to support a
non-post-script printer driver,

00:08:24.290 --> 00:08:29.150
then you write a special filter and
provide a PPD file that tells CUPS to

00:08:29.150 --> 00:08:31.800
use that filter when it's printing.

00:08:31.950 --> 00:08:35.000
So as far as the application
and the user are concerned,

00:08:35.040 --> 00:08:37.810
everything looks like
a post-script printer.

00:08:40.240 --> 00:08:42.920
Now the good thing about using
PPD files is you can use the same

00:08:42.920 --> 00:08:45.200
PPD files in every operating system.

00:08:45.350 --> 00:08:48.310
So we can support Mac OS clients
from UNIX servers,

00:08:48.570 --> 00:08:50.810
we can support Windows clients
from UNIX servers,

00:08:50.900 --> 00:08:53.200
we can support Windows clients
from Mac servers.

00:08:53.200 --> 00:08:54.990
It really doesn't matter.

00:08:55.080 --> 00:08:59.540
Everybody can use a PPD file and
everybody's got a PostScript driver,

00:08:59.540 --> 00:09:00.990
so that all works.

00:09:01.280 --> 00:09:03.890
The same filters that you
write for one operating system,

00:09:03.890 --> 00:09:07.630
unless they're using something that's
really operating system specific,

00:09:07.630 --> 00:09:11.900
will work on another operating
system just by recompiling it.

00:09:11.900 --> 00:09:16.260
And that piece, all the device specific,
operating system specific

00:09:16.390 --> 00:09:20.460
stuff is handled by a separate
program that CUPS provides.

00:09:22.700 --> 00:09:27.550
IPP was designed from the ground up
to support things like access control,

00:09:27.670 --> 00:09:32.420
security, encryption,
where LPD was just a little

00:09:32.550 --> 00:09:35.010
hack that they came up with.

00:09:35.080 --> 00:09:37.260
As far as I've seen,
it's just been over a few

00:09:37.290 --> 00:09:38.690
days as the usual story.

00:09:38.690 --> 00:09:46.950
And it really isn't set up to do anything
more complicated than listing a set

00:09:46.950 --> 00:09:46.950
of hosts that are allowed to print.

00:09:48.190 --> 00:09:51.180
Another advantage of IPP is
you can pass in any kind of

00:09:51.180 --> 00:09:54.020
job attributes that you want,
so that you can say,

00:09:54.140 --> 00:09:57.220
"This is a double-sided document," or,
"This needs to be printed

00:09:57.220 --> 00:10:00.650
on photo media," and,
"This is the resolution I need

00:10:00.650 --> 00:10:03.850
to print at." Whereas LPD,
there's really no support for that.

00:10:04.020 --> 00:10:09.530
There's been some vendor
extensions for that,

00:10:09.530 --> 00:10:09.530
but they're not standard,
so you can't rely on them.

00:10:11.080 --> 00:10:13.460
As I mentioned before,
there's authentication,

00:10:13.460 --> 00:10:18.030
access control and encryption,
which LPD completely lacks.

00:10:21.720 --> 00:10:24.440
Now, in the old days,
you had a text file you

00:10:24.440 --> 00:10:26.370
wanted to print or a man page.

00:10:26.510 --> 00:10:30.940
You just LPR the file and
everything worked pretty well.

00:10:31.030 --> 00:10:32.620
Same thing happens with CUPS.

00:10:32.660 --> 00:10:36.480
Commands are exactly the same,
plus you have the option of using command

00:10:36.480 --> 00:10:41.640
line options to control the media and in
this case use the Pretty Print option,

00:10:41.640 --> 00:10:43.970
which is the equivalent of the old

00:10:45.120 --> 00:10:48.660
However, if you have a PDF document and
you want to print double-sided,

00:10:48.660 --> 00:10:52.350
there's really no way to tell LPD to
do that or even to print the PDF file

00:10:52.430 --> 00:10:56.700
unless you have a special filter added,
and then that filter depends

00:10:56.700 --> 00:10:58.740
on which printer you've got.

00:10:58.900 --> 00:11:02.520
With COPS,
all printers support PDF files.

00:11:02.520 --> 00:11:04.020
All printers support PostScript files.

00:11:04.190 --> 00:11:07.240
All printers support JPEG files,
and they all take the

00:11:07.330 --> 00:11:08.750
same kinds of options.

00:11:08.810 --> 00:11:11.860
Now, in this example,
we print on legal size media

00:11:11.860 --> 00:11:15.510
and do two-sided printing on the
long which just means you're not

00:11:15.540 --> 00:11:17.990
flipping a page on each side.

00:11:18.640 --> 00:11:21.580
If you had a printer that
doesn't support duplex printing,

00:11:21.680 --> 00:11:23.540
it'll go through and
print single-sided and,

00:11:23.540 --> 00:11:27.950
you know, if you send the IPP request,
it'll actually come back and say, "Sorry,

00:11:28.040 --> 00:11:32.350
this option wasn't supported,
but I'm going to print your file anyway."

00:11:36.200 --> 00:12:41.700
[Transcript missing]

00:12:43.770 --> 00:12:48.580
Now, as far as the design of CUPS,
it implements version 1.1 of IPP.

00:12:48.580 --> 00:12:53.070
This is a version that's on the
standards track within the IETF,

00:12:53.070 --> 00:12:56.760
and basically just about
everybody supports it.

00:12:56.830 --> 00:12:58.710
There's a few exceptions.

00:12:58.710 --> 00:13:01.630
Microsoft only supports IPP 1.0.

00:13:01.630 --> 00:13:06.150
We are compatible with 1.0 clients,
so you can still print,

00:13:06.340 --> 00:13:10.350
but there's a few things that if
you're talking to a Microsoft server,

00:13:10.550 --> 00:13:14.730
it has to kind of go into
back compatibility mode.

00:13:15.860 --> 00:13:22.590
CUPS itself has a small central server
that handles any client connections,

00:13:22.610 --> 00:13:28.990
any network communications and actually
scheduling and printing the jobs.

00:13:29.030 --> 00:13:33.270
It's just a big finite state
machine and it does what it needs

00:13:33.270 --> 00:13:36.790
to do and then fires off other
processes to do the hard work.

00:13:37.530 --> 00:13:42.660
Any applications that want to
send a print job or get a PPD file

00:13:42.660 --> 00:13:47.160
and pop up options for the user
just have to communicate with

00:13:47.460 --> 00:13:49.560
the scheduler via HTTP and IPP.

00:13:49.690 --> 00:13:53.140
IPP is layered over HTTP.

00:13:57.820 --> 00:13:59.740
There's also a web browser interface.

00:13:59.860 --> 00:14:04.840
Now, the nice thing about this interface
is that you can have users open

00:14:04.870 --> 00:14:10.420
up the interface to be able to
access the documentation online.

00:14:10.420 --> 00:14:15.870
You can provide your own content if you
have specific rules for how you send a

00:14:15.890 --> 00:14:20.170
print job and where you go to get it and
if you don't pick up your job within five

00:14:20.170 --> 00:14:23.190
minutes we're going to throw it away,
that sort of thing.

00:14:23.190 --> 00:14:25.560
It also lets you monitor print jobs,
printers,

00:14:25.770 --> 00:14:30.180
classes and for the administrator
to do administrative functions.

00:14:31.690 --> 00:14:35.300
When a job gets printed,
it fires off a set of programs called

00:14:35.420 --> 00:14:39.150
filters and those are all piped into
a back end program which actually

00:14:39.150 --> 00:14:41.140
communicates with the printer.

00:14:41.230 --> 00:14:43.980
There's back ends for parallel, serial,
USB.

00:14:43.980 --> 00:14:48.280
There's a new fire wire interface
going into the new version of CUPS.

00:14:48.290 --> 00:14:52.750
Plus a bunch of network protocols,
app socket for Jet Direct type of thing,

00:14:52.870 --> 00:14:57.580
LPD for older network
interfaces and of course IPP.

00:14:58.550 --> 00:15:02.740
All of the printers and jobs
and devices in CUPS are managed

00:15:02.750 --> 00:15:05.280
dynamically by the scheduler.

00:15:05.410 --> 00:15:07.720
So if you have a new
network interface come up,

00:15:07.720 --> 00:15:10.930
it can recognize that and
start using it right away.

00:15:11.110 --> 00:15:14.210
Similarly, new devices, new printers,
new jobs,

00:15:14.210 --> 00:15:16.290
all that information is dynamic.

00:15:16.290 --> 00:15:19.890
So you don't have to worry about
reconfiguring the scheduler and then,

00:15:19.990 --> 00:15:21.550
"Oh, I have to restart it every time."

00:15:25.900 --> 00:15:29.890
This is a simplified
block diagram of CUPS.

00:15:29.960 --> 00:15:34.000
The commands communicate
to the scheduler via IPP.

00:15:34.000 --> 00:15:39.300
And there's also a series of mini daemons
that provide some auxiliary functions.

00:15:39.300 --> 00:15:42.120
One of them provides LPD client support.

00:15:42.120 --> 00:15:48.870
There's another that does polling so
you can cross the subnet barrier and

00:15:48.870 --> 00:15:48.870
we'll cover that a little bit later.

00:15:49.940 --> 00:15:53.420
And then all the filters,
printer drivers,

00:15:53.420 --> 00:15:57.330
backends and so forth are invoked
by the scheduler and communicate

00:15:57.330 --> 00:15:59.040
with the scheduler as things happen.

00:16:03.010 --> 00:16:06.270
Now if you send a print job,
you run the LPR command,

00:16:06.270 --> 00:16:10.400
it actually takes the print file,
opens up the connection

00:16:10.400 --> 00:16:12.300
with the scheduler,
says, "Okay,

00:16:12.530 --> 00:16:15.860
is this printer okay for me to print to,
number one?" It is.

00:16:16.060 --> 00:16:18.130
"Alright, here's the options,
here's the job file,

00:16:18.200 --> 00:16:22.300
go ahead and print it." Scheduler
will copy that job file into

00:16:22.300 --> 00:16:25.900
its spool directory and then
schedule it for printing.

00:16:26.000 --> 00:16:28.600
There are certain
options that you can set.

00:16:28.600 --> 00:16:31.990
You can tell it to hold the job
until the operator releases it.

00:16:31.990 --> 00:16:36.500
You can have it print at night,
so if you have a long job,

00:16:36.500 --> 00:16:37.790
you don't want to tie up the printer.

00:16:37.790 --> 00:16:38.830
You can do that.

00:16:38.830 --> 00:16:41.330
It's very flexible.

00:16:42.220 --> 00:16:45.830
Once the job does get scheduled to print,
it goes through,

00:16:45.950 --> 00:16:49.860
it determines which filters to run
and which printer drivers to run.

00:16:49.870 --> 00:16:54.240
It fires those off so they can
start reading the document file.

00:16:54.240 --> 00:16:57.370
And then the back end opens up
a connection to the printer,

00:16:57.830 --> 00:17:00.840
whether it's a network printer
or a locally connected printer.

00:17:00.880 --> 00:17:05.410
The filters don't really care.

00:17:05.450 --> 00:17:06.260
And they all communicate
data back and forth.

00:17:09.400 --> 00:17:15.130
In the case of supporting LPD clients,
we have that mini-demon called CUPS LPD.

00:17:15.300 --> 00:17:17.640
It handles all the requests,
talks to the scheduler,

00:17:17.790 --> 00:17:18.730
passes on those things.

00:17:18.850 --> 00:17:23.440
So if the user asks for a job listing,
it'll get that information

00:17:23.510 --> 00:17:24.330
from the scheduler.

00:17:24.390 --> 00:17:27.760
If the user wants to submit a file,
it goes through and gets put

00:17:27.760 --> 00:17:29.400
into the spool directory.

00:17:29.400 --> 00:17:34.480
And you can start and stop printers and
do all those sorts of things via LPD.

00:17:37.050 --> 00:17:40.070
From the user's perspective and
from the developer's perspective,

00:17:40.070 --> 00:17:42.270
CUPS provides a lot of stuff.

00:17:42.350 --> 00:17:45.120
There's command line interfaces,
the web interfaces,

00:17:45.120 --> 00:17:47.470
we've talked about those a
little bit and we'll cover

00:17:47.700 --> 00:17:50.440
those in depth in a second here.

00:17:50.440 --> 00:17:57.790
All of the filter and driver
interfaces and various other

00:17:57.790 --> 00:17:57.790
services for applications.

00:17:59.330 --> 00:18:01.370
Now,
your typical Berkeley printing commands,

00:18:01.400 --> 00:18:05.280
which you're probably most familiar with,
your LPC, LPR, LPQ and LPRM,

00:18:05.280 --> 00:18:09.200
those are all available and
those are all fully functional.

00:18:09.300 --> 00:18:11.170
They look just like the originals.

00:18:14.160 --> 00:18:16.330
They also provide the System 5 commands.

00:18:16.480 --> 00:18:19.210
These may be less familiar to you,
but these are the ones that are

00:18:19.230 --> 00:18:24.810
provided on AT&T System 5 based UNIXs.

00:18:25.080 --> 00:18:30.880
Accept and reject will allow the printer
to accept or reject new print jobs.

00:18:31.020 --> 00:18:32.790
So if you're having a
problem with the printer,

00:18:32.800 --> 00:18:36.710
you can actually tell the queue
to stop accepting new requests

00:18:36.800 --> 00:18:38.680
until you solve the problem.

00:18:38.830 --> 00:18:42.000
Cancel does the same thing as LPRM,
it cancels a job.

00:18:42.000 --> 00:18:44.920
Enable and disable,
start and stop the printer.

00:18:44.920 --> 00:18:48.970
So if you have to stop the printer
to change a toner cartridge or

00:18:49.110 --> 00:18:53.180
something and you don't want it
to try printing any new jobs,

00:18:53.180 --> 00:18:53.920
you can tell it to do so.

00:18:54.960 --> 00:18:56.480
LP is the same as LPR.

00:18:56.620 --> 00:19:01.210
LP admin is the command you use to do
command line printer administration,

00:19:01.210 --> 00:19:03.970
add new printers, delete printers,
set up classes.

00:19:04.040 --> 00:19:07.740
And LP stat is the equivalent
to LPQ in the Berkeley world.

00:19:12.150 --> 00:19:15.590
Now as far as the CUPS commands go,
there's two that you might

00:19:15.590 --> 00:19:17.600
use as an administrator.

00:19:17.630 --> 00:19:20.160
The first is CUPS Add SMB.

00:19:20.230 --> 00:19:23.240
This is the program that you
use to export your printer

00:19:23.290 --> 00:19:27.110
drivers from CUPS into Samba,
and then the Samba drivers

00:19:27.110 --> 00:19:31.230
can be downloaded by
Windows clients automatically.

00:19:31.370 --> 00:19:33.280
They see the printer in
the network neighborhood,

00:19:33.280 --> 00:19:36.380
they double click on the printer,
and it will download the printer

00:19:36.380 --> 00:19:40.040
driver from Samba and install
it on a local Windows client.

00:19:40.140 --> 00:19:45.500
So it's very easy to set up printers and
share them with Windows clients that way.

00:19:45.950 --> 00:19:48.070
CUPSd is the actual scheduler program.

00:19:48.150 --> 00:19:53.340
Normally you won't have to run this,
but if you're doing things with a

00:19:53.340 --> 00:19:56.750
scheduler and you want to stop it,
that's a process you'd kill,

00:19:56.980 --> 00:19:58.670
and then you could start it back up.

00:19:58.930 --> 00:20:01.890
There's also the init scripts as usual.

00:20:04.360 --> 00:20:08.130
Some other CUPS commands, there's LPINFO,
which allows you to list

00:20:08.250 --> 00:20:11.300
devices that are available on
the system and printer drivers.

00:20:11.450 --> 00:20:13.090
There's short and long forms.

00:20:13.100 --> 00:20:17.300
The short forms are easily
parsable by programs and scripts.

00:20:17.400 --> 00:20:20.190
The long forms are nice for the
user so they can see all the details

00:20:20.220 --> 00:20:22.660
about the particular drivers.

00:20:22.660 --> 00:20:27.690
LPMOVE moves jobs from one printer
to another and LPOPTIONS sets up

00:20:27.900 --> 00:20:30.540
default options for the printers.

00:20:31.350 --> 00:20:33.240
Now, one of the nice things about
LPOPTIONS as well is you can

00:20:33.340 --> 00:20:35.440
set up instances of printers.

00:20:35.520 --> 00:20:40.680
So if you have a LaserJet and you want
the default to print duplex but you

00:20:40.680 --> 00:20:44.620
want to offer a simplex queue as well,
rather than setting up

00:20:44.620 --> 00:20:47.900
a separate print queue,
you just set up a separate instance.

00:20:47.960 --> 00:20:54.480
And for LPOPTIONS you just specify
LaserJet/simplex and that would

00:20:54.620 --> 00:20:58.890
set up a separate instance of
that printer with new options.

00:21:01.760 --> 00:21:03.560
The web interface is very simple.

00:21:03.830 --> 00:21:06.920
It's all template driven.

00:21:06.920 --> 00:21:13.150
The front page there has just listed
out what tasks you can do on it.

00:21:13.960 --> 00:21:15.800
There's links there to
download the software,

00:21:15.800 --> 00:21:19.050
get online help, manage your jobs,
manage your printers,

00:21:19.170 --> 00:21:20.670
all very straight-forward.

00:21:20.670 --> 00:21:24.540
Whenever there's an administrative task,
you try to do a wizard type

00:21:24.540 --> 00:21:28.530
of interface rather than type
everything in on one form and then

00:21:28.610 --> 00:21:30.620
expect the user to know what to do.

00:21:30.720 --> 00:21:32.600
So it's very flexible that way.

00:21:32.700 --> 00:21:34.140
And you can customize this.

00:21:34.310 --> 00:21:38.460
So if you want to have your own header on
the top or have your own look and feel,

00:21:38.460 --> 00:21:42.300
you can completely replace the
templates that come with CUPS and

00:21:42.300 --> 00:21:45.510
provide your own local version.

00:21:47.560 --> 00:21:51.060
This is a list of the printers that
are available on that one system.

00:21:51.060 --> 00:21:54.680
And as you see,
there's various commands that you can

00:21:54.680 --> 00:22:00.860
access right from each printer to resume,
to start the printer, stop the printer,

00:22:00.860 --> 00:22:04.370
accept jobs, reject jobs,
set options for the printer,

00:22:04.370 --> 00:22:06.130
reconfigure the printer.

00:22:06.240 --> 00:22:09.260
So if the IP address of the
printer changes and you want to,

00:22:09.410 --> 00:22:12.130
you've hard coded the
IP address in there,

00:22:12.130 --> 00:22:16.290
you can go in and modify the
printer without having to do an

00:22:16.500 --> 00:22:18.060
And it also shows you
your default printer,

00:22:18.060 --> 00:22:20.770
so if you need to change that,
you can set the default

00:22:20.890 --> 00:22:22.640
from inside of there.

00:22:23.160 --> 00:22:25.880
As I said,
you can customize all of the user

00:22:25.880 --> 00:22:30.130
interface with HTML templates,
but you can also localize the interface.

00:22:30.290 --> 00:22:34.540
So if you have users that
are speaking French and users

00:22:34.540 --> 00:22:36.590
that are speaking English,
you can provide a

00:22:36.630 --> 00:22:38.580
French version of the templates.

00:22:38.620 --> 00:22:40.650
Just put them in a subdirectory.

00:22:40.690 --> 00:22:46.370
The web interface will detect what
language is preferred by the browser

00:22:46.370 --> 00:22:48.850
and will use the appropriate templates.

00:22:48.870 --> 00:22:52.410
So it's very easy to add
support for other languages.

00:22:55.490 --> 00:22:59.280
The file filter interface
is really where CUPS shines.

00:22:59.350 --> 00:23:05.030
You can put in any kind of file
format and as long as you identify

00:23:05.030 --> 00:23:11.460
this is how I know it's a Foo file
and this is how I convert from

00:23:11.460 --> 00:23:16.580
Foo to PostScript and so forth,
then you can support any kind

00:23:16.580 --> 00:23:16.580
of document you might run into.

00:23:16.920 --> 00:23:20.250
The scheduler keeps track of all of
the available filters on the system

00:23:20.260 --> 00:23:22.260
and all of the available file types.

00:23:22.260 --> 00:23:25.740
And when a print job comes in,
it will determine what type of

00:23:25.870 --> 00:23:29.580
file is being printed and then
see what's the best way to get

00:23:29.590 --> 00:23:32.060
that file printed for a printer.

00:23:32.100 --> 00:23:34.640
It goes through,
finds the least cost solution, you know,

00:23:34.680 --> 00:23:37.690
whether it's running one
program or five programs.

00:23:37.790 --> 00:23:41.530
It keeps track of the relative
cost of each filter and

00:23:41.530 --> 00:23:43.900
uses the right combination.

00:23:45.570 --> 00:23:49.800
The filters that come with
CUPS print international text,

00:23:50.060 --> 00:23:53.860
and by that I mean all of the
ISO and Windows character sets

00:23:53.970 --> 00:23:56.500
plus UTF-8 for Unicode text.

00:23:56.500 --> 00:24:01.690
There's a PostScript filter
for printing PostScript files

00:24:01.810 --> 00:24:06.610
and also for converting the
PostScript files to a device-dependent

00:24:06.610 --> 00:24:06.610
format for ripping later.

00:24:06.660 --> 00:24:10.140
There's a PDF filter for
printing PDF files and an HPGL2

00:24:10.150 --> 00:24:13.320
filter for printing HPGL2 files.

00:24:13.360 --> 00:24:16.150
A lot of printers don't
support those formats directly,

00:24:16.230 --> 00:24:19.670
so this makes sure that you can
print from a CAD application,

00:24:19.670 --> 00:24:23.210
for example,
that's designed to just produce HPGL2.

00:24:24.840 --> 00:24:27.410
There's also image file filters.

00:24:27.410 --> 00:24:37.810
What we chose to do rather than just
converting to PostScript and using the

00:24:37.810 --> 00:24:37.810
PostScript rep is we actually have a

00:24:38.180 --> 00:24:42.670
Image File RIP that generates raster
images directly for raster printers

00:24:42.740 --> 00:24:47.100
and a PostScript filter that generates
PostScript for PostScript printers.

00:24:47.100 --> 00:24:48.780
It's a lot more efficient.

00:24:48.840 --> 00:24:52.150
And then the PostScript RIP handles
printing PostScript files directly.

00:24:53.880 --> 00:24:58.500
All of the non-postscript printers
drivers use a common raster format.

00:24:58.650 --> 00:25:01.870
It's basically a page header at
the top that says these are the

00:25:01.870 --> 00:25:05.500
options to use for this page
and then the raster data itself.

00:25:05.500 --> 00:25:08.960
The header also includes the
dimensions of the raster data,

00:25:08.960 --> 00:25:12.670
the color space that's being used,
resolution and so forth.

00:25:13.130 --> 00:25:16.960
There's several sample
drivers included with CUPS.

00:25:16.960 --> 00:25:20.150
Covers most of the Epson and HP printers.

00:25:20.210 --> 00:25:24.250
There's also Okidata dot matrix
support and Dymo label printer,

00:25:24.250 --> 00:25:27.530
which is kind of an oddball,
but it was easy to support.

00:25:31.310 --> 00:25:34.300
Now if you go to write
your own file filter,

00:25:34.320 --> 00:25:35.900
it's very basic rule.

00:25:35.900 --> 00:25:37.850
You convert from one format to another.

00:25:39.420 --> 00:25:43.160
And you tell the scheduler,
"These are the formats I support in,

00:25:43.190 --> 00:25:46.790
and this is the format that comes
out." And that's all you gotta do.

00:25:48.500 --> 00:25:53.580
Some filters are used both as an actual
printer driver and some are just used as

00:25:53.580 --> 00:25:56.240
an inline filter to go to something else.

00:25:56.280 --> 00:26:00.200
The PostScript to PostScript filter
is an example of one that's used

00:26:00.430 --> 00:26:04.180
to go both as a printer driver
and into the PostScript rep.

00:26:04.320 --> 00:26:07.970
Because it does the,
all the page sorting and inserting

00:26:08.050 --> 00:26:12.000
of page commands and that sort
of thing that goes on either

00:26:12.000 --> 00:26:15.790
directly to a PostScript printer
or into the PostScript rep.

00:26:15.990 --> 00:26:18.530
The Image to PostScript filter
is another example.

00:26:18.660 --> 00:26:21.520
That's the one that takes an
image file and converts it into

00:26:21.580 --> 00:26:24.400
PostScript for a particular printer.

00:26:27.980 --> 00:26:31.660
Now most of the filters you'll see
in CUPS either produce PostScript or

00:26:31.660 --> 00:26:33.940
they produce a raster string.

00:26:34.040 --> 00:26:38.900
You may have other programs that go
to some other intermediate format.

00:26:38.990 --> 00:26:44.350
There's a CGM to HPGL filter out there,
I think on the bazaar,

00:26:44.550 --> 00:26:49.020
and that would then convert CGM to
HPGL2 and then the HPGL2 would

00:26:49.120 --> 00:26:53.820
get converted to PostScript and
so forth until it got printed.

00:26:53.820 --> 00:26:57.840
Now filters that produce
raster data are called RIPs.

00:27:00.300 --> 00:27:04.640
Every filter that you're going
to write takes seven standard

00:27:04.640 --> 00:27:06.500
arguments on the command line.

00:27:06.960 --> 00:27:11.550
The argument zero is
normally your program name.

00:27:11.640 --> 00:27:14.020
In CUPS we pass it through
as the printer name.

00:27:14.020 --> 00:27:19.840
This is kind of compatible with the
System 5 interface script mechanism.

00:27:19.840 --> 00:27:22.840
And you'll find that all of the
arguments here are actually compatible.

00:27:22.840 --> 00:27:28.360
So if you have a legacy printer
driver for System 5 printing system,

00:27:28.470 --> 00:27:32.050
you can still use those and
it just treats it as a do

00:27:32.050 --> 00:27:34.610
all filter within the system.

00:27:35.590 --> 00:27:38.710
Each filter gets the current job ID,
the printer name,

00:27:38.890 --> 00:27:41.870
the user name for the person
that's printing the job,

00:27:41.870 --> 00:27:46.000
a title for the job, the number of copies
that need to be produced,

00:27:46.100 --> 00:27:48.610
and then any options
that are going through.

00:27:48.610 --> 00:27:51.300
The first filter gets
the file to be printed.

00:27:51.300 --> 00:27:53.530
That's the file that's
in the spool directory.

00:27:53.530 --> 00:27:56.920
Every other filter after that has
to read from the standard input.

00:27:56.920 --> 00:28:00.670
So one of the rules when writing
a filter for CUPS is that your

00:28:00.810 --> 00:28:04.670
filter has to be able to read from
standard input or from a file.

00:28:04.670 --> 00:28:07.470
If you can't read from
a standard input stream,

00:28:07.470 --> 00:28:12.450
then you have to copy standard input to
a temporary file and then deal with that.

00:28:12.580 --> 00:28:14.900
There's some filters,
like the PDF filter,

00:28:14.980 --> 00:28:19.080
that have to work that way because
they need random access to the file.

00:28:21.210 --> 00:28:24.400
There's a lot of environment
variables that get passed in.

00:28:24.570 --> 00:28:29.460
Some of these are kind of like what
you get from a CGI application.

00:28:29.610 --> 00:28:31.850
Some of these are CUPS specific.

00:28:32.010 --> 00:28:34.700
Some of the ones to keep
in mind is CUPS data dir,

00:28:34.860 --> 00:28:37.900
which defines where to
find the CUPS data files.

00:28:37.970 --> 00:28:42.360
This allows your filter to not be
hard coded for a particular path

00:28:42.360 --> 00:28:44.910
that CUPS might be installed with.

00:28:44.950 --> 00:28:48.850
And also CUPS server route,
which tells you where to find

00:28:48.850 --> 00:28:49.570
your configuration files.

00:28:50.520 --> 00:28:56.520
The device URI is the actual device that
your driver will eventually talk to.

00:28:56.520 --> 00:29:03.230
Now, we've kind of loosely modeled all
of the printer communications to

00:29:03.230 --> 00:29:07.580
a final device URI that describes,
well, this is an IPP printer,

00:29:07.710 --> 00:29:11.030
or this is a serial printer,
or this is a parallel printer.

00:29:11.030 --> 00:29:12.400
It's very generalized.

00:29:12.400 --> 00:29:15.240
It allows us to add new
backends in the future without

00:29:15.240 --> 00:29:18.350
breaking any compatibility,
and the applications

00:29:18.350 --> 00:29:19.960
just don't really care.

00:29:20.800 --> 00:29:26.280
Lang environment variable set to
the language of the print job.

00:29:26.390 --> 00:29:28.540
So if you have a French user
that submits a job,

00:29:28.540 --> 00:29:32.330
that Lang variable will be FR,
but an English user

00:29:32.330 --> 00:29:34.000
will get EN passed in.

00:29:34.160 --> 00:29:37.520
So you can localize any messages
that you produce for the

00:29:37.520 --> 00:29:39.670
user based on that language.

00:29:40.190 --> 00:29:45.750
The path is set up to a,
to user bin and slash bin, I think.

00:29:45.820 --> 00:29:49.560
And it just restricts what
normally gets exported.

00:29:49.560 --> 00:29:53.680
Normally you'd get some really
long path that's inherited from the

00:29:53.730 --> 00:29:57.890
environment and we really didn't
want to do that for security reasons.

00:29:58.200 --> 00:30:00.780
A PPD environment variable
tells you where to find the

00:30:00.790 --> 00:30:02.240
PPD file for the printer.

00:30:02.350 --> 00:30:04.140
Usually it will be
under CUPS server root,

00:30:04.150 --> 00:30:05.960
but it could be located elsewhere.

00:30:05.960 --> 00:30:09.160
Just use that and you can
get the PPD file right away.

00:30:09.220 --> 00:30:13.820
And then the printer environment variable
is the same name that you get in ARCV0,

00:30:13.950 --> 00:30:17.860
but if you're writing
a script-based filter,

00:30:17.860 --> 00:30:23.590
you can't really get ARCV0 without
having the wrong name in there.

00:30:25.820 --> 00:30:28.590
For the RIP filters,
there's an environment variable that's

00:30:28.710 --> 00:30:30.540
passed in for them called RIP Cache.

00:30:30.540 --> 00:30:33.790
It determines the maximum amount
of memory that will be used

00:30:33.820 --> 00:30:35.880
for that individual filter.

00:30:35.980 --> 00:30:38.720
So, for example,
if you have a server that's got

00:30:38.870 --> 00:30:43.460
five raster printers on it and
you've only got 512 megs of memory,

00:30:43.460 --> 00:30:46.750
for example,
and these are large format printers,

00:30:46.890 --> 00:30:50.210
you can say, "Well,
I only want to use 32 megs per

00:30:50.220 --> 00:30:54.200
printer maximum so that if they're
all going at the same time,

00:30:54.200 --> 00:30:57.540
I'm not going to run out of
memory just because I'm printing.

00:30:58.390 --> 00:31:01.270
Some of the other software,
TZ for the time zone

00:31:01.270 --> 00:31:02.850
and user are available.

00:31:02.990 --> 00:31:05.520
They're not generally used
because they're available in

00:31:05.630 --> 00:31:11.220
other places and it's like the
software environment variables,

00:31:11.220 --> 00:31:11.220
not all that interesting.

00:31:13.560 --> 00:31:16.600
Now, file filters are read from
standard input or file name that

00:31:16.600 --> 00:31:20.940
comes in on the command line,
but every bit of output that they send

00:31:20.940 --> 00:31:23.670
goes out on the standard output file.

00:31:24.540 --> 00:31:27.300
This lets you pipe in to the
next filter and the next filter

00:31:27.300 --> 00:31:32.580
and then finally into a back-end
process which talks to the printer.

00:31:32.580 --> 00:31:35.450
Any status messages,
error messages that you want to pass

00:31:35.620 --> 00:31:38.960
back to the scheduler or the user,
get passed on standard error.

00:31:39.190 --> 00:31:42.850
So naturally,
in order to identify it you need to

00:31:42.850 --> 00:31:44.730
have a little bit of a prefix string.

00:31:44.790 --> 00:31:48.900
Just do your fprintf standard
error and put in error colon to

00:31:48.900 --> 00:31:53.480
say it's an error or info colon to
say it's an informational message.

00:31:53.560 --> 00:31:57.570
There's also things for page accounting
and for printer status which will

00:31:57.650 --> 00:32:01.710
be coming in CUPS 1.2 and we'll
talk about that a little later.

00:32:02.040 --> 00:32:05.990
Anything except for the debug
messages gets passed to the user.

00:32:06.110 --> 00:32:09.690
So if you have an error message,
that gets logged in the error log

00:32:09.690 --> 00:32:13.720
and it also gets put in the printer
state message so that when the

00:32:13.790 --> 00:32:16.860
user checks the printer status,
they'll see, oh,

00:32:16.860 --> 00:32:18.760
the printer's out of paper.

00:32:22.340 --> 00:32:25.850
Once you've written the file filter,
you have to register it with CUPS.

00:32:25.890 --> 00:32:27.540
There's two files you create.

00:32:27.600 --> 00:32:30.700
One is a types file
and one's a cons file.

00:32:30.730 --> 00:32:34.950
The types file lists a bunch
of MIME types and magic rules

00:32:34.950 --> 00:32:37.300
to identify the file type.

00:32:37.300 --> 00:32:41.640
For the purposes of printing,
the only rules that are of any

00:32:41.720 --> 00:32:45.340
use are the ones that actually
look at the contents of the file.

00:32:45.340 --> 00:32:48.230
There's also extension
rules that you can use.

00:32:48.230 --> 00:32:51.640
Those are only used when
you're using the web interface.

00:32:51.690 --> 00:32:55.800
So for printing, you don't really use
the extensions at all.

00:32:55.850 --> 00:32:59.420
In this example,
we're registering the application/PDF

00:32:59.420 --> 00:33:05.810
MIME type and we say any file that
starts with percent PDF is a PDF file.

00:33:08.910 --> 00:33:12.100
The COPS file maps the actual filter.

00:33:12.280 --> 00:33:16.360
It says this is the file format
that I take in and this is what

00:33:16.360 --> 00:33:20.050
I produce coming out and the
relative cost of running that

00:33:20.050 --> 00:33:23.140
filter and then the filter itself.

00:33:23.160 --> 00:33:26.210
Now if you don't specify
the full path to the filter,

00:33:26.270 --> 00:33:29.460
it'll assume it's in the
CUPS server bin directory.

00:33:29.540 --> 00:33:35.830
If you do specify the full path,
it'll run it from wherever

00:33:35.830 --> 00:33:36.410
you told it to run it from.

00:33:37.170 --> 00:33:40.060
And as I mentioned before,
CUPS automatically uses

00:33:40.060 --> 00:33:41.720
the lowest cost solution.

00:33:41.920 --> 00:33:44.640
So if you have a new
PostScript RIP that you install

00:33:44.730 --> 00:33:48.070
that's faster than GhostScript,
you can give it a lower cost

00:33:48.220 --> 00:33:51.850
and it will use that one in
preference to GhostScript because

00:33:51.850 --> 00:33:54.760
it's a better solution,
a faster solution.

00:33:57.380 --> 00:33:59.670
You write a printer driver,
things work just a

00:33:59.690 --> 00:34:01.140
little bit differently.

00:34:01.240 --> 00:34:04.550
Instead of registering mine
types and conversion filters

00:34:05.050 --> 00:34:08.010
in a special file in etc.

00:34:08.110 --> 00:34:13.610
CUPS, you actually put the information in
the PPD file for the printer driver.

00:34:14.730 --> 00:34:19.140
The CUPS filter attribute
specifies what filters to run

00:34:19.140 --> 00:34:21.650
for specific types of files.

00:34:21.680 --> 00:34:25.400
In this example,
we're saying that the CUPS raster

00:34:25.400 --> 00:34:31.240
format can be converted to the printer's
format using raster to my printer.

00:34:31.500 --> 00:34:34.120
It has a relative cost of 50.

00:34:34.130 --> 00:34:37.170
If you're printing a plain text file,
you can use text to my printer

00:34:37.220 --> 00:34:39.180
and it only has a cost of 50.

00:34:39.250 --> 00:34:42.230
So when it goes to print a text file,
it'll choose that over going

00:34:42.290 --> 00:34:45.390
from text to postscript,
postscript to raster,

00:34:45.390 --> 00:34:47.780
raster to my printer.

00:34:50.940 --> 00:34:54.720
Now, you notice in the CUPS filter line,
it only shows one MIME type.

00:34:55.050 --> 00:35:02.630
This is because the printer MIME type,
which will be printer slash printer name,

00:35:02.630 --> 00:35:02.630
gets the

00:35:03.660 --> 00:35:05.400
It gets inserted there automatically.

00:35:05.400 --> 00:35:10.470
It's assumed that any filters that you
list in the PPD file are going from one

00:35:10.470 --> 00:35:13.510
format to the printer's native format.

00:35:16.400 --> 00:35:19.640
Once you get out of all the filters,
it goes into a back-end process.

00:35:19.650 --> 00:35:22.660
The back-end process actually
communicates with the printer.

00:35:22.660 --> 00:35:25.620
So when you're printing,
and you're printing to a USB port,

00:35:25.760 --> 00:35:29.800
it goes through the USB back-end
and all the print data comes

00:35:29.870 --> 00:35:31.540
from one set of filters.

00:35:31.540 --> 00:35:34.790
You reconnect that to a network port,
then it's running at one

00:35:34.790 --> 00:35:39.150
of the network back-ends,
but the print filters stay the same.

00:35:39.150 --> 00:35:43.400
So all that communication is
common and generalized so that

00:35:43.400 --> 00:35:47.920
you don't have to worry about,
"Am I able to talk from this driver

00:35:47.920 --> 00:35:50.740
to this particular back-end?"
They all use the same interface.

00:35:52.470 --> 00:35:54.570
One of the other things that
backends do is they provide

00:35:54.570 --> 00:35:56.400
the list of available devices.

00:35:56.530 --> 00:36:00.280
So, for example, on the network backend,
you could actually list the available

00:36:00.280 --> 00:36:02.010
network printers that are out there.

00:36:02.010 --> 00:36:06.020
So when you're first setting up
your printers on your network,

00:36:06.080 --> 00:36:08.940
it'll see the printers on the network,
list them out there,

00:36:08.940 --> 00:36:14.600
and you'll see I've got a LaserJet 4000
here and I've got a Xerox N40 over there,

00:36:14.680 --> 00:36:17.910
and just pick them from a list
when you're adding a printer rather

00:36:17.910 --> 00:36:21.280
than trying to remember what the
IP address is and what protocol

00:36:21.280 --> 00:36:23.080
they use and that sort of thing.

00:36:23.080 --> 00:36:25.580
It can identify that stuff automatically.

00:36:25.720 --> 00:36:28.100
Similarly,
for USB printers and for parallel

00:36:28.100 --> 00:36:31.580
printers and for serial printers,
it'll list out what's

00:36:31.580 --> 00:36:33.480
connected to the port.

00:36:37.500 --> 00:36:41.160
Now another interesting thing you
can do is you can define a back end

00:36:41.160 --> 00:36:44.060
that's kind of a pseudo back end.

00:36:44.060 --> 00:36:48.540
It acts as an agent for another back end.

00:36:48.540 --> 00:36:53.240
An example of this might be an SLP back
end that could go out there and see

00:36:53.240 --> 00:36:56.020
what SLP aware printers are out there.

00:36:56.150 --> 00:36:58.730
And then once it sees what
printers are out there,

00:36:58.740 --> 00:37:01.430
it can query to find out
what printing services are

00:37:01.430 --> 00:37:03.590
available and then tell CUPS,
hey,

00:37:03.610 --> 00:37:08.070
you've got a printer over here and it
supports IPP and LPD and these others.

00:37:08.070 --> 00:37:11.460
And then when it actually sends a job,
instead of going through

00:37:11.460 --> 00:37:13.840
that SLP back end,
it'll use the IPP back

00:37:13.840 --> 00:37:16.350
end or the LPD back end,
depending on how you

00:37:16.350 --> 00:37:17.180
configure the printer.

00:37:19.490 --> 00:37:23.130
Standard CUPS comes with
backends for parallel,

00:37:23.130 --> 00:37:27.180
serial, USB, AppSocket,
which is the JetDirect protocol,

00:37:27.180 --> 00:37:30.160
LPD and IPP connected printers.

00:37:30.190 --> 00:37:33.340
There's a new FireWire interface
that's going in probably in

00:37:33.600 --> 00:37:38.080
CUPS 1.1.16 and also in CUPS 1.2.

00:37:39.770 --> 00:37:42.720
If you get Samba, you download it,
you configure it with CUPS support,

00:37:42.760 --> 00:37:45.220
you'll get a program called SMB Spool.

00:37:45.550 --> 00:37:47.680
That is the SMB backend for CUPS.

00:37:53.060 --> 00:37:58.490
Now, a lot of people ask about what can
I do about job accounting when I've

00:37:58.490 --> 00:38:02.210
got a thousand users and they're all
wasting the paper in my printer and what

00:38:02.210 --> 00:38:04.600
do I do to keep track of that stuff?

00:38:04.860 --> 00:38:09.540
Well, each job object in the server,
and it keeps track of things kind

00:38:09.540 --> 00:38:13.220
of in an object-oriented fashion,
though it's not C++

00:38:13.220 --> 00:38:14.960
or anything like that.

00:38:14.960 --> 00:38:19.060
Each job object has a bunch of state
information and as long as that job

00:38:19.060 --> 00:38:23.450
object is being tracked by CUPS,
you'll be able to query that information

00:38:23.450 --> 00:38:27.280
and see how many pages have been printed,
what the state of the job is,

00:38:27.280 --> 00:38:29.990
if it's being held or if it's
completed or if it aborted

00:38:29.990 --> 00:38:34.650
because the printer said,
"Sorry, I can't print Chinese text

00:38:34.660 --> 00:38:38.130
on the printer." You know,
whatever condition happens to occur

00:38:38.250 --> 00:38:42.910
for the job when it's being printed,
that's reflected in that job object.

00:38:45.120 --> 00:38:48.140
Now, when you're printing to
a non-postscript printer,

00:38:48.160 --> 00:38:51.480
the accounting information
is 100% accurate.

00:38:51.480 --> 00:38:54.320
We know this because
when we print a file,

00:38:54.320 --> 00:38:57.650
we're preparing each raster
page or each text page and then

00:38:57.750 --> 00:38:59.300
sending it off to the printer.

00:38:59.300 --> 00:39:03.030
So we know exactly how many pages
we're sending out and so we can keep

00:39:03.030 --> 00:39:05.340
track of the information that way.

00:39:05.340 --> 00:39:07.840
When you go to a postscript printer,
things are a little bit

00:39:07.840 --> 00:39:08.840
different right now.

00:39:08.840 --> 00:39:12.960
It only uses the page comments
in the postscript file.

00:39:13.090 --> 00:39:17.670
Normally you're printing from a
Mac client or a Windows client.

00:39:17.730 --> 00:39:22.950
This isn't a big issue because those
systems do produce DSC compliant files.

00:39:23.630 --> 00:39:26.770
However,
there are some applications and a lot on

00:39:26.770 --> 00:39:30.510
UNIX that tend not to be 100% compliant.

00:39:30.520 --> 00:39:34.630
We do the best we can,
but we can't guarantee right now

00:39:34.630 --> 00:39:38.960
that postscript printers will
have 100% accurate accounting.

00:39:38.960 --> 00:39:43.140
That is coming in CUPS 1.2 when we're
actually adding a back channel support

00:39:43.170 --> 00:39:45.750
so that we can query the printer,
find out from the printer

00:39:45.750 --> 00:39:49.490
how many pages did you print,
and then put that information

00:39:49.600 --> 00:39:51.910
into the database.

00:39:55.390 --> 00:39:59.380
Now, as the file is being printed,
there is a page log file that

00:39:59.380 --> 00:40:02.080
actually lists out every file,
every file that's printed,

00:40:02.140 --> 00:40:04.340
every page that's
printed on each printer,

00:40:04.340 --> 00:40:07.340
what user printed it,
when it was printed.

00:40:07.490 --> 00:40:14.250
So you can actually track down,
if you see that there was

00:40:14.250 --> 00:40:14.880
a failure on the printer,
you can see, oh, well that was on page

00:40:14.880 --> 00:40:14.880
four in the document.

00:40:15.300 --> 00:40:40.800
[Transcript missing]

00:40:43.340 --> 00:40:45.270
Now, quotas is another big thing.

00:40:45.270 --> 00:40:47.070
How do you do quotas with CUPS?

00:40:47.240 --> 00:40:51.440
Well, you can set quotas on
any printer or any class,

00:40:51.550 --> 00:40:54.180
which is a collection of printers.

00:40:54.300 --> 00:40:57.240
The quotas currently are based
on the number of kilobytes

00:40:57.240 --> 00:40:59.690
or the number of pages,
and it can be over a

00:40:59.690 --> 00:41:04.120
specific period of time,
or it can be just forever.

00:41:05.250 --> 00:41:08.120
The current setup you can say,
I want to allow the users to print

00:41:08.220 --> 00:41:12.690
100 pages per week and if they go over
that limit their jobs get cut off.

00:41:12.770 --> 00:41:18.120
You can set one global limit
on each queue for all users.

00:41:19.560 --> 00:41:22.000
That's something also
that is changing in 1.2.

00:41:22.000 --> 00:41:26.980
There's actually an accounting API that
we'll be providing so that you can

00:41:26.980 --> 00:41:31.140
plug in whatever accounting system you
want if it's based off of a database or

00:41:31.140 --> 00:41:34.440
some other specialized functionality.

00:41:34.510 --> 00:41:40.200
When we went out and asked
people what they wanted,

00:41:40.200 --> 00:41:40.490
we got a thousand different answers.

00:41:40.490 --> 00:41:40.490
So we figured that was the best solution.

00:41:42.650 --> 00:41:47.910
Now, another big advantage of CUPS is
how it supports network printing.

00:41:48.010 --> 00:41:50.790
Traditionally,
you have a server and then on

00:41:50.790 --> 00:41:55.820
each client you'll configure it,
say, okay, I want to provide this printer

00:41:55.820 --> 00:41:57.070
and this printer and this printer.

00:41:57.080 --> 00:41:59.760
Then you go to the next client
and you do the same thing.

00:41:59.900 --> 00:42:02.340
And if the server changes
or the queue's changed,

00:42:02.340 --> 00:42:05.560
you have to go to every client and
change them or you have to come

00:42:05.560 --> 00:42:09.930
up with some solution to push the
configuration files out to the clients.

00:42:09.940 --> 00:42:11.360
Not very convenient.

00:42:11.480 --> 00:42:15.140
Certainly for the user it can
be frustrating because if the

00:42:15.200 --> 00:42:21.380
printing situation changes suddenly,
it won't be reflected on their systems.

00:42:21.390 --> 00:42:25.350
So what we do with CUPS is
we use directory services.

00:42:25.370 --> 00:42:27.420
We have two protocols
we support right now.

00:42:27.480 --> 00:42:30.800
In CUPS 1.2 we're probably
going to be adding three more.

00:42:31.150 --> 00:42:33.100
One of them will be zero conf.

00:42:33.100 --> 00:42:35.220
There's also LDAP and so forth.

00:42:35.250 --> 00:42:36.990
We'll cover that later.

00:42:37.360 --> 00:42:40.700
The first native protocol is
called CUPS browsing protocol.

00:42:40.980 --> 00:42:45.190
It's broadcast based,
so it doesn't go past the subnet.

00:42:45.210 --> 00:42:46.210
It's very simple.

00:42:46.420 --> 00:42:49.740
It just sends out,
"I've got a printer here," and then

00:42:49.780 --> 00:42:55.790
the clients receive that and say,
"Okay," and they log it locally so

00:42:55.790 --> 00:42:55.790
that the user will see the printer.

00:42:56.810 --> 00:42:59.430
When the clients are assembling
their list of printers,

00:42:59.430 --> 00:43:01.210
they can create implicit classes.

00:43:01.270 --> 00:43:04.620
It basically means you see two
LaserJet 4000s out there and say,

00:43:04.660 --> 00:43:06.420
"Okay, well,
we'll tell the user there's one

00:43:06.550 --> 00:43:10.080
LaserJet 4000 and they print to it
and it'll go to the first available

00:43:10.080 --> 00:43:14.360
one." So it's very easy to set
up not only redundant printing,

00:43:14.380 --> 00:43:16.310
but load balance printing.

00:43:17.710 --> 00:43:21.230
And of course if you have two labs
and they happen to be on the same

00:43:21.230 --> 00:43:24.790
subnet but you don't want to show
the printers from one lab in one area

00:43:24.790 --> 00:43:27.820
and the other lab in the other area,
you can filter out those

00:43:27.820 --> 00:43:28.880
printers very easily.

00:43:32.220 --> 00:43:35.850
Now, the CUPS browsing protocol,
like I said, is broadcast based.

00:43:35.930 --> 00:43:39.690
It just regularly broadcasts
printer information,

00:43:39.730 --> 00:43:41.990
its available and its current status.

00:43:42.000 --> 00:43:45.280
When the status changes,
it sends out a new broadcast.

00:43:45.360 --> 00:43:47.570
Each broadcast is about
80 bytes per printer.

00:43:47.640 --> 00:43:52.200
It varies on the size of the
server name and the printer name.

00:43:52.410 --> 00:43:56.900
And the default configuration
sends it out every 30 seconds.

00:43:59.020 --> 00:44:02.050
When the clients receive the packet,
they will add the printer

00:44:02.120 --> 00:44:03.860
if it's not already there.

00:44:03.920 --> 00:44:06.340
And if it is there, it will say, "Okay,
I saw this printer,

00:44:06.340 --> 00:44:12.110
so I'm not going to try to remove it
in the timeout interval." The default

00:44:12.110 --> 00:44:14.320
timeout interval is like 300 seconds.

00:44:14.440 --> 00:44:17.850
So if it doesn't receive
an update after 10 tries,

00:44:17.850 --> 00:44:21.000
then it says,
"The server must be down or the printer's

00:44:21.000 --> 00:44:25.100
gone away." And it will remove it
from the list of available printers.

00:44:25.100 --> 00:44:29.110
So if you were at the
networking session before,

00:44:29.240 --> 00:44:33.080
the laptop that got
connected to the printer,

00:44:33.110 --> 00:44:36.100
it made the printer available
on the network and the other

00:44:36.100 --> 00:44:39.880
computer saw it immediately and
added that to the user interface.

00:44:39.920 --> 00:44:42.000
That's that functionality here.

00:44:44.580 --> 00:44:49.930
Now as far as the client support,
CUPS provides native IPP and LPD support.

00:44:50.020 --> 00:44:54.310
The IPP support is right in the
scheduler and the LPD support is

00:44:54.310 --> 00:44:56.970
through the CUPS LPD mini daemon.

00:44:58.000 --> 00:45:01.770
The mini-daemon approach
was chosen because,

00:45:01.800 --> 00:45:06.940
number one, LPD is not the friendliest
of protocols to deal with,

00:45:07.010 --> 00:45:11.070
and number two,
it was a lot easier to do it that way and

00:45:11.440 --> 00:45:14.980
assure that the scheduler itself would
not get caught up in some state where

00:45:14.980 --> 00:45:17.960
it wouldn't be able to recover from.

00:45:20.110 --> 00:45:22.740
IPP supports encryption.

00:45:22.890 --> 00:45:29.310
We use the OpenSSL library to provide
128 bit SSL and TLS encryption.

00:45:30.200 --> 00:45:34.330
We support both persistent encryption,
so when you connect it's

00:45:34.330 --> 00:45:37.490
always using encryption,
and also HTTP upgrade,

00:45:37.490 --> 00:45:40.160
so that you can upgrade
from a non-encrypt,

00:45:40.160 --> 00:45:44.270
unencrypted connection to an
encrypted connection before you

00:45:44.420 --> 00:45:46.380
actually send the print job.

00:45:46.380 --> 00:45:51.200
You notice if you do a man on LP or LPR,
they support an option minus capital

00:45:51.210 --> 00:45:53.570
E that will encrypt your job.

00:45:53.580 --> 00:45:59.160
So if you do LPR minus E, mycontract.pdf,
it'll send that job to

00:45:59.160 --> 00:46:02.300
the CUPS server encrypted,
so that nobody else

00:46:02.480 --> 00:46:03.590
will be able to see it.

00:46:03.600 --> 00:46:06.240
You know, as much protection as
you can get from that.

00:46:08.000 --> 00:46:10.930
You can enable the encryption
on all requests or you

00:46:11.000 --> 00:46:12.600
can just make it optional.

00:46:12.700 --> 00:46:16.770
The encryption can be required by the
client or by the server or by both.

00:46:16.770 --> 00:46:18.760
It's a very flexible scenario.

00:46:22.510 --> 00:46:27.200
Now as I mentioned before,
printer drivers use PPD files.

00:46:27.200 --> 00:46:31.450
We use the standard PPD files that
you get for any PostScript printer

00:46:31.450 --> 00:46:33.210
for Windows or Mac OS.

00:46:33.480 --> 00:46:35.240
And if you have a
non-post-script printer,

00:46:35.240 --> 00:46:38.510
you're still using a PPD file and
it's got some extra information

00:46:38.620 --> 00:46:41.590
to tell CUPS that it's a
non-post-script printer file.

00:46:41.870 --> 00:46:47.680
Besides the CUPS filter attribute,
there's also color profile attributes.

00:46:47.680 --> 00:46:50.310
There's an attribute to specify
whether or not the printer

00:46:50.310 --> 00:46:53.620
can produce its own copies,
and other assorted attributes

00:46:53.620 --> 00:46:57.220
that you can use to tell the
scheduler and any filters that you

00:46:57.220 --> 00:46:59.070
need special behavior from them.

00:47:02.370 --> 00:47:05.970
As far as clients are concerned,
they get the PPD file for

00:47:05.970 --> 00:47:07.470
the printer using HTTP.

00:47:07.750 --> 00:47:13.170
The URL for printer might be
IPP://servername/printer/fu

00:47:13.170 --> 00:47:18.720
and the PPD file would be
servername/printer/fu.ppd.

00:47:18.720 --> 00:47:21.680
So it's very easy to get the PPD file.

00:47:21.680 --> 00:47:26.000
The CUPS API provides a complete
set of functions for accessing this.

00:47:26.000 --> 00:47:29.310
So if you wanted to get a PPD file,
there's a function called

00:47:29.460 --> 00:47:33.010
CUPS Get PPD and you get a
PPD file and you can open it up

00:47:33.010 --> 00:47:35.530
and do whatever you need with it.

00:47:38.070 --> 00:47:42.220
Now that API provides not only
those convenience functions

00:47:42.220 --> 00:47:46.230
for doing the day-to-day stuff
your application might need.

00:47:46.290 --> 00:47:50.810
They also provide the low-level
functions for HTTP and IPP.

00:47:50.860 --> 00:47:54.750
Now, like the Apple solutions,
they're all finite state machine

00:47:54.750 --> 00:47:58.590
based and they keep track of
all the stuff for doing SSL and

00:47:58.590 --> 00:48:01.060
TLS and digest authentication.

00:48:01.110 --> 00:48:06.860
All that stuff is very straightforward,
very fast and very simple.

00:48:07.930 --> 00:48:12.170
The PPD files are accessed
using PPD functions,

00:48:12.370 --> 00:48:15.990
obviously,
and they load in all of the attributes

00:48:15.990 --> 00:48:18.880
in the PPD file so that you can
access them from your program rather

00:48:18.880 --> 00:48:21.780
than writing your own PPD parser.

00:48:23.690 --> 00:48:27.480
The other part of the CUPS libraries
that are installed on the system is

00:48:27.490 --> 00:48:29.880
something called the imaging library.

00:48:29.990 --> 00:48:33.740
Now, aside from supporting the printer
drivers with the raster functions,

00:48:33.880 --> 00:48:37.940
these are also used by the image
filters to load image files,

00:48:38.050 --> 00:48:41.580
do scaling on the fly,
and do color space conversion

00:48:41.680 --> 00:48:43.500
and color management.

00:48:43.870 --> 00:48:46.540
This normally you wouldn't
use in your applications,

00:48:46.700 --> 00:48:49.540
but in your filters you might
find them useful if you're

00:48:49.540 --> 00:48:50.390
dealing with raster images.

00:48:52.530 --> 00:48:55.380
The scaling modes that are
supported are nearest neighbor,

00:48:55.390 --> 00:48:58.540
which is used for draft output,
and bilinear.

00:48:58.620 --> 00:49:02.120
We're also adding bicubic in CUPS 1.2.

00:49:03.720 --> 00:49:07.680
Now, besides the book,
there's a lot of documentation that

00:49:07.680 --> 00:49:11.660
comes standard with CUPS for the
end user and for the developer.

00:49:11.720 --> 00:49:14.180
There's a typical administrator's
manual that takes you

00:49:14.180 --> 00:49:16.660
through how to set up CUPS,
how to add printers,

00:49:16.770 --> 00:49:20.440
how to do the typical
administrative type of things.

00:49:20.520 --> 00:49:23.390
There's a programmer's manual
that's a reference and a

00:49:23.390 --> 00:49:25.390
tutorial for the CUPS API.

00:49:25.480 --> 00:49:29.200
And there's the user's manual that has
all the stuff the user might need to

00:49:29.210 --> 00:49:33.260
know on setting up printer instances,
printing files with special

00:49:33.400 --> 00:49:35.160
options and so forth.

00:49:35.160 --> 00:49:39.320
And of course, the ubiquitous man pages
where you do a man LPR,

00:49:39.450 --> 00:49:41.560
man filter,
and you get your quick summary.

00:49:43.740 --> 00:49:47.990
Now, aside from the normal kind
of documentation you get,

00:49:48.000 --> 00:49:52.150
we have a lot of documentation
that we've generated,

00:49:52.170 --> 00:49:56.990
primarily because we came from the
military arena and this kind of

00:49:57.230 --> 00:49:59.980
documentation is standard there.

00:50:00.010 --> 00:50:02.680
So there's a configuration
management plan.

00:50:02.680 --> 00:50:06.950
If you do code submissions for CUPS,
there are guidelines in there for how the

00:50:06.950 --> 00:50:09.390
code has to be formatted and documented.

00:50:09.450 --> 00:50:13.280
It's very straightforward,
no stringent requirements,

00:50:13.370 --> 00:50:15.720
just a basic this is how we do things.

00:50:16.590 --> 00:50:20.250
There's a document that describes
the CUPS implementation of IPP.

00:50:20.340 --> 00:50:25.060
If you're doing specific IPP requests,
you'll want to look at that document

00:50:25.160 --> 00:50:29.310
because it does describe every single
attribute and every single operation we

00:50:29.660 --> 00:50:32.430
support and how they're used within CUPS.

00:50:32.860 --> 00:50:37.300
The interface design document covers
all of the interfaces within CUPS,

00:50:37.360 --> 00:50:39.680
both internal and external.

00:50:39.900 --> 00:50:42.690
If you're using anything
with the raster filters,

00:50:42.690 --> 00:50:43.910
it's useful there.

00:50:44.070 --> 00:50:49.440
A lot of the content there refers
to publicly available specifications

00:50:49.440 --> 00:50:51.610
such as IPP and the PPD spec.

00:50:52.150 --> 00:50:57.060
The overview document is kind of a
short version of this presentation

00:50:57.060 --> 00:51:01.940
and it covers all of the functionality
that's in the printing system.

00:51:01.940 --> 00:51:06.370
Software design description is
your typical high level design

00:51:06.370 --> 00:51:11.880
document that kind of sort of gives
you an idea of what the printing

00:51:11.880 --> 00:51:14.980
system does and how it does it,
but you really need to look

00:51:14.980 --> 00:51:18.380
at the code because it doesn't
go to the detailed level.

00:51:18.380 --> 00:51:23.600
Software security report is something we
developed in response to Linux vendors

00:51:23.600 --> 00:51:28.860
specifically that wanted to know what
are the risks involved with using CUPS.

00:51:29.080 --> 00:51:32.400
And you're providing this
IPP printing service and doing

00:51:32.400 --> 00:51:34.250
all these things with a network.

00:51:34.390 --> 00:51:37.920
How is that going to affect the security
on the system and what are the risks?

00:51:37.920 --> 00:51:40.430
This document describes them.

00:51:40.600 --> 00:51:42.960
There's a translation manual.

00:51:42.960 --> 00:51:45.240
A lot of people have been submitting
translations for a very long time.

00:51:45.250 --> 00:51:45.880
I'm not going to go into all the
details of the translation manual.

00:51:45.880 --> 00:51:45.880
But I'm going to go through
the manual and I'm going to

00:51:45.880 --> 00:51:45.880
go through the instructions.

00:51:45.880 --> 00:51:45.880
So, the first thing that you're going
to do is you're going to go through

00:51:45.880 --> 00:51:45.920
the manual and you're going to go
through the manual and you're going

00:51:45.920 --> 00:51:45.950
to go through the instructions.

00:51:45.950 --> 00:51:46.080
And then you're going to go
through the instructions.

00:51:46.080 --> 00:51:46.120
And then you're going to go
through the instructions.

00:51:46.120 --> 00:51:47.480
And then you're going to go
through the instructions.

00:51:47.570 --> 00:51:49.750
So, that's a little bit more of a
general overview of what the

00:51:49.960 --> 00:51:51.380
instructions are going to do.

00:51:51.380 --> 00:51:53.720
I'm going to go through the instructions.

00:51:53.720 --> 00:51:56.180
And then I'm going to go
through the instructions.

00:51:56.190 --> 00:51:58.710
And then I'm going to go
through the instructions.

00:51:58.720 --> 00:52:01.920
So, the first thing that you're
going to do is you're going to

00:52:01.930 --> 00:52:03.720
go through the instructions.

00:52:03.720 --> 00:52:05.670
And then you're going to go
through the instructions.

00:52:05.670 --> 00:52:07.740
And then you're going to go
through the instructions.

00:52:08.300 --> 00:52:10.610
And finally,
there's a software version description

00:52:10.610 --> 00:52:15.290
document which outlines the changes from
the old versions to the new versions.

00:52:15.300 --> 00:52:19.210
It's pretty boring and if you
look at the change log you'll

00:52:19.240 --> 00:52:20.580
probably get more information.

00:52:23.050 --> 00:52:25.570
Okay,
what's coming in the new version of CUPS?

00:52:25.660 --> 00:52:29.300
This is not what you'll have in Jaguar,
but you'll probably see

00:52:29.300 --> 00:52:32.430
this in some future version,
I'm sure.

00:52:32.630 --> 00:52:35.510
IP version 6 support is high on the list.

00:52:35.590 --> 00:52:39.460
Obviously, a lot of people are looking at
this seriously now because we're

00:52:39.460 --> 00:52:42.210
running out of version 4 addresses.

00:52:42.370 --> 00:52:46.850
The current version of CUPS 1.2,
there is a development tree

00:52:46.850 --> 00:52:48.820
in CVS that you can download.

00:52:48.840 --> 00:52:51.980
That version is fully
IP version 6 functional,

00:52:52.000 --> 00:52:57.010
except it doesn't support version
6 IP addresses and URLs yet.

00:52:57.080 --> 00:52:59.200
That is being addressed.

00:52:59.200 --> 00:53:02.030
It also will have full
ICC color profile support.

00:53:02.030 --> 00:53:05.870
The beginnings of that are in there,
but not complete yet.

00:53:05.890 --> 00:53:08.140
It should be within the month.

00:53:08.210 --> 00:53:13.350
There's support for two new
operations from the IPP standard.

00:53:13.370 --> 00:53:18.180
One is called Print URI,
so you can say print/dot.org and it

00:53:18.180 --> 00:53:20.940
will go and grab the home page from
there and print it out on your printer.

00:53:20.960 --> 00:53:22.960
And then you can print
it out on your printer.

00:53:22.960 --> 00:53:25.740
And similarly,
send URIs used when you're sending

00:53:25.740 --> 00:53:29.440
an individual page in a collection
of pages rather than just one.

00:53:31.380 --> 00:53:34.590
One of the things that we get
often is people want to print

00:53:34.590 --> 00:53:36.600
a compressed PostScript file.

00:53:36.660 --> 00:53:40.080
You have a document from the
internet that's been gzipped.

00:53:40.150 --> 00:53:43.750
This will allow you to do that and it
tells the scheduler that the document

00:53:43.750 --> 00:53:48.450
is compressed and actually will send the
document to the scheduler even if it's

00:53:48.450 --> 00:53:51.350
off in some other place in the world.

00:53:51.720 --> 00:53:54.910
It will keep it compressed
until it gets to the server.

00:53:55.670 --> 00:53:58.700
Another big thing is IPP notifications.

00:53:58.700 --> 00:54:04.320
We have a lot of new events that we're
adding to the standard IPP notifications.

00:54:04.320 --> 00:54:09.930
So whenever the printers change,
whenever you have a fault on the job,

00:54:10.030 --> 00:54:14.820
you can get notified of that and
take whatever appropriate action.

00:54:14.900 --> 00:54:18.260
There's three notification
methods we'll be supporting:

00:54:18.300 --> 00:54:20.110
IPP Get, INDP and Mailto.

00:54:20.250 --> 00:54:23.310
Mailto is probably the
one you usually use.

00:54:23.890 --> 00:54:25.800
LDAP support, another big one.

00:54:25.990 --> 00:54:30.100
We may be supporting authentication,
certainly the directory services

00:54:30.100 --> 00:54:32.920
for listing the available printers.

00:54:32.920 --> 00:54:36.640
Another big addition for the
backends is back channel support,

00:54:36.670 --> 00:54:39.510
so you can actually feed data
from the print drivers into the

00:54:39.510 --> 00:54:42.580
backend and then the printer
responds back with some message.

00:54:42.780 --> 00:54:48.220
That'll make its way back to the printer
driver and you can do your chats with the

00:54:48.220 --> 00:54:53.490
printer to find out if it's got the right
ink cartridge in there and so forth.

00:54:55.550 --> 00:54:56.950
Mentioned before, Firewire.

00:54:57.310 --> 00:55:00.650
There are some printers out there
that only work good with Firewire.

00:55:00.700 --> 00:55:04.670
Why that should be, I don't know,
but they take a lot of data

00:55:04.670 --> 00:55:08.640
and they really need the
speed that Firewire offers.

00:55:08.780 --> 00:55:10.100
We're working on Linux right now.

00:55:10.100 --> 00:55:12.060
We'll be adding support for Darwin.

00:55:12.130 --> 00:55:16.330
It will be in there and it will probably
be the fastest interface we support.

00:55:18.510 --> 00:55:20.270
There's also extended PPD options.

00:55:20.490 --> 00:55:24.520
Right now everything's restricted
to a Boolean or pick from a list,

00:55:24.640 --> 00:55:26.630
or pick many from a list.

00:55:26.630 --> 00:55:31.950
We're adding support for additional
things so you can specify a number and

00:55:31.970 --> 00:55:34.570
text and different types of attributes.

00:55:34.570 --> 00:55:36.300
Those are going in there.

00:55:36.300 --> 00:55:39.800
They have kind of a backwards
compatibility mode for

00:55:39.800 --> 00:55:41.740
standard printer drivers.

00:55:41.740 --> 00:55:44.880
So they'll see a standard PPD file
with some funny attributes

00:55:44.880 --> 00:55:48.030
that are intermixed in there,
but they'll ignore them.

00:55:48.240 --> 00:55:52.400
And the CUPS-aware applications will see,
oh, this is a special attribute

00:55:52.400 --> 00:55:55.600
and I can act accordingly.

00:55:55.710 --> 00:55:59.480
This is mostly in response to the
GIMP print project where they want to

00:55:59.480 --> 00:56:02.880
have a slider for the gamma control
for each of the individual color

00:56:03.080 --> 00:56:06.330
channels and the density and so forth.

00:56:07.480 --> 00:56:13.560
Another feature that's been requested a
lot is policies for the IPP operations.

00:56:13.620 --> 00:56:17.750
Right now, you can say, "Alright,
I only want people in this group to be

00:56:17.750 --> 00:56:23.410
able to add printers." But that also
applies to starting and stopping printers

00:56:23.410 --> 00:56:29.030
and accepting and rejecting jobs,
basically doing any administrative tasks.

00:56:29.030 --> 00:56:32.390
So the new policy mechanism
will allow you to say,

00:56:32.460 --> 00:56:35.720
"Well,
users from this group can do printer

00:56:35.720 --> 00:56:42.010
administration on this printer." Or,
"These users are allowed to cancel jobs,

00:56:42.010 --> 00:56:47.110
but they're not allowed to start and
stop the printer." Be very flexible.

00:56:47.110 --> 00:56:52.510
You have total control over individual
IPP operations and print CUPS.

00:56:53.660 --> 00:56:57.560
The new version also has
extended raster support.

00:56:57.670 --> 00:57:01.080
One of the comments that
we've received in the past is,

00:57:01.080 --> 00:57:04.510
"Well, you don't have enough user-defined
options in there for us to

00:57:04.600 --> 00:57:07.490
pass into the reps." Or,
"You don't have 16-bit

00:57:07.490 --> 00:57:11.900
per channel support," or,
"You don't have ICC color spaces." Well,

00:57:12.070 --> 00:57:16.570
that's all coming in the new
version and it works very well.

00:57:17.340 --> 00:57:22.530
Finally, there's full localization for
the command line interfaces.

00:57:22.770 --> 00:57:24.270
Right now you get English.

00:57:24.270 --> 00:57:28.010
In the future you'll get whatever
language you happen to be talking

00:57:28.010 --> 00:57:32.140
and the interface also supports
transcoding to local character sets.

00:57:32.250 --> 00:57:36.760
So message catalogs are in UTF-8 and
you'll get them in whatever character

00:57:36.760 --> 00:57:39.080
set you happen to be configured for.

00:57:41.190 --> 00:57:42.100
Just what I said.

00:57:42.200 --> 00:57:44.640
There will be more printer drivers.

00:57:44.700 --> 00:57:48.540
We're looking to include drivers
for Canon and also we'll probably

00:57:48.540 --> 00:57:57.090
have the full set of Xerox,
HP, Okidata, Genicom and

00:57:57.700 --> 00:57:58.120
I forget.

00:57:58.230 --> 00:58:01.290
There's another printer manufacturer,
but they've all agreed to

00:58:01.360 --> 00:58:04.860
provide us with PPDs and we can
provide them standard with CUPS.

00:58:05.000 --> 00:58:10.370
So the number of drivers
that will be available out of

00:58:10.370 --> 00:58:10.370
the box will be substantial.

00:58:11.360 --> 00:58:14.870
One problem that we ran into with
USB and will probably run into with

00:58:15.000 --> 00:58:19.400
Firewire is you disconnect a device and
then you connect a different one and

00:58:19.410 --> 00:58:23.250
the print system still thinks it has,
you know, you disconnect an HP,

00:58:23.250 --> 00:58:26.680
you connect an Epson,
it still thinks it has an HP connected.

00:58:26.680 --> 00:58:30.580
There will be a new device monitor that
will keep track of those changes and

00:58:30.580 --> 00:58:35.320
automatically update the print cues as
needed so that they can still operate.

00:58:39.240 --> 00:58:41.290
Well, Richard mentioned the CUPS website.

00:58:41.500 --> 00:58:44.430
There's also our website for our company.

00:58:44.550 --> 00:58:48.360
There's the commercial version
of CUPS called ESP Print Pro that

00:58:48.360 --> 00:58:51.600
may or may not make its way
into Darwin or into Mac OS,

00:58:51.600 --> 00:58:54.420
but we provide a lot of
printer drivers there,

00:58:54.420 --> 00:58:56.260
over 3,000 right now.

00:58:56.260 --> 00:59:01.730
And then there's the GIMP Print Project,
which has all of the free drivers for

00:59:01.920 --> 00:59:05.820
various inkjet printers primarily.

00:59:05.820 --> 00:59:09.910
There's also OMNI and HPIJS and so on.

00:59:09.970 --> 00:59:12.710
You go to any of these pages,
you'll be able to find links to

00:59:12.710 --> 00:59:15.940
all of the available open source
and commercial drivers for CUPS.

00:59:20.070 --> 00:59:21.520
A lot of add-ons for CUPS.

00:59:21.650 --> 00:59:24.800
There's a SourceForge project
out there for those add-ons.

00:59:24.800 --> 00:59:28.830
So it's basically any kind of

00:59:28.930 --> 00:59:29.900
Thank you.

00:59:29.900 --> 00:59:30.900
Richard Blaenchard: Thank you.

00:59:30.900 --> 00:59:32.120
So, the first thing you're looking for,
a graphics panel or a printer driver,

00:59:32.140 --> 00:59:33.810
you'll find it there as well.

00:59:33.850 --> 00:59:38.520
And then, for any information on IPP,
go to the printer working group web page.

00:59:38.520 --> 00:59:43.780
They're the ones that actually run
the working group for developing IPP.

00:59:43.780 --> 00:59:46.590
They work in conjunction with
the IETF IPP working group.

00:59:46.710 --> 00:59:50.770
In fact, most of the members are
shared between the two groups.

00:59:50.820 --> 00:59:56.290
And that's where you'll find all the
IPP specs and all the stuff that's

00:59:57.940 --> 01:00:00.780
And those are the RFCs
you want to look at.

01:00:00.780 --> 01:00:06.410
2910 and 2911 are the current
IPP 1.1 specifications.

01:00:06.540 --> 01:00:10.170
There are a bunch of new RFCs that
hopefully within the next couple

01:00:10.660 --> 01:00:12.400
months will actually be published.

01:00:12.400 --> 01:00:14.880
They've been in the queue
for a little over a year now.

01:00:14.930 --> 01:00:17.290
And they're catching up.

01:00:17.320 --> 01:00:21.300
It's been a little difficult
to get them published.

01:00:21.300 --> 01:00:25.590
And the old LPD specification 1179,
if you have a particular

01:00:25.590 --> 01:00:30.340
problem with an LPD client,
you can use this to reference that and

01:00:30.340 --> 01:00:34.100
see if there's anything we're doing wrong
or if anything your client's doing wrong.

01:00:34.100 --> 01:00:36.570
And with that...

01:00:47.200 --> 01:00:49.190
I'm an imaging evangelist.

01:00:49.200 --> 01:00:52.560
I'm responsible for most of the
graphics tracks here at WWDC.

01:00:52.560 --> 01:00:57.520
What I wanted to do is sort of
bring things together for a moment.

01:00:57.520 --> 01:00:59.190
What we've done here
is tell you about CUPS,

01:00:59.290 --> 01:01:02.270
the printing architecture
that's being put into Darwin.

01:01:02.300 --> 01:01:05.930
And we've told you about CUPS in terms
of what its full functionality is on

01:01:05.930 --> 01:01:09.080
Darwin and other forms of UNIX and Linux.

01:01:09.080 --> 01:01:11.810
There's a second part to that story,
and that story is how

01:01:11.810 --> 01:01:14.650
Mac OS X as an operating system
is going to leverage CUPS.

01:01:14.810 --> 01:01:18.110
And that's actually what's
happening tomorrow in Hall 2

01:01:18.110 --> 01:01:20.600
at 10:30 in the morning.

01:01:20.600 --> 01:01:24.280
In the printing and Mac OS X session,
we're going to spend a lot of time

01:01:24.280 --> 01:01:27.970
communicating how we plan to leverage
CUPS and expose it in terms of UI and

01:01:27.970 --> 01:01:30.120
functionality in the operating system.

01:01:30.120 --> 01:01:31.520
So it's sort of the companion piece.

01:01:31.520 --> 01:01:33.760
They're basically bookends.

01:01:33.760 --> 01:01:36.710
So if you like what you heard in this
session and you need to find out more

01:01:36.710 --> 01:01:40.280
about the specifics of what we're going
to plan to do with CUPS and Mac OS X,

01:01:40.280 --> 01:01:41.920
please attend that session.

01:01:41.960 --> 01:01:41.960
Thank you.

01:01:43.480 --> 01:01:46.100
Now, if you need to contact me
with any questions relating

01:01:46.100 --> 01:01:48.820
to graphics and imaging and
specifically printing and CUPS,

01:01:48.820 --> 01:01:52.440
please feel free to send me
an email at travis@apple.com.

01:01:52.530 --> 01:01:54.660
That's my email address up there.

01:01:54.770 --> 01:01:59.250
And what I want to do is bring up a
Q&A panel so we can field questions

01:01:59.250 --> 01:02:01.680
from the audience relative to what
we've spoken about here today.