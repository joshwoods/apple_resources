# Wwdc2025 234

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Summary

Transcript

Code

Filter and tunnel network traffic with NetworkExtensionLearn about the APIs in the NetworkExtension framework that give your app the power and flexibility to extend the system's core networking features — like implementing network content filters, creating and managing VPN configurations, and more. In iOS, iPadOS and macOS 26, you can now build robust content filters that make traffic decisions using the entire URL — not just the hostname — all without compromising privacy and security. We'll start by briefly covering many of the key use cases for the NetworkExtension framework, including network relays and VPN. Then, we'll dive into the new URL filter API and its key components, including Private Information Retrieval, Privacy Pass, and more.Chapters0:00 -Welcome1:48 -Tour NetworkExtension3:21 -Access remote resources8:40 -Filter content10:54 -Create URL filtersResourcesFiltering traffic by URLNEHotspotManagerNetwork ExtensionNEURLFilterManagerPIRServiceTN3120: Expected use cases for Network Extension packet tunnel providersTN3165: Packet Filter is not APIverdict(for:)HD VideoSD VideoRelated VideosWWDC25Integrate privacy into your development processWWDC19Network Extensions for the Modern Mac

Learn about the APIs in the NetworkExtension framework that give your app the power and flexibility to extend the system's core networking features — like implementing network content filters, creating and managing VPN configurations, and more. In iOS, iPadOS and macOS 26, you can now build robust content filters that make traffic decisions using the entire URL — not just the hostname — all without compromising privacy and security. We'll start by briefly covering many of the key use cases for the NetworkExtension framework, including network relays and VPN. Then, we'll dive into the new URL filter API and its key components, including Private Information Retrieval, Privacy Pass, and more.

0:00 -Welcome

1:48 -Tour NetworkExtension

3:21 -Access remote resources

8:40 -Filter content

10:54 -Create URL filters

Filtering traffic by URL

NEHotspotManager

Network Extension

NEURLFilterManager

PIRService

TN3120: Expected use cases for Network Extension packet tunnel providers

TN3165: Packet Filter is not API

verdict(for:)

HD VideoSD Video

HD Video

SD Video

Integrate privacy into your development process

Network Extensions for the Modern Mac

Search this video…Hi, my name is Maria Alice Dos Santos,and I am part of the Internet Technologies team at Apple.I’m here to tell you all about the Network Extension frameworkand its latest advances in iOS and macOS 26.Network Extension is a framework that provides a rich suite of APIsfor you to build apps that extend and customizenetworking capabilities on Apple platforms.Network Extension apps work seamlessly throughout the networking stack,integrated closely with Network framework,CFNetwork, WebKit, and Sockets APIas well as system-level components like routing, traffic policy,and all types of system management.This allows Network Extension to achieve the desired functionalitiesin the most optimized manner,in terms of networking performance and security.Network Extension is a powerful frameworkthat lets you alter networking across the system.To make sure your app works consistently with other apps and with the system,it’s essential to pick the right API for the type of app you want to build.In this session, I will introduce you to the wide range of appsyou can create using Network Extension framework,and the ways you can create apps to access remote resourcesby using relays and VPNs.I will also discuss how you can create content filters using Network Extension,including a new way to create a URL-based filter in iOS and macOS 26.Network Extension framework supports various ways for your appsto customize and extend networking capabilities.On iOS, the Wi-Fi Management and Hotspots APIs allow your appsto configure Wi-Fi settings and interact with Wi-Fi hotspots.This includes the new NEHotspotHelper extension API in iOS 26.iOS apps can also use the Local Push API.This is for apps used on networks without accessto the Apple Push Notification service, like cruise ships or hospitals.This lets you support features like text messaging and Voice-over-IP callswhile on the restricted network.You can build a security app to protect DNS trafficfrom attacks by using the DNS Configuration and Proxy API.You can install a DNS configurationand use this built-in encrypted DNS protocols,or proxy DNS traffic over your own security channel.Mac apps can use the Transparent Proxy API,for example, to divert traffic for a specific websiteto a cloud-based security service for authentication and authorization.You can also build apps that let people access remote resources securely,or apps that protect people by securely and privatelyfiltering the content they access on the network.Secure Remote Access is a broad categorythat covers many different ways people connect to internal systemssecurely from outside,or to protect personal traffic on unsecured networksby tunneling traffic from a device to a remote server.With Network Extension, there are two main approaches to consider.Network relays and IP-based VPN.Use the one that best suits your needdepending on the type of traffic you want to tunnel.Consider Network relays instead of traditional VPNswhen you want to tunnel TCP or UDP traffic to access specific apps.For example, cloud-hosted enterprise apps,like for email or collaboration, are a great fit for relays.The MASQUE protocol enables secure proxying,optimized for performance.It can easily be integrated into modern cloud environments.And since the platform has built-in support for relays,you don't need to build your own extension to take advantage of it.You can just configure your relay settings and authenticationusing NERelayManager API,or through a configuration profile from the MDM server.If you want to tunnel IP traffic, use the IP-based VPN option.For example, IP-based VPNs can be used in the enterpriseto extend the corporate network to employees,giving them full network access as if they were physically in the office.This solution is ideal for long-term trusted employeeswho need persistent or full tunnel access to the company network.Or, highly regulated organizations, with stringent network security policies,may need to send all traffic from their managed devicesthrough the corporate network.People may also want to protect their traffic with a VPNover unsecured networks to preserve their privacy and anonymity.To create an IP-based VPN tunnel,use the NEVPNManager API to leverage one of the built-in protocols,IKEv2 or IPsec, or use the NEPacketTunnelProviderto implement your own custom tunneling protocols.When creating an IP-based VPN,your implementation tells the system what traffic to tunnel,with specific included and excluded routes.On macOS, the routing table could be modifiedoutside of your app by an administrator or another process.More precise routes could interfere with your VPN routes.Network Extension lets your app enforce its VPN routes to ensurethey take precedence and are honored at all times.Network Extension makes it easy for your appto manage your tunnels routing requirements.For a split-tunnel VPN, you can enable the enforceRoutes optionto enforce both the included routes and excluded routes.For a full-tunnel VPN, you can turn on the includeAllNetworks optionto enforce all traffic to be routed through your tunnel.When this option is enabled, any specified excludedRoutes will have no effect.Both of these options support configurable exceptionsto allow a system-defined set of traffic to go outside the tunnelso that essential services work as expected while your VPN is running.For instance, turn on excludeLocalNetworksif you want local network services like AirDropand AirPlay to bypass tunnel.Or turn on other exceptions to allow services like calls and messaging,the Apple Push Notification service,and device communication to bypass the tunnel.Most of these exceptions are enabled by default,but allow customization to fit your security need.Network Extension is the supported API to build a VPN app.It works seamlessly with other networking and system components.Building a VPN app with anything else is highly discouraged.Avoid using Packet Filter or directly modifying the routing table on the Mac.This is not supported and risk clashing with traffic filtering and routing rulesinstalled by the system or other apps.If your VPN app doesn’t use Network Extension today,you should migrate as soon as possible.This will ensure your app remains compatible with the systemand all of its key functionality that your customers expect,like working in harmony with features such as AirDrop,Mac Virtual Display, Xcode, as well as Continuity features like sidecar.Use NEPacketTunnelProvider only to tunnel IP traffic.Using it to accomplish any other goals is not recommended.NEPacketTunnelProvider operates at the IP layer,and will not receive flow or application level metadataneeded to do other things, like proxying DNS requests or content filtering.If your goal is to filter content,use the Content Filter API, which I will cover next.The Content Filter API allows you to introspect traffic on deviceto monitor or to make filtering decisionsas traffic flows through the networking stack.A common use case is a personal firewall,which examines and blocks traffic flowsthat are deemed malicious for a personal device.Or an enterprise traffic monitoring app, for managed devices,to monitor all inbound and outbound network traffic,for employees in highly secure environments.Create a subclass of one or both of the content filter providersto get the desired traffic.NEFilterDataProvider provides you with TCP and UDP flows,as well as other IP protocol traffic, such as ICMP.For mac apps, a subclass of NEFilterPacketProviderwill get Layer 2 packets.Filter providers cannot modify traffic,but simply provide a filter verdict to the system,either to allow or drop the flow.iOS system-wide content filter is supported on supervised devices only.Content filters using NEFilterDataProviderand NEFilterPacketProvider are great if your app needs to filter contentbased on the traffic flow or through packet inspection.But sometimes you might want to filter based on application-level metadata,like the URL.With a traditional content filter,your app can make filtering decisions based on the traffic-level information,like the host and port of this HTTPS request.But some apps may not want to block entire sites,but instead filter specific resources.HTTPS requests are encrypted, so a traditional content filterwould not have access to the necessary detail of the URL requestto make an accurate filtering decision,like the specific resource requested, or query parameters in the URL.Starting in iOS 26, you can create a new type of filter, a URL Filter,which makes content filtering decisions based on the full URL.Network Extension URL Filter allows you to filter system-wide HTTP and HTTPS requests,matching against the full URL of the request.This technology allows you to build appsthat block specific resources on the internet.For example, you can build a parental control appto protect children from harmful websites.An app for schools might use a filter to prevent studentsfrom accessing social media,gambling, or other sensitive content across many websites.Or enterprises may want to block non-work-related content for employees.At Apple, we believe privacy is a fundamental human right.URL Filtering uses state-of-the-art cryptographyto let you build apps that effectively make filtering decisionsbased on the full URL, without compromising privacy.URLs can reveal sensitive information like unique identifiers, or browsing history.Network Extension is designed to allow you to build a content filterthat makes accurate filtering decisions based on the full URL.But the URL contents are not revealed to the app,and all database queries to the backend servers are anonymized to protect privacy.The entire chain of backend servers, both Apple’s and your servers,will have no access to any of the content and identity information.URL Filtering is performed with your URL data set,containing URLs you want to block.You provide an on-device prefilter and an off-device database serverfor URL lookups.The system performs the entire filtering process on your behalf with your data set.Your app does not execute in the filtering pathand has no access to traffic.The system performs on-device prefilter to improve performanceand may perform off-device database lookups for final verdicts.All off-device database exchanges are protectedto ensure content and identity privacy preservation.With strong privacy preservation,URL Filters are supported on both managed and unmanaged devices.Before I go into how the feature works,I will introduce the technologies that serve as the building blocks.There are four technologies that URL Filter relies on, and they are:Bloom filters, Private Information Retrieval,Privacy Pass, and Oblivious HTTP Relay.I will start with Bloom filters.For URL Filtering, Network Extension will use the Bloom filter you buildwith your URL data set containing URLs you want to block.A Bloom filter is constructed from a predefined data setby hashing each element in the set using multiple hash functionsand setting the corresponding bits in a fixed-size bit array.Once built, you can use the Bloom filterto test whether an element is a member of the set.Bloom filters will never produce false negatives,but may produce false positives.Your Bloom filter will be used as a prefilter for a quick check.If the match is negative,the checked URL is definitively not part of your URL data setand will be allowed immediately without further verification.If the match is positive,the match result is not definitive due to potential false positives.Further verification, such as an off-device database lookup,will be necessary to reach a conclusive verdict.Using a Bloom filter as a prefiltergreatly reduces off-device database lookups, improving performance.The second key technology is Private Information Retrieval.Private Information Retrieval, or PIR,enables a client to perform a database lookupagainst a server hosting a keyword-value databasewithout revealing the queried keyword and the lookup result to the server.It relies on Homomorphic Encryption,which allows computation on encrypted data,enabling Private Information Retrieval serverto perform database lookups on encrypted queries.So server has no access to the query or the response contents.Here's how it works.The Client on device generates the encryption keyand keeps it private on device,which encrypts all queries sent to the server.The server then uses the encrypted queries to perform database lookups.The server cannot decrypt the query at any time during processing.The server sends back encrypted responses to the Client.The Client receives and decrypts responses on device.Only the Client, not even the server, can decrypt the response from the server.The Client then uses the lookup results.Private Information Retrieval is already a technologyused for many privacy-preserving features, like the Live Caller ID Lookup API.For URL Filtering, Private Information Retrieval serverperforms URL lookups with encrypted queries,which allows the server to provide filtering capabilitieswithout learning which URLs are being requestedand what results are being returned.The third key technology is Privacy Pass.Private Information Retrieval uses Privacy Passfor anonymous authentication to your server.This lets you ensure your server is only responding to queriesfrom authenticated and authorized devices,without being able to track individual request histories.Each device goes through an initial attestationto get a long-term credential,which then can be used to retrieve a collection ofcryptographically blind-signed tokens from the Privacy Pass Issuer.The device uses these tokens to authenticate with your serverwithout revealing identity.The last key technology is Oblivious HTTP Relay.Oblivious HTTP Relay is a privacy-preserving proxythat hides the IP address of the origin,which helps prevent the server from trackingand linking requests over time.It has three entities, the Client, the Relay, and the Gateway.The Client encrypts requests using the public key of the Gateway.It then sends the encrypted request to the Relay.The relay removes the client’s IP address from the incoming requestsand forwards the requests to the Gateway.The Gateway decrypts the request and sends them to the target resource.The Relay doesn’t learn anything about the content of the requests,while the Gateway and the target resourcedon’t know where the traffic is coming from.I have introduced the four technologies.I will now walk through how to set up the solutionand how URL Filtering works.Starting with your URL Filter app installed on the device,your app will provide Network Extension, your URL data set, as a Bloom filter,as well as a URL database hosted on yourPrivate Information Retrieval server, servicing URL lookups.Your server setup also includes a Privacy Pass Issuerfor anonymous authentication.Your URL Filter app tells Network Extensionwhere to reach your Private Information Retrieval server,Your app also implements a new app extensionto fetch your Bloom filter onto device.All database queries and responses are exchanged overthe Oblivious HTTP Relay hosted by Apple.This means the Oblivious HTTP Gatewaywill be hosted by you to forward traffic to your server.Request using Oblivious HTTP for URL Filteringflow through an Apple-hosted Oblivious HTTP Relay.This is a capability that you must apply for,using the request form available in the documentation.Apple will validate your server configurationfor Oblivious HTTP Relay before approval.This must be completed before you can distribute your appon the App Store, with TestFlight, ad-hoc, developer-ID, or enterprise-signed builds.Development-signed builds are exempt from this requirement,allowing you to start building and testing your filtering app right away.With all the pieces in place, I will work-through an exampleto show how URL Filtering works.URL Filtering will be performed solely by the system.Your app and app extension do not execute in this path.The system will examine all the URL requests,checking each URL against your data set.In this example, a browser initiates an URL requestto some specific resource at example.com.The system will check the requested URL against the Bloom filter first.A negative match from the Bloom filter meansfor sure the URL is not in your data set.The URL will be allowed, and the browser will proceed with the HTTP request.Now the browser initiates another URL requestfor a different resource on example.com,which gets a positive match from the Bloom filter.Due to potential false positives,a positive match means the URL may be in your data set.In this case, the system will perform an off-device lookupwith your Private Information Retrieval serverby sending an encrypted query to the server.At the server, Database Lookup is performedwith the received encrypted query to get a match result.The server has no knowledge of what is being queried or what is being returned.The server encrypts the match result and replies back.The system on device decrypts the response.If the returned result indicates a match,the URL will be denied and the browser will fail the request.Network Extension URL Filtering is system-wide.Checking all HTTP requests sent via Apple networking APIs,such as WebKit and URLSession.However, for apps that are not using these networking APIs,their HTTP traffic will not be checked automatically by the system.For those of you building a web browser or any appnot using WebKit or URLSession,adopt the participation API to check all URL requests before sending.Call NEURLFilter verdictForURL with the URL of the request,and honor the returned verdictby failing the request if the URL is denied.Now that you know how URL Filters work,I will explain the steps for you to create one.You will set up your Private Information Retrieval serverand create your Bloom filter.Then, build your URL Filter app and app extension.I will start with Private Information Retrieval server setup.Use the sample code to get started,which provides a sample Private Information Retrieval server.At the project repository, you will find sample implementationsof the Private Information Retrieval server as well as a Privacy Pass Issuer.To customize the server for URL Filtering,create an use case with a specific name format.The use case name must havethe bundle identifier of your app as the prefix,followed by the string url.filtering.Private Information Retrieval server stores data records in a key-value format.For Network Extension URL Filter, format your data set accordingly,setting each record with the URL string as the keyand the value to the integer 1.The second step is to build your Bloom filter.Build the Bloom filter with your URL data setwith the specified hash functions and method,documented for the NEURLFilterControlProvider APIDepending on how static or dynamic your data set is,decide how to deliver your Bloom filter onto deviceand how often you want to update it.For static data set that rarely changes,include your Bloom filter in your app bundleand let your app extension fetch it from your app bundle resources.Subsequent Bloom filter updatescan be included together with your app updates.For dynamic data set that changes frequently,configure the system to trigger fetching periodically.When the system triggers the fetch,your app extension can download the Bloom Filter from your server.Next step is to build your URL Filter app.Add the new Network Extension url-filter-provider entitlement to your app,which allows you to use the URL Filter APIs.Use NEURLFilterManager API in your appto create configuration and manage your URL Filter.Import Network Extension Frameworkand use the NEURLFilterManager shared singleton instance.You can configure and enable your URL Filter in a few steps.First, load the latest snapshot of the URL Filter configurationfrom disk if any.Then set the required attribute in your configurationto tell the system how to reach and talk to yourPrivate Information Retrieval server,Configure other optional parameters to fine tune your URL Filter.Finally, enable and save your URL Filter configuration.Now your URL Filter will take effect.URL Filter supports both consumer as well as enterprise deployments.For Scale enterprise deployment of your URL Filter app,push the URL Filter configuration profilevia Mobile Device Management onto managed devices.The existing Content Filter payload now supports:a new key to enable the URL Filter feature,as well as a new dictionary to configure the URLFilterParameters.MDM URL Filter configuration requires device supervision.Next step is to build your URL Filter App Extension.To create your app extension,use the new URL Filter app extension template in Xcode.Implement the NEURLFilterControlProvider protocol as your app extension.This protocol allows your app extension to fetch your Bloom filter onto device.Import the Network Extension frameworkand implement the NEURLFilterControlProvider protocol.Your implementation of the fetchPrefilter function,will be invoked by the system,to fetch your Bloom filter, according to the interval you configured.In your implementation,fetch the Bloom filter and return it to the system.Your implementation can retrieve your Bloom filter dataeither from your app bundle resources or by downloading it from your server.And before you submit your app to the App Store or TestFlight,make sure that your capability request has been submitted and approved,so that requests can flow to your Oblivious HTTP Gateway.Network Extension is such a powerful frameworkthat allows you to tunnel and filter traffic and much more.Review how you use Network Extension.Use the appropriate API that helps you build appsthat deliver the desired functionality and work well with the system.Use Network relays for secure remote access for TCP and UDP traffic.Use Network Extension to build your VPN solutions.Create powerful content filters using Network Extension URL Filter API.To get you started, check out the sample server and app.Thanks for watching.

Hi, my name is Maria Alice Dos Santos,and I am part of the Internet Technologies team at Apple.I’m here to tell you all about the Network Extension frameworkand its latest advances in iOS and macOS 26.

Network Extension is a framework that provides a rich suite of APIsfor you to build apps that extend and customizenetworking capabilities on Apple platforms.

Network Extension apps work seamlessly throughout the networking stack,integrated closely with Network framework,CFNetwork, WebKit, and Sockets APIas well as system-level components like routing, traffic policy,and all types of system management.This allows Network Extension to achieve the desired functionalitiesin the most optimized manner,in terms of networking performance and security.

Network Extension is a powerful frameworkthat lets you alter networking across the system.To make sure your app works consistently with other apps and with the system,it’s essential to pick the right API for the type of app you want to build.

In this session, I will introduce you to the wide range of appsyou can create using Network Extension framework,and the ways you can create apps to access remote resourcesby using relays and VPNs.I will also discuss how you can create content filters using Network Extension,including a new way to create a URL-based filter in iOS and macOS 26.

Network Extension framework supports various ways for your appsto customize and extend networking capabilities.

On iOS, the Wi-Fi Management and Hotspots APIs allow your appsto configure Wi-Fi settings and interact with Wi-Fi hotspots.This includes the new NEHotspotHelper extension API in iOS 26.

iOS apps can also use the Local Push API.This is for apps used on networks without accessto the Apple Push Notification service, like cruise ships or hospitals.This lets you support features like text messaging and Voice-over-IP callswhile on the restricted network.

You can build a security app to protect DNS trafficfrom attacks by using the DNS Configuration and Proxy API.

You can install a DNS configurationand use this built-in encrypted DNS protocols,or proxy DNS traffic over your own security channel.

Mac apps can use the Transparent Proxy API,for example, to divert traffic for a specific websiteto a cloud-based security service for authentication and authorization.

You can also build apps that let people access remote resources securely,or apps that protect people by securely and privatelyfiltering the content they access on the network.

Secure Remote Access is a broad categorythat covers many different ways people connect to internal systemssecurely from outside,or to protect personal traffic on unsecured networksby tunneling traffic from a device to a remote server.

With Network Extension, there are two main approaches to consider.Network relays and IP-based VPN.Use the one that best suits your needdepending on the type of traffic you want to tunnel.Consider Network relays instead of traditional VPNswhen you want to tunnel TCP or UDP traffic to access specific apps.For example, cloud-hosted enterprise apps,like for email or collaboration, are a great fit for relays.The MASQUE protocol enables secure proxying,optimized for performance.It can easily be integrated into modern cloud environments.And since the platform has built-in support for relays,you don't need to build your own extension to take advantage of it.You can just configure your relay settings and authenticationusing NERelayManager API,or through a configuration profile from the MDM server.

If you want to tunnel IP traffic, use the IP-based VPN option.

For example, IP-based VPNs can be used in the enterpriseto extend the corporate network to employees,giving them full network access as if they were physically in the office.This solution is ideal for long-term trusted employeeswho need persistent or full tunnel access to the company network.

Or, highly regulated organizations, with stringent network security policies,may need to send all traffic from their managed devicesthrough the corporate network.

People may also want to protect their traffic with a VPNover unsecured networks to preserve their privacy and anonymity.

To create an IP-based VPN tunnel,use the NEVPNManager API to leverage one of the built-in protocols,IKEv2 or IPsec, or use the NEPacketTunnelProviderto implement your own custom tunneling protocols.When creating an IP-based VPN,your implementation tells the system what traffic to tunnel,with specific included and excluded routes.On macOS, the routing table could be modifiedoutside of your app by an administrator or another process.More precise routes could interfere with your VPN routes.Network Extension lets your app enforce its VPN routes to ensurethey take precedence and are honored at all times.

Network Extension makes it easy for your appto manage your tunnels routing requirements.For a split-tunnel VPN, you can enable the enforceRoutes optionto enforce both the included routes and excluded routes.For a full-tunnel VPN, you can turn on the includeAllNetworks optionto enforce all traffic to be routed through your tunnel.When this option is enabled, any specified excludedRoutes will have no effect.Both of these options support configurable exceptionsto allow a system-defined set of traffic to go outside the tunnelso that essential services work as expected while your VPN is running.For instance, turn on excludeLocalNetworksif you want local network services like AirDropand AirPlay to bypass tunnel.

Or turn on other exceptions to allow services like calls and messaging,the Apple Push Notification service,and device communication to bypass the tunnel.Most of these exceptions are enabled by default,but allow customization to fit your security need.

Network Extension is the supported API to build a VPN app.It works seamlessly with other networking and system components.Building a VPN app with anything else is highly discouraged.

Avoid using Packet Filter or directly modifying the routing table on the Mac.This is not supported and risk clashing with traffic filtering and routing rulesinstalled by the system or other apps.If your VPN app doesn’t use Network Extension today,you should migrate as soon as possible.This will ensure your app remains compatible with the systemand all of its key functionality that your customers expect,like working in harmony with features such as AirDrop,Mac Virtual Display, Xcode, as well as Continuity features like sidecar.Use NEPacketTunnelProvider only to tunnel IP traffic.Using it to accomplish any other goals is not recommended.NEPacketTunnelProvider operates at the IP layer,and will not receive flow or application level metadataneeded to do other things, like proxying DNS requests or content filtering.

If your goal is to filter content,use the Content Filter API, which I will cover next.The Content Filter API allows you to introspect traffic on deviceto monitor or to make filtering decisionsas traffic flows through the networking stack.A common use case is a personal firewall,which examines and blocks traffic flowsthat are deemed malicious for a personal device.Or an enterprise traffic monitoring app, for managed devices,to monitor all inbound and outbound network traffic,for employees in highly secure environments.

Create a subclass of one or both of the content filter providersto get the desired traffic.

NEFilterDataProvider provides you with TCP and UDP flows,as well as other IP protocol traffic, such as ICMP.

For mac apps, a subclass of NEFilterPacketProviderwill get Layer 2 packets.

Filter providers cannot modify traffic,but simply provide a filter verdict to the system,either to allow or drop the flow.iOS system-wide content filter is supported on supervised devices only.

Content filters using NEFilterDataProviderand NEFilterPacketProvider are great if your app needs to filter contentbased on the traffic flow or through packet inspection.But sometimes you might want to filter based on application-level metadata,like the URL.With a traditional content filter,your app can make filtering decisions based on the traffic-level information,like the host and port of this HTTPS request.

But some apps may not want to block entire sites,but instead filter specific resources.

HTTPS requests are encrypted, so a traditional content filterwould not have access to the necessary detail of the URL requestto make an accurate filtering decision,like the specific resource requested, or query parameters in the URL.

Starting in iOS 26, you can create a new type of filter, a URL Filter,which makes content filtering decisions based on the full URL.

Network Extension URL Filter allows you to filter system-wide HTTP and HTTPS requests,matching against the full URL of the request.This technology allows you to build appsthat block specific resources on the internet.For example, you can build a parental control appto protect children from harmful websites.An app for schools might use a filter to prevent studentsfrom accessing social media,gambling, or other sensitive content across many websites.Or enterprises may want to block non-work-related content for employees.

At Apple, we believe privacy is a fundamental human right.URL Filtering uses state-of-the-art cryptographyto let you build apps that effectively make filtering decisionsbased on the full URL, without compromising privacy.

URLs can reveal sensitive information like unique identifiers, or browsing history.Network Extension is designed to allow you to build a content filterthat makes accurate filtering decisions based on the full URL.But the URL contents are not revealed to the app,and all database queries to the backend servers are anonymized to protect privacy.The entire chain of backend servers, both Apple’s and your servers,will have no access to any of the content and identity information.URL Filtering is performed with your URL data set,containing URLs you want to block.You provide an on-device prefilter and an off-device database serverfor URL lookups.

The system performs the entire filtering process on your behalf with your data set.Your app does not execute in the filtering pathand has no access to traffic.

The system performs on-device prefilter to improve performanceand may perform off-device database lookups for final verdicts.All off-device database exchanges are protectedto ensure content and identity privacy preservation.With strong privacy preservation,URL Filters are supported on both managed and unmanaged devices.

Before I go into how the feature works,I will introduce the technologies that serve as the building blocks.There are four technologies that URL Filter relies on, and they are:Bloom filters, Private Information Retrieval,Privacy Pass, and Oblivious HTTP Relay.

I will start with Bloom filters.

For URL Filtering, Network Extension will use the Bloom filter you buildwith your URL data set containing URLs you want to block.A Bloom filter is constructed from a predefined data setby hashing each element in the set using multiple hash functionsand setting the corresponding bits in a fixed-size bit array.

Once built, you can use the Bloom filterto test whether an element is a member of the set.Bloom filters will never produce false negatives,but may produce false positives.

Your Bloom filter will be used as a prefilter for a quick check.If the match is negative,the checked URL is definitively not part of your URL data setand will be allowed immediately without further verification.If the match is positive,the match result is not definitive due to potential false positives.Further verification, such as an off-device database lookup,will be necessary to reach a conclusive verdict.

Using a Bloom filter as a prefiltergreatly reduces off-device database lookups, improving performance.

The second key technology is Private Information Retrieval.Private Information Retrieval, or PIR,enables a client to perform a database lookupagainst a server hosting a keyword-value databasewithout revealing the queried keyword and the lookup result to the server.It relies on Homomorphic Encryption,which allows computation on encrypted data,enabling Private Information Retrieval serverto perform database lookups on encrypted queries.So server has no access to the query or the response contents.

Here's how it works.The Client on device generates the encryption keyand keeps it private on device,which encrypts all queries sent to the server.The server then uses the encrypted queries to perform database lookups.

The server cannot decrypt the query at any time during processing.

The server sends back encrypted responses to the Client.The Client receives and decrypts responses on device.Only the Client, not even the server, can decrypt the response from the server.The Client then uses the lookup results.Private Information Retrieval is already a technologyused for many privacy-preserving features, like the Live Caller ID Lookup API.

For URL Filtering, Private Information Retrieval serverperforms URL lookups with encrypted queries,which allows the server to provide filtering capabilitieswithout learning which URLs are being requestedand what results are being returned.The third key technology is Privacy Pass.

Private Information Retrieval uses Privacy Passfor anonymous authentication to your server.This lets you ensure your server is only responding to queriesfrom authenticated and authorized devices,without being able to track individual request histories.

Each device goes through an initial attestationto get a long-term credential,which then can be used to retrieve a collection ofcryptographically blind-signed tokens from the Privacy Pass Issuer.The device uses these tokens to authenticate with your serverwithout revealing identity.The last key technology is Oblivious HTTP Relay.

Oblivious HTTP Relay is a privacy-preserving proxythat hides the IP address of the origin,which helps prevent the server from trackingand linking requests over time.

It has three entities, the Client, the Relay, and the Gateway.

The Client encrypts requests using the public key of the Gateway.It then sends the encrypted request to the Relay.The relay removes the client’s IP address from the incoming requestsand forwards the requests to the Gateway.The Gateway decrypts the request and sends them to the target resource.The Relay doesn’t learn anything about the content of the requests,while the Gateway and the target resourcedon’t know where the traffic is coming from.

I have introduced the four technologies.I will now walk through how to set up the solutionand how URL Filtering works.

Starting with your URL Filter app installed on the device,your app will provide Network Extension, your URL data set, as a Bloom filter,as well as a URL database hosted on yourPrivate Information Retrieval server, servicing URL lookups.

Your server setup also includes a Privacy Pass Issuerfor anonymous authentication.

Your URL Filter app tells Network Extensionwhere to reach your Private Information Retrieval server,Your app also implements a new app extensionto fetch your Bloom filter onto device.

All database queries and responses are exchanged overthe Oblivious HTTP Relay hosted by Apple.

This means the Oblivious HTTP Gatewaywill be hosted by you to forward traffic to your server.

Request using Oblivious HTTP for URL Filteringflow through an Apple-hosted Oblivious HTTP Relay.

This is a capability that you must apply for,using the request form available in the documentation.Apple will validate your server configurationfor Oblivious HTTP Relay before approval.

This must be completed before you can distribute your appon the App Store, with TestFlight, ad-hoc, developer-ID, or enterprise-signed builds.

Development-signed builds are exempt from this requirement,allowing you to start building and testing your filtering app right away.

With all the pieces in place, I will work-through an exampleto show how URL Filtering works.

URL Filtering will be performed solely by the system.Your app and app extension do not execute in this path.The system will examine all the URL requests,checking each URL against your data set.

In this example, a browser initiates an URL requestto some specific resource at example.com.The system will check the requested URL against the Bloom filter first.A negative match from the Bloom filter meansfor sure the URL is not in your data set.

The URL will be allowed, and the browser will proceed with the HTTP request.

Now the browser initiates another URL requestfor a different resource on example.com,which gets a positive match from the Bloom filter.Due to potential false positives,a positive match means the URL may be in your data set.

In this case, the system will perform an off-device lookupwith your Private Information Retrieval serverby sending an encrypted query to the server.At the server, Database Lookup is performedwith the received encrypted query to get a match result.The server has no knowledge of what is being queried or what is being returned.The server encrypts the match result and replies back.

The system on device decrypts the response.If the returned result indicates a match,the URL will be denied and the browser will fail the request.

Network Extension URL Filtering is system-wide.Checking all HTTP requests sent via Apple networking APIs,such as WebKit and URLSession.However, for apps that are not using these networking APIs,their HTTP traffic will not be checked automatically by the system.For those of you building a web browser or any appnot using WebKit or URLSession,adopt the participation API to check all URL requests before sending.Call NEURLFilter verdictForURL with the URL of the request,and honor the returned verdictby failing the request if the URL is denied.Now that you know how URL Filters work,I will explain the steps for you to create one.You will set up your Private Information Retrieval serverand create your Bloom filter.Then, build your URL Filter app and app extension.

I will start with Private Information Retrieval server setup.

Use the sample code to get started,which provides a sample Private Information Retrieval server.At the project repository, you will find sample implementationsof the Private Information Retrieval server as well as a Privacy Pass Issuer.

To customize the server for URL Filtering,create an use case with a specific name format.The use case name must havethe bundle identifier of your app as the prefix,followed by the string url.filtering.

Private Information Retrieval server stores data records in a key-value format.For Network Extension URL Filter, format your data set accordingly,setting each record with the URL string as the keyand the value to the integer 1.The second step is to build your Bloom filter.Build the Bloom filter with your URL data setwith the specified hash functions and method,documented for the NEURLFilterControlProvider APIDepending on how static or dynamic your data set is,decide how to deliver your Bloom filter onto deviceand how often you want to update it.

For static data set that rarely changes,include your Bloom filter in your app bundleand let your app extension fetch it from your app bundle resources.Subsequent Bloom filter updatescan be included together with your app updates.For dynamic data set that changes frequently,configure the system to trigger fetching periodically.When the system triggers the fetch,your app extension can download the Bloom Filter from your server.Next step is to build your URL Filter app.Add the new Network Extension url-filter-provider entitlement to your app,which allows you to use the URL Filter APIs.Use NEURLFilterManager API in your appto create configuration and manage your URL Filter.Import Network Extension Frameworkand use the NEURLFilterManager shared singleton instance.You can configure and enable your URL Filter in a few steps.

First, load the latest snapshot of the URL Filter configurationfrom disk if any.Then set the required attribute in your configurationto tell the system how to reach and talk to yourPrivate Information Retrieval server,Configure other optional parameters to fine tune your URL Filter.

Finally, enable and save your URL Filter configuration.Now your URL Filter will take effect.

URL Filter supports both consumer as well as enterprise deployments.For Scale enterprise deployment of your URL Filter app,push the URL Filter configuration profilevia Mobile Device Management onto managed devices.

The existing Content Filter payload now supports:a new key to enable the URL Filter feature,as well as a new dictionary to configure the URLFilterParameters.MDM URL Filter configuration requires device supervision.

Next step is to build your URL Filter App Extension.

To create your app extension,use the new URL Filter app extension template in Xcode.Implement the NEURLFilterControlProvider protocol as your app extension.This protocol allows your app extension to fetch your Bloom filter onto device.Import the Network Extension frameworkand implement the NEURLFilterControlProvider protocol.Your implementation of the fetchPrefilter function,will be invoked by the system,to fetch your Bloom filter, according to the interval you configured.In your implementation,fetch the Bloom filter and return it to the system.Your implementation can retrieve your Bloom filter dataeither from your app bundle resources or by downloading it from your server.And before you submit your app to the App Store or TestFlight,make sure that your capability request has been submitted and approved,so that requests can flow to your Oblivious HTTP Gateway.Network Extension is such a powerful frameworkthat allows you to tunnel and filter traffic and much more.Review how you use Network Extension.Use the appropriate API that helps you build appsthat deliver the desired functionality and work well with the system.Use Network relays for secure remote access for TCP and UDP traffic.Use Network Extension to build your VPN solutions.Create powerful content filters using Network Extension URL Filter API.To get you started, check out the sample server and app.Thanks for watching.

22:15 -Use participation API to check URLs before sending requests

25:01 -Configure and manage URL Filter

26:41 -Implement NEURLFilterControlProvider protocol

0:00 -WelcomeLearn about Network Extension, a framework you can use to build apps that customize networking on Apple platforms. In iOS and macOS 26, the framework offers VPNs, relays, and content filters, and new URL-based filtering capabilities.1:48 -Tour NetworkExtensionThe Network Extension framework enables apps in iOS and macOS to customize networking. This includes Wi-Fi management, hotspot interaction, local push notifications for restricted networks, DNS security, content filtering, and secure remote resource access.3:21 -Access remote resourcesSecure Remote Access lets people connect securely to internal systems from external locations or protect personal traffic on unsecured networks.

Network Extension offers two main approaches for tunneling traffic: network relays and IP-based VPNs. Network relays, using the MASQUE protocol, are optimized for performance and are suitable for tunneling TCP or UDP traffic to specific apps, such as cloud-hosted enterprise apps. You can configure relays using 'NERelayManager', or through an MDM profile.

IP-based VPNs are best reserved for extending corporate networks to employees, providing full network access, or for highly regulated organizations that need to send all traffic through the corporate network. Individuals can also use them to protect their privacy on unsecured networks.

You can create IP-based VPN tunnels using the NEVPNManager API, leveraging built-in protocols like IKEv2 or IPsec, or custom protocols. Network Extension allows apps to enforce VPN routes, ensuring they take precedence, and supports split-tunnel and full-tunnel VPN configurations with configurable exceptions. Network Extension is the recommended and supported API for building VPN apps. Using other methods is highly discouraged and may lead to compatibility issues. Migrate your VPN app to Network Extension as soon as possible.8:40 -Filter contentThe Content Filter API lets you to create personal firewalls and enterprise traffic monitoring apps. It allows apps to inspect traffic flows and provide 'allow' or 'drop' verdicts.10:54 -Create URL filtersIn iOS 26, you can create a URL Filter to make apps that block specific resources on the internet system-wide. This technology is particularly useful for parental control apps, schools, and enterprises to restrict access to inappropriate or non-work-related content.

URL Filter uses advanced cryptographic techniques to prioritize user privacy. The system employs a combination of four key technologies: Bloom filters, Private Information Retrieval (PIR), Privacy Pass, and Oblivious HTTP Relay.

Your app doesn’t execute in the filtering path and has no access to URL traffic. Additionally, neither Apple nor your server have access to URL traffic or identity information. URL filters are supported on both managed and unmanaged devices.

URL filters use an Apple hosted OHTTP relay, which you must apply to configure and use for distribution-signed apps. Development-signed builds are exempt from this requirement.

If you’re building an app that doesn’t use WebKit or URLSession, pass each URL to the NEURLFilter API and honor the returned verdict.

For enterprise deployments, the URL Filter configuration profile can be pushed via Mobile Device Management onto managed devices.

0:00 -Welcome

Learn about Network Extension, a framework you can use to build apps that customize networking on Apple platforms. In iOS and macOS 26, the framework offers VPNs, relays, and content filters, and new URL-based filtering capabilities.

Learn about Network Extension, a framework you can use to build apps that customize networking on Apple platforms. In iOS and macOS 26, the framework offers VPNs, relays, and content filters, and new URL-based filtering capabilities.

1:48 -Tour NetworkExtension

The Network Extension framework enables apps in iOS and macOS to customize networking. This includes Wi-Fi management, hotspot interaction, local push notifications for restricted networks, DNS security, content filtering, and secure remote resource access.

The Network Extension framework enables apps in iOS and macOS to customize networking. This includes Wi-Fi management, hotspot interaction, local push notifications for restricted networks, DNS security, content filtering, and secure remote resource access.

3:21 -Access remote resources

Secure Remote Access lets people connect securely to internal systems from external locations or protect personal traffic on unsecured networks.

Network Extension offers two main approaches for tunneling traffic: network relays and IP-based VPNs. Network relays, using the MASQUE protocol, are optimized for performance and are suitable for tunneling TCP or UDP traffic to specific apps, such as cloud-hosted enterprise apps. You can configure relays using 'NERelayManager', or through an MDM profile.

IP-based VPNs are best reserved for extending corporate networks to employees, providing full network access, or for highly regulated organizations that need to send all traffic through the corporate network. Individuals can also use them to protect their privacy on unsecured networks.

You can create IP-based VPN tunnels using the NEVPNManager API, leveraging built-in protocols like IKEv2 or IPsec, or custom protocols. Network Extension allows apps to enforce VPN routes, ensuring they take precedence, and supports split-tunnel and full-tunnel VPN configurations with configurable exceptions. Network Extension is the recommended and supported API for building VPN apps. Using other methods is highly discouraged and may lead to compatibility issues. Migrate your VPN app to Network Extension as soon as possible.

Secure Remote Access lets people connect securely to internal systems from external locations or protect personal traffic on unsecured networks.

Network Extension offers two main approaches for tunneling traffic: network relays and IP-based VPNs. Network relays, using the MASQUE protocol, are optimized for performance and are suitable for tunneling TCP or UDP traffic to specific apps, such as cloud-hosted enterprise apps. You can configure relays using 'NERelayManager', or through an MDM profile.

IP-based VPNs are best reserved for extending corporate networks to employees, providing full network access, or for highly regulated organizations that need to send all traffic through the corporate network. Individuals can also use them to protect their privacy on unsecured networks.

You can create IP-based VPN tunnels using the NEVPNManager API, leveraging built-in protocols like IKEv2 or IPsec, or custom protocols. Network Extension allows apps to enforce VPN routes, ensuring they take precedence, and supports split-tunnel and full-tunnel VPN configurations with configurable exceptions. Network Extension is the recommended and supported API for building VPN apps. Using other methods is highly discouraged and may lead to compatibility issues. Migrate your VPN app to Network Extension as soon as possible.

8:40 -Filter content

The Content Filter API lets you to create personal firewalls and enterprise traffic monitoring apps. It allows apps to inspect traffic flows and provide 'allow' or 'drop' verdicts.

The Content Filter API lets you to create personal firewalls and enterprise traffic monitoring apps. It allows apps to inspect traffic flows and provide 'allow' or 'drop' verdicts.

10:54 -Create URL filters

In iOS 26, you can create a URL Filter to make apps that block specific resources on the internet system-wide. This technology is particularly useful for parental control apps, schools, and enterprises to restrict access to inappropriate or non-work-related content.

URL Filter uses advanced cryptographic techniques to prioritize user privacy. The system employs a combination of four key technologies: Bloom filters, Private Information Retrieval (PIR), Privacy Pass, and Oblivious HTTP Relay.

Your app doesn’t execute in the filtering path and has no access to URL traffic. Additionally, neither Apple nor your server have access to URL traffic or identity information. URL filters are supported on both managed and unmanaged devices.

URL filters use an Apple hosted OHTTP relay, which you must apply to configure and use for distribution-signed apps. Development-signed builds are exempt from this requirement.

If you’re building an app that doesn’t use WebKit or URLSession, pass each URL to the NEURLFilter API and honor the returned verdict.

For enterprise deployments, the URL Filter configuration profile can be pushed via Mobile Device Management onto managed devices.

In iOS 26, you can create a URL Filter to make apps that block specific resources on the internet system-wide. This technology is particularly useful for parental control apps, schools, and enterprises to restrict access to inappropriate or non-work-related content.

URL Filter uses advanced cryptographic techniques to prioritize user privacy. The system employs a combination of four key technologies: Bloom filters, Private Information Retrieval (PIR), Privacy Pass, and Oblivious HTTP Relay.

Your app doesn’t execute in the filtering path and has no access to URL traffic. Additionally, neither Apple nor your server have access to URL traffic or identity information. URL filters are supported on both managed and unmanaged devices.

URL filters use an Apple hosted OHTTP relay, which you must apply to configure and use for distribution-signed apps. Development-signed builds are exempt from this requirement.

If you’re building an app that doesn’t use WebKit or URLSession, pass each URL to the NEURLFilter API and honor the returned verdict.

For enterprise deployments, the URL Filter configuration profile can be pushed via Mobile Device Management onto managed devices.

## Code Samples

```swift
// Use participation API to check URLs before sending requests



import
 NetworkExtension


func
 
checkURL
(
url
: 
URL
) 
async
 
throws
 -> 
Bool
 {
  
var
 passRequest : 
Bool
 
=
 
true


  
let
 verdict 
=
 
await
 
NEURLFilter
.verdict(for: url)

  
if
 verdict 
==
 .deny {
    passRequest 
=
 
false

  }
  
return
 passRequest
}
```

```swift
// Configure and manage URL Filter



import
 NetworkExtension


let
 manager 
=
 
NEURLFilterManager
.shared


try
 
await
 manager.loadFromPreferences()


try
 manager.setConfiguration(
    pirServerURL: 
URL
(string:
"https://pir.example.com"
)
!
,
    pirPrivacyPassIssuerURL: 
URL
(string:
"https://privacypass.example.com"
)
!
,
    pirAuthenticationToken: 
"1234"
,
    controlProviderBundleIdentifier: 
"com.example.myURLFilter.extension"
)

manager.prefilterFetchInterval 
=
 
86400
 
// fetch every 1 day

manager.shouldFailClosed 
=
 
false

manager.localizedDescription 
=
 
"Alice's URL Filter"

manager.isEnabled 
=
 
true



try
 
await
 manager.saveToPreferences()
```

```swift
// Implement NEURLFilterControlProvider protocol



import
 NetworkExtension


class
 
URLFilterControlProvider
: 
NEURLFilterControlProvider
 {

  
func
 
fetchPrefilter
() 
async
 
throws
 -> 
NEURLFilterPrefilter
? {
        
    
// Fetch your Bloom filters data from your app bundle or from your server

    
let
 data 
=
 
NEURLFilterPrefilter
.
PrefilterData
.temporaryFilepath(fileURL)
    
let
 result 
=
 
NEURLFilterPrefilter
(data: data,
                                      bitCount: numberOfBits,
                                      hashCount: numberOfHashes,
                                      murmurSeed: murmurSeed)
    
return
 result
  }
}
```

