# Wwdc2023 10053

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Transcript

Code

What’s new in privacyAt Apple, we believe that privacy is a fundamental human right. Learn about new technologies on Apple platforms that make it easier for you to implement essential privacy patterns that build customer trust in your app. Discover privacy improvements for Apple's platforms, as well as a study of how privacy shaped the software architecture and design for the input model on visionOS.Chapters1:01 -Privacy pillars3:03 -Photos picker5:44 -Screen capture picker7:46 -Calendar access10:29 -Oblivious HTTP (OHTTP)14:22 -Communication Safety17:46 -App sandbox21:57 -Advanced Data Protection23:41 -Safari Private Browsing26:40 -Safari app extensions27:22 -Spatial input modelResourcesApp SandboxDetecting nudity in media and providing intervention optionsHD VideoSD VideoRelated VideosWWDC23Discover Calendar and EventKitElevate your windowed app for spatial computingEmbed the Photos Picker in your appReady, set, relay: Protect app traffic with network relaysWhat’s new in App Store ConnectWhat’s new in Safari extensionsWhat’s new in ScreenCaptureKitWWDC22Replace CAPTCHAs with Private Access TokensWWDC21Meet privacy-preserving ad attributionWhat's new in CloudKitWWDC20Enable encrypted DNS

At Apple, we believe that privacy is a fundamental human right. Learn about new technologies on Apple platforms that make it easier for you to implement essential privacy patterns that build customer trust in your app. Discover privacy improvements for Apple's platforms, as well as a study of how privacy shaped the software architecture and design for the input model on visionOS.

1:01 -Privacy pillars

3:03 -Photos picker

5:44 -Screen capture picker

7:46 -Calendar access

10:29 -Oblivious HTTP (OHTTP)

14:22 -Communication Safety

17:46 -App sandbox

21:57 -Advanced Data Protection

23:41 -Safari Private Browsing

26:40 -Safari app extensions

27:22 -Spatial input model

App Sandbox

Detecting nudity in media and providing intervention options

HD VideoSD Video

HD Video

SD Video

Discover Calendar and EventKit

Elevate your windowed app for spatial computing

Embed the Photos Picker in your app

Ready, set, relay: Protect app traffic with network relays

What’s new in App Store Connect

What’s new in Safari extensions

What’s new in ScreenCaptureKit

Replace CAPTCHAs with Private Access Tokens

Meet privacy-preserving ad attribution

What's new in CloudKit

Enable encrypted DNS

Search this video…♪ Mellow instrumental hip-hop ♪♪Hi there!I'm Michael from Privacy Engineering,and welcome to "What's new in privacy."At Apple, we believe privacy is a fundamental human right.To respect and protect it is all of our shared responsibility.For this reason, privacy is a central componentto how we approach designing new and improved features at Apple.Many products and services have become a central mainstayin all our lives, and so you have becomea vital partner in protecting people.Providing a great privacy experience in your app,where people understand and controlwhat data is being accessed and for what purpose,helps them trust your app,especially in sensitive parts of their lives.The privacy pillars are a great guide for youwhen building privacy into your app.You might have heard us talk about them before,as these are four central ideas we use at Appleto think about the privacy of our products and services.The first pillar is data minimization:use only the data needed to build a feature.This applies throughout your app's architecture,from the amount of data features accessed,to data shared with application servers,to data that might be shared with third parties.Second is on-device processing: tap into the power of the deviceto process data locally and avoid sharing itwith any servers.Third, transparency and control is about making surepeople understand the what, why, when, and whereof data access and processing, and to give themadequate controls before that happens.And also, enable them to change their mind later.The last pillar is security protections:apply strong technical mitigationsto enforce the other pillars, such as end-to-end encryption.To help you implement the privacy pillars in your app,I will tell you about new tools with privacy-centric designthat you can adopt, give the latest updateson important platform changes for privacy,and finally, I will talk about how the spatial input modelon Apple's newest platform was designed to protect privacy.I will start with new privacy-enhancing technologiescoming to Apple's platforms that make it easier for youto build great apps with great privacy.This includes a set of new APIs that allow your appto obtain access to content seamlessly,while giving users fine-grain control over sharing,as well as new APIs to better protect communicationwith servers and people.I will begin with improvements to the Photos picker,designed to provide low-friction access to photos.Over the years, our photo libraries have grown massivelyas more and more of our precious moments are captured there,starting with embarrassing childhood photos,to the last hiking trip.For this reason, a fundamental wayto build up trust in your app is to empower peopleto make fine-grain decisions about which data they sharewith your app and when they share it.So if someone wants to use your appto share the most scenic photos from their last trip,they can do so without granting your app access to all photos.This is what the Photos picker allows you to do.This API gives your app access to selected photos or videos,without requiring permission to access the entire photo library.And in iOS 17 and macOS Sonoma, you can fully embed the pickerinto your app for a completely seamless experience.Even though the photos look like they are part of your app,they are rendered by the system and only shared when selected,so the user's photos always remain in their control.With the new customization options,you can choose whether you want to show the pickerwithout any chrome, like this,or as a minimal, single row of photosthat can be scrolled horizontally,or as an inline version of the full picker,with a new Options menu, providing controlsabout sharing photo metadata, such as captionsor location information.The Photos picker is a great and fast way to obtain photos,as you don't need to worry about obtaining permissionfor accessing the entire library,or designing and implementing a photo-picking flow.Consider adopting the picker to individually access photosinstead of requesting full access.For an in-depth explanation of the picker's new capabilities,watch the video "Embed the Photos picker in your app."And in case you are developing an appthat has a strong requirementfor accessing the full photo library,iOS 17 has a redesigned permission dialogthat includes the number of photosand a sample of what will be shared.This helps people make the decisionthat is right for them about what to share.Because the preferences might change over time,the system also periodically reminds peopleif your app has full access to the photo library.Next up is the Screen Capture picker,a new API in ScreenCaptureKit for macOSthat enables people to share only the windows or screenyour app needs when screen sharing,while providing a better experience.Prior to macOS Sonoma, when a user wants to screen sharetheir presentation in a virtual video conference,they need to grant the conferencing app permissionto record the full screen via the Settings app,resulting in a poor experience and risk of oversharing.With the new SCContentSharingPicker API,macOS Sonoma shows a window picker on your behalfwhere people can pick the screen content that they want to share.macOS makes sure to only share the selected windows or screenas soon as they are picked.Because of the explicit action to record the screen,your app is permitted to record selected contentfor the duration of the screen capture session.This means your app is not requiredto obtain separate permission to capture the screenor build its own screen content picker --this is all handled by SCContentSharingPicker.To make sure that people are always aware,macOS Sonoma also includes a new screen sharing menu bar itemserving as a reminder that your app is recording the screen.Keep this in mind and only record screen contentwhen it is expected.When clicked, the menu expands to provide a previewof the shared content.This also allows quickly adding or removing screen contentto the capture session or ending it altogether.SCContentSharingPicker also provides optionsfor customization in order to adjust itbased on your app's needs,such as preferred selection modes or applications.For more details,watch "What's new in ScreenCaptureKit."Calendar is another area that now enablesseamless experiences in your app,especially for apps that only create new events.The calendar provides a detailed viewinto people's lives, such as doctor appointmentsor flight information, which is why peoplemay be surprised or even say no when your app asks for access.For apps that are only seeking accessto write calendar events, this can result in a failureto add events, frustration, and maybe even peoplemissing a concert or a good friend's birthday party.In order to avoid this issue, there are two important changesto Apple's platforms for Calendar access.First, if your app only creates new calendar events,I have great news for you:with EventKitUI, your app does not need any permission.This is made possible by renderingEventKitUI view controllers outside of your app,without any changes to the APIs or functionality.Second, if you prefer to provide your own UI for creating events,there is a new add-only calendar permission,allowing your app to add eventswithout access to other events on the calendar.This is another great way to integrate your app's eventsinto the user's day, without them having to worrywhether your app might be fetching contentof their calendar.And, should your app need full Calendar access later,you can ask once to upgrade.It is best to make this request when linked to user intent.When asked at an unexpected timeor for an unexpected reason, it might be rejectedand can degrade the experience in your app.Help people understand why the access is needed,by defining a meaningful purpose string.In order to provide the benefits of write-only accessto all apps,there are two important things to remember.If your app has been granted Calendar access previously,it defaults to write-only permission on upgrade to iOS 17or macOS Sonoma.Similarly, if you are linking against an older versionof EventKit and your app asks for Calendar access,the system only prompts for write-only access.In this case, when your app attemptsto fetch Calendar events, the system automatically asksto upgrade your app to full access.For more information about how to integrate EventKitand EventKitUI into your app,watch "Discover Calendar and EventKit."Next is the new Oblivious HTTP API,which helps you to hide client IP addresses from your serversand potentially sensitive app usage patternsfrom network operators.Knowing when and which apps people use on a daily basiscan provide deep insight into their lives.Because cellular and Wi-Fi network operatorscan observe what servers someone connects to,they can observe their personal app usage and life patterns.And some network operators may be interestedin using their position to learn about how people use your app.This could be especially sensitive to them,such as dating apps or apps for specific health conditions.IP addresses are an essential elementfor communication on the internet;however, the IP address can be abusedto determine someone's location or their identity.Exposure to IP addresses can resultin additional challenges for you if you wantto implement features with anonymity guaranteesin your app, such as client analytics.Apple platforms now support Oblivious HTTP,or OHTTP for short, in order to help youprotect people's app usage and IP addressby separating the who from what.OHTTP is a standardized internet protocolthat is designed to be lightweight,proxying encrypted messages at the application layerto allow for fast transactional server interactions.With OHTTP, the network operator can only observea connection to the relay provider,instead of your application server.The cornerstone of this architecture is the relay,which knows the client's IP addressand the destination server name,but none of the encrypted content.It is assumed that the relay always sees connectionsto your application server, so the only meaningful informationthe relay gains is the client IP.The final connection to your application serveris made by the relay.When the relay is operated by a third party,no single party has full visibility of the source IP,destination IP, and the content.This also enables you to add technical guaranteesto features where you don't want to be ableto identify or track users, such as anonymous analytics.With OHTTP support, you have the chance to buildstronger internet privacy protectionsthat impact people meaningfully.Services like iCloud Private Relayalready make use of OHTTPfor its great performance and strong privacy protections.For example, Private Relay uses it to protect all DNS queries.To learn more about how you can adopt OHTTP,watch the network relay video.Adopting OHTTP also means you will need to think abouthow to replace IP addresses in your system architecture --for example, to perform real-user detection.Refer to "Replace CAPTCHAs with Private Access Tokens"from WWDC22 to learn how to replace IP reputation systemswith a privacy-preserving alternative.Encrypting DNS queries is another essential partof protecting app usage from networks.To learn how, watch "Enable Encrypted DNS" from WWDC20.The last new tool is Communication Safetyand the new Sensitive Content Analysis framework,which utilizes on-device processingto help you protect children in your app.Apple platforms and the apps you buildhave become an important part of many families,as children use our products and servicesto explore the digital world and communicatewith family and friends.Communication Safety helps families to keep children safe,by warning children and providing helpful resourcesif they receive or attempt to share photosthat likely contain nudity.And it is important that these protections are appliedthroughout Apple's platforms, as well as in your app.To this end, Communication Safetyexpands beyond Messages to also detect sensitive contentwhen sharing via AirDrop,when leaving a message on FaceTime,when sharing contact posters in the Phone app,and in the Photos picker.We also make these features available to everyone,no matter their age, with Sensitive Content Warning.And now, with the new Sensitive Content Analysis framework,you can detect sensitive content in your app too.It taps into the same on-device technologywith system-provided ML models,so you don't have to share any content with any servers.And with this framework, this is possible for youwithout having to deal with the complexityof training large ML models and packing them into your app.Integration into your app is possiblewith just a few lines of code.To get started,create an instance of SCSensitivityAnalyzer.You can check the analysisPolicy attributeto decide whether analysis is needed,and what kind of intervention should be shownif the image or video contains nudity.Then, call the analyzeImage method with the URLof the photo, or the CGImage, that you want to analyze.For analyzing a video, call the videoAnalysis method instead.This returns a handler, so you can track progressand cancel the analysis if needed.To obtain the analysis result, call hasSensitiveContenton the handler.If isSensitive is true, the image or videolikely contains nudity.In this case, your app should provide its own intervention --which can consist of blurring or otherwise obfuscatingthe image or video --and an option to view the content.Also, check the analysis policy to tailor the interventiondepending on whether Communication Safetyor Sensitive Content Warning is enabled.You can find more detailed design guidelinesfor interventions in the Apple Developer documentation.Those are the new APIs to adopt to offer great privacyin your app.In addition to that, there are a few privacy changesto existing features on Apple platforms.This includes new ways you can protect data in your appas well as privacy improvements for Safariand Safari app extensions.First, our new privacy protections for macOS,designed to help you protect data in your appfrom other apps on the same device.Locations on disk like the Desktop, Documents,and Downloads folder have a system-managed permission.This ensures people are in controlover when apps have access to their private data.This model works well for files that peopledirectly interact with, like a project presentationor a spreadsheet with a budget.Some applications might store private datain different locations, such as a messaging appthat has a database of sent and received messages,or a notes app with vacation plans.These files are often stored in locationslike the Library folder, or for App Sandboxed apps,the app's data container.macOS Sonoma gives users additional controlover who can access their data.Specifically, macOS ensures that they give permissionbefore an app can access data in an application data containerfrom a different developer.This can impact your application in two ways.First, if your application stores dataoutside of system-managed data stores,adopt App Sandbox in order to extendthis new protection to data of your users.Then, all files created by your app will be protected.Apps that are already using App Sandboxget this new protection automatically.Second, if your app accesses data from other apps,there are a few ways that you can ask for permission.Without any changes on your side,macOS Sonoma will ask for permissionwhen your app accesses a file in another app's data container.The permission is valid for as long as your app remains open,and once the app is quit, the permission resets.You should only attempt to read other apps' fileswhen it is expected.If the timing of the prompt is surprising,or the purpose is unclear, your app's access might be denied.A meaningful purpose string will help peopleunderstand why your app is requesting access.There are a few alternative ways you can get explicit permissionto access files from other apps.For seamless access to individual files and folders,use NSOpenPanel.This shows the macOS file picker outside of your process,and your app can read or write selected resourcesonce the user confirms the selection.NSOpenPanel also allows you to specify the paththat is shown by default in the pickerto make the selection even easier.For backup utilities or disk-management toolsthat have already been granted Full Disk Access,no additional prompt will be shown at time of access,since people have already chosen to allow these appsaccess to all files.In addition, all apps signed with your Team IDcan access data in your other app's containers by default,without a permission prompt.So if you release a new app that imports datafrom a previous version of your app,this will work seamlessly.However, there may be instanceswhere you want to define a more restrictive policy.For example, if you build a code interpretersuch as an editor, browser, or a shell,you might want macOS to ask for permissionwhen this app accesses data from a messaging appthat you also developed.To do so, you can specify an NSDataAccessSecurityPolicyin your app's Info.plist, to replacethe default same-team policy with an explicit AllowList.When specified, listed processesand installer packages are permitted to accessyour app's data without additional consentwhile other apps require permission.Advanced Data Protection is another opportunity for youto protect data of your users.Advanced Data Protection was added in 2022,providing a way for people to enable end-to-end encryptionfor the vast majority of their data stored in iCloud.By adopting CloudKit, you can end-to-end encrypt datastored in CloudKit by your appwhenever someone enables Advanced Data Protection.And this is possible without any changes required on your end,in order to manage encryption keys,encryption operations,or complex and risky recovery flows.To extend the great privacy benefitsof Advanced Data Protection to your users,you only need to follow a few steps.First, make sure to use encrypted data typesfor all fields in your CloudKit schema.This includes CKAsset fields by default,and for most data types in CloudKit,there is an encrypted variant, such as EncryptedString.Then, you can use the encryptedValues API,to retrieve or store data on your CloudKit records.All encryption and decryption operations are abstracted awayby this API for your convenience.As a result, your app's data receives the full benefitof security breach and privacy protectionthat is available from Advanced Data Protection,whenever someone enables this feature.For an explanation of how you can adopt CloudKit in your app,including code samples,watch "What's New in CloudKit" from WWDC21.Next up are new fingerprinting and tracking protectionsin Safari Private Browsing mode.Safari is designed with privacy at its core.Private Browsing Mode enables additional privacy protectionsin Safari,such as making sure that when a tab is closed,Safari doesn't remember the pages you visited,search history, or AutoFill information.Private Browsing mode in Safari 17adds advanced tracking and fingerprinting protection,which includes two new protectionsfor preventing tracking across websites.First, Safari prevents known trackingand fingerprinting resources from being loaded.If you are a website developer, make sure to test your website'sfunctionality in Private Browsing mode:focus testing on login flows, cross-site navigationfrom your website, and use of browser APIsrelated to screen, audio, and graphics.You can reload without advanced trackingand fingerprinting protections, to confirm if a changein behavior of your website is due to the new protections.Do this by right-clicking on the reload button on macOS,via the page settings button on iOS,or by testing in Safari in normal browsing mode.You can also open the Web Inspectorto examine any output to the JavaScript console.Network requests that were blocked as a resultof contacting known trackers show up as a messagebeginning with "Blocked connection to known tracker."Another common method for cross-website trackingare unique identifiers embedded into URLs,for example, in query parameters.To give people control over where they can be tracked,another new protection is removal of tracking parametersas part of browser navigation, and when copying a link.When a tracking parameter is detected,Safari strips the identifying components of the URL,while leaving nonidentifiable parts intact.Remember that ad attribution can be donewithout identifying individuals across websites.For example, Private Click Measurementis a privacy-preserving alternativeto tracking parameters for advertising attribution.And it is now also available in Private Browsing modefor direct-response advertising, where no data is written to diskand attribution is limited to a single browsing context,based on a single tab.This follows Safari's existing strict modelof ephemeral browsing and separation of tabsin Private Browsing.For more information, check out the video"Meet privacy-preserving ad attribution" from WWDC21.The last platform change is the new permission modelfor app extensions in Safari.With Safari 17, the permission modelApple pioneered for web extensionsis coming to app extensions as well.This means that people are able to choose which webpagesyour extension is able to access on a per-site basis.We're also giving them controlover which extensions can run in Private Browsing mode.To learn more about these changes to extensionsand how permissions for your extensionscan be granted per-site, you can watch the video"What's new in Safari extensions."The privacy principles behind new tools for developersand our platform changes extend across all of the featureswe build at Apple, including the input modelon our new spatial computing platform.The system is really simple to use:just look around,decide what you want to interact with,and tap.There are no new permissions,no extra work for every app developer,and no worrying about apps tracking where you look.The results are a great new product with great privacy.Let's go through the privacy engineering approachto the development of eye and hand control.First, there are high-level goalsthe input model needs to achieve.The input experience should be fast and fluid,enabling natural interaction with UI elements.It should give real-time feedbackabout what people are looking at in order to provide confidencein interacting with UI elements of all kinds and sizes.In addition, existing iPhone and iPad applicationsshould work out of the box.And last, it should not require new app permissionsjust for apps to receive basic inputs.Next are the privacy goals for the input model.To prevent apps from learning sensitive detailsabout your eyes, including medical conditions,only relevant system components should be able to accessthe eye cameras.To enable permissionless access, apps should be able to workwithout learning details about people's eyes or hands.And what people look at can reveal what they're thinking,so it is important that apps work without learningwhat people look at and only learn what they interact with.Let's go over the system Apple engineeredto achieve all of these goals.The internal and external camera datathat measures eyes and hands for the input systemis processed in an isolated system process.This delivers a measurement of where the eyes and handsare located to the eye and pinch detection systems,and abstracts away complex camera processingfrom all other system components, including your app.The hover feedback system combineswhat is shown onscreen with the eye positionto determine what the user is looking at.If they are looking at a UI element,the system adds a highlighting layer as it is rendered.This is done by the rendering engineoutside of the app's process and only visibleto the person using the device,so they understand what they are looking atwithout revealing any information to apps.And as soon as a pinch gesture is detected,the system delivers a normal tap eventfor the highlighted UI element to your app.With this system architecture,the complexity of translating camera data into input eventsis handled by the operating system.This means, no changes are requiredto receive inputs on this new platform.In addition to the default system behavior,UIKit, SwiftUI, and RealityKit make it easyto tune these effects to match your app's design,with the same privacy protectionsas system-provided UI elements.You can change the type, shape,and what elements the hover effects apply to.To learn more about how to adopt,watch "Meet SwiftUI for spatial computing" as well as"Elevate your windowed app for spatial computing."This spatial input model is made possibleby implementing the privacy pillars.The system minimizes the amount of dataeach component of the system needs access to.All of the processing takes place on the device.People have control, since only intentional interactionsare shared with apps.And where you look is protected using process isolationenforced by the operating system's kernel.By making privacy a core design goal,it is possible to deliver both great featuresand great privacy.We hope that learning about the new privacy changesacross Apple platforms has helped inspire youas they make it easier for you to build trustthrough great privacy;minimize data accessed by your appwith content-picking APIs providing seamless user control;protect children in your app by adoptingthe Sensitive Content Analysis frameworkwith on-device processing.And for protecting user data in your app,adopt security protections such App Sandbox on macOS,and make sure to encrypt data in CloudKit.Thank you for watching this video.We can't wait to see what you build.♪

♪ Mellow instrumental hip-hop ♪♪Hi there!I'm Michael from Privacy Engineering,and welcome to "What's new in privacy."At Apple, we believe privacy is a fundamental human right.

To respect and protect it is all of our shared responsibility.

For this reason, privacy is a central componentto how we approach designing new and improved features at Apple.

Many products and services have become a central mainstayin all our lives, and so you have becomea vital partner in protecting people.

Providing a great privacy experience in your app,where people understand and controlwhat data is being accessed and for what purpose,helps them trust your app,especially in sensitive parts of their lives.

The privacy pillars are a great guide for youwhen building privacy into your app.

You might have heard us talk about them before,as these are four central ideas we use at Appleto think about the privacy of our products and services.

The first pillar is data minimization:use only the data needed to build a feature.

This applies throughout your app's architecture,from the amount of data features accessed,to data shared with application servers,to data that might be shared with third parties.

Second is on-device processing: tap into the power of the deviceto process data locally and avoid sharing itwith any servers.

Third, transparency and control is about making surepeople understand the what, why, when, and whereof data access and processing, and to give themadequate controls before that happens.

And also, enable them to change their mind later.

The last pillar is security protections:apply strong technical mitigationsto enforce the other pillars, such as end-to-end encryption.

To help you implement the privacy pillars in your app,I will tell you about new tools with privacy-centric designthat you can adopt, give the latest updateson important platform changes for privacy,and finally, I will talk about how the spatial input modelon Apple's newest platform was designed to protect privacy.

I will start with new privacy-enhancing technologiescoming to Apple's platforms that make it easier for youto build great apps with great privacy.

This includes a set of new APIs that allow your appto obtain access to content seamlessly,while giving users fine-grain control over sharing,as well as new APIs to better protect communicationwith servers and people.

I will begin with improvements to the Photos picker,designed to provide low-friction access to photos.

Over the years, our photo libraries have grown massivelyas more and more of our precious moments are captured there,starting with embarrassing childhood photos,to the last hiking trip.

For this reason, a fundamental wayto build up trust in your app is to empower peopleto make fine-grain decisions about which data they sharewith your app and when they share it.

So if someone wants to use your appto share the most scenic photos from their last trip,they can do so without granting your app access to all photos.

This is what the Photos picker allows you to do.

This API gives your app access to selected photos or videos,without requiring permission to access the entire photo library.

And in iOS 17 and macOS Sonoma, you can fully embed the pickerinto your app for a completely seamless experience.

Even though the photos look like they are part of your app,they are rendered by the system and only shared when selected,so the user's photos always remain in their control.

With the new customization options,you can choose whether you want to show the pickerwithout any chrome, like this,or as a minimal, single row of photosthat can be scrolled horizontally,or as an inline version of the full picker,with a new Options menu, providing controlsabout sharing photo metadata, such as captionsor location information.

The Photos picker is a great and fast way to obtain photos,as you don't need to worry about obtaining permissionfor accessing the entire library,or designing and implementing a photo-picking flow.

Consider adopting the picker to individually access photosinstead of requesting full access.

For an in-depth explanation of the picker's new capabilities,watch the video "Embed the Photos picker in your app."And in case you are developing an appthat has a strong requirementfor accessing the full photo library,iOS 17 has a redesigned permission dialogthat includes the number of photosand a sample of what will be shared.

This helps people make the decisionthat is right for them about what to share.

Because the preferences might change over time,the system also periodically reminds peopleif your app has full access to the photo library.

Next up is the Screen Capture picker,a new API in ScreenCaptureKit for macOSthat enables people to share only the windows or screenyour app needs when screen sharing,while providing a better experience.

Prior to macOS Sonoma, when a user wants to screen sharetheir presentation in a virtual video conference,they need to grant the conferencing app permissionto record the full screen via the Settings app,resulting in a poor experience and risk of oversharing.

With the new SCContentSharingPicker API,macOS Sonoma shows a window picker on your behalfwhere people can pick the screen content that they want to share.

macOS makes sure to only share the selected windows or screenas soon as they are picked.

Because of the explicit action to record the screen,your app is permitted to record selected contentfor the duration of the screen capture session.

This means your app is not requiredto obtain separate permission to capture the screenor build its own screen content picker --this is all handled by SCContentSharingPicker.

To make sure that people are always aware,macOS Sonoma also includes a new screen sharing menu bar itemserving as a reminder that your app is recording the screen.

Keep this in mind and only record screen contentwhen it is expected.

When clicked, the menu expands to provide a previewof the shared content.

This also allows quickly adding or removing screen contentto the capture session or ending it altogether.

SCContentSharingPicker also provides optionsfor customization in order to adjust itbased on your app's needs,such as preferred selection modes or applications.

For more details,watch "What's new in ScreenCaptureKit."Calendar is another area that now enablesseamless experiences in your app,especially for apps that only create new events.

The calendar provides a detailed viewinto people's lives, such as doctor appointmentsor flight information, which is why peoplemay be surprised or even say no when your app asks for access.

For apps that are only seeking accessto write calendar events, this can result in a failureto add events, frustration, and maybe even peoplemissing a concert or a good friend's birthday party.

In order to avoid this issue, there are two important changesto Apple's platforms for Calendar access.

First, if your app only creates new calendar events,I have great news for you:with EventKitUI, your app does not need any permission.

This is made possible by renderingEventKitUI view controllers outside of your app,without any changes to the APIs or functionality.

Second, if you prefer to provide your own UI for creating events,there is a new add-only calendar permission,allowing your app to add eventswithout access to other events on the calendar.

This is another great way to integrate your app's eventsinto the user's day, without them having to worrywhether your app might be fetching contentof their calendar.

And, should your app need full Calendar access later,you can ask once to upgrade.

It is best to make this request when linked to user intent.

When asked at an unexpected timeor for an unexpected reason, it might be rejectedand can degrade the experience in your app.

Help people understand why the access is needed,by defining a meaningful purpose string.

In order to provide the benefits of write-only accessto all apps,there are two important things to remember.

If your app has been granted Calendar access previously,it defaults to write-only permission on upgrade to iOS 17or macOS Sonoma.

Similarly, if you are linking against an older versionof EventKit and your app asks for Calendar access,the system only prompts for write-only access.

In this case, when your app attemptsto fetch Calendar events, the system automatically asksto upgrade your app to full access.

For more information about how to integrate EventKitand EventKitUI into your app,watch "Discover Calendar and EventKit."Next is the new Oblivious HTTP API,which helps you to hide client IP addresses from your serversand potentially sensitive app usage patternsfrom network operators.

Knowing when and which apps people use on a daily basiscan provide deep insight into their lives.

Because cellular and Wi-Fi network operatorscan observe what servers someone connects to,they can observe their personal app usage and life patterns.

And some network operators may be interestedin using their position to learn about how people use your app.

This could be especially sensitive to them,such as dating apps or apps for specific health conditions.

IP addresses are an essential elementfor communication on the internet;however, the IP address can be abusedto determine someone's location or their identity.

Exposure to IP addresses can resultin additional challenges for you if you wantto implement features with anonymity guaranteesin your app, such as client analytics.

Apple platforms now support Oblivious HTTP,or OHTTP for short, in order to help youprotect people's app usage and IP addressby separating the who from what.

OHTTP is a standardized internet protocolthat is designed to be lightweight,proxying encrypted messages at the application layerto allow for fast transactional server interactions.

With OHTTP, the network operator can only observea connection to the relay provider,instead of your application server.

The cornerstone of this architecture is the relay,which knows the client's IP addressand the destination server name,but none of the encrypted content.

It is assumed that the relay always sees connectionsto your application server, so the only meaningful informationthe relay gains is the client IP.

The final connection to your application serveris made by the relay.

When the relay is operated by a third party,no single party has full visibility of the source IP,destination IP, and the content.

This also enables you to add technical guaranteesto features where you don't want to be ableto identify or track users, such as anonymous analytics.

With OHTTP support, you have the chance to buildstronger internet privacy protectionsthat impact people meaningfully.

Services like iCloud Private Relayalready make use of OHTTPfor its great performance and strong privacy protections.

For example, Private Relay uses it to protect all DNS queries.

To learn more about how you can adopt OHTTP,watch the network relay video.

Adopting OHTTP also means you will need to think abouthow to replace IP addresses in your system architecture --for example, to perform real-user detection.

Refer to "Replace CAPTCHAs with Private Access Tokens"from WWDC22 to learn how to replace IP reputation systemswith a privacy-preserving alternative.

Encrypting DNS queries is another essential partof protecting app usage from networks.

To learn how, watch "Enable Encrypted DNS" from WWDC20.

The last new tool is Communication Safetyand the new Sensitive Content Analysis framework,which utilizes on-device processingto help you protect children in your app.

Apple platforms and the apps you buildhave become an important part of many families,as children use our products and servicesto explore the digital world and communicatewith family and friends.

Communication Safety helps families to keep children safe,by warning children and providing helpful resourcesif they receive or attempt to share photosthat likely contain nudity.

And it is important that these protections are appliedthroughout Apple's platforms, as well as in your app.

To this end, Communication Safetyexpands beyond Messages to also detect sensitive contentwhen sharing via AirDrop,when leaving a message on FaceTime,when sharing contact posters in the Phone app,and in the Photos picker.

We also make these features available to everyone,no matter their age, with Sensitive Content Warning.

And now, with the new Sensitive Content Analysis framework,you can detect sensitive content in your app too.

It taps into the same on-device technologywith system-provided ML models,so you don't have to share any content with any servers.

And with this framework, this is possible for youwithout having to deal with the complexityof training large ML models and packing them into your app.

Integration into your app is possiblewith just a few lines of code.

To get started,create an instance of SCSensitivityAnalyzer.

You can check the analysisPolicy attributeto decide whether analysis is needed,and what kind of intervention should be shownif the image or video contains nudity.

Then, call the analyzeImage method with the URLof the photo, or the CGImage, that you want to analyze.

For analyzing a video, call the videoAnalysis method instead.

This returns a handler, so you can track progressand cancel the analysis if needed.

To obtain the analysis result, call hasSensitiveContenton the handler.

If isSensitive is true, the image or videolikely contains nudity.

In this case, your app should provide its own intervention --which can consist of blurring or otherwise obfuscatingthe image or video --and an option to view the content.

Also, check the analysis policy to tailor the interventiondepending on whether Communication Safetyor Sensitive Content Warning is enabled.

You can find more detailed design guidelinesfor interventions in the Apple Developer documentation.

Those are the new APIs to adopt to offer great privacyin your app.

In addition to that, there are a few privacy changesto existing features on Apple platforms.

This includes new ways you can protect data in your appas well as privacy improvements for Safariand Safari app extensions.

First, our new privacy protections for macOS,designed to help you protect data in your appfrom other apps on the same device.

Locations on disk like the Desktop, Documents,and Downloads folder have a system-managed permission.

This ensures people are in controlover when apps have access to their private data.

This model works well for files that peopledirectly interact with, like a project presentationor a spreadsheet with a budget.

Some applications might store private datain different locations, such as a messaging appthat has a database of sent and received messages,or a notes app with vacation plans.

These files are often stored in locationslike the Library folder, or for App Sandboxed apps,the app's data container.

macOS Sonoma gives users additional controlover who can access their data.

Specifically, macOS ensures that they give permissionbefore an app can access data in an application data containerfrom a different developer.

This can impact your application in two ways.

First, if your application stores dataoutside of system-managed data stores,adopt App Sandbox in order to extendthis new protection to data of your users.

Then, all files created by your app will be protected.

Apps that are already using App Sandboxget this new protection automatically.

Second, if your app accesses data from other apps,there are a few ways that you can ask for permission.

Without any changes on your side,macOS Sonoma will ask for permissionwhen your app accesses a file in another app's data container.

The permission is valid for as long as your app remains open,and once the app is quit, the permission resets.

You should only attempt to read other apps' fileswhen it is expected.

If the timing of the prompt is surprising,or the purpose is unclear, your app's access might be denied.

A meaningful purpose string will help peopleunderstand why your app is requesting access.

There are a few alternative ways you can get explicit permissionto access files from other apps.

For seamless access to individual files and folders,use NSOpenPanel.

This shows the macOS file picker outside of your process,and your app can read or write selected resourcesonce the user confirms the selection.

NSOpenPanel also allows you to specify the paththat is shown by default in the pickerto make the selection even easier.

For backup utilities or disk-management toolsthat have already been granted Full Disk Access,no additional prompt will be shown at time of access,since people have already chosen to allow these appsaccess to all files.

In addition, all apps signed with your Team IDcan access data in your other app's containers by default,without a permission prompt.

So if you release a new app that imports datafrom a previous version of your app,this will work seamlessly.

However, there may be instanceswhere you want to define a more restrictive policy.

For example, if you build a code interpretersuch as an editor, browser, or a shell,you might want macOS to ask for permissionwhen this app accesses data from a messaging appthat you also developed.

To do so, you can specify an NSDataAccessSecurityPolicyin your app's Info.plist, to replacethe default same-team policy with an explicit AllowList.

When specified, listed processesand installer packages are permitted to accessyour app's data without additional consentwhile other apps require permission.

Advanced Data Protection is another opportunity for youto protect data of your users.

Advanced Data Protection was added in 2022,providing a way for people to enable end-to-end encryptionfor the vast majority of their data stored in iCloud.

By adopting CloudKit, you can end-to-end encrypt datastored in CloudKit by your appwhenever someone enables Advanced Data Protection.

And this is possible without any changes required on your end,in order to manage encryption keys,encryption operations,or complex and risky recovery flows.

To extend the great privacy benefitsof Advanced Data Protection to your users,you only need to follow a few steps.

First, make sure to use encrypted data typesfor all fields in your CloudKit schema.

This includes CKAsset fields by default,and for most data types in CloudKit,there is an encrypted variant, such as EncryptedString.

Then, you can use the encryptedValues API,to retrieve or store data on your CloudKit records.

All encryption and decryption operations are abstracted awayby this API for your convenience.

As a result, your app's data receives the full benefitof security breach and privacy protectionthat is available from Advanced Data Protection,whenever someone enables this feature.

For an explanation of how you can adopt CloudKit in your app,including code samples,watch "What's New in CloudKit" from WWDC21.

Next up are new fingerprinting and tracking protectionsin Safari Private Browsing mode.

Safari is designed with privacy at its core.

Private Browsing Mode enables additional privacy protectionsin Safari,such as making sure that when a tab is closed,Safari doesn't remember the pages you visited,search history, or AutoFill information.

Private Browsing mode in Safari 17adds advanced tracking and fingerprinting protection,which includes two new protectionsfor preventing tracking across websites.

First, Safari prevents known trackingand fingerprinting resources from being loaded.

If you are a website developer, make sure to test your website'sfunctionality in Private Browsing mode:focus testing on login flows, cross-site navigationfrom your website, and use of browser APIsrelated to screen, audio, and graphics.

You can reload without advanced trackingand fingerprinting protections, to confirm if a changein behavior of your website is due to the new protections.

Do this by right-clicking on the reload button on macOS,via the page settings button on iOS,or by testing in Safari in normal browsing mode.

You can also open the Web Inspectorto examine any output to the JavaScript console.

Network requests that were blocked as a resultof contacting known trackers show up as a messagebeginning with "Blocked connection to known tracker."Another common method for cross-website trackingare unique identifiers embedded into URLs,for example, in query parameters.

To give people control over where they can be tracked,another new protection is removal of tracking parametersas part of browser navigation, and when copying a link.

When a tracking parameter is detected,Safari strips the identifying components of the URL,while leaving nonidentifiable parts intact.

Remember that ad attribution can be donewithout identifying individuals across websites.

For example, Private Click Measurementis a privacy-preserving alternativeto tracking parameters for advertising attribution.

And it is now also available in Private Browsing modefor direct-response advertising, where no data is written to diskand attribution is limited to a single browsing context,based on a single tab.

This follows Safari's existing strict modelof ephemeral browsing and separation of tabsin Private Browsing.

For more information, check out the video"Meet privacy-preserving ad attribution" from WWDC21.

The last platform change is the new permission modelfor app extensions in Safari.

With Safari 17, the permission modelApple pioneered for web extensionsis coming to app extensions as well.

This means that people are able to choose which webpagesyour extension is able to access on a per-site basis.

We're also giving them controlover which extensions can run in Private Browsing mode.

To learn more about these changes to extensionsand how permissions for your extensionscan be granted per-site, you can watch the video"What's new in Safari extensions."The privacy principles behind new tools for developersand our platform changes extend across all of the featureswe build at Apple, including the input modelon our new spatial computing platform.

The system is really simple to use:just look around,decide what you want to interact with,and tap.

There are no new permissions,no extra work for every app developer,and no worrying about apps tracking where you look.

The results are a great new product with great privacy.

Let's go through the privacy engineering approachto the development of eye and hand control.

First, there are high-level goalsthe input model needs to achieve.

The input experience should be fast and fluid,enabling natural interaction with UI elements.

It should give real-time feedbackabout what people are looking at in order to provide confidencein interacting with UI elements of all kinds and sizes.

In addition, existing iPhone and iPad applicationsshould work out of the box.

And last, it should not require new app permissionsjust for apps to receive basic inputs.

Next are the privacy goals for the input model.

To prevent apps from learning sensitive detailsabout your eyes, including medical conditions,only relevant system components should be able to accessthe eye cameras.

To enable permissionless access, apps should be able to workwithout learning details about people's eyes or hands.

And what people look at can reveal what they're thinking,so it is important that apps work without learningwhat people look at and only learn what they interact with.

Let's go over the system Apple engineeredto achieve all of these goals.

The internal and external camera datathat measures eyes and hands for the input systemis processed in an isolated system process.

This delivers a measurement of where the eyes and handsare located to the eye and pinch detection systems,and abstracts away complex camera processingfrom all other system components, including your app.

The hover feedback system combineswhat is shown onscreen with the eye positionto determine what the user is looking at.

If they are looking at a UI element,the system adds a highlighting layer as it is rendered.

This is done by the rendering engineoutside of the app's process and only visibleto the person using the device,so they understand what they are looking atwithout revealing any information to apps.

And as soon as a pinch gesture is detected,the system delivers a normal tap eventfor the highlighted UI element to your app.

With this system architecture,the complexity of translating camera data into input eventsis handled by the operating system.

This means, no changes are requiredto receive inputs on this new platform.

In addition to the default system behavior,UIKit, SwiftUI, and RealityKit make it easyto tune these effects to match your app's design,with the same privacy protectionsas system-provided UI elements.

You can change the type, shape,and what elements the hover effects apply to.

To learn more about how to adopt,watch "Meet SwiftUI for spatial computing" as well as"Elevate your windowed app for spatial computing."This spatial input model is made possibleby implementing the privacy pillars.

The system minimizes the amount of dataeach component of the system needs access to.

All of the processing takes place on the device.

People have control, since only intentional interactionsare shared with apps.

And where you look is protected using process isolationenforced by the operating system's kernel.

By making privacy a core design goal,it is possible to deliver both great featuresand great privacy.

We hope that learning about the new privacy changesacross Apple platforms has helped inspire youas they make it easier for you to build trustthrough great privacy;minimize data accessed by your appwith content-picking APIs providing seamless user control;protect children in your app by adoptingthe Sensitive Content Analysis frameworkwith on-device processing.

And for protecting user data in your app,adopt security protections such App Sandbox on macOS,and make sure to encrypt data in CloudKit.

Thank you for watching this video.

We can't wait to see what you build.

♪

16:00 -Detect sensitive content

## Code Samples

```swift
// Analyzing photos



let
 analyzer 
=
 
SCSensitivityAnalyzer
()

let
 policy 
=
 analyzer.analysisPolicy


let
 result 
=
 
try
 
await
 analyzer.analyzeImage(at: url)

let
 result 
=
 
try
 
await
 analyzer.analyzeImage(image.cgImage
!
)


// Analyzing videos


let
 handler 
=
 analyzer.videoAnalysis(forFileAt: url)

let
 result 
=
 
try
 
await
 handler.hasSensitiveContent()


if
 result.isSensitive {
    intervene(policy)
}
```

