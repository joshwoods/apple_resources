# Wwdc2023 10142

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Transcript

Explore testing in-app purchasesLearn how you can test in-app purchases throughout development with StoreKit Testing in Xcode, App Store sandbox, and TestFlight. Explore how each tool functions and how you can combine them to build the right workflow for testing your apps and games. We'll also share a sneak preview of how you can test Family Sharing for in-app purchases & subscriptions in the App Store sandbox.ResourcesApp Store Server NotificationsBeta Testing Made SimpleMessageSetting up StoreKit Testing in XcodeSubmit feedbackTesting at all stages of development with Xcode and the sandboxTesting failing subscription renewals and In-App PurchasesTesting In-App Purchases with sandboxTurn on Family Sharing for in-app purchasesHD VideoSD VideoRelated VideosWWDC23Meet the App Store Server LibraryWhat’s new in App Store ConnectWhat’s new in StoreKit 2 and StoreKit Testing in XcodeTech TalksExplore Family Sharing for In-App PurchasesGet started with TestFlightWWDC22What's new in StoreKit testingWhat's new with in-app purchase

Learn how you can test in-app purchases throughout development with StoreKit Testing in Xcode, App Store sandbox, and TestFlight. Explore how each tool functions and how you can combine them to build the right workflow for testing your apps and games. We'll also share a sneak preview of how you can test Family Sharing for in-app purchases & subscriptions in the App Store sandbox.

App Store Server Notifications

Beta Testing Made Simple

Message

Setting up StoreKit Testing in Xcode

Submit feedback

Testing at all stages of development with Xcode and the sandbox

Testing failing subscription renewals and In-App Purchases

Testing In-App Purchases with sandbox

Turn on Family Sharing for in-app purchases

HD VideoSD Video

HD Video

SD Video

Meet the App Store Server Library

What’s new in App Store Connect

What’s new in StoreKit 2 and StoreKit Testing in Xcode

Explore Family Sharing for In-App Purchases

Get started with TestFlight

What's new in StoreKit testing

What's new with in-app purchase

Search this video…♪ ♪Hemant: Hi, I am Hemant,a Commerce Developer Advocate for the App Store.I'm excited to discuss App Store's tools to help you testand validate your in-app purchase experience.I'll cover benefits for each of these toolsand when it's best to use which.I will also cover all the great new featureswe are introducing this year for testing in-app purchases.So let's get started.App Store offers three tools to help you test in-app purchases.There is StoreKit Testing in Xcode,where you can test in-app purchases locally,and then there's sandbox, which uses products you have set upin App Store Connect, and TestFlight for performing end-to-end beta testingand to gather feedback from testers.These tools are available to help you build,test, and optimize your app's in-app purchase experience.I'll briefly describe each of these tools to help you determinethe appropriate tool for your in-app purchase testing.Starting with StoreKit Testing in Xcode.We introduced StoreKit Testing in Xcode at WWDC20.It enables you to test in-app purchaseswithout setting up your products in App Store Connect.You can test your in-app purchases fully offline,without requiring a server.It provides you with the ability to create and manage your in-app purchasesin the StoreKit configuration file.So you can test your code changes locally and in real-time.As you began your StoreKit integration,you can test your in-app purchase experienceusing simulator or a device.You can build automations to continuously test your in-app purchasesby using a dedicated StoreKitTest framework.In addition, you can sync your in-app purchase productsfrom App Store Connect to Xcode.This alleviates the need to set up a StoreKit configuration file manually.And you have ability to test advanced subscription use cases,such as offer code redemptions, price increase sheet,and subscriptions entering and exiting billing retry,all locally without having any dependency on a server.And one unique capability is the flexible subscription renewal rates,where you have option to choose a rate that fits your needs,from real-time to every two seconds.And now we have new options available with Xcode 15,giving you a set of renewal rates that are staticand independent of the subscription duration.So a monthly product or annual productwould renew at that same rate.You can simulate StoreKit errors that your app may encounter,which will help you build error handling into your app,errors such as if a product is not available for saleor if a user cancels the purchase.And now, if you are running multiple instances of your app,the transaction manager will display transactions for each app instance,allowing you to test on multiple devices.Transaction manager has added the ability to buy in-app purchases directly,all without opening your app,so you can test how your app handles external transactions.These new capabilities are available with Xcode 15.For more details, please see WWDC23 session"What's new in StoreKit 2 and StoreKit Testing in Xcode."Now, let's take a look at App Store sandbox.The App Store sandbox enables you to test and validateyour end-to-end in-app purchase implementationon both client and server.This is important when buildingand qualifying your complete app experienceand ensuring you are successfully delivering content to your users.To test in-app purchases in sandbox, your developer account needs to havea paid application agreement.You can test the app and in-app purchaseson a registered device with your developer account.To make a purchase in sandbox, you'll first need to createa sandbox Apple ID in the Users and Access sectionof App Store Connect.To run your app on an iOS device running iOS 16 or greater,you will need to enable developer mode in Privacy Settings.The installed app is intended to be used for development and testing.Sandbox helps you validate your logic to handle production-like scenariossuch as purchases, restores, and subscription offerand provides you confidence to launch your app in production.To test your app in sandbox, you need a device,and you can distribute your app using two options,such as you can tether your device to your Macand download the app on the deviceor using either of the distribution methodlike Release Testing,Debugging, and Custom to generate an IPA file.These methods help you deliver the app for testing purposesto your teams without a need to provide source code.We have been listening to your feedbackand we understand sandbox is important to youfor testing the customer experience.We continue to improve sandbox and add new testing features,and this year, we added supportto simulate scenarios around involuntary churnsuch as subscription billing problem messagingand billing grace period.Later this year, we are releasing supportfor testing Family Sharing in-app purchases,and we have added new options to the iOS sandbox Account Settings page.Let's deep-dive into all of these features.Billing problem message simulation is available to you in sandbox,and later this year, it will be presented to customers in productionwhen they enter billing retry.Billing problem messaging helps customers to resolve the payment issuewithout leaving your app and stay subscribedto your content and service.The billing problem sheet uses StoreKit 2 message APIwith reason billingIssue.The StoreKit message API is displayed by defaultwhen the customer launches your app or brings it to the foreground.Your can choose to defer or suppress the messageby implementing a message listener in views,where a billing problem sheet presentation might confuse the customer.You can simulate the message API reason billingIssue in sandboxto test how your app handles the message presentation.To learn more about implementing StoreKit 2 Message API,please see WWDC22 session "What's new with in-app purchase."Now, let's review the steps for simulating a billing problem message in sandbox.To test billing problem message, your sandbox Apple ID needs to besubscribed to an auto-renewable subscription with status active.Then you can simulate billing issue by navigatingto your sandbox account settings page on device in App Store settingsand disable the switch "Allow Purchases & Renewals."Disabling the switch will simulate billing issue for the Sandbox Apple ID,and the existing auto-renewable subscriptions will fail to renewas per the configured subscription renewal rateand will go into billing retry state.And when you navigate back to your app,App Store will send the billingIssue messageonce the subscription fails to renew,and the billing problem message will appear.When you tap the Continue button,it will open the iOS sandbox Account Settings page,and you can now toggle ON the "Allow Purchases & Renewals" switchto successfully renew the subscription.Once the subscription renews successfully,you will no longer get the billing problem message.This helps you simulate a customer recovering from billing issuewithout leaving your app when they update their payment method for their Apple ID.Enabling grace period allows customers to retain full accessto your app's paid content and servicewhile Apple attempts to collect the payment.This also helps you as a developerto avoid interruption to your paid days of serviceif an auto-renewable subscription is recovered within the grace period.To enable and simulate billing grace period in sandbox,navigate to your App Subscriptions section in App Store Connect.In the Billing Grace Period section, click "Set Up Billing Grace Period."This will open a dialog, which will allow you to configurebilling grace period for your app.You can than select from available grace period durations.Remember, these durations apply to production only,so when testing in sandbox, the duration of billing retryand billing grace period are pre-setaccording to your sandbox account's renewal rate.You can also select the eligible subscriberfor billing grace period and select the environment.You can choose to enable it first in sandboxor choose to enable in both sandbox and production,then click Confirm.You'll see your selection visible in App Store Connect.And now let's discuss Family Sharing.Family Sharing is a powerful tool that makes it easy for customersto share their digital purchases with their family members.Enabling Family Sharing for your auto-renewable subscriptionsand non-consumable products can help you attract new customers,increase user engagement, and improve retention.We wanted to provide you with an ability to testFamily Sharing in-app purchases in sandbox.To test Family Sharing in sandbox,you will need to log in to App Store Connectand navigate to the subscription or non-consumable productsfor which you need to enable Family Sharing.Then you will need to organize sandbox Family Sharing Membersin App Store Connect.And lastly, make a purchase with your sandbox Apple IDwhich is enabled for Family Sharing.Let's walk through the testing details.Once you have enabled your in-app purchase productto be family-sharable,you can now navigate to "User and Access" sectionof App Store Connect,and there, you will see a new section labelled "Family Sharing."In that section, you will be able to organize and viewyour sandbox family members for a storefront.Let's illustrate what the in-app purchase experience looks like in sandbox.Here, you initiate a purchase on device,just like any other normal sandbox purchase.As Family Sharing is enabled,transactions will be created for each family member.Your app will now see these new transactions upon launchor in real-time from StoreKit.At this point, you can test your app logicto make sure it validates and entitles service for the transaction.Additionally, you can also simulate a family memberlosing access to the service.For that, on iOS sandbox Account Settings,tap Family Sharing.This will present you a view of all the family members in sandbox,and you can choose to stop Family Sharing.The Family Sharing in sandbox will allow you to verifyand validate use cases such as:merchandising family-sharable productsusing isFamilySharable property of StoreKit.Validate your app logic to entitle service to a family member,for a new or existing purchase.Each family member can turn off sharing, enabling you totest when family members lose access to a previously shared purchase.For a scenario when a purchaser stops Family Sharing,you will be able to validate revoking access to servicesby using revocationDate available in JWSTransactions.And lastly, you will receive App Store Server Notificationsfor family members.To learn more about implementing Family Sharing,please see Tech Talk session "Explore Family Sharing for in-app purchases."Later this year, we are adding options to iOS sandbox Account Settings.The iOS sandbox Account Settings is availableonce you have made an initial in-app purchase in your sandbox app.Your signed-in sandbox account is visible in App Store settings.Scroll down this page to view your Sandbox Apple ID.When you tap on Sandbox Apple ID,a dialog appears.Tap the Manage button,and you'll navigate to your sandbox Account Settings.Later this year, you'll see three options, which were earlier availablein App Store Connect and are now available to youon-device for testing.Now through the Account Settings page, you'll be to adjustsubscription renewal rate,test interrupted purchases, and clear purchase history.When you tap on Renewal Rate, you can adjustthe subscription renewal rate for your sandbox account.And you'll also be able to clear purchase history of the sandbox Apple ID,to refresh your sandbox Apple ID and re-test your use cases.Lastly, let's take a look at TestFlight.TestFlight helps you to test your app's end-to-end experience,distribute your apps, and gather feedback from a wider tester audience.This helps you to validate and improve your app experiencebefore releasing it on the App Store.TestFlight allows you to distribute your app across all Apple platforms.You can add both internal and external testers,create multiple groups of testers, and add different builds to each groupdepending on the features you want each group to test.Testers can allow latest builds to be installed automatically,and each build remains available for 90 days after upload.For more information, please watch the Tech Talks session"Get started with TestFlight."When testing in-app purchases, testers need to downloadyour app builds using the TestFlight app.When buying an in-app purchase for an app downloaded through TestFlight,it uses your Apple ID, which is signed into Media & Purchases settings of the device.Similar to sandbox, you won't be charged for testingin-app purchases for an app downloaded through TestFlight.For testing auto-renewable subscriptions, the renewal ratesin TestFlight are equivalent to default renewal rate of sandbox.And if your app has implemented showManageSubscription APIof the StoreKit, it gives you the abilityto test subscription cancellation or change subscription.This year, we are making it easier to manage testers in TestFlight.You can filter by tester data like status, sessions,and bulk select group of testers to add or remove from a group.And to streamline your TestFlight app distribution,a new method is added for you to distribute the build, Internal Only.Using this method ensures the build can be availableto internal testers and cannot be submittedfor the App Store review.To learn more, please see session "What's new in App Store Connect"and "Simplify distribution in Xcode and Xcode Cloud."Now that I have reviewed the tools availablefor testing in-app purchases,it's important for you to know that these tools havetheir own benefits and differences but also have a lot in common,such as they support testing all in-app purchase types,and the subscriptions renew at an accelerated rate.However, some of these tools may be ideal for specific feature implementationsor use cases.For example,subscription offer code redemption and price increase sheetcan be tested using StoreKit Testing in Xcode.Billing retry and grace period can be testedusing both StoreKit Testing in Xcode and sandbox.To validate your server side implementation,both sandbox and TestFlight support App Store Server Notificationsand App Store Server API,while TestFlight provides you with a streamlined processto receive feedback from internal and external testersabout your app's performance and overall experience.Consider leveraging these tools for testing in-app purchasesdepending upon your use cases, feature implementation,and your organization's team structure.We have covered a lot today, and I hope this session helped youbetter understand all the available tools for you to test in-app purchases.To learn more, please see available documentationon developer.apple.com.And we would love to hear your feedback on how we can improveyour in-app purchase testing experience.Please let us know through Feedback Assistant.Thank you for taking time to watch this session.

♪ ♪Hemant: Hi, I am Hemant,a Commerce Developer Advocate for the App Store.I'm excited to discuss App Store's tools to help you testand validate your in-app purchase experience.I'll cover benefits for each of these toolsand when it's best to use which.I will also cover all the great new featureswe are introducing this year for testing in-app purchases.So let's get started.App Store offers three tools to help you test in-app purchases.There is StoreKit Testing in Xcode,where you can test in-app purchases locally,and then there's sandbox, which uses products you have set upin App Store Connect, and TestFlight for performing end-to-end beta testingand to gather feedback from testers.These tools are available to help you build,test, and optimize your app's in-app purchase experience.I'll briefly describe each of these tools to help you determinethe appropriate tool for your in-app purchase testing.

Starting with StoreKit Testing in Xcode.We introduced StoreKit Testing in Xcode at WWDC20.It enables you to test in-app purchaseswithout setting up your products in App Store Connect.You can test your in-app purchases fully offline,without requiring a server.It provides you with the ability to create and manage your in-app purchasesin the StoreKit configuration file.So you can test your code changes locally and in real-time.As you began your StoreKit integration,you can test your in-app purchase experienceusing simulator or a device.You can build automations to continuously test your in-app purchasesby using a dedicated StoreKitTest framework.In addition, you can sync your in-app purchase productsfrom App Store Connect to Xcode.This alleviates the need to set up a StoreKit configuration file manually.And you have ability to test advanced subscription use cases,such as offer code redemptions, price increase sheet,and subscriptions entering and exiting billing retry,all locally without having any dependency on a server.And one unique capability is the flexible subscription renewal rates,where you have option to choose a rate that fits your needs,from real-time to every two seconds.And now we have new options available with Xcode 15,giving you a set of renewal rates that are staticand independent of the subscription duration.So a monthly product or annual productwould renew at that same rate.You can simulate StoreKit errors that your app may encounter,which will help you build error handling into your app,errors such as if a product is not available for saleor if a user cancels the purchase.And now, if you are running multiple instances of your app,the transaction manager will display transactions for each app instance,allowing you to test on multiple devices.Transaction manager has added the ability to buy in-app purchases directly,all without opening your app,so you can test how your app handles external transactions.These new capabilities are available with Xcode 15.For more details, please see WWDC23 session"What's new in StoreKit 2 and StoreKit Testing in Xcode."Now, let's take a look at App Store sandbox.The App Store sandbox enables you to test and validateyour end-to-end in-app purchase implementationon both client and server.This is important when buildingand qualifying your complete app experienceand ensuring you are successfully delivering content to your users.To test in-app purchases in sandbox, your developer account needs to havea paid application agreement.You can test the app and in-app purchaseson a registered device with your developer account.To make a purchase in sandbox, you'll first need to createa sandbox Apple ID in the Users and Access sectionof App Store Connect.To run your app on an iOS device running iOS 16 or greater,you will need to enable developer mode in Privacy Settings.The installed app is intended to be used for development and testing.

Sandbox helps you validate your logic to handle production-like scenariossuch as purchases, restores, and subscription offerand provides you confidence to launch your app in production.To test your app in sandbox, you need a device,and you can distribute your app using two options,such as you can tether your device to your Macand download the app on the deviceor using either of the distribution methodlike Release Testing,Debugging, and Custom to generate an IPA file.These methods help you deliver the app for testing purposesto your teams without a need to provide source code.We have been listening to your feedbackand we understand sandbox is important to youfor testing the customer experience.We continue to improve sandbox and add new testing features,and this year, we added supportto simulate scenarios around involuntary churnsuch as subscription billing problem messagingand billing grace period.Later this year, we are releasing supportfor testing Family Sharing in-app purchases,and we have added new options to the iOS sandbox Account Settings page.Let's deep-dive into all of these features.Billing problem message simulation is available to you in sandbox,and later this year, it will be presented to customers in productionwhen they enter billing retry.Billing problem messaging helps customers to resolve the payment issuewithout leaving your app and stay subscribedto your content and service.The billing problem sheet uses StoreKit 2 message APIwith reason billingIssue.The StoreKit message API is displayed by defaultwhen the customer launches your app or brings it to the foreground.Your can choose to defer or suppress the messageby implementing a message listener in views,where a billing problem sheet presentation might confuse the customer.You can simulate the message API reason billingIssue in sandboxto test how your app handles the message presentation.To learn more about implementing StoreKit 2 Message API,please see WWDC22 session "What's new with in-app purchase."Now, let's review the steps for simulating a billing problem message in sandbox.To test billing problem message, your sandbox Apple ID needs to besubscribed to an auto-renewable subscription with status active.Then you can simulate billing issue by navigatingto your sandbox account settings page on device in App Store settingsand disable the switch "Allow Purchases & Renewals."Disabling the switch will simulate billing issue for the Sandbox Apple ID,and the existing auto-renewable subscriptions will fail to renewas per the configured subscription renewal rateand will go into billing retry state.And when you navigate back to your app,App Store will send the billingIssue messageonce the subscription fails to renew,and the billing problem message will appear.When you tap the Continue button,it will open the iOS sandbox Account Settings page,and you can now toggle ON the "Allow Purchases & Renewals" switchto successfully renew the subscription.Once the subscription renews successfully,you will no longer get the billing problem message.This helps you simulate a customer recovering from billing issuewithout leaving your app when they update their payment method for their Apple ID.Enabling grace period allows customers to retain full accessto your app's paid content and servicewhile Apple attempts to collect the payment.This also helps you as a developerto avoid interruption to your paid days of serviceif an auto-renewable subscription is recovered within the grace period.To enable and simulate billing grace period in sandbox,navigate to your App Subscriptions section in App Store Connect.In the Billing Grace Period section, click "Set Up Billing Grace Period."This will open a dialog, which will allow you to configurebilling grace period for your app.You can than select from available grace period durations.Remember, these durations apply to production only,so when testing in sandbox, the duration of billing retryand billing grace period are pre-setaccording to your sandbox account's renewal rate.You can also select the eligible subscriberfor billing grace period and select the environment.You can choose to enable it first in sandboxor choose to enable in both sandbox and production,then click Confirm.You'll see your selection visible in App Store Connect.And now let's discuss Family Sharing.Family Sharing is a powerful tool that makes it easy for customersto share their digital purchases with their family members.Enabling Family Sharing for your auto-renewable subscriptionsand non-consumable products can help you attract new customers,increase user engagement, and improve retention.We wanted to provide you with an ability to testFamily Sharing in-app purchases in sandbox.

To test Family Sharing in sandbox,you will need to log in to App Store Connectand navigate to the subscription or non-consumable productsfor which you need to enable Family Sharing.Then you will need to organize sandbox Family Sharing Membersin App Store Connect.And lastly, make a purchase with your sandbox Apple IDwhich is enabled for Family Sharing.Let's walk through the testing details.Once you have enabled your in-app purchase productto be family-sharable,you can now navigate to "User and Access" sectionof App Store Connect,and there, you will see a new section labelled "Family Sharing."In that section, you will be able to organize and viewyour sandbox family members for a storefront.Let's illustrate what the in-app purchase experience looks like in sandbox.Here, you initiate a purchase on device,just like any other normal sandbox purchase.As Family Sharing is enabled,transactions will be created for each family member.Your app will now see these new transactions upon launchor in real-time from StoreKit.At this point, you can test your app logicto make sure it validates and entitles service for the transaction.Additionally, you can also simulate a family memberlosing access to the service.For that, on iOS sandbox Account Settings,tap Family Sharing.This will present you a view of all the family members in sandbox,and you can choose to stop Family Sharing.The Family Sharing in sandbox will allow you to verifyand validate use cases such as:merchandising family-sharable productsusing isFamilySharable property of StoreKit.Validate your app logic to entitle service to a family member,for a new or existing purchase.Each family member can turn off sharing, enabling you totest when family members lose access to a previously shared purchase.For a scenario when a purchaser stops Family Sharing,you will be able to validate revoking access to servicesby using revocationDate available in JWSTransactions.And lastly, you will receive App Store Server Notificationsfor family members.To learn more about implementing Family Sharing,please see Tech Talk session "Explore Family Sharing for in-app purchases."Later this year, we are adding options to iOS sandbox Account Settings.The iOS sandbox Account Settings is availableonce you have made an initial in-app purchase in your sandbox app.Your signed-in sandbox account is visible in App Store settings.Scroll down this page to view your Sandbox Apple ID.When you tap on Sandbox Apple ID,a dialog appears.Tap the Manage button,and you'll navigate to your sandbox Account Settings.Later this year, you'll see three options, which were earlier availablein App Store Connect and are now available to youon-device for testing.Now through the Account Settings page, you'll be to adjustsubscription renewal rate,test interrupted purchases, and clear purchase history.When you tap on Renewal Rate, you can adjustthe subscription renewal rate for your sandbox account.And you'll also be able to clear purchase history of the sandbox Apple ID,to refresh your sandbox Apple ID and re-test your use cases.Lastly, let's take a look at TestFlight.TestFlight helps you to test your app's end-to-end experience,distribute your apps, and gather feedback from a wider tester audience.This helps you to validate and improve your app experiencebefore releasing it on the App Store.

TestFlight allows you to distribute your app across all Apple platforms.You can add both internal and external testers,create multiple groups of testers, and add different builds to each groupdepending on the features you want each group to test.Testers can allow latest builds to be installed automatically,and each build remains available for 90 days after upload.For more information, please watch the Tech Talks session"Get started with TestFlight."When testing in-app purchases, testers need to downloadyour app builds using the TestFlight app.When buying an in-app purchase for an app downloaded through TestFlight,it uses your Apple ID, which is signed into Media & Purchases settings of the device.Similar to sandbox, you won't be charged for testingin-app purchases for an app downloaded through TestFlight.For testing auto-renewable subscriptions, the renewal ratesin TestFlight are equivalent to default renewal rate of sandbox.And if your app has implemented showManageSubscription APIof the StoreKit, it gives you the abilityto test subscription cancellation or change subscription.This year, we are making it easier to manage testers in TestFlight.You can filter by tester data like status, sessions,and bulk select group of testers to add or remove from a group.And to streamline your TestFlight app distribution,a new method is added for you to distribute the build, Internal Only.Using this method ensures the build can be availableto internal testers and cannot be submittedfor the App Store review.To learn more, please see session "What's new in App Store Connect"and "Simplify distribution in Xcode and Xcode Cloud."Now that I have reviewed the tools availablefor testing in-app purchases,it's important for you to know that these tools havetheir own benefits and differences but also have a lot in common,such as they support testing all in-app purchase types,and the subscriptions renew at an accelerated rate.However, some of these tools may be ideal for specific feature implementationsor use cases.For example,subscription offer code redemption and price increase sheetcan be tested using StoreKit Testing in Xcode.Billing retry and grace period can be testedusing both StoreKit Testing in Xcode and sandbox.To validate your server side implementation,both sandbox and TestFlight support App Store Server Notificationsand App Store Server API,while TestFlight provides you with a streamlined processto receive feedback from internal and external testersabout your app's performance and overall experience.Consider leveraging these tools for testing in-app purchasesdepending upon your use cases, feature implementation,and your organization's team structure.We have covered a lot today, and I hope this session helped youbetter understand all the available tools for you to test in-app purchases.To learn more, please see available documentationon developer.apple.com.And we would love to hear your feedback on how we can improveyour in-app purchase testing experience.Please let us know through Feedback Assistant.Thank you for taking time to watch this session.

## Code Samples

