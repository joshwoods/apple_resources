# Wwdc2023 10070

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Transcript

Create a great spatial playback experienceGet ready to support video in your visionOS app! Take a tour of the frameworks and APIs that power video playback and learn how you can update your app to play 3D content. We'll also share tips for customizing playback to create a more immersive watching experience.ResourcesHD VideoSD VideoRelated VideosWWDC23Deliver video content for spatial experiencesOptimize app power and performance for spatial computing

Get ready to support video in your visionOS app! Take a tour of the frameworks and APIs that power video playback and learn how you can update your app to play 3D content. We'll also share tips for customizing playback to create a more immersive watching experience.

HD VideoSD Video

HD Video

SD Video

Deliver video content for spatial experiences

Optimize app power and performance for spatial computing

Search this video…♪ Mellow instrumental hip-hop ♪♪Hi, my name is Jeremy,and I'm a media experience software engineer.This talk will explain how to createa great spatial experience for video playback in your app.A great experience is optimized for the platform,takes advantage of its powerful media capabilities,and integrates with the whole system.First, we'll explore the media experiencewith a minimal app.Next, I'll go over some more advanced UI features.Then, I'll go over some other methods of displaying video.Finally, I'll compare the options.If you have used the media APIs on iOS or tvOS,then this may feel familiar.This platform builds on those same APIsand extends them for its unique capabilities.AVFoundation handles all the work of playing movies:streaming, parsing, decoding, synchronizing.And AVKit builds on AVFoundation and UI Frameworks,to create a playback experience that's customizedand integrated for each platform.On this platform, AVFoundation has been enhancedto support new media formats that take advantageof its unique capabilities, such as 3D video.Refer to this session for more details about these formats.AVFoundation has also been enhanced to render performantlyand with high quality using RealityKit,so that video can be composited seamlesslyinto the world around you,and so that audio also responds to the world around you.And AVKit's AVPlayerViewControllerhas been extended to make use of the power of RealityKitand the unique capabilities of the platformto create a highly refined experience.This includes all the playback controls you expect,but also has many unique capabilities.What's required to take advantage of this in your app?First, the Xcode target must build with this platform's SDK.Compatible iOS apps built with the iOS SDKwill get an iOS compatible experience.Use AVPlayerViewControllerjust like you do on iOS or tvOS.And finally, present the view controllerso it fills the window.Let's demonstrate this with some code.First, we'll import AVFoundation and AVKit.Next, create an AVPlayerViewControllerand connect an AVPlayer to it.Then, create a new player item with the content URLand set it on the player.Adding the item after setting the playeron the view controller can improve performancebecause the player will understandhow it will be displayed before it starts loading the media.Then, to use it in SwiftUI,wrap that code in a UIViewControllerRepresentable.We'll call this one PlayerView.Then, we'll create our app,which we'll call MoviePlayingApp.Add the view controller, which we just defined,so it fills the window.Just like that, you've got a movie playing app.If you're thinking this code looks very similarto what you would write on other Apple platforms,that's because it is.AVPlayerViewController and AVPlayer are doinga lot of the heavy lifting so you don't have to.Let me show you the media experiencea simple app like this has.Before the app is launched, just the room is visible.When the app launches,a large screen appears right in frontand the room darkens, creating a nice ambiance.When moving, the screen stays in place,and the audio stays anchored to the screen.To show playback controls, look at the screen and tap.The controls float just in front of the video.While playing,do nothing and they will disappear on their own.Or make them disappearby looking at the screen and tapping again.Grab the window bar below the screento reposition it.Grab the corner of the screen to resize.Notice that as the screen resizes,it animates smoothly and matches the aspect ratio of the video.Adjust the volume by turning the Digital Crown.Or use the Digital Crown to open an environment, like this.I love watching movies this way.You've got to experience this for yourself.Now, let's examine the playback controls more closelyto see the features they provide.Here is our player interface.At the top right is the volume controlto make quick adjustments or to mute.As I mentioned, volume can also be adjustedwith the Digital Crown.At the bottom left are the familiar play/pauseand back/forward buttons.In the bottom middle is the scrubberto jump to a different time in the movie.And in the bottom rightis this button with more options.Here are options to adjust the playback speed.When movies contain multiple audio tracks or caption tracks,use these options to choose the languagefor the audio track,or to enable captions in the preferred language.This last option is Dimming Effect.I love watching movies in the darkto really focus on them,but sometimes a video isn't my only focus.Here, I can turn off Dimming Effectto better see what's around me.We've covered the basics that are built in.Now, let's explore some more advanced features.Thumbnail scrubbing shows a small imageof the video while scrubbing,allowing seamless navigation of the content.The controls will automatically display a thumbnailwhen scrubbing for HLS streamsthat have an I-frame only playlist,also known as a Trick Play track.Small Trick Play trackswith a width of 145 pixels are preferred.Refer to this document for more details.Sometimes media needs to be inserted into the timelinefor a logo, a recap, or an ad.Interstitials support enables this ability.When interstitials are present,the controls will automatically reflect themwith an indicator in the timeline.These interstitials can be configured programmaticallywith an AVPlayerInterstital EventController,or they can be described within the HLS stream.Refer to this session for more details.There are some additional UI optionscommonly used by video playing apps.Contextual actions allow you to add buttons likeSkip intro or Play next episode.They can have a title and an optional image.Custom info view controllers can be usedto show metadata about the contentor to suggest related content.These APIs work the same as on other Apple platforms.Refer to this session for more details.Your app can also transport you to another placewith a feature called Immersive Spaces.When your app creates an Immersive Space,you get to decide what that space looks like.And even better, your video screenwill automatically move into that spaceand anchor itself at a predictable size and positionto guarantee an excellent viewing angle every time.And the controls detach and move closerto make them easier to interact with.Let's check out some code.Here is our MoviePlayingApp from earlier.First, we'll add an Immersive Space.The 3D content will be describedby RealityKit entities.Then we'll use onAppear on our PlayerViewto open the space.Make sure your Immersive Space is designed to accommodatethe movie player when it's docked.For more information about how to buildand present spaces, refer to this session.AVPlayerViewController has been thoroughly refinedand designed for a great experience on this platform.We really want AVPlayerViewControllerto work for you.So, if there are features or behaviors you'd like to suggest,please provide feedback so we can continueto improve it for your use cases.Now, there could still be rare situationswhere someone needs to build custom playback controls.In that case, please provide feedback.And we recommend you use AVPlayerViewController.You can hide the controlsand supply an overlay for your custom UI.This is preferred over using a lower-level API because,as we've demonstrated, AVPlayerViewControllerprovides a lot of system integration featuresbeyond just playback controls.And you'll continue to get great system integration features.We've explored AVPlayerViewController'sfullscreen experience.Now let's look at some other use cases for video playback.Sometimes you want a movie to play inline in a window.It could be part of a document or to play a preview.AVPlayerViewController inline is great for this situation too.How do you get the inline view?It will automatically use this modewhenever it's displayed without filling the window.Its inline controls are also redesigned for the OS.Note, because video is composited within the windowusing AVPlayerLayer,it won't be able to display 3D video.Sometimes your app may want to play videoas an entity of a 3D scene.It could be a splash screen or a video transition.In these cases, you don't want playback controlsand you also don't want system integration like docking.For those cases,use RealityKit's VideoPlayerComponent.VideoPlayerComponent connects a RealityKit Entityto an AVPlayer.You can position it in your RealityKit scenejust like any other entity.It creates an aspect ratio correct mesh for the video,and it supports displaying captions.Whenever possible, prefer it over AVPlayerLayer.Because it takes advantage of RealityKit's optimizationsfor video, it gets better performance than AVPlayerLayer,and it supports new 3D video formats.Refer to this session for more details.Sometimes you may want to use video in a 3D scenewhere the video is used as an effect.In this case, you may want to create your own geometryand have more control over how the video is displayed.VideoMaterial is a lower-level APIthat will display video on arbitrary geometry.This means it can't ensure the original aspect ratioand it doesn't have the ability to display captions.Check out this related talk for more details.We've talked about some additional UI featuresand some other use cases.The DestinationVideo sample appdemonstrates some of these features.It has a video browser for choosing videosand plays them in an Immersive Space.Here it is.Choose a video to show the info pageand an Immersive Space opens.Notice the use of an inline player with custom UI controlsfor the preview.Then, play the movie.The player UI appears and immediately docksinto the Immersive Spaceat a fixed size and location for optimal viewing.Another nice detail is that when the screen is dockedin an Immersive Space like this, the playback controls detachand come a little closer to make them more convenientto interact with.Tap the list button.The app has supplied custom info view controllersto display more info about the contentand related content while watching the video.Near the end of the video,a contextual action button labeled Play Nextappears in the bottom-right corner.We've covered the spatial experience for video playback.It has a large screen floating in space in front of youwith beautiful visuals and great spatial audio.It includes playback controls for everything you need to do,and we've talked about some other playback use cases.There are several ways to display video in your app.Let's compare them.These are the APIs to show video.Each has different capabilities.Use the correct API for the media experience you need.Make sure your media is displayed accuratelyand is accessible.Make sure it's optimized for the platformand enables 3D video formats by rendering with RealityKit.And make sure it has powerful playback controlstuned for the platform.And make sure it's integrated with the whole systemto get a great experience.AVPlayerViewController will allow your appto take full advantage of features you've been usingin other Apple platformsand the new, unique features of this platform.You can deliver a great movie playback experiencefor your users.Spatial media capabilities represent an opportunityfor people to experience video in a whole new way.To get started, check out DestinationVideo Sample Project.It demonstrates many of the features discussed here.And check out these related talks.I can't wait for people to see what you makewith these powerful tools.But now, I've got to get back to watching a show.Enjoy!♪

♪ Mellow instrumental hip-hop ♪♪Hi, my name is Jeremy,and I'm a media experience software engineer.This talk will explain how to createa great spatial experience for video playback in your app.A great experience is optimized for the platform,takes advantage of its powerful media capabilities,and integrates with the whole system.First, we'll explore the media experiencewith a minimal app.Next, I'll go over some more advanced UI features.Then, I'll go over some other methods of displaying video.Finally, I'll compare the options.If you have used the media APIs on iOS or tvOS,then this may feel familiar.This platform builds on those same APIsand extends them for its unique capabilities.AVFoundation handles all the work of playing movies:streaming, parsing, decoding, synchronizing.And AVKit builds on AVFoundation and UI Frameworks,to create a playback experience that's customizedand integrated for each platform.On this platform, AVFoundation has been enhancedto support new media formats that take advantageof its unique capabilities, such as 3D video.Refer to this session for more details about these formats.AVFoundation has also been enhanced to render performantlyand with high quality using RealityKit,so that video can be composited seamlesslyinto the world around you,and so that audio also responds to the world around you.And AVKit's AVPlayerViewControllerhas been extended to make use of the power of RealityKitand the unique capabilities of the platformto create a highly refined experience.This includes all the playback controls you expect,but also has many unique capabilities.What's required to take advantage of this in your app?First, the Xcode target must build with this platform's SDK.Compatible iOS apps built with the iOS SDKwill get an iOS compatible experience.Use AVPlayerViewControllerjust like you do on iOS or tvOS.And finally, present the view controllerso it fills the window.Let's demonstrate this with some code.First, we'll import AVFoundation and AVKit.Next, create an AVPlayerViewControllerand connect an AVPlayer to it.Then, create a new player item with the content URLand set it on the player.Adding the item after setting the playeron the view controller can improve performancebecause the player will understandhow it will be displayed before it starts loading the media.Then, to use it in SwiftUI,wrap that code in a UIViewControllerRepresentable.We'll call this one PlayerView.Then, we'll create our app,which we'll call MoviePlayingApp.Add the view controller, which we just defined,so it fills the window.Just like that, you've got a movie playing app.If you're thinking this code looks very similarto what you would write on other Apple platforms,that's because it is.AVPlayerViewController and AVPlayer are doinga lot of the heavy lifting so you don't have to.Let me show you the media experiencea simple app like this has.Before the app is launched, just the room is visible.When the app launches,a large screen appears right in frontand the room darkens, creating a nice ambiance.When moving, the screen stays in place,and the audio stays anchored to the screen.To show playback controls, look at the screen and tap.The controls float just in front of the video.While playing,do nothing and they will disappear on their own.Or make them disappearby looking at the screen and tapping again.Grab the window bar below the screento reposition it.

Grab the corner of the screen to resize.Notice that as the screen resizes,it animates smoothly and matches the aspect ratio of the video.Adjust the volume by turning the Digital Crown.Or use the Digital Crown to open an environment, like this.I love watching movies this way.You've got to experience this for yourself.

Now, let's examine the playback controls more closelyto see the features they provide.Here is our player interface.At the top right is the volume controlto make quick adjustments or to mute.As I mentioned, volume can also be adjustedwith the Digital Crown.At the bottom left are the familiar play/pauseand back/forward buttons.In the bottom middle is the scrubberto jump to a different time in the movie.And in the bottom rightis this button with more options.Here are options to adjust the playback speed.When movies contain multiple audio tracks or caption tracks,use these options to choose the languagefor the audio track,or to enable captions in the preferred language.This last option is Dimming Effect.I love watching movies in the darkto really focus on them,but sometimes a video isn't my only focus.Here, I can turn off Dimming Effectto better see what's around me.We've covered the basics that are built in.Now, let's explore some more advanced features.Thumbnail scrubbing shows a small imageof the video while scrubbing,allowing seamless navigation of the content.The controls will automatically display a thumbnailwhen scrubbing for HLS streamsthat have an I-frame only playlist,also known as a Trick Play track.Small Trick Play trackswith a width of 145 pixels are preferred.Refer to this document for more details.Sometimes media needs to be inserted into the timelinefor a logo, a recap, or an ad.Interstitials support enables this ability.When interstitials are present,the controls will automatically reflect themwith an indicator in the timeline.These interstitials can be configured programmaticallywith an AVPlayerInterstital EventController,or they can be described within the HLS stream.Refer to this session for more details.There are some additional UI optionscommonly used by video playing apps.Contextual actions allow you to add buttons likeSkip intro or Play next episode.They can have a title and an optional image.Custom info view controllers can be usedto show metadata about the contentor to suggest related content.These APIs work the same as on other Apple platforms.Refer to this session for more details.Your app can also transport you to another placewith a feature called Immersive Spaces.When your app creates an Immersive Space,you get to decide what that space looks like.And even better, your video screenwill automatically move into that spaceand anchor itself at a predictable size and positionto guarantee an excellent viewing angle every time.And the controls detach and move closerto make them easier to interact with.Let's check out some code.Here is our MoviePlayingApp from earlier.First, we'll add an Immersive Space.The 3D content will be describedby RealityKit entities.Then we'll use onAppear on our PlayerViewto open the space.Make sure your Immersive Space is designed to accommodatethe movie player when it's docked.For more information about how to buildand present spaces, refer to this session.AVPlayerViewController has been thoroughly refinedand designed for a great experience on this platform.We really want AVPlayerViewControllerto work for you.So, if there are features or behaviors you'd like to suggest,please provide feedback so we can continueto improve it for your use cases.Now, there could still be rare situationswhere someone needs to build custom playback controls.In that case, please provide feedback.And we recommend you use AVPlayerViewController.You can hide the controlsand supply an overlay for your custom UI.This is preferred over using a lower-level API because,as we've demonstrated, AVPlayerViewControllerprovides a lot of system integration featuresbeyond just playback controls.And you'll continue to get great system integration features.We've explored AVPlayerViewController'sfullscreen experience.Now let's look at some other use cases for video playback.Sometimes you want a movie to play inline in a window.It could be part of a document or to play a preview.AVPlayerViewController inline is great for this situation too.How do you get the inline view?It will automatically use this modewhenever it's displayed without filling the window.Its inline controls are also redesigned for the OS.Note, because video is composited within the windowusing AVPlayerLayer,it won't be able to display 3D video.Sometimes your app may want to play videoas an entity of a 3D scene.It could be a splash screen or a video transition.In these cases, you don't want playback controlsand you also don't want system integration like docking.For those cases,use RealityKit's VideoPlayerComponent.VideoPlayerComponent connects a RealityKit Entityto an AVPlayer.You can position it in your RealityKit scenejust like any other entity.It creates an aspect ratio correct mesh for the video,and it supports displaying captions.Whenever possible, prefer it over AVPlayerLayer.Because it takes advantage of RealityKit's optimizationsfor video, it gets better performance than AVPlayerLayer,and it supports new 3D video formats.Refer to this session for more details.Sometimes you may want to use video in a 3D scenewhere the video is used as an effect.In this case, you may want to create your own geometryand have more control over how the video is displayed.VideoMaterial is a lower-level APIthat will display video on arbitrary geometry.This means it can't ensure the original aspect ratioand it doesn't have the ability to display captions.Check out this related talk for more details.We've talked about some additional UI featuresand some other use cases.The DestinationVideo sample appdemonstrates some of these features.It has a video browser for choosing videosand plays them in an Immersive Space.Here it is.Choose a video to show the info pageand an Immersive Space opens.Notice the use of an inline player with custom UI controlsfor the preview.Then, play the movie.The player UI appears and immediately docksinto the Immersive Spaceat a fixed size and location for optimal viewing.Another nice detail is that when the screen is dockedin an Immersive Space like this, the playback controls detachand come a little closer to make them more convenientto interact with.Tap the list button.The app has supplied custom info view controllersto display more info about the contentand related content while watching the video.Near the end of the video,a contextual action button labeled Play Nextappears in the bottom-right corner.We've covered the spatial experience for video playback.It has a large screen floating in space in front of youwith beautiful visuals and great spatial audio.It includes playback controls for everything you need to do,and we've talked about some other playback use cases.There are several ways to display video in your app.Let's compare them.These are the APIs to show video.Each has different capabilities.Use the correct API for the media experience you need.Make sure your media is displayed accuratelyand is accessible.Make sure it's optimized for the platformand enables 3D video formats by rendering with RealityKit.And make sure it has powerful playback controlstuned for the platform.And make sure it's integrated with the whole systemto get a great experience.AVPlayerViewController will allow your appto take full advantage of features you've been usingin other Apple platformsand the new, unique features of this platform.You can deliver a great movie playback experiencefor your users.Spatial media capabilities represent an opportunityfor people to experience video in a whole new way.To get started, check out DestinationVideo Sample Project.It demonstrates many of the features discussed here.And check out these related talks.I can't wait for people to see what you makewith these powerful tools.But now, I've got to get back to watching a show.Enjoy!♪

## Code Samples

