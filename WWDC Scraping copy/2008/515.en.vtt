WEBVTT

00:00:21.150 --> 00:00:21.940
- Good morning.

00:00:21.940 --> 00:00:29.420
It is morning, 9:00 AM,
middle of the week.

00:00:29.470 --> 00:00:30.890
I'm awake.

00:00:31.290 --> 00:00:32.320
My name is Schoun Regan.

00:00:32.340 --> 00:00:35.380
I'm the provider development
manager for Apple.

00:00:35.400 --> 00:00:40.930
And this session is best practices
for Tiger to Leopard Server Migration,

00:00:41.150 --> 00:00:45.210
which doesn't mean that you
just buy a Leopard Server and

00:00:45.210 --> 00:00:46.570
magically it just comes over.

00:00:46.680 --> 00:00:51.580
So we want to talk about some of
the stuff that Apple has planned

00:00:51.580 --> 00:00:54.550
for doing a successful migration.

00:00:54.720 --> 00:00:57.750
Joining me is going to be
Jeff Walling and for demos,

00:00:57.750 --> 00:00:59.110
Andre LaBranche.

00:00:59.110 --> 00:01:01.640
We'll get to them in a little bit.

00:01:01.640 --> 00:01:07.310
But what we want to talk about
is the preparation that you need

00:01:07.310 --> 00:01:10.840
when moving from one to the other.

00:01:10.840 --> 00:01:15.960
We did this two years ago with Panther to
Tiger and we're doing it again.

00:01:15.960 --> 00:01:19.510
But we want to focus on
certain critical areas.

00:01:19.510 --> 00:01:23.120
And those areas are the
service configurations.

00:01:23.120 --> 00:01:25.480
DNS, AFP, the file sharing services.

00:01:25.480 --> 00:01:28.420
Firewall, really critical,
some other stuff.

00:01:28.420 --> 00:01:30.560
We're going to talk about
the password server,

00:01:31.330 --> 00:01:34.480
KDC, and we want to talk
about all the accounts.

00:01:34.480 --> 00:01:37.400
The user accounts, group accounts,
computers, computer lists,

00:01:37.400 --> 00:01:39.820
computer groups,
all that kind of fun stuff.

00:01:39.820 --> 00:01:44.540
If you haven't downloaded the upgrading
and migration guide from Apple,

00:01:44.610 --> 00:01:45.840
the URL is at the end.

00:01:45.840 --> 00:01:47.450
I urge you to go out there.

00:01:47.460 --> 00:01:49.150
So go to Apple.com.

00:01:49.260 --> 00:01:51.360
The wireless is up here.

00:01:51.360 --> 00:01:54.560
Download it and you can play along
with your home version of the games.

00:01:54.560 --> 00:01:59.160
So what we want to talk
about is some terminology.

00:01:59.180 --> 00:02:03.070
We want to talk about backing
up your server right away,

00:02:03.080 --> 00:02:05.260
just a quick and dirty method.

00:02:05.290 --> 00:02:07.720
So if things go bad, you can get back.

00:02:07.720 --> 00:02:09.640
Talk about some rules of engagement.

00:02:09.640 --> 00:02:11.880
And we have two different
things we want to talk about,

00:02:11.880 --> 00:02:14.280
upgrades and migration.

00:02:14.290 --> 00:02:17.110
So first off, the terminology.

00:02:17.290 --> 00:02:22.590
We have three terms and sometimes
these terms get misused,

00:02:22.590 --> 00:02:25.960
so we want to define them.

00:02:25.960 --> 00:02:27.940
So we have an update.

00:02:27.940 --> 00:02:34.920
So recently Apple updated
from 10.5.2 to 10.5.3.

00:02:35.850 --> 00:02:38.700
And then we have an upgrade.

00:02:38.720 --> 00:02:44.320
An upgrade is Tiger to Leopard, major OS,
.rev.

00:02:44.350 --> 00:02:48.140
You learned from Bertrand that
Snow Leopard will be coming

00:02:48.140 --> 00:02:50.330
out and that'll be an upgrade.

00:02:50.460 --> 00:02:54.610
And then we have migration.

00:02:55.690 --> 00:02:58.620
So we want to separate these.

00:02:58.770 --> 00:02:59.760
We want to talk about these.

00:02:59.850 --> 00:03:01.400
We're not really going
to talk about an update.

00:03:01.400 --> 00:03:03.290
We're going to talk about an upgrade.

00:03:03.300 --> 00:03:06.760
Then we're going to
talk about a migration.

00:03:08.250 --> 00:03:09.620
So what's supported?

00:03:09.630 --> 00:03:14.980
Well, 10.4.10.

00:03:15.420 --> 00:03:19.800
So if you have Tiger,
you need at least 10.4.10.

00:03:19.860 --> 00:03:23.240
It updates the schema
extensions for Leopard,

00:03:23.270 --> 00:03:25.970
anything less not supported.

00:03:26.160 --> 00:03:28.340
Panther 10.3.9.

00:03:28.340 --> 00:03:30.840
How many people are still
running Panther Server?

00:03:30.850 --> 00:03:31.340
Two?

00:03:31.350 --> 00:03:31.840
All right.

00:03:31.840 --> 00:03:33.390
OK.

00:03:36.080 --> 00:03:38.880
If it's running DNS, DHCP,
if it's running firewall,

00:03:38.890 --> 00:03:39.880
it's going to work good for you.

00:03:39.880 --> 00:03:41.760
It's not a problem.

00:03:41.820 --> 00:03:45.780
Also, anybody out here Windows NT?

00:03:45.820 --> 00:03:48.030
No, yeah, no.

00:03:49.000 --> 00:03:51.300
All right, what's in the migration guide?

00:03:51.330 --> 00:03:55.140
So if you want to do it, it's in there.

00:03:55.560 --> 00:03:56.490
We're not really going to cover that.

00:03:56.670 --> 00:03:59.400
But we can also upgrade
from Jaguar as well.

00:03:59.500 --> 00:04:01.320
10.2.8, 10.3.9, 10.4.10.

00:04:01.370 --> 00:04:03.170
We can migrate over.

00:04:03.490 --> 00:04:06.280
Easiest method,
probably already been there.

00:04:06.330 --> 00:04:10.640
If you have a small deployment,
small office, home office, clean install.

00:04:10.730 --> 00:04:12.840
You have five, 10 users.

00:04:12.920 --> 00:04:16.680
Migrate the data, back it up, do a wipe.

00:04:16.740 --> 00:04:19.660
Easily recreate the passwords,
recreate the users.

00:04:19.730 --> 00:04:23.280
There's no access control list,
no file ACLs, service ACLs,

00:04:23.290 --> 00:04:24.360
or directory service ACLs.

00:04:24.440 --> 00:04:25.310
You don't have that problem.

00:04:25.380 --> 00:04:28.330
That's easy.

00:04:29.140 --> 00:04:32.240
So think about your deployment.

00:04:32.280 --> 00:04:36.200
How many people are running
Open Directory Masters replicas?

00:04:36.270 --> 00:04:37.240
Show of hands?

00:04:37.240 --> 00:04:38.690
OK.

00:04:39.560 --> 00:04:43.440
So if you have that,
it's going to be a little bit easier.

00:04:43.440 --> 00:04:46.340
We're going to talk about
that a little bit later.

00:04:46.410 --> 00:04:50.530
But what we want to focus on
are the tools necessary to

00:04:50.530 --> 00:04:53.240
do a successful migration.

00:04:53.420 --> 00:04:54.420
How to do this?

00:04:54.720 --> 00:04:57.500
How to do an upgrade in place?

00:04:57.760 --> 00:05:01.250
What do we really need to focus on?

00:05:02.140 --> 00:05:05.300
So let's talk about a quick
and dirty backup procedure.

00:05:05.340 --> 00:05:08.760
And this works great no
matter what you're doing.

00:05:08.760 --> 00:05:10.740
If you have an XServe,
you have three drives,

00:05:10.740 --> 00:05:13.390
you can do this at home.

00:05:14.520 --> 00:05:20.110
First off, you have an XServe,
chances are if you're running the OS,

00:05:20.110 --> 00:05:24.200
you may have a mirrored software
RAID on the first two drives,

00:05:24.300 --> 00:05:26.360
you have the third drive.

00:05:27.050 --> 00:05:32.910
You can install Mac OS X or
Mac OS X Server on that third drive.

00:05:33.510 --> 00:05:37.630
When you set up that third drive,
make sure the username, password,

00:05:37.730 --> 00:05:41.100
make sure all your SSH keys
if you're doing that,

00:05:41.140 --> 00:05:45.640
make sure the IP address is the same,
use ARD, set it up.

00:05:45.690 --> 00:05:49.780
Basically set it up exactly
like you would the server.

00:05:50.430 --> 00:05:53.100
Copy over library preferences,
preferences.plist with the

00:05:53.100 --> 00:05:56.180
IP address information,
all that kind of good stuff.

00:05:57.230 --> 00:06:02.000
When you do that,
if the XServe software fails for

00:06:02.000 --> 00:06:05.980
some reason or you reboot the XServe,
you're still going to be able

00:06:05.990 --> 00:06:07.180
to remote access into it.

00:06:07.380 --> 00:06:09.510
It's going to have the
same IP information,

00:06:09.590 --> 00:06:13.190
same administrator password,
same username, same SSH keys,

00:06:13.190 --> 00:06:14.670
all that kind of stuff.

00:06:15.060 --> 00:06:17.440
When you boot into it,
you can actually use

00:06:17.530 --> 00:06:20.580
Apple Software Restore,
you can use disk image,

00:06:20.580 --> 00:06:22.220
do whatever you need.

00:06:22.220 --> 00:06:25.880
You can make a sparse disk image,
make a clone of your server.

00:06:26.980 --> 00:06:31.180
Don't get the user data because
you want all the really good stuff,

00:06:31.180 --> 00:06:32.200
right?

00:06:34.660 --> 00:06:37.990
When you do it that way,
you have a live backup that you can

00:06:37.990 --> 00:06:40.620
just push back over any time you need.

00:06:40.690 --> 00:06:44.740
And you can actually use rsync if
you want to to synchronize the two.

00:06:44.800 --> 00:06:49.520
Use hdiutil, mount the disk image,
use rsync to synchronize the data,

00:06:49.560 --> 00:06:53.080
unmount the disk image,
works really well.

00:06:53.150 --> 00:06:57.020
So where are we right now?

00:06:57.080 --> 00:07:01.990
Right now you should be thinking about,
okay, I did a backup.

00:07:02.720 --> 00:07:04.140
Am I going to do an upgrade?

00:07:04.240 --> 00:07:06.140
Am I going to do a migration?

00:07:06.240 --> 00:07:08.100
Which am I going to do?

00:07:08.230 --> 00:07:13.360
And before we go any further,
we have some rules.

00:07:13.440 --> 00:07:14.670
We need to play by these rules.

00:07:14.770 --> 00:07:18.830
We don't play, things don't go well.

00:07:19.150 --> 00:07:20.960
Rule number one.

00:07:24.600 --> 00:07:31.000
[Transcript missing]

00:07:31.320 --> 00:07:32.110
and Andrew F.

00:07:32.110 --> 00:07:32.600
Hans.

00:07:32.650 --> 00:07:33.370
Thank you.

00:07:33.390 --> 00:07:36.700
So, show of hands of people
that have lost their jobs.

00:07:38.200 --> 00:07:52.700
[Transcript missing]

00:07:53.690 --> 00:07:55.760
What do you really want to back up?

00:07:55.810 --> 00:08:02.080
Well, hopefully the user created data,
all the iLife files and iWork files and

00:08:02.080 --> 00:08:07.220
Office files and all that kind of stuff,
hopefully that's all backed up.

00:08:08.400 --> 00:08:14.500
What we're talking about is
the data based on the services,

00:08:15.260 --> 00:08:19.460
The account data, KDC, password server,
all the critical stuff,

00:08:19.510 --> 00:08:23.800
all the configuration stuff,
all the stuff that at 3:00 AM you

00:08:23.870 --> 00:08:27.270
changed because it didn't work and
then you went back to sleep because

00:08:27.280 --> 00:08:29.180
you didn't remember what you changed.

00:08:29.260 --> 00:08:32.280
You need to remember what you changed.

00:08:32.310 --> 00:08:34.100
DNS.

00:08:35.440 --> 00:08:38.130
We say this all the time,
if you bend any of the other,

00:08:38.280 --> 00:08:42.500
just the DNS house needs to be in order,
period.

00:08:43.360 --> 00:08:46.940
If you have homegrown configuration
files in certain services,

00:08:46.970 --> 00:08:53.280
and we're going to talk about that later,
these files may be fixed or cleaned.

00:08:53.340 --> 00:08:56.990
A good example of that we're
going to talk about is DNS.

00:08:57.130 --> 00:08:59.740
If you've customized your
DNS configuration files

00:08:59.740 --> 00:09:04.340
and you do an upgrade,
Apple may try and clean those up.

00:09:04.430 --> 00:09:06.890
So you may want to
have a backup of those.

00:09:07.840 --> 00:09:10.700
We need the server admin tools.

00:09:10.890 --> 00:09:11.700
Right?

00:09:11.700 --> 00:09:13.700
Need to download them,
need to make them there.

00:09:13.930 --> 00:09:18.460
You can have the Tiger and the Leopard
Server admin tools on the same thing.

00:09:18.700 --> 00:09:20.560
It's not going to cause a problem.

00:09:20.700 --> 00:09:25.040
So if you need to administer both,
you can do both, but you can't go back.

00:09:26.190 --> 00:09:27.690
and what about netboot images?

00:09:27.760 --> 00:09:32.160
You have your greatest
hits netboot images.

00:09:32.200 --> 00:09:34.280
You're still running Panther.

00:09:34.310 --> 00:09:38.680
If you have 10.3 netboot images,
they're still gonna work, they're fine.

00:09:38.730 --> 00:09:42.160
Anything retro,
you're gonna have to update a little bit.

00:09:42.990 --> 00:09:44.380
and what about some caveats?

00:09:44.540 --> 00:09:48.530
Well, hardware mon D,

00:09:48.730 --> 00:09:50.960
Any startup items?

00:09:51.100 --> 00:09:53.640
Anything like that
that you've customized?

00:09:53.720 --> 00:09:54.360
No.

00:09:54.390 --> 00:09:56.930
LaunchD rules the roost.

00:09:56.950 --> 00:09:58.010
It's process number one.

00:09:58.080 --> 00:10:00.150
So Watchdog?

00:10:00.150 --> 00:10:01.000
No.

00:10:01.000 --> 00:10:02.440
HardwareMondee?

00:10:02.690 --> 00:10:03.030
No.

00:10:03.030 --> 00:10:04.370
Startup items?

00:10:04.370 --> 00:10:05.900
You've customized them.

00:10:05.970 --> 00:10:07.720
You may want to copy them over.

00:10:08.880 --> 00:10:12.140
Everything you have should
be moved to LaunchD.

00:10:12.250 --> 00:10:13.280
Everything.

00:10:13.320 --> 00:10:18.400
Watch a process, watch a file,
watch a packet, watch the network,

00:10:18.400 --> 00:10:21.930
then trigger a script to do it.

00:10:22.180 --> 00:10:26.800
Macintosh Manager people!

00:10:27.800 --> 00:10:28.700
Yeah, okay.

00:10:28.780 --> 00:10:32.040
So no Mac manager support anymore.

00:10:32.090 --> 00:10:34.420
John Detroit is just
shedding a tear right now,

00:10:34.420 --> 00:10:36.800
but there's no Mac manager support.

00:10:37.040 --> 00:10:38.740
QuickTime Publisher, it's gone.

00:10:38.780 --> 00:10:42.080
If you were a fan of QuickTime Publisher,
that's all right.

00:10:42.080 --> 00:10:47.470
You may need to redo the path
to your MP3s and your playlists.

00:10:47.530 --> 00:10:50.980
Update the paths,
you're going to be fine.

00:10:50.980 --> 00:10:52.120
Right?

00:10:52.120 --> 00:10:54.150
And PHP is into life.

00:10:54.150 --> 00:10:55.500
PHP 4 is done.

00:10:55.650 --> 00:10:56.680
It's over.

00:10:57.740 --> 00:11:00.650
There's not going to be any
more updates after August.

00:11:00.690 --> 00:11:04.100
So if you're running PHP, upgrade to 5.

00:11:04.240 --> 00:11:05.910
If you're still running 4,
just make sure you have

00:11:06.080 --> 00:11:06.810
the patches in place.

00:11:06.810 --> 00:11:09.170
Those of you that write the code,
understand that.

00:11:09.170 --> 00:11:10.180
Just be aware of that.

00:11:13.060 --> 00:11:14.180
And what about the XML files?

00:11:14.280 --> 00:11:16.760
We have a couple slides just
to talk about the XML files.

00:11:16.860 --> 00:11:20.900
Almost all the XML files
now are stored as binary.

00:11:22.690 --> 00:11:26.370
which means you can use property
list editor to open them,

00:11:26.370 --> 00:11:29.760
you can use PLU till to convert them,
right?

00:11:29.910 --> 00:11:33.110
You can have automated scripts
that actually convert them,

00:11:33.140 --> 00:11:36.840
make some changes that you want,
convert them back.

00:11:36.920 --> 00:11:41.240
And I'd like to invite
Andre LaBranche up,

00:11:41.240 --> 00:11:44.670
do a little demo.

00:11:45.350 --> 00:11:46.740
of an upgrade.

00:11:46.740 --> 00:11:47.580
- Andre.

00:11:47.580 --> 00:11:48.380
- Thank you.

00:11:48.470 --> 00:11:50.320
So I have no less than
five demos for you today.

00:11:50.320 --> 00:11:53.510
This one's gonna be very short,
sort of kind of an intro demo.

00:11:53.800 --> 00:11:57.520
Basically, we're gonna start with
the upgrade in place path.

00:11:57.520 --> 00:12:00.780
And so what I'm gonna show you
here is just a Tiger Server 10.4.11

00:12:00.780 --> 00:12:04.580
briefly showcase some of the
services that are set up.

00:12:04.600 --> 00:12:08.750
And I don't really expect you
to see all the details here.

00:12:08.960 --> 00:12:12.580
The point is I'm just showing you that
we have a bunch of stuff going on here.

00:12:12.600 --> 00:12:16.460
And so I'm going to launch a few
things and just quickly show you that,

00:12:16.460 --> 00:12:17.940
hey, this is a Tiger Server.

00:12:17.980 --> 00:12:20.180
It's got stuff running on it.

00:12:20.180 --> 00:12:24.180
And then I'm going to kick
off and upgrade to Leopard.

00:12:24.220 --> 00:12:26.880
So we have mail server.

00:12:26.880 --> 00:12:28.900
We have Kerberized mail.

00:12:28.900 --> 00:12:30.880
Got a couple of mail accounts here.

00:12:30.920 --> 00:12:32.240
Here's a server admin.

00:12:32.240 --> 00:12:34.280
And I'm just showing you
this not to demonstrate mail,

00:12:34.360 --> 00:12:36.140
just to show you that a
mail server is running.

00:12:36.140 --> 00:12:37.760
There is actual data here.

00:12:37.760 --> 00:12:40.450
You can see a list of
services we have configured.

00:12:40.590 --> 00:12:44.030
If I click back over here,
I'll just show you a couple of quick

00:12:44.100 --> 00:12:46.530
shell script outputs that I've got.

00:12:46.540 --> 00:12:49.000
We've got a DNS zone file here.

00:12:49.000 --> 00:12:51.400
That's a little dig command
that shows a zone transfer.

00:12:51.430 --> 00:12:53.600
So you can see I've got some DNS records.

00:12:53.600 --> 00:12:57.800
We've got some IPFW rules,
including one custom rule that I've

00:12:57.850 --> 00:13:01.540
placed in etsy/ipfilter/ipfw.conf.

00:13:01.560 --> 00:13:04.280
In addition to rules
configured through the GUI,

00:13:04.280 --> 00:13:06.350
we've got a Jabber server set up.

00:13:06.400 --> 00:13:09.390
We've got an
Open Directory master set up.

00:13:09.410 --> 00:13:12.580
And I can do things like,
since I just logged in using

00:13:12.580 --> 00:13:16.140
Kerberos with the mail client,
see that I've got Kerberos

00:13:16.140 --> 00:13:18.400
ticket-graining tickets
and service tickets.

00:13:18.460 --> 00:13:21.100
If I go into Workgroup Manager,

00:13:21.740 --> 00:13:25.130
You can see that I've got some,
I've got an LDAP container here,

00:13:25.220 --> 00:13:29.200
got some users, got some groups,
got some computer lists,

00:13:29.200 --> 00:13:34.370
and I have one computer list
that is slightly populated.

00:13:34.570 --> 00:13:37.050
And that's pretty much all
I want to show you there.

00:13:37.060 --> 00:13:38.440
So we've got our Tiger Server.

00:13:38.440 --> 00:13:39.450
It's working.

00:13:39.540 --> 00:13:40.110
Hooray.

00:13:40.220 --> 00:13:41.800
So now we're going to upgrade.

00:13:41.990 --> 00:13:44.240
So basically-- oh, and the web as well.

00:13:44.240 --> 00:13:47.020
I've got two websites,
one that's pretty cool,

00:13:47.020 --> 00:13:50.020
and another one that's
just unspeakably cool,

00:13:50.020 --> 00:13:50.540
SSL.

00:13:50.540 --> 00:13:54.180
I don't know if you can tell,
the URL there is an SSL-enabled URL.

00:13:54.250 --> 00:13:58.680
So I'm using a self-signed
certificate for that.

00:13:58.730 --> 00:14:00.700
And oh, you get a print queue as well.

00:14:00.780 --> 00:14:05.300
So there's my print queue,
which is just a standard LPR queue,

00:14:05.300 --> 00:14:06.670
or IPP queue, I should say.

00:14:06.830 --> 00:14:11.520
So then we will boot into
the Leopard Server installer.

00:14:11.590 --> 00:14:12.640
So I go to my startup disk.

00:14:12.700 --> 00:14:15.520
Now I've went ahead and imaged
this to a hard drive partition,

00:14:15.520 --> 00:14:17.380
so it's a little faster for the demo.

00:14:17.450 --> 00:14:21.790
But same idea.

00:14:21.980 --> 00:14:25.090
As it's restarting here,
I'll just sort of describe what's going

00:14:25.090 --> 00:14:26.190
to be coming with the rest of the demo.

00:14:26.200 --> 00:14:29.630
So this is sort of almost an intro demo,
not really showing you too much here.

00:14:29.690 --> 00:14:32.200
I'm going to click through the
basic in-place upgrade steps

00:14:32.300 --> 00:14:35.300
that you would take if you were
going to do an in-place upgrade.

00:14:35.300 --> 00:14:39.360
And then the rest of the demos are going
to focus on what happens afterwards.

00:14:39.360 --> 00:14:41.790
So you've got a server
that was upgraded in place,

00:14:41.910 --> 00:14:43.570
what happens to the services.

00:14:43.570 --> 00:14:47.490
So through each of the subsequent demos,
I'll be sort of picking a couple of

00:14:47.540 --> 00:14:51.040
services and just showing you the
results of the in-place upgrade.

00:14:51.040 --> 00:14:53.000
And then the last demo is a bit longer.

00:14:53.000 --> 00:14:56.050
That's sort of the migration
example where we have a fresh

00:14:56.050 --> 00:14:59.010
Leopard Server installation and
I've got a bunch of data that was

00:14:59.010 --> 00:15:00.700
exported from my Tiger Server.

00:15:00.700 --> 00:15:03.680
So things like service configurations,
open directory archives,

00:15:03.750 --> 00:15:04.680
that sort of stuff.

00:15:04.700 --> 00:15:05.750
Things we'll be talking about.

00:15:05.770 --> 00:15:09.350
And oh yes,
the installer DVD does not do mirroring.

00:15:09.470 --> 00:15:11.490
So...

00:15:11.760 --> 00:15:14.240
I'm clicking Next.

00:15:14.380 --> 00:15:15.800
Clicking Continue.

00:15:15.920 --> 00:15:17.680
And there's no way to
set mirroring from here.

00:15:17.730 --> 00:15:18.980
Totally forgot about that.

00:15:19.030 --> 00:15:22.340
Clicking Agree, License Agreement,
Select a Disk.

00:15:22.360 --> 00:15:26.540
I will select my-- you know,
I'm telling you what's happening here.

00:15:26.630 --> 00:15:27.540
I select Tiger Server.

00:15:27.540 --> 00:15:28.260
I click Continue.

00:15:28.260 --> 00:15:31.760
I could customize it if I want to by
selecting or deselecting other packages.

00:15:31.940 --> 00:15:33.630
And I click Install.

00:15:33.670 --> 00:15:36.330
And away we go with the in-place upgrade.

00:15:36.380 --> 00:15:39.590
And so now I'll turn
it back over to Schoun.

00:15:43.800 --> 00:15:46.700
Thanks Andre.

00:15:46.730 --> 00:15:51.220
Just to confirm, yeah,
it's really doing that.

00:15:53.850 --> 00:15:59.600
So the upgrade that Andre is doing,
right, the most important one,

00:15:59.600 --> 00:16:03.220
and that's the one we want to focus on,
is the Tiger Master to Leopard Master,

00:16:03.220 --> 00:16:03.800
right?

00:16:03.870 --> 00:16:06.740
So we have an OD Master,
we have an LDAP database, we have a KDC,

00:16:06.740 --> 00:16:08.200
we have a password server,
all the really,

00:16:08.200 --> 00:16:11.400
really crucial stuff that we need.

00:16:11.400 --> 00:16:13.300
And so we've done the in-place upgrade.

00:16:13.340 --> 00:16:15.360
So we've upgraded it.

00:16:15.770 --> 00:16:18.430
Most importantly, serial number.

00:16:18.570 --> 00:16:20.300
Obviously, you have the serial number.

00:16:20.340 --> 00:16:21.090
Have it there.

00:16:21.190 --> 00:16:22.910
Boot from the DVD.

00:16:23.100 --> 00:16:25.040
Make sure you have the
hardware requirements.

00:16:25.190 --> 00:16:29.900
Right, it's not going to work if it has
less RAM or a smaller hard drive.

00:16:29.940 --> 00:16:33.260
You can image it over,
but let's meet Apple's requirements

00:16:33.260 --> 00:16:34.880
to make sure we're happy.

00:16:34.960 --> 00:16:36.760
Have it ready to go back up,
maybe a replica.

00:16:36.760 --> 00:16:39.760
If things go awry, reboot the server.

00:16:41.500 --> 00:16:51.700
[Transcript missing]

00:16:53.450 --> 00:16:56.400
Then upgrade each replica.

00:16:56.430 --> 00:17:00.100
Test with your clients.

00:17:00.190 --> 00:17:03.860
Leopard clients, Tiger clients.

00:17:03.940 --> 00:17:07.210
Make sure everything testing is done.

00:17:07.450 --> 00:17:09.000
Then you can get your groove on.

00:17:09.060 --> 00:17:10.830
Then you can go.

00:17:11.830 --> 00:17:13.020
It doesn't work.

00:17:13.470 --> 00:17:14.340
Things go wrong.

00:17:14.340 --> 00:17:17.330
You don't have,
maybe you have some custom

00:17:17.360 --> 00:17:20.830
configuration files,
maybe the power went out,

00:17:20.960 --> 00:17:22.420
whatever happened.

00:17:22.420 --> 00:17:27.480
You still have that Tiger replica that
you can promote to a Tiger master,

00:17:27.480 --> 00:17:28.150
right?

00:17:28.150 --> 00:17:32.770
You can change that LDAP database
from read-only to read-write.

00:17:32.770 --> 00:17:38.370
So, that's the path that Apple supports,
that's the path they want you to take,

00:17:38.370 --> 00:17:39.150
that's the path that we're suggesting.

00:17:40.490 --> 00:17:43.700
What about Nuke and Pave?

00:17:43.770 --> 00:17:49.480
Archive using server admin
utility 10.4.10 or later.

00:17:50.520 --> 00:17:52.100
Get the disk image.

00:17:52.120 --> 00:17:55.640
Open the disk image.

00:17:58.510 --> 00:18:03.940
Make sure the files are there.

00:18:03.980 --> 00:18:10.380
Make sure that you can see
the files and read the files.

00:18:10.440 --> 00:18:14.620
When you do an archive,
what does it save?

00:18:15.100 --> 00:18:18.350
It pipes out the LDAP database.

00:18:18.400 --> 00:18:19.810
Does dump of the password server.

00:18:19.990 --> 00:18:22.340
Pipes out the KDC database.

00:18:22.340 --> 00:18:25.500
It pipes out the directory service
folder in the library preferences.

00:18:25.500 --> 00:18:27.870
It pipes out the IP address information.

00:18:28.050 --> 00:18:33.360
It pipes out Tiger NetInfo.

00:18:34.580 --> 00:18:39.340
It pipes out the SMB.configuration file.

00:18:39.340 --> 00:18:40.000
It gets this.

00:18:40.110 --> 00:18:42.340
What doesn't it get?

00:18:42.450 --> 00:18:47.500
SSH keys if you're doing key pairs.

00:18:47.790 --> 00:18:50.120
Custom configuration files.

00:18:51.000 --> 00:18:54.080
Service preferences.

00:18:55.470 --> 00:18:58.980
So you got to make sure you get those.

00:18:59.010 --> 00:19:00.740
Just make sure you get those.

00:19:00.780 --> 00:19:06.150
Archive it, back up the other ones,
especially if you have

00:19:06.150 --> 00:19:09.290
not service hackles,
not file system hackles,

00:19:09.410 --> 00:19:10.630
but directory service hackles.

00:19:10.640 --> 00:19:14.580
So in Tiger you could do directory
service hackles to make sure

00:19:14.590 --> 00:19:17.730
you knew who read the database,
who could write to the database,

00:19:17.730 --> 00:19:18.680
that kind of thing.

00:19:18.680 --> 00:19:25.120
And a little interesting way to do that,
you had to use the inspector and

00:19:25.140 --> 00:19:28.290
write the commands or import them.

00:19:28.500 --> 00:19:32.580
and perform a clean
install of Leopard Server.

00:19:32.690 --> 00:19:36.150
Promote it to an open directory master.

00:19:36.250 --> 00:19:38.240
Use server admin to pull the stuff in.

00:19:38.240 --> 00:19:42.150
Joy.

00:19:48.300 --> 00:19:57.700
You want to be careful because when you
promote to an open directory master,

00:19:59.240 --> 00:20:05.240
Make sure you use the same
administrator name and password

00:20:05.440 --> 00:20:13.700
and Because when you do a restore,
you want to make sure that the username

00:20:13.700 --> 00:20:17.550
and the password that you had in the
LDAP database that's going to be restored

00:20:17.560 --> 00:20:24.300
for your Open Directory master is exactly
the same as the one that you have now.

00:20:24.890 --> 00:20:29.740
Because password server doesn't merge,
doesn't really do an overwrite,

00:20:29.740 --> 00:20:32.990
so you want to make sure
that they're the same.

00:20:34.730 --> 00:20:38.800
Upgrade server service changes.

00:20:38.800 --> 00:20:40.700
Each service has a config file.

00:20:40.700 --> 00:20:42.170
In Tiger we have the
really cool tear off,

00:20:42.170 --> 00:20:42.600
right?

00:20:42.600 --> 00:20:44.770
You go to the services,
do the tear off thing and you

00:20:44.830 --> 00:20:47.690
show that to Windows people
and they'd be really cool.

00:20:47.700 --> 00:20:52.740
So you could do that and you save
those files and you want to import

00:20:52.740 --> 00:20:55.990
those files one at a time and
test all the services that you're

00:20:56.250 --> 00:20:58.050
running on your Leopard server.

00:20:59.840 --> 00:21:03.830
What about directory
services and then upgrade?

00:21:03.930 --> 00:21:10.700
Well, we want to talk about four things,
NetInfo, LDAP, Kerberos and binding.

00:21:11.910 --> 00:21:13.960
Net info doesn't live here anymore.

00:21:14.060 --> 00:21:16.630
You heard it last year,
you're gonna hear it again.

00:21:16.780 --> 00:21:18.390
It's gone.

00:21:23.570 --> 00:21:26.000
Apparently there's applause
for NetInfo being gone.

00:21:26.000 --> 00:21:28.700
Okay, fair enough.

00:21:28.700 --> 00:21:32.230
The next people are shutting it here,
but that's okay.

00:21:32.250 --> 00:21:36.110
Private VARDB, DSLocal, nodes default.

00:21:36.120 --> 00:21:38.000
That's where everything is stored.

00:21:38.000 --> 00:21:39.290
We'll talk more about that.

00:21:39.300 --> 00:21:43.720
And I urge you to go to the directory
services troubleshooting session

00:21:43.720 --> 00:21:48.140
and the directory services lab if
you're interested in finding out

00:21:48.140 --> 00:21:50.120
more about the local data store.

00:21:50.120 --> 00:21:52.680
There's some really cool things
you can do with a local data store.

00:21:54.410 --> 00:21:55.830
LDAP.

00:21:55.900 --> 00:22:02.710
The schema was updated in 10.4.10
to add the Leopard schema additions.

00:22:02.950 --> 00:22:06.130
You can actually use slap test.

00:22:06.200 --> 00:22:08.000
to talk about these changes.

00:22:08.150 --> 00:22:12.490
So if any of you have
actually updated your schema,

00:22:12.970 --> 00:22:16.730
and configure your schema
in a custom sort of way,

00:22:16.910 --> 00:22:20.570
you can actually use
slap test to do this.

00:22:21.640 --> 00:22:27.590
And what you're going to find out
is if you did the schema changes,

00:22:27.590 --> 00:22:30.500
you actually have a new container.

00:22:30.500 --> 00:22:33.790
And so I don't want to spend a lot
of time on this because we're going

00:22:33.800 --> 00:22:35.320
to talk about directory services.

00:22:35.320 --> 00:22:38.410
But the bottom line is if
you have an LDAP container,

00:22:38.450 --> 00:22:41.350
you have main server.printedincode.com.

00:22:41.370 --> 00:22:43.180
And inside there you have
a container for users,

00:22:43.180 --> 00:22:45.340
container for groups,
container for configurations,

00:22:45.340 --> 00:22:46.370
all that kind of stuff.

00:22:46.380 --> 00:22:49.490
If you have custom schema,
it actually goes into

00:22:49.490 --> 00:22:51.140
a separate container.

00:22:51.500 --> 00:22:55.250
Which is the config
container which is local.

00:22:55.260 --> 00:23:00.530
And it actually overlays on top.

00:23:01.590 --> 00:23:04.940
So the directory service team has
done a wonderful job of handling

00:23:04.940 --> 00:23:08.010
the overlays in that fashion.

00:23:08.720 --> 00:23:09.750
You can do it without a restart.

00:23:09.760 --> 00:23:11.920
It actually works really, really nicely.

00:23:11.930 --> 00:23:14.400
What about group accounts?

00:23:14.470 --> 00:23:17.900
Group records should include the GUIDs,
right?

00:23:18.040 --> 00:23:23.240
For all the members and computer
lists to computer groups.

00:23:23.250 --> 00:23:26.000
So we have this migration.

00:23:26.310 --> 00:23:30.290
from Tiger to Leopard because
we have certain attributes

00:23:31.070 --> 00:23:32.700
that the groups need to have.

00:23:32.710 --> 00:23:35.780
So you can actually do an export
because groups don't have passwords.

00:23:35.840 --> 00:23:37.940
So you can use Workgroup Manager to
do an export and do an import.

00:23:37.990 --> 00:23:40.420
And Andre is going to speak
to that in just a little bit.

00:23:40.530 --> 00:23:43.090
And we have Kerberos.

00:23:43.370 --> 00:23:45.430
If you still have users
with crypt passwords,

00:23:45.430 --> 00:23:48.600
it can be brought into the 21st century,
right?

00:23:48.720 --> 00:23:50.910
And if you have a service
that's not Kerberized,

00:23:50.910 --> 00:23:56.480
you can use slap config with the
Kerberos flag and crank up the

00:23:56.730 --> 00:23:59.160
The KVC part and make sure
the principles are going.

00:23:59.400 --> 00:24:00.270
And what about binding?

00:24:00.300 --> 00:24:01.840
What about the magic triangle?

00:24:02.060 --> 00:24:03.860
Unbind.

00:24:04.280 --> 00:24:07.720
Unbind first, do the upgrade, rebind.

00:24:07.850 --> 00:24:11.750
Keep in mind that with Leopard Server,
if you're going to do a magic triangle,

00:24:11.790 --> 00:24:14.030
and again, I'm going to talk about this,
make sure you bind

00:24:14.030 --> 00:24:17.480
active directory first,
then promote to an open directory master.

00:24:17.480 --> 00:24:20.240
The KDC is smart enough
now not to start up,

00:24:20.240 --> 00:24:23.590
not to overwrite the edu.mnt.gobros file.

00:24:26.050 --> 00:24:29.040
Sensors applause about that.

00:24:29.040 --> 00:24:32.360
You may want to also look inside
your local config container

00:24:32.720 --> 00:24:35.000
because when you do a bind,
not only is it in the

00:24:35.000 --> 00:24:40.120
edu.mit.curberos file,
but inside your local config container,

00:24:40.120 --> 00:24:43.120
you also have a config record
for all the KDC information,

00:24:43.120 --> 00:24:45.840
just like you would on
an open directory master.

00:24:45.840 --> 00:24:47.690
It's pretty cool.

00:24:49.100 --> 00:24:50.890
At this time,
I'm going to turn it back over to Andre.

00:24:50.900 --> 00:24:53.540
Hopefully the machine is restarted
and things are going to work.

00:24:54.080 --> 00:24:54.680
Thank you, Schoun.

00:24:54.680 --> 00:24:56.340
So as you may have guessed,
I have cheated.

00:24:56.340 --> 00:24:59.220
I have pre-baked states
here on Firewire partitions,

00:24:59.240 --> 00:25:01.160
just like on the cooking shows.

00:25:01.160 --> 00:25:03.240
So I have one in the oven
here I'm going to show you.

00:25:03.430 --> 00:25:06.650
And in this short demo,
I'm going to basically show you a couple

00:25:06.650 --> 00:25:08.790
of changes between Tiger and Leopard.

00:25:08.940 --> 00:25:12.980
Going to show you some changes with the
way the group records need to be managed,

00:25:12.980 --> 00:25:14.950
a couple of gotchas or one gotcha there.

00:25:15.100 --> 00:25:18.710
Going to take a quick look at the
DSLocal replacement for NetInfo and also

00:25:18.830 --> 00:25:22.400
quickly talk about the local KDC as well.

00:25:22.400 --> 00:25:25.940
So if I pull up Workgroup Manager,
this is the upgrade, by the way.

00:25:25.980 --> 00:25:28.880
So we could see in Server Admin that,
hey, look,

00:25:28.880 --> 00:25:30.260
most of our services are there.

00:25:30.260 --> 00:25:31.720
Most of them, but not all of them.

00:25:31.720 --> 00:25:33.560
We'll get to those later.

00:25:33.560 --> 00:25:35.370
So let's start back here
in Workgroup Manager.

00:25:35.460 --> 00:25:36.660
Got a couple of groups here.

00:25:36.740 --> 00:25:39.220
I've got one called
Dev and one called Legacy.

00:25:39.220 --> 00:25:42.000
Now this is a slightly contrived example,
but it's still kind of

00:25:42.010 --> 00:25:43.400
important to know about.

00:25:43.420 --> 00:25:47.180
So normally, a group will have lots
of different attributes,

00:25:47.200 --> 00:25:50.990
but two of the key ones are group
members and group membership.

00:25:51.190 --> 00:25:54.680
The basic idea is that a group is
more than just a list of usernames.

00:25:54.840 --> 00:25:58.480
It's also a list of GUIDs that
correspond to each username.

00:25:58.480 --> 00:26:01.890
And the GUID is important because
it helps the system identify a user,

00:26:01.890 --> 00:26:05.770
even if the same username might exist
in another directory somewhere else.

00:26:05.900 --> 00:26:12.100
So Mac OS X Server really wants each
user to have a GUID in this group record.

00:26:12.100 --> 00:26:14.780
So my Legacy group here
doesn't have any GUIDs.

00:26:14.780 --> 00:26:16.020
That's why it's called Legacy.

00:26:16.020 --> 00:26:19.050
So if you had a really old GUID,
you'd have a really old group record,

00:26:19.050 --> 00:26:22.310
like a BSD standard record or such,
you might not have

00:26:22.310 --> 00:26:23.820
these extra attributes.

00:26:23.820 --> 00:26:29.150
So there used to be actually a button
that said upgrade legacy group.

00:26:29.350 --> 00:26:30.940
So that was a feature of Tiger Server.

00:26:30.940 --> 00:26:31.760
We're in Leopard now.

00:26:31.810 --> 00:26:33.940
So if you happen to have
one of these legacy groups,

00:26:33.940 --> 00:26:37.200
the easiest way to get it into
the new format to add those extra

00:26:37.240 --> 00:26:38.480
attributes is simply delete it.

00:26:38.590 --> 00:26:39.630
Well, first you would back it up.

00:26:39.640 --> 00:26:40.570
I've already done that.

00:26:40.610 --> 00:26:43.000
Just export it using Workgroup Manager.

00:26:43.010 --> 00:26:45.180
And then import it again.

00:26:45.200 --> 00:26:48.460
And when you do that, you will be able to
import your legacy group.

00:26:48.460 --> 00:26:51.220
And you will basically
get your group record,

00:26:51.220 --> 00:26:57.990
your group configs legacy group.

00:26:59.040 --> 00:27:01.400
What I will see is that if
I go into the inspector,

00:27:01.400 --> 00:27:03.830
which you can turn on in the
Workgroup Manager preferences,

00:27:03.830 --> 00:27:07.980
that now I have both the group member
and the group membership attributes.

00:27:07.980 --> 00:27:10.980
So I have the corresponding GUIDs
for each user in the group list,

00:27:11.120 --> 00:27:12.340
which is very important.

00:27:12.440 --> 00:27:16.000
So make sure that your
groups are correct.

00:27:16.000 --> 00:27:19.490
And there's actually another gotcha
that we'll see in the last demo where

00:27:19.500 --> 00:27:22.910
if you don't have a proper group record,
some of the things that should

00:27:22.910 --> 00:27:24.220
automatically work don't.

00:27:24.260 --> 00:27:25.990
So make sure that your
group records are good.

00:27:26.600 --> 00:27:30.680
So next we'll take a quick brief
look at the DS local database.

00:27:30.680 --> 00:27:33.740
So if I open my utilities
folder and I type in,

00:27:33.740 --> 00:27:35.430
what's missing here?

00:27:35.440 --> 00:27:39.260
Well, the network, excuse me,
the net info utility is missing.

00:27:39.260 --> 00:27:40.980
So you don't have that utility anymore.

00:27:40.980 --> 00:27:43.750
Instead,
we rely on directory services tools.

00:27:43.800 --> 00:27:48.930
So Tiger has a bunch of tools,
command line tools that start with DS.

00:27:48.940 --> 00:27:52.040
A very easy way to find your
DS tools is to open a terminal,

00:27:52.060 --> 00:27:54.460
type DS, and then hit tab a couple times.

00:27:54.460 --> 00:27:56.460
The shell will show you all
the commands that start.

00:27:56.460 --> 00:27:56.780
So if you want to use
the command line tools,

00:27:56.780 --> 00:27:57.040
you can do that with DS.

00:27:57.040 --> 00:27:58.740
Read the man pages for all of these.

00:27:58.740 --> 00:27:59.200
They're good.

00:27:59.200 --> 00:28:03.800
So we could use, for example, DSCL,
the directory services command line.

00:28:03.800 --> 00:28:05.900
And it's sort of got an
interactive interface.

00:28:05.900 --> 00:28:08.750
So I could browse into local and list.

00:28:08.820 --> 00:28:11.510
And we have an instance of a local
database type called default.

00:28:11.540 --> 00:28:13.290
There could be others,
but usually there's not.

00:28:13.300 --> 00:28:14.650
I'll go into default.

00:28:14.680 --> 00:28:17.840
And we see all of our record types here,
like users and groups.

00:28:17.900 --> 00:28:19.410
And I could browse into this.

00:28:19.480 --> 00:28:20.700
And oops, got to type it right.

00:28:20.740 --> 00:28:22.100
Does tab completion.

00:28:22.100 --> 00:28:24.260
And this is just the same
as it would be on Tiger.

00:28:24.260 --> 00:28:25.230
That's kind of the point.

00:28:25.280 --> 00:28:26.290
Totally new database.

00:28:26.500 --> 00:28:27.140
Database underneath.

00:28:27.140 --> 00:28:30.920
But because the directory services
tools provide an abstraction layer,

00:28:30.920 --> 00:28:34.020
you shouldn't even need to care that
it's a different database format.

00:28:34.020 --> 00:28:37.870
So if you use your DS tools,
the point of that is when you

00:28:37.870 --> 00:28:40.040
need to operate on this data,
use DS tools.

00:28:40.060 --> 00:28:42.180
And that will sort of future-proof you.

00:28:42.180 --> 00:28:45.120
So, for example,
if you were doing things like operating

00:28:45.120 --> 00:28:48.920
on raw NetInfo database files,
you would have to update those procedures

00:28:48.920 --> 00:28:50.800
for Leopard because there is no NetInfo.

00:28:50.800 --> 00:28:53.590
So use the abstractions provided
to you through the DS tools.

00:28:53.620 --> 00:28:56.110
I do want to show you
one quick thing here.

00:28:56.500 --> 00:28:57.540
Grab a root shell.

00:28:57.540 --> 00:29:02.500
And I'm going to go into
var db dslocal default.

00:29:02.500 --> 00:29:04.220
Or excuse me, nodes default.

00:29:04.220 --> 00:29:09.320
And this is actually the back-end
data storage for the dslocal node.

00:29:09.320 --> 00:29:14.120
And we see record directories here
that correspond to record types.

00:29:14.160 --> 00:29:15.640
I can go into one of these directories.

00:29:15.640 --> 00:29:18.220
Each record now is stored
as a property list,

00:29:18.220 --> 00:29:21.410
an XML property list that
you can actually read.

00:29:21.430 --> 00:29:24.220
So you could look at it
through a pager such as less.

00:29:25.230 --> 00:29:28.450
This is basically a group record,
but now it's in sort of an XML format.

00:29:28.460 --> 00:29:31.380
Resist the urge to operate
on this data directly.

00:29:31.470 --> 00:29:35.740
Again, for the reason I just mentioned,
this totally bypasses the directory

00:29:35.740 --> 00:29:37.980
services abstraction layer,
which means that if

00:29:37.980 --> 00:29:41.180
you make changes here,
the running directory services demon, A,

00:29:41.180 --> 00:29:43.930
doesn't know about it, and B,
you're not protecting yourself

00:29:43.990 --> 00:29:47.710
from any potential changes that may
occur to the back-end data format.

00:29:47.720 --> 00:29:51.390
So use the directory services
tools and everything will be good,

00:29:51.510 --> 00:29:52.240
hopefully.

00:29:52.260 --> 00:29:54.660
So there is one other
thing I want to mention.

00:29:54.660 --> 00:29:56.370
There is one other thing
I wanted to point out here,

00:29:56.370 --> 00:29:59.650
and that is in the config directory.

00:29:59.680 --> 00:30:01.150
Let's see if I can find it.

00:30:01.660 --> 00:30:03.020
Here it is.

00:30:03.100 --> 00:30:06.420
So the config directory is
the authoritative source

00:30:06.420 --> 00:30:08.740
for lots of configuration
information for your server,

00:30:08.780 --> 00:30:11.280
in particular the Kerberos configuration.

00:30:11.280 --> 00:30:15.310
So library preferences, edu, MIT,
Kerberos is not the main source

00:30:15.310 --> 00:30:17.280
of that information anymore.

00:30:17.280 --> 00:30:18.580
It's actually this directory.

00:30:18.580 --> 00:30:21.160
So whenever you want to go
troubleshoot this stuff,

00:30:21.160 --> 00:30:22.570
this is really where you should look.

00:30:22.580 --> 00:30:24.210
The library preferences, edu, MIT,
Kerberos is the main

00:30:24.210 --> 00:30:24.580
source of that information.

00:30:24.580 --> 00:30:26.580
So if you want to go through
the library preferences,

00:30:26.580 --> 00:30:27.480
edu, MIT, Kerberos is basically created
from data stored here.

00:30:27.620 --> 00:30:31.040
So I'm calling this location
out because I don't know of any

00:30:31.040 --> 00:30:33.560
other places where you would say,
hey, look here for stuff,

00:30:33.560 --> 00:30:34.740
but look here for stuff.

00:30:34.820 --> 00:30:38.220
Okay,
and I just wanted to show you quickly the

00:30:38.220 --> 00:30:41.580
local Kerberos key distribution center.

00:30:41.580 --> 00:30:46.220
So the LKDC is a new feature in
Leopard client and Leopard server,

00:30:46.220 --> 00:30:49.340
and it basically pushes single
sign-on down to desktop machines

00:30:49.340 --> 00:30:51.320
who are not open directory masters.

00:30:51.320 --> 00:30:54.340
But because Mac OS X server
is a superset,

00:30:54.580 --> 00:30:57.770
we have the LKDC in server as well.

00:30:57.890 --> 00:31:02.340
So to show you some of
the backend bits of that,

00:31:02.340 --> 00:31:07.450
I can grab a Kerberos administration
shell using K admin dot local,

00:31:07.640 --> 00:31:10.530
and I could run a command
such as list principles.

00:31:10.600 --> 00:31:14.580
Principle is just fancy term for
like a record in the Kerberos system.

00:31:14.580 --> 00:31:17.580
And we see a bunch of principles here.

00:31:17.580 --> 00:31:20.580
Like we see ones that I would
expect based on the fact that

00:31:20.580 --> 00:31:21.540
I was an open directory master.

00:31:21.640 --> 00:31:26.080
I have like, you know,
name slash server name,

00:31:26.080 --> 00:31:28.370
and then the realm I have
is server dot WWDC.

00:31:28.580 --> 00:31:30.080
We've also got some crazy ones in here.

00:31:30.080 --> 00:31:35.580
Look at these, like SIFS, LKDC,
SHA-1 hash, big unreadable string,

00:31:35.580 --> 00:31:37.580
another at SHA-1 hash realm.

00:31:37.580 --> 00:31:40.820
So these are provided by the local KDC.

00:31:41.220 --> 00:31:44.080
The upshot is you shouldn't really
have to worry about this too much.

00:31:44.080 --> 00:31:47.040
It's designed to interoperate with
everything else you've got going.

00:31:47.080 --> 00:31:51.580
So basically the point is that your
machine is essentially hosting,

00:31:51.580 --> 00:31:54.250
two different Kerberos realms.

00:31:55.200 --> 00:31:57.990
If I grab a process listing,
I can see that Curb 5 KDC is

00:31:57.990 --> 00:32:00.410
running with two different realms.

00:32:00.460 --> 00:32:02.950
The first one there,
after the first dash R,

00:32:03.020 --> 00:32:04.300
is my local KDC realm.

00:32:04.300 --> 00:32:06.290
And the second one,
which is sort of continued

00:32:06.350 --> 00:32:09.220
on the second line there,
is server.wwc.

00:32:09.220 --> 00:32:15.370
One interesting thing is if I actually
look at the Kerberos key tabs that are

00:32:15.370 --> 00:32:21.060
installed on my system using K-list-KE,
I see all of my server at WWDC tickets,

00:32:21.060 --> 00:32:24.850
but I don't see any local Kerberos,
I don't see any LKDC key

00:32:24.850 --> 00:32:26.320
tabs installed here.

00:32:26.320 --> 00:32:29.260
If I'm an open directory
master when I'm doing this,

00:32:29.260 --> 00:32:32.070
it doesn't fully initialize
all the LKDC stuff,

00:32:32.140 --> 00:32:34.590
which shouldn't really be a big deal
because you're already Kerberized.

00:32:34.600 --> 00:32:38.750
But this would be a difference between an
upgrade install versus a clean install,

00:32:38.750 --> 00:32:40.280
which I'll show you later.

00:32:40.280 --> 00:32:43.210
So if you don't see these
LKDC entries in your key tab,

00:32:43.280 --> 00:32:46.540
don't freak out because if
it's an in-place upgrade,

00:32:46.540 --> 00:32:47.670
then they won't be there.

00:32:48.140 --> 00:32:51.160
And back to Sean.

00:32:58.660 --> 00:33:00.510
So what about some other services?

00:33:00.650 --> 00:33:03.840
Well, what about DNS?

00:33:03.930 --> 00:33:05.180
We know DNS is important.

00:33:05.290 --> 00:33:07.220
If you're running a
Mac OS X server as a DNS,

00:33:07.240 --> 00:33:10.390
give yourself a round of applause
because it is really good.

00:33:10.470 --> 00:33:11.290
Thank you.

00:33:11.300 --> 00:33:19.170
So the thing is that if you've customized
the DNS files and you do an upgrade,

00:33:19.170 --> 00:33:21.380
an in-place upgrade...

00:33:23.030 --> 00:33:28.230
Leopard has a different way of dealing
with the DNS configuration files and

00:33:28.230 --> 00:33:31.470
you're going to get the option to

00:33:31.600 --> 00:33:35.440
Transmogrify,
to use a Calvin and Hobbes term,

00:33:35.480 --> 00:33:38.600
those DNS configuration files.

00:33:38.600 --> 00:33:39.600
You don't have to.

00:33:39.600 --> 00:33:44.250
DNS will continue to work fine,
but you won't be able to

00:33:44.250 --> 00:33:47.590
administer it from the GUI anymore.

00:33:47.780 --> 00:33:50.970
But chances are if you've made custom
configuration changes to your DNS file,

00:33:50.980 --> 00:33:53.710
you're not using the
GUI in the first place.

00:33:53.900 --> 00:33:55.310
So just be aware of that fact.

00:33:55.400 --> 00:33:58.360
If you choose to do that,
you're not going to be able

00:33:58.360 --> 00:33:59.820
to administer those anymore.

00:33:59.950 --> 00:34:01.670
And printing.

00:34:02.040 --> 00:34:05.080
You want to reset your print queues,
import your settings,

00:34:05.080 --> 00:34:07.740
use the server admin command line tool,
right?

00:34:07.880 --> 00:34:12.040
Your server admin settings,
old print settings, suck them in.

00:34:12.190 --> 00:34:14.310
In the firewall.

00:34:15.310 --> 00:34:16.880
Cool.

00:34:17.020 --> 00:34:22.540
If you have custom rules,
everything imports fine.

00:34:22.650 --> 00:34:26.300
So if you're doing an in-place
upgrade and you have the firewall,

00:34:26.300 --> 00:34:31.490
which is critically important because you
don't want users attacking your machine,

00:34:31.490 --> 00:34:32.960
everything is fine.

00:34:34.130 --> 00:34:35.960
And what about certs?

00:34:36.090 --> 00:34:37.610
Older certs work fine.

00:34:37.640 --> 00:34:39.600
You can suck them in.

00:34:39.740 --> 00:34:42.400
If you have customized
configuration files,

00:34:42.500 --> 00:34:47.050
you need to make sure
that the path is the same.

00:34:47.480 --> 00:34:50.420
By that I mean if you're using
Mail or using LDAP or something

00:34:50.420 --> 00:34:54.690
else and you've pushed it off to
a customized configuration file,

00:34:54.740 --> 00:34:58.000
when you do that in-place upgrade,
you want to make sure the path

00:34:58.000 --> 00:35:01.650
that references where those
certificates are is exactly the same.

00:35:01.680 --> 00:35:04.360
At this time,
I'm going to turn it back over to Andre.

00:35:04.360 --> 00:35:07.050
We're going to show you a few
things that we just talked about.

00:35:07.060 --> 00:35:07.780
All right, thanks.

00:35:07.780 --> 00:35:12.320
Okay, so this is the third in our sort
of rapid-fire sequence of demos.

00:35:12.920 --> 00:35:14.980
And I'll show you one thing I forgot
to show you in the last one,

00:35:14.980 --> 00:35:18.460
which is the difference in the
way that the computer records

00:35:18.460 --> 00:35:19.560
and computer lists are managed.

00:35:19.560 --> 00:35:23.420
Basically, we have an extra button in
our little button bar up here.

00:35:23.420 --> 00:35:26.830
And so we have the third one that
shows all of our computer records

00:35:26.830 --> 00:35:30.500
discreetly and the fourth one
which shows us our computer lists.

00:35:30.500 --> 00:35:33.460
And list is just a group for computers,
basically.

00:35:33.460 --> 00:35:36.800
You would use that as a target for
things like managed preferences and such.

00:35:36.800 --> 00:35:40.800
Another important difference that
I should quickly call out is the

00:35:40.800 --> 00:35:42.460
fact that if you have authentic.

00:35:42.960 --> 00:35:46.130
Binding enabled on your server,
people who are users in your

00:35:46.130 --> 00:35:48.810
system can actually create their
own group records by doing an

00:35:48.810 --> 00:35:50.520
authenticated bind to your directory.

00:35:50.520 --> 00:35:53.720
And while that may sound scary,
it's actually pretty cool

00:35:53.790 --> 00:35:56.760
because when they do that,
it actually initializes Kerberos on

00:35:56.780 --> 00:36:00.850
their system and actually installs
key tabs for their services on their

00:36:00.950 --> 00:36:04.320
workstation or server and integrates
them with your Kerberos environment.

00:36:04.320 --> 00:36:08.550
So by doing a trusted bind,
you're actually setting up single sign-on

00:36:08.580 --> 00:36:12.820
for the services on their machine,
which, of course, is cool.

00:36:12.880 --> 00:36:16.270
Because more passwordless login
is beneficial to everyone.

00:36:16.420 --> 00:36:19.720
So now I will show you
the stuff in this demo,

00:36:19.720 --> 00:36:21.780
which is the DNS stuff.

00:36:21.780 --> 00:36:25.020
So first thing to note is
that DNS actually works fine

00:36:25.020 --> 00:36:27.020
without touching anything.

00:36:27.020 --> 00:36:31.010
So I've done the in-place upgrade,
and here I am.

00:36:31.320 --> 00:36:34.510
I'm going to show you just
a quick zone transfer here.

00:36:34.620 --> 00:36:37.760
So if I do, again,
my dig command that I did before,

00:36:37.760 --> 00:36:39.680
which shows me all the
records in my zone,

00:36:39.690 --> 00:36:41.290
everything still works.

00:36:41.300 --> 00:36:44.240
You may have noticed that I'm still
an open directory master and so you

00:36:44.410 --> 00:36:47.920
could probably infer that my DNS is
still working just based on that.

00:36:47.920 --> 00:36:51.580
But I still have all of my DNS records,
so that's good.

00:36:51.720 --> 00:36:55.380
But if I were to actually go and try to
manage these records in Server Admin,

00:36:55.400 --> 00:36:59.270
as soon as I click on the DNS tab,
it offers to upgrade the

00:36:59.270 --> 00:37:01.420
DNS configuration for me.

00:37:01.450 --> 00:37:03.850
And I can choose not to
upgrade it if I don't want to,

00:37:03.950 --> 00:37:05.710
but that basically just
means I can't edit the

00:37:05.780 --> 00:37:07.960
configuration using Server Admin.

00:37:08.080 --> 00:37:10.840
But if I do want to upgrade it,
I just click Upgrade.

00:37:10.870 --> 00:37:13.840
And then it just kind of works
like you would expect it to.

00:37:13.840 --> 00:37:17.800
I can see all the records in my
zone and can go back here and do

00:37:17.870 --> 00:37:22.490
another zone transfer and see that,
hey, all the records are still there.

00:37:22.890 --> 00:37:25.400
So you shouldn't really
have to do much for DNS.

00:37:25.500 --> 00:37:28.800
It's always, of course,
good to back up your DNS settings

00:37:28.800 --> 00:37:29.880
ahead of time just in case.

00:37:29.920 --> 00:37:32.950
But DNS should just work for you.

00:37:33.100 --> 00:37:35.150
So that's handy.

00:37:35.450 --> 00:37:42.990
There is a new repository for some
DNS configuration settings in ETSI DNS.

00:37:43.080 --> 00:37:46.690
And I'm only calling this out because
this is a new directory in Leopard.

00:37:46.790 --> 00:37:50.520
So you'll have some items in
here which are included from the

00:37:50.520 --> 00:37:54.360
primary DNS configuration file,
DNS server configuration file.

00:37:54.360 --> 00:37:57.050
And so we support
configuration for views,

00:37:57.140 --> 00:37:58.310
DNS views and such.

00:37:58.320 --> 00:38:01.100
So for example,
if you twiddle some settings,

00:38:01.100 --> 00:38:03.550
I can look at publicview.conf here.

00:38:03.680 --> 00:38:07.620
For example,
right now I'm allowing local networks

00:38:07.620 --> 00:38:09.830
to do recursion through my DNS server.

00:38:09.990 --> 00:38:13.610
If I were to, for example, disable that,

00:38:14.340 --> 00:38:19.560
by removing this entry and saving,
changes to none.

00:38:19.560 --> 00:38:22.390
So now if you're on the none network,
you can recurse.

00:38:22.400 --> 00:38:26.560
And we see that it updates the file here.

00:38:26.560 --> 00:38:30.450
So one theme here that you'll
see consistently with Mac,

00:38:30.450 --> 00:38:34.170
Wist and Server config files, ideally,
is that the comments will tell you if

00:38:34.170 --> 00:38:36.100
it's okay to touch the stuff or not.

00:38:36.100 --> 00:38:37.540
Listen to those comments.

00:38:37.540 --> 00:38:39.710
It's in your best interest, I promise.

00:38:39.710 --> 00:38:42.930
So if it says don't edit this file,
you really shouldn't edit this

00:38:42.930 --> 00:38:46.080
file because your changes could be
overwritten the next time server

00:38:46.080 --> 00:38:48.960
admin has to go and update the
file due to some of the changes.

00:38:48.960 --> 00:38:52.240
Now, for most services,
Apple does give you a place to put

00:38:52.240 --> 00:38:56.190
your own hand-edited configuration
in a file that is typically

00:38:56.270 --> 00:39:00.920
included through a main config file,
but the separate file is not

00:39:00.970 --> 00:39:03.270
maintained by the admin tools,
and so it's safe for you

00:39:03.270 --> 00:39:04.410
to put things in there.

00:39:04.410 --> 00:39:07.820
And one example of that would be IPFW.

00:39:07.820 --> 00:39:10.700
So I had a firewall running in Tiger.

00:39:10.700 --> 00:39:14.280
I can do IPFW show,
or I could go in the admin tool,

00:39:14.450 --> 00:39:17.010
and we see all of my rules here,
and the one that I want

00:39:17.020 --> 00:39:20.190
to point out is this one,
which is a custom rule that I had

00:39:20.190 --> 00:39:22.990
configured in ETSI IP filter,
IPFW.conf.

00:39:22.990 --> 00:39:26.660
So because this is an in-place upgrade,
obviously all those directories

00:39:26.660 --> 00:39:29.360
are going to be maintained in
the ETSI IP filter directory.

00:39:29.360 --> 00:39:32.530
So the firewall works without
you having to do anything.

00:39:32.630 --> 00:39:34.160
You'll notice that it's on.

00:39:34.230 --> 00:39:35.620
It's catching packets.

00:39:35.620 --> 00:39:38.060
You can see in the second and
third columns there that we

00:39:38.060 --> 00:39:40.970
are actually matching packets,
and the firewall is active.

00:39:40.970 --> 00:39:46.060
And yeah, there's not even,
you'll notice that it doesn't

00:39:46.060 --> 00:39:48.470
actually configure my firewall
service for me in the sense that it

00:39:48.730 --> 00:39:51.560
doesn't enable service configuration,
which basically means I have

00:39:51.570 --> 00:39:53.980
to select my server name,
go over to services tab,

00:39:54.000 --> 00:39:56.400
and then if I want to
edit my firewall settings,

00:39:56.400 --> 00:40:01.250
check the box, click save,
then firewall shows up in my list,

00:40:01.280 --> 00:40:05.710
and I can go and edit just
like I would normally edit.

00:40:05.710 --> 00:40:11.260
And that is fairly straightforward,
and that is all I want to show you.

00:40:11.260 --> 00:40:13.240
Oh, excuse me,
I have print settings as well.

00:40:13.240 --> 00:40:15.940
So in the sense that you have
to do a little bit of work.

00:40:15.940 --> 00:40:18.820
So if I go into my print
and fax thing here,

00:40:18.820 --> 00:40:23.220
I see that I've got no print queues,
whereas before you saw the dummy queue.

00:40:23.220 --> 00:40:26.900
So if I want to import my print settings,
easiest way to do that is to have

00:40:26.900 --> 00:40:30.820
simply exported the print settings
from server admin in Tiger,

00:40:30.820 --> 00:40:34.110
and then I just go import
settings in server admin.

00:40:34.120 --> 00:40:34.180
So I'm going to go ahead and
import my print settings,

00:40:34.180 --> 00:40:34.490
and then I'm going to go import my print
settings from server admin in Tiger,

00:40:34.490 --> 00:40:40.950
and then I'm going to go import my
print settings from server admin.

00:40:41.110 --> 00:40:46.100
Print config.plist and I okay that.

00:40:46.100 --> 00:40:53.320
So now I've got back over here in print,
I can see that I've got my dummy queue.

00:40:53.320 --> 00:40:54.550
I switch back to server admin.

00:40:54.620 --> 00:40:57.000
Hey, there's my, or excuse me,
system preferences.

00:40:57.000 --> 00:40:57.900
There's my dummy queue.

00:40:58.040 --> 00:41:00.880
So the print settings do
require a little bit of,

00:41:00.880 --> 00:41:06.880
well, they do require some hand massaging
there in order to restore your settings.

00:41:06.890 --> 00:41:08.200
And that's all for that demo.

00:41:08.210 --> 00:41:10.040
So I'll kick it back over to Schoun.

00:41:10.990 --> 00:41:12.970
Thank you, Andre.

00:41:14.800 --> 00:41:15.980
So what about file sharing?

00:41:15.980 --> 00:41:16.970
Well, you already saw it.

00:41:16.970 --> 00:41:22.010
The file share share points
used to be inside NetInfo.

00:41:22.080 --> 00:41:24.200
When Andre went into
the config container,

00:41:24.200 --> 00:41:25.050
you saw the share points.

00:41:25.190 --> 00:41:27.220
All the share points are held there,
right?

00:41:27.220 --> 00:41:32.610
So private var DB, nodes default,
they're all inside there.

00:41:32.620 --> 00:41:35.130
And you can use the sharing
command if you want to,

00:41:35.140 --> 00:41:38.560
to actually confirm that all your
share points are still there.

00:41:39.820 --> 00:41:41.440
What about automounts?

00:41:41.440 --> 00:41:44.540
If you have automounts,
maybe group automounts,

00:41:44.540 --> 00:41:48.620
maybe you have an NFS automount,
maybe network home directories,

00:41:48.620 --> 00:41:51.880
might be a good idea for you
when you're doing an in-place

00:41:52.090 --> 00:41:55.280
upgrade to unshare that automount,
save the change,

00:41:55.280 --> 00:41:59.160
and reshare that automount
just to write the record back.

00:41:59.170 --> 00:42:01.130
If you already see the record,
you should be fine.

00:42:01.130 --> 00:42:04.300
But if it didn't pull the record in,
not a problem.

00:42:04.320 --> 00:42:07.630
Just unshare it, save the change,
and reshare it.

00:42:07.630 --> 00:42:08.280
Okay?

00:42:09.500 --> 00:42:10.430
Web and mail?

00:42:10.430 --> 00:42:15.400
Apache 1.3, just so 2007.

00:42:16.480 --> 00:42:20.240
Upgrading to 2.2 uses server admin GUI.

00:42:20.280 --> 00:42:23.270
It was 32 bit, now it's 64 bit,
screen fast.

00:42:23.380 --> 00:42:28.110
Any custom configuration files,
back them up.

00:42:28.310 --> 00:42:30.950
Make sure you got them.

00:42:31.030 --> 00:42:35.410
You can use one of the plethora
of migration tools that Apple has

00:42:35.690 --> 00:42:39.640
inside of system library
server setup migration tools.

00:42:39.640 --> 00:42:42.730
In this case,
it's the web config migrator

00:42:42.730 --> 00:42:45.010
command line tool to do that.

00:42:45.030 --> 00:42:47.140
What about mail?

00:42:47.140 --> 00:42:50.500
If you're running a Tiger mail server
and you're doing an in-place upgrade,

00:42:50.530 --> 00:42:54.680
after you restart the computer,
you may actually have to go into server

00:42:54.680 --> 00:42:57.180
admin and restart the mail service.

00:42:57.180 --> 00:42:58.670
You're going to have to
click on that start button.

00:42:58.680 --> 00:43:01.210
It's really tough,
but you may have to restart

00:43:01.210 --> 00:43:02.940
the mail service manually.

00:43:02.940 --> 00:43:07.630
You can also use the Cyrus IMAP tool to
actually migrate the information over.

00:43:09.460 --> 00:43:12.530
Okay,
obviously if you're running Clam AV,

00:43:12.530 --> 00:43:16.560
Spam Assassin, anything else,
make sure you have the latest versions.

00:43:16.560 --> 00:43:21.140
If you do an upgrade in place,
go back out, recheck,

00:43:21.140 --> 00:43:24.800
make sure you go back out
to Spam Assassin or Clam AV,

00:43:24.800 --> 00:43:26.780
make sure that the virus
definitions are exactly the

00:43:26.780 --> 00:43:28.050
same and those are up to date.

00:43:28.060 --> 00:43:30.530
So I want to turn it back over
to Andre to talk about these.

00:43:30.580 --> 00:43:35.490
Okay, so we have a short demo here
to talk about mail and web.

00:43:35.980 --> 00:43:39.770
So as Schoun mentioned,
we'll start with the web.

00:43:39.840 --> 00:43:43.400
So first thing we notice is that
it did not add it to the list.

00:43:43.430 --> 00:43:47.320
So I will go once again,
select my server name, click settings,

00:43:47.320 --> 00:43:50.200
find web, check the checkbox, click save.

00:43:50.200 --> 00:43:52.450
So if I were to just,
and we do see that the

00:43:52.450 --> 00:43:55.000
web service is running,
so that's good.

00:43:55.040 --> 00:43:59.960
But if I were to grab my browser,
try to actually hit one of my websites.

00:44:00.020 --> 00:44:02.900
Uh-oh, 404, let me try the other one.

00:44:02.920 --> 00:44:04.980
Oh no, 404.

00:44:04.980 --> 00:44:05.910
Actually, this isn't a 404.

00:44:06.020 --> 00:44:09.180
Well, it will be in a minute,
but the SSL stuff keeps working because

00:44:09.180 --> 00:44:12.830
it's giving me the certificate prompt
due to my self-signed certificate.

00:44:12.920 --> 00:44:14.440
But then it's a 404.

00:44:14.440 --> 00:44:15.360
Oh no, what happened?

00:44:15.360 --> 00:44:18.690
You have to back up and
restore your library document,

00:44:18.690 --> 00:44:20.800
library web server documents.

00:44:20.800 --> 00:44:23.900
Well, wherever you put your website,
basically the document root,

00:44:23.940 --> 00:44:27.630
if you have it stored somewhere else,
back that up and be ready to restore it.

00:44:27.640 --> 00:44:29.820
So I will do that now.

00:44:31.270 --> 00:44:34.560
Basically,
I just have a very simple setup here.

00:44:34.590 --> 00:44:41.560
So I'll go to Library web server,
Documents, and grab my simple little

00:44:41.560 --> 00:44:45.380
document root directories here,
drop them in.

00:44:45.450 --> 00:44:49.460
And now when I reload, hey,
there's my SSL website,

00:44:49.490 --> 00:44:51.020
and there's my other website.

00:44:51.080 --> 00:44:56.090
So the upshot is take care
of your document roots.

00:44:56.400 --> 00:45:08.500
[Transcript missing]

00:45:08.790 --> 00:45:13.170
So that is the sort of, so again,
I guess the other thing

00:45:13.170 --> 00:45:16.260
I wanted to point out is aside
from the document root stuff,

00:45:16.260 --> 00:45:17.300
it did just work, right?

00:45:17.300 --> 00:45:21.000
I didn't have to mess with
any settings in server admin.

00:45:21.050 --> 00:45:23.860
But if I did go into server admin,

00:45:24.620 --> 00:45:26.230
And select the overview tab.

00:45:26.450 --> 00:45:28.500
Right at the bottom there,
there's a little button that

00:45:28.500 --> 00:45:30.000
says upgrade Apache version.

00:45:30.000 --> 00:45:35.720
And this would basically transmogrify
myself from Apache 1 to Apache 2.

00:45:35.720 --> 00:45:40.000
And so I'll just go ahead and
tempt fate by clicking that button.

00:45:40.020 --> 00:45:42.670
And I have a dizzying
array of choices here.

00:45:42.790 --> 00:45:44.780
I wonder if I left it with
1.3 and clicked continue,

00:45:44.780 --> 00:45:46.460
what would happen?

00:45:46.470 --> 00:45:47.160
Let's not try that.

00:45:47.180 --> 00:45:52.400
2.2.

00:45:56.430 --> 00:45:58.770
And a little service
configuration assistant.

00:45:59.040 --> 00:46:01.930
One common theme you'll see in
Leopard Server is whenever you

00:46:01.930 --> 00:46:04.620
have like a multi-step operation,
you'll get like this other

00:46:04.630 --> 00:46:05.800
little window that comes up.

00:46:05.800 --> 00:46:09.340
That's a service configuration assistant
window and it's sort of there to

00:46:09.340 --> 00:46:12.930
help you do step-by-step things where
there might be like a branching tree,

00:46:12.930 --> 00:46:15.080
different, you know,
like a choose your own

00:46:15.080 --> 00:46:17.390
adventure kind of thing,
which is sort of hard to

00:46:17.390 --> 00:46:20.670
represent in the server admin UI,
so they have this separate stuff,

00:46:20.670 --> 00:46:22.760
which is pretty helpful actually.

00:46:23.580 --> 00:46:25.880
So we've done the upgrade.

00:46:26.020 --> 00:46:29.700
If I go to sites,
I see my sites are still there.

00:46:29.700 --> 00:46:34.340
I can go back to Safari and
everything still works.

00:46:34.340 --> 00:46:37.840
I could even quit and relaunch Safari to
make sure that everything still works.

00:46:37.840 --> 00:46:42.120
And there's my SSL warning again,
but hey, look, it's good.

00:46:42.120 --> 00:46:45.320
So we have...

00:46:45.890 --> 00:46:47.170
Mail as well.

00:46:47.260 --> 00:46:50.580
And the mail isn't as hard to deal with,
but you will notice that the

00:46:50.580 --> 00:46:53.280
mail service is not running.

00:46:53.480 --> 00:46:56.840
So I click start mail and
I get a little warning,

00:46:56.840 --> 00:47:00.060
I guess,
because the firewall is turned on.

00:47:00.180 --> 00:47:03.760
And mail will start up.

00:47:04.750 --> 00:47:05.900
Ideally.

00:47:05.900 --> 00:47:11.240
And so there's some state
issues with this UI apparently,

00:47:11.330 --> 00:47:14.420
but if I launch Mail.app,

00:47:14.680 --> 00:47:16.340
Which is still configured,
although you wouldn't know it from

00:47:16.340 --> 00:47:18.840
this window because it's like,
oh no, my settings still there?

00:47:18.840 --> 00:47:19.730
Yes, they actually are.

00:47:19.740 --> 00:47:22.240
I click continue,
it's upgraded my mail database because

00:47:22.490 --> 00:47:24.540
remember this is the in-place upgrade.

00:47:24.540 --> 00:47:27.100
I did actually show you Mail.app
briefly in Tiger Server.

00:47:27.100 --> 00:47:33.280
And so what we have here is...

00:47:34.420 --> 00:47:35.660
and Eric from Mail.app.

00:47:35.730 --> 00:47:42.200
So we can basically jump back in here,
check my mail settings and make sure that

00:47:42.450 --> 00:47:43.840
They are correct.

00:47:43.840 --> 00:47:46.920
And they are actually not in
the sense that my Mail.app

00:47:46.920 --> 00:47:48.990
is configured to use SSL.

00:47:49.070 --> 00:47:53.110
But if I want to use SSL,
I would actually have to reselect -- oh,

00:47:53.260 --> 00:47:54.470
it does say require.

00:47:54.470 --> 00:47:55.420
There we go.

00:47:55.480 --> 00:47:58.520
I think we just have a
little state issue there.

00:47:58.990 --> 00:47:59.900
Stay offline.

00:47:59.900 --> 00:48:02.140
I'll just quit and relaunch mail.

00:48:02.140 --> 00:48:03.170
And there we go.

00:48:03.230 --> 00:48:06.830
So I get the certificate
validation error.

00:48:06.930 --> 00:48:07.840
And I click Continue.

00:48:07.840 --> 00:48:11.310
And hey, look,
there's my Kerberos prompt.

00:48:11.550 --> 00:48:14.580
and hey, look at that,
it's an unread message.

00:48:14.720 --> 00:48:19.480
Well, it was actually read before,
so you may have some issues with

00:48:19.480 --> 00:48:24.810
message state in the sense that
the flags may not be preserved.

00:48:25.030 --> 00:48:26.500
I'm not sure if there's a
way to work around that,

00:48:26.500 --> 00:48:28.020
but at least in the
in-place upgrade scenario,

00:48:28.020 --> 00:48:30.120
I'm kind of showing you
what actually happens.

00:48:30.140 --> 00:48:32.860
So this actually happened
in an in-place upgrade.

00:48:32.860 --> 00:48:35.750
So I don't actually know if
there's a way to work around that,

00:48:35.800 --> 00:48:37.200
but do be aware of that.

00:48:37.240 --> 00:48:43.580
So I could go back into my
terminal and do a K list.

00:48:43.580 --> 00:48:47.100
And we see that I've got my Kerberos
tickets for IMAP and my Kerb TGT.

00:48:47.100 --> 00:48:49.100
So the mail service did continue to work.

00:48:49.120 --> 00:48:51.720
Without much prompting,
I just simply had to start it again.

00:48:51.740 --> 00:48:53.260
That's all for that demo.

00:48:53.260 --> 00:48:54.360
Back over to Schoun.

00:48:55.000 --> 00:48:58.400
Thanks, Andre.

00:49:00.120 --> 00:49:01.490
All right.

00:49:01.610 --> 00:49:04.950
So we've talked about an upgrade and
over the next few minutes we're going to

00:49:04.990 --> 00:49:07.460
take a really quick look at migration.

00:49:07.460 --> 00:49:11.520
So I'd like to invite up
Jeff Walling to the stage.

00:49:11.600 --> 00:49:13.100
So Jeff, come on up.

00:49:13.100 --> 00:49:16.500
And we're going to talk about
migrating from one server to another.

00:49:16.500 --> 00:49:17.260
Jeff.

00:49:17.260 --> 00:49:18.020
Thanks, Schoun.

00:49:21.310 --> 00:49:23.300
With a migration,
what we're really talking about

00:49:23.300 --> 00:49:26.170
is the ability to move from
one instance of OS X Server to

00:49:26.170 --> 00:49:30.200
another instance of OS X Server,
preferably from Tiger to Leopard Server.

00:49:30.200 --> 00:49:34.290
And more than likely what we're
looking at is migrating from one box,

00:49:34.410 --> 00:49:37.320
one physical OS X Server to
another OS X Server.

00:49:37.320 --> 00:49:39.890
For example,
moving from a PowerPC Mac over

00:49:40.050 --> 00:49:40.920
to an Intel Mac.

00:49:40.980 --> 00:49:43.610
We're also going to look at
things like restoring files from

00:49:43.700 --> 00:49:46.320
an older version of OS X Server,
bringing those into your

00:49:46.320 --> 00:49:47.850
new Leopard Server instance.

00:49:48.440 --> 00:49:51.740
Merging custom configuration files
for file services and other services.

00:49:51.740 --> 00:49:54.460
How to import over all your
pertinent databases like your

00:49:54.470 --> 00:49:56.240
Open Directory Master Database.

00:49:56.240 --> 00:49:58.470
And we're going to talk a little
bit about some of the migration

00:49:58.470 --> 00:50:00.920
tools that are available to help
you do some of that migration.

00:50:02.740 --> 00:50:05.100
One of the most important things
that we need to talk about when we

00:50:05.180 --> 00:50:09.210
look at a migration is the ability to
pull over all of our open directory

00:50:09.210 --> 00:50:11.580
information into our new server instance.

00:50:11.580 --> 00:50:15.110
So we need to look at what we do
with regards to the user database.

00:50:15.130 --> 00:50:18.490
How do we get all of our users out of
our old OS X server instance and bring

00:50:18.690 --> 00:50:20.820
them into our new OS X server instance?

00:50:20.820 --> 00:50:24.250
How do we extract those records
and reimport them safely?

00:50:24.260 --> 00:50:28.300
How do we get the user's passwords
out of the password server database?

00:50:29.240 --> 00:50:31.870
And how do we get their Kerberos
principles out as well so

00:50:31.870 --> 00:50:35.340
that when we do our migration,
it's seamless to the end user.

00:50:35.340 --> 00:50:36.700
Everything looks exactly the same.

00:50:36.700 --> 00:50:37.960
It functions exactly the same.

00:50:40.230 --> 00:50:43.860
When we export settings out of our
previous instance of OS X Server,

00:50:43.860 --> 00:50:45.480
we have a couple of
different ways to do this.

00:50:45.480 --> 00:50:50.160
We have a couple of different tools
either via the UI or via command line.

00:50:50.290 --> 00:50:52.710
When we export out our
open directory settings,

00:50:52.720 --> 00:50:55.530
all of our user information,
our password server database,

00:50:55.620 --> 00:51:00.160
we can choose to use Workgroup Manager,
we can choose to use Server Admin.

00:51:00.270 --> 00:51:04.400
When we export our service settings out,
we can choose to use Server Admin,

00:51:04.400 --> 00:51:08.190
we can choose to use the command line,
the Server Admin command.

00:51:10.510 --> 00:51:13.710
When we export and bring over
or migrate our user data,

00:51:14.170 --> 00:51:18.270
easiest way to do that and preserve all
of our file system ACLs and all the other

00:51:18.270 --> 00:51:21.270
information that we need to preserve
in our user data migration is to simply

00:51:21.270 --> 00:51:26.140
wrap all that data up into a zip file,
a tar file, however you'd like to zip all

00:51:26.140 --> 00:51:29.160
that information up and then
migrate the data over so it

00:51:29.160 --> 00:51:31.400
preserves all the file system ACLs.

00:51:31.400 --> 00:51:33.400
So export all of your information out.

00:51:33.400 --> 00:51:36.260
When we look at exporting
information out of the server,

00:51:36.260 --> 00:51:38.180
especially our user groups,
our computer lists,

00:51:38.210 --> 00:51:41.110
all of our open directory information,
the first tool that pops into

00:51:41.110 --> 00:51:42.520
mind is Workgroup Manager.

00:51:42.520 --> 00:51:46.520
If we use Workgroup Manager to
export our users out of the server,

00:51:46.530 --> 00:51:49.230
out of our previous
open directory master,

00:51:49.230 --> 00:51:52.940
one of the things that we
lose are our users' passwords.

00:51:52.940 --> 00:51:55.570
So if we use the export setting
out of Workgroup Manager in,

00:51:55.570 --> 00:51:58.650
say, Tiger Server,
we're going to lose our users' passwords.

00:51:58.660 --> 00:52:01.320
However,
if we use Server Admin to do this.

00:52:01.400 --> 00:52:04.620
and create a disk image
from our Server Admin,

00:52:04.620 --> 00:52:08.510
our open directory master settings,
we get both the password server database

00:52:08.590 --> 00:52:11.650
and the Kerberos server database,
and we get the full backup

00:52:11.710 --> 00:52:15.230
of everything that's involved
in the open directory master.

00:52:15.660 --> 00:52:18.650
From the command line,
we can also use DS export to export all

00:52:18.650 --> 00:52:22.070
our information out and server admin
to pull out all the service settings

00:52:22.110 --> 00:52:25.900
as well as server admin from the UI.

00:52:26.470 --> 00:52:29.390
If we choose to take more of a manual
approach to get all of our information

00:52:29.400 --> 00:52:32.540
out of our Open Directory master,
we can use the LDAP search command to

00:52:32.540 --> 00:52:34.860
back up all of our user information.

00:52:34.860 --> 00:52:38.200
One thing to point out here is that any
changes that you've made to the schema in

00:52:38.210 --> 00:52:41.890
your previous instance of OS X Server are
going to be overwritten when they're

00:52:41.990 --> 00:52:44.760
imported back into the Leopard Server.

00:52:46.260 --> 00:52:49.290
If we use LDAP search to export
our user information from our

00:52:49.290 --> 00:52:54.120
previous instance of OS X Server,
we also need to export the user password

00:52:54.120 --> 00:52:56.040
databases and the Kerberos database.

00:52:56.040 --> 00:53:00.580
So we use MakePassDB and the KRB5
util to export all of that information

00:53:00.580 --> 00:53:05.100
out of both the password server
database and the Kerberos database.

00:53:08.350 --> 00:53:10.660
Once we have all of our
information backed up,

00:53:10.660 --> 00:53:13.650
we've used server admin or the
server admin command line to back

00:53:13.690 --> 00:53:15.590
up all of our service information.

00:53:15.630 --> 00:53:18.510
We've used either server admin or
work group manager to back up all

00:53:18.510 --> 00:53:20.770
of our open directory information.

00:53:20.900 --> 00:53:22.620
We've backed up all of our user data.

00:53:22.620 --> 00:53:26.520
We've put that into a zip file,
ready to move over to our new system,

00:53:26.520 --> 00:53:29.290
our new instance of OS X Server.

00:53:29.510 --> 00:53:33.170
We need to look at a method for importing
the services and bringing all that

00:53:33.170 --> 00:53:35.230
information back into our new system.

00:53:35.330 --> 00:53:37.940
So the first step would be to
copy over your user created data,

00:53:37.940 --> 00:53:39.890
all of their files.

00:53:40.000 --> 00:53:44.480
Bring that zip file over into the system,
unzip it, untar it,

00:53:44.490 --> 00:53:48.000
put it back in the state in the
system where you need it to be.

00:53:48.220 --> 00:53:50.290
Make sure that your home
directory structure,

00:53:50.460 --> 00:53:53.700
if this was a home directory server,
make sure that your home directory

00:53:54.130 --> 00:53:57.430
structure is configured the way
that you need it to be configured.

00:53:58.520 --> 00:54:01.500
Next, import your open directory
information back in.

00:54:01.610 --> 00:54:04.540
Rebind into Active Directory if
you need to.

00:54:04.690 --> 00:54:08.830
Import all the information back
into your directory services.

00:54:10.110 --> 00:54:14.000
Set up and test all of your
services and your permissions.

00:54:14.000 --> 00:54:16.270
So import any service
settings that you have,

00:54:16.270 --> 00:54:20.340
AFP, SMB, import those service
settings back in and test,

00:54:20.470 --> 00:54:21.000
test, test.

00:54:21.000 --> 00:54:25.990
Make sure that everything you have is
working the way it should be working.

00:54:27.800 --> 00:54:30.080
One caveat to this that
I want to point out,

00:54:30.220 --> 00:54:32.580
if your server is also
running as a DNS server,

00:54:32.580 --> 00:54:34.240
for example,
you're hosting a DNS for your

00:54:34.250 --> 00:54:36.600
network and your server is
also an open directory master.

00:54:36.640 --> 00:54:40.950
The one change in this step process
needs to be that when you reimport

00:54:40.950 --> 00:54:45.690
your services and your settings,
you're going to need to do DNS first.

00:54:45.700 --> 00:54:47.710
Otherwise,
your open directory master is not

00:54:47.720 --> 00:54:49.250
going to come back up properly.

00:54:49.850 --> 00:54:53.100
So be sure if your server is running
as a DNS server that that pops

00:54:53.100 --> 00:54:55.980
up and that repopulates first,
then bring in your open

00:54:55.980 --> 00:54:58.820
directory settings and follow
the rest of these steps.

00:55:01.440 --> 00:55:04.330
As with the export, we showed you how to
do some manual steps.

00:55:04.340 --> 00:55:05.500
Same thing with the import.

00:55:05.500 --> 00:55:09.440
If we choose to go with a manual method
instead of restoring from a database,

00:55:09.440 --> 00:55:13.180
we can use LDAP add to bring
information back in from our

00:55:13.350 --> 00:55:17.560
exported information and migrate
into our new OS X server instance.

00:55:20.080 --> 00:55:22.960
We also need to bring back in
the password server databases

00:55:22.960 --> 00:55:25.170
and the KDC database.

00:55:25.240 --> 00:55:29.530
One thing to really point out here,
because we're using a merge,

00:55:29.570 --> 00:55:33.400
when we use MakePassDB to merge
our two password server databases,

00:55:33.400 --> 00:55:38.390
you need to make sure that your previous
directory administrator account,

00:55:38.390 --> 00:55:41.960
long name, short name, password,
all match up with the new

00:55:41.960 --> 00:55:44.810
directory administrator account
that you're creating on your

00:55:44.810 --> 00:55:46.260
new OS 10 server instance.

00:55:46.460 --> 00:55:49.760
So that when the password servers get
merged with the MakePassDB command,

00:55:49.760 --> 00:55:53.900
you can still log into your server
with the same user account information.

00:55:57.290 --> 00:56:00.600
Always verify that
everything went properly.

00:56:00.630 --> 00:56:03.780
Use KAdmin.local to make sure that
all your principles got pulled over

00:56:03.780 --> 00:56:09.040
correctly for your KDC and use your
MakePassDB and dump all the information

00:56:09.040 --> 00:56:13.060
out of your password server database
to make sure that your password server

00:56:13.100 --> 00:56:17.070
slots line up for what you had in your
previous instance of OS X Server to

00:56:17.070 --> 00:56:19.270
your new instance of OS X Server.

00:56:20.450 --> 00:56:23.960
Access control lists take
a little bit more care.

00:56:23.980 --> 00:56:26.540
If we look at file system
access control lists,

00:56:26.620 --> 00:56:29.780
file system access control lists
are stored in the HFS+ file system.

00:56:29.950 --> 00:56:33.780
So if we zip up our previous
user data and move that

00:56:33.780 --> 00:56:37.180
data over to our new server,
our new OS 10 server instance,

00:56:37.180 --> 00:56:39.480
and unzip that information,
the file system ACLs

00:56:39.480 --> 00:56:41.080
are gonna be preserved.

00:56:41.100 --> 00:56:43.320
That stuff's all gonna come over with us.

00:56:43.340 --> 00:56:47.290
Our service access control lists are
now located in the local database.

00:56:47.640 --> 00:56:52.310
So they are now located in the
same local database where our local

00:56:52.310 --> 00:56:54.120
users and information is stored.

00:56:54.140 --> 00:56:58.060
Our directory service ACLs are
stored in a brand new location.

00:56:58.060 --> 00:57:01.760
If we look at the two examples below,
we have a normal standard container

00:57:02.120 --> 00:57:05.760
of main server.pretendcode.com,
where our information is stored

00:57:05.780 --> 00:57:08.670
in the standard container
for our directory services.

00:57:08.810 --> 00:57:12.990
Our directory ACLs are now stored in
a separate container outside of the

00:57:12.990 --> 00:57:17.230
standard container in CN equals config.

00:57:19.310 --> 00:57:22.970
We use pretty much the same tools to
bring the information back over to

00:57:23.060 --> 00:57:26.880
our new server instances we did to
export them from our previous instance.

00:57:26.920 --> 00:57:30.160
So we use Workgroup Manager and
Server Admin from the GUI and we

00:57:30.160 --> 00:57:33.510
use DS Import and Server Admin
from the command line to bring

00:57:33.510 --> 00:57:35.510
all that information back in.

00:57:37.070 --> 00:57:39.750
Schoun's mentioned in some of
the previous slides the migration

00:57:39.850 --> 00:57:41.330
tools that Apple has available.

00:57:41.440 --> 00:57:43.430
And here's the path,
system library server

00:57:43.430 --> 00:57:44.990
setup migration extras.

00:57:45.000 --> 00:57:48.460
And there are migration tools
available to migrate almost all of

00:57:48.460 --> 00:57:53.180
your services and settings from your
previous instance of OS X Server over

00:57:53.180 --> 00:57:55.470
to your new instance of OS X Server.

00:57:55.660 --> 00:57:59.370
And here are just a few,
the Web Configuration Migrator,

00:57:59.370 --> 00:58:03.490
the IPFW Configuration Migrator
and the Jabber Migrator.

00:58:05.100 --> 00:58:08.880
When we look at migrating
services from 10.4 over to 10.5,

00:58:08.920 --> 00:58:11.650
there are a lot of
services that we can move.

00:58:11.700 --> 00:58:16.670
And the next couple of slides give you
the paths and information of each one

00:58:16.680 --> 00:58:18.460
of these locations for these services.

00:58:18.460 --> 00:58:20.600
I'm going to go through
these pretty quickly,

00:58:20.600 --> 00:58:23.650
but I want to point out down at the
bottom that all this information is

00:58:23.650 --> 00:58:26.730
in the upgrading and migrating manual
that Schoun's going to show you the

00:58:26.730 --> 00:58:28.250
URL for at the end of the slides.

00:58:28.750 --> 00:58:31.220
So, I know you're not going to have
time to write all these down,

00:58:31.220 --> 00:58:34.350
but when we look at web, Tomcat, JBoss,
WebObjects, QuickTime Streaming,

00:58:34.350 --> 00:58:37.840
QuickTime Streaming Server Publisher,
we can migrate all that

00:58:37.840 --> 00:58:42.090
information as well as Mail,
NetBoot, iChat, MySQL, Print,

00:58:42.160 --> 00:58:43.240
FTP and AFP.

00:58:43.240 --> 00:58:48.370
Moving on, SMB, NAT, DHCP, DNS,
IP Firewall and VPN.

00:58:48.380 --> 00:58:51.860
You can get the paths and locations
for all of this information in the

00:58:52.060 --> 00:58:53.840
upgrading and migrating manual.

00:58:55.250 --> 00:58:57.110
I'm going to turn it
over to Andre for a demo.

00:58:57.270 --> 00:58:58.490
Thank you very much.

00:58:58.670 --> 00:59:04.670
And this is the intended to be slightly
longer demo showing the migration path.

00:59:04.740 --> 00:59:07.440
So we have a fresh Leopard server here.

00:59:07.440 --> 00:59:12.010
While it's not totally fresh,
I went ahead and updated it to 10.5.3.

00:59:12.080 --> 00:59:14.560
You should do that too, by the way,
before you finish with

00:59:14.800 --> 00:59:16.460
your migration procedure.

00:59:16.590 --> 00:59:20.670
So let's take a look at what
we have in Server Admin.

00:59:24.140 --> 00:59:26.960
And it should be first
launch configuration.

00:59:27.010 --> 00:59:30.220
So we don't even have any
services configured yet,

00:59:30.220 --> 00:59:35.720
in the sense that there will be nothing
listed on the left to actually configure.

00:59:35.910 --> 00:59:39.760
So instead of clicking check
boxes like a billion times,

00:59:39.760 --> 00:59:43.040
I'm just going to do a
little shortcut here.

00:59:44.410 --> 00:59:48.560
So server admin, the command line tool,
you can say server admin

00:59:48.580 --> 00:59:50.940
settings and then a service name
and it'll print out settings.

00:59:50.940 --> 00:59:54.260
You can take that actual chunk that it
prints out and shove it right back in

00:59:54.260 --> 00:59:56.120
as a way of reloading those settings.

00:59:56.120 --> 01:00:01.290
So what I've done just there is
turned on service configurations,

01:00:01.290 --> 01:00:05.020
which if I reload the
UI by hitting command R.

01:00:05.020 --> 01:00:06.240
So now we have one service.

01:00:06.240 --> 01:00:07.270
Nothing's running.

01:00:07.890 --> 01:00:12.360
So let's get started with restoring
some of our service configurations.

01:00:12.730 --> 01:00:15.990
So if we want to be an
open directory master,

01:00:15.990 --> 01:00:19.110
then I will select open directory,
click change,

01:00:19.110 --> 01:00:22.860
go through the old setup assistant
or service configuration assistant,

01:00:22.880 --> 01:00:25.800
type in my password there.

01:00:25.800 --> 01:00:26.700
Wait a minute.

01:00:26.700 --> 01:00:27.570
What's wrong?

01:00:27.620 --> 01:00:28.600
Anyone notice?

01:00:28.600 --> 01:00:31.100
I'll click continue.

01:00:31.100 --> 01:00:33.610
Looks like it's going to work, right?

01:00:33.620 --> 01:00:35.000
It's spinning gear.

01:00:35.020 --> 01:00:36.510
That's got to be good.

01:00:37.880 --> 01:00:41.510
Dun dun dun, anticipation builds.

01:00:43.200 --> 01:00:46.560
And hey, it worked, right?

01:00:46.620 --> 01:00:48.120
So I click on Overview.

01:00:48.140 --> 01:00:49.080
What's wrong here?

01:00:49.120 --> 01:00:50.710
My Kerberos is stopped.

01:00:50.840 --> 01:00:52.230
Anybody know why?

01:00:52.350 --> 01:00:53.720
I was hosting my own DNS.

01:00:53.880 --> 01:00:55.740
Guess what I didn't do first?

01:00:55.750 --> 01:00:57.450
Restore my DNS settings.

01:00:57.550 --> 01:01:01.270
So I'm going to demote
back down to standalone.

01:01:02.330 --> 01:01:04.980
which fortunately is a
pretty quick process.

01:01:05.180 --> 01:01:08.040
So if you follow the upgrade
and migration document,

01:01:08.070 --> 01:01:11.540
it will walk you through the
appropriate order for doing everything.

01:01:11.540 --> 01:01:14.720
And I would stress that because
the order is quite important,

01:01:14.720 --> 01:01:16.980
especially in the case of
Open Directory Master where

01:01:16.980 --> 01:01:18.840
you need to have DNS.

01:01:19.050 --> 01:01:20.940
So if you were to look
through that guide,

01:01:20.970 --> 01:01:24.750
you would basically see
information about how to backup

01:01:24.760 --> 01:01:26.740
and restore your DNS config files.

01:01:26.740 --> 01:01:29.700
I'm gonna take a slight shortcut
here in the sense that I've got

01:01:29.840 --> 01:01:34.350
all the commands that I need
sort of already ready to go here.

01:01:34.490 --> 01:01:36.240
So I'm just gonna drop those in.

01:01:36.300 --> 01:01:40.600
And basically it's just restoring
my DNS config files from backup.

01:01:40.640 --> 01:01:45.400
And I should now be able to
configure my system preferences

01:01:45.490 --> 01:01:47.240
to use myself as a DNS server.

01:01:47.270 --> 01:01:48.460
'Cause remember, this is a clean install.

01:01:48.480 --> 01:01:50.640
I can't just configure
and start the DNS server.

01:01:50.640 --> 01:01:53.340
I have to use my own DNS service.

01:01:53.500 --> 01:01:57.820
So instead of using system preferences,
I'm going to use network setup,

01:01:57.860 --> 01:01:59.780
which is a nice command line
tool along with system setup

01:01:59.850 --> 01:02:00.740
that you can use to automate.

01:02:00.740 --> 01:02:04.340
Or do at least command line
scripting for a lot of these things.

01:02:04.510 --> 01:02:06.300
That would usually require the GUI.

01:02:06.590 --> 01:02:12.370
So if I then refresh, excuse me,
I guess I have to start the service too.

01:02:12.800 --> 01:02:18.880
So I start the service and my zone's at.

01:02:18.890 --> 01:02:22.680
Hmm, let me try quitting and
relaunching this guy.

01:02:26.900 --> 01:02:30.240
Because you do need DNS to
be an open directory master.

01:02:30.310 --> 01:02:33.140
Uh-oh.

01:02:33.190 --> 01:02:37.030
It's a dreaded
indeterminate state bullet.

01:02:37.480 --> 01:02:38.590
Ah, there we go.

01:02:38.650 --> 01:02:39.150
Hey.

01:02:39.280 --> 01:02:41.400
So it's noticed that I have
old DNS configuration.

01:02:41.400 --> 01:02:42.700
It wants to upgrade that for me.

01:02:42.700 --> 01:02:44.690
I click upgrade.

01:02:45.280 --> 01:02:46.740
and now there's my zones.

01:02:46.760 --> 01:02:48.200
Whew, that was close.

01:02:48.220 --> 01:02:51.960
All right,
so now I can be an Open Directory master.

01:02:52.040 --> 01:02:55.320
So once again, go through here,
Open Directory master.

01:02:55.340 --> 01:02:58.540
Going to use the same admin name
and password that I used before.

01:02:58.730 --> 01:03:01.450
And there's the screen that I was looking
for before where it's prompting me for

01:03:01.580 --> 01:03:03.460
my Kerberos Realm and LDAP search base.

01:03:03.650 --> 01:03:05.240
You typically want to
accept these defaults,

01:03:05.240 --> 01:03:08.470
but the point here is that it should
be able to suggest default values that

01:03:08.470 --> 01:03:10.580
are based on your DNS domain name.

01:03:10.660 --> 01:03:13.980
If it can't do that, that typically means
your DNS has a problem.

01:03:14.100 --> 01:03:16.600
So I'm going to promote
myself to a master.

01:03:16.600 --> 01:03:19.590
And we are running out of time,
so I'm just going to show you

01:03:19.680 --> 01:03:22.620
some of the key highlights
from the rest of this demo.

01:03:22.670 --> 01:03:27.780
The big thing for most would
be to restore your users,

01:03:27.800 --> 01:03:30.910
passwords, group accounts,
that sort of stuff.

01:03:31.030 --> 01:03:33.650
And so the easiest way to
do that is to simply use an

01:03:33.780 --> 01:03:36.000
Open Directory archive restore.

01:03:36.100 --> 01:03:40.880
So when I was in 10.4.11,
I used the archive capabilities to

01:03:40.880 --> 01:03:46.330
export an encrypted disk image And now
I'm going to import that image.

01:03:46.340 --> 01:03:48.750
I'm going to navigate.

01:03:49.440 --> 01:03:51.280
There's my image.

01:03:51.350 --> 01:03:54.240
Actually, there's my directory.

01:03:54.390 --> 01:03:56.460
Oh, that's the wrong-- sorry.

01:03:56.630 --> 01:03:58.480
Restore from.

01:03:59.250 --> 01:04:01.330
Hey, at least it saved my directory.

01:04:01.430 --> 01:04:03.090
So I will restore.

01:04:03.340 --> 01:04:05.130
And before I do that,
let me just launch Workgroup

01:04:05.140 --> 01:04:09.180
Manager just to show you that I do,
in fact, have an empty container.

01:04:09.180 --> 01:04:13.300
And that's the wrong admin name, but .

01:04:15.310 --> 01:04:18.130
All right, so I see that I'm in LDATv3.

01:04:18.490 --> 01:04:21.880
I see that I have no users, no groups,
no computer lists.

01:04:22.110 --> 01:04:24.890
So when I click OK--

01:04:25.210 --> 01:04:27.260
Get the little barber pole.

01:04:27.290 --> 01:04:29.150
And boy, that was fast.

01:04:29.240 --> 01:04:29.990
Did it even work?

01:04:30.060 --> 01:04:32.780
It's almost disconcertingly fast.

01:04:32.830 --> 01:04:36.290
But if I go back into
Workgroup Manager and refresh,

01:04:36.750 --> 01:04:37.840
Refresh.

01:04:38.080 --> 01:04:39.580
I do see that I have stuff.

01:04:39.760 --> 01:04:41.820
Stuff is good.

01:04:41.820 --> 01:04:47.540
And I can, for example, test my Kerberos
credentials by using a KNIT.

01:04:47.690 --> 01:04:54.400
and I can use K list to see that my
Kerberos does in fact still work.

01:04:54.400 --> 01:04:58.830
And so at this point basically you
would continue to restore your service

01:04:58.840 --> 01:05:00.950
settings following the admin guide.

01:05:00.950 --> 01:05:02.730
So each service is a little different.

01:05:02.730 --> 01:05:05.030
Sometimes you can just
restore the property list

01:05:05.040 --> 01:05:06.600
that you backed up from Tiger.

01:05:06.600 --> 01:05:10.280
Sometimes you actually have to go
and move config files or directories

01:05:10.370 --> 01:05:14.520
of config files or directories of
database files like in the case of mail.

01:05:14.520 --> 01:05:17.880
Sometimes you actually have to
go and run one of the system

01:05:17.880 --> 01:05:19.000
migrator scripts manually.

01:05:19.140 --> 01:05:22.450
These are things that would normally
happen for you in an in-place upgrade.

01:05:22.600 --> 01:05:25.300
And all that's in the upgrading
and migrating documents.

01:05:25.410 --> 01:05:27.700
So you might have to like
copy some files and then,

01:05:27.810 --> 01:05:29.800
you know,
path to a Ruby script or something

01:05:29.800 --> 01:05:32.570
that would actually do the
processing and conversion of the

01:05:32.680 --> 01:05:34.100
old format to the new format.

01:05:34.220 --> 01:05:36.540
And then you would be able
to use the admin tools and

01:05:36.540 --> 01:05:38.410
continue on with the service.

01:05:38.580 --> 01:05:41.580
And because we're almost out of time,
I'm going to go ahead and stop there.

01:05:41.580 --> 01:05:43.340
There was a bit more,
but I think you get the idea.

01:05:43.340 --> 01:05:47.670
So I'll turn it back over to
whoever wants to take the mic.

01:05:47.720 --> 01:05:49.390
Thanks, Andre.

01:05:49.400 --> 01:05:49.990
You're welcome.

01:05:55.010 --> 01:05:57.130
One thing we haven't talked
about thus far is how to migrate

01:05:57.150 --> 01:05:59.060
your open directory replicas.

01:05:59.060 --> 01:06:01.730
And the question really becomes
is whether or not we need to

01:06:01.810 --> 01:06:05.280
migrate those replicas or just
start them over from scratch.

01:06:05.280 --> 01:06:07.960
Because a replica truly is a copy
of your open directory master.

01:06:07.960 --> 01:06:11.830
So the ability to migrate your
open directory master gives you the

01:06:11.830 --> 01:06:15.820
ability to really start from scratch
with your open directory replicas.

01:06:15.820 --> 01:06:19.290
Create a brand new instance of OS 10
server and simply repromote those new

01:06:19.290 --> 01:06:22.660
servers to be replicas of your brand
new migrated open directory master.

01:06:27.020 --> 01:06:29.400
When it comes to home directories,
we mentioned this before,

01:06:29.400 --> 01:06:31.600
when you're backing up and
migrating all of your user data,

01:06:31.600 --> 01:06:35.520
simply zip all of that information up
so it preserves the file system ACLs,

01:06:35.540 --> 01:06:38.590
preserves all the information
that you need to migrate from

01:06:38.590 --> 01:06:41.940
your previous server instance
over to your new server instance,

01:06:42.100 --> 01:06:45.060
copy that data over, unzip it,
and you're ready to go.

01:06:46.910 --> 01:06:51.220
One caveat with migration is if you
need to change the IP address of your

01:06:51.220 --> 01:06:55.120
server from what it previously was
to what it will be now in the future.

01:06:55.320 --> 01:06:57.650
To do that we use the change IP command.

01:06:57.650 --> 01:07:01.540
And change IP runs a set of numerous
scripts to be able to change over all the

01:07:01.540 --> 01:07:06.410
information that includes your previous
IP address and your previous host name

01:07:06.410 --> 01:07:09.000
to your new IP address and new host name.

01:07:10.410 --> 01:07:13.750
So when you're dealing with change IP,
first make sure that your new

01:07:13.750 --> 01:07:14.950
IP and host name are correct.

01:07:15.020 --> 01:07:17.860
If you're changing your IP address,
make sure that your new

01:07:17.970 --> 01:07:21.530
IP address has DNS resolution,
forward and reverse resolution

01:07:21.880 --> 01:07:23.300
already set up and working for it.

01:07:23.320 --> 01:07:24.890
Run the change IP command.

01:07:24.900 --> 01:07:28.820
We have two examples of what the change
IP command can do down at the bottom.

01:07:28.820 --> 01:07:31.660
Change your network settings
to your new IP address.

01:07:31.720 --> 01:07:37.120
So running the change IP command does
not update your network system prefs.

01:07:37.520 --> 01:07:39.640
You have to go into system prefs,
go into network,

01:07:39.780 --> 01:07:43.040
change to your new IP address,
change to your new computer

01:07:43.090 --> 01:07:47.270
name in the sharing system pref,
typically reboot the machine and

01:07:47.270 --> 01:07:50.650
you'll be ready to go with your
new IP address and new host name.

01:07:51.960 --> 01:07:53.220
And that's it for migrating.

01:07:53.240 --> 01:07:55.960
I'm going to turn back over
to Schoun and finish this up.

01:07:56.150 --> 01:07:56.470
Thanks, Jeff.

01:07:56.490 --> 01:07:57.850
So where are we?

01:08:00.500 --> 01:08:04.540
We need to make sure we have our
customized configuration files.

01:08:04.640 --> 01:08:05.910
You handled every service.

01:08:05.970 --> 01:08:07.170
You tested it.

01:08:07.390 --> 01:08:11.850
You may have gained some gooey command
line experience when you've done this.

01:08:12.170 --> 01:08:12.890
What do you need to do?

01:08:12.890 --> 01:08:13.850
You attended the session.

01:08:13.850 --> 01:08:14.970
Check it off your list.

01:08:14.990 --> 01:08:17.740
Back it up at least once.

01:08:17.740 --> 01:08:20.060
Test in a private environment.

01:08:20.060 --> 01:08:23.160
Make sure that it works
inside a private environment.

01:08:23.160 --> 01:08:24.290
There's the URL.

01:08:24.290 --> 01:08:27.300
You can find it at manualsinfo.apple.com.

01:08:27.300 --> 01:08:29.810
You can go on out and look for that.

01:08:29.890 --> 01:08:31.940
It's with everything else.

01:08:33.100 --> 01:08:37.300
And upgrading and migrating,
it's always been a process

01:08:37.300 --> 01:08:40.460
that was not totally,
totally error free.

01:08:40.460 --> 01:08:44.640
But Apple has done an excellent
job of doing all the background

01:08:44.840 --> 01:08:46.670
and the hard work for you.

01:08:46.740 --> 01:08:51.820
Planning, testing is the best defense
against having a production

01:08:51.880 --> 01:08:54.430
server that just might go down.