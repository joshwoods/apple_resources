WEBVTT

00:00:28.970 --> 00:00:29.800
Good morning.

00:00:29.920 --> 00:00:33.410
I'm glad to see that everybody
made it here on Friday,

00:00:33.690 --> 00:00:37.090
very early morning session
after the beer bash.

00:00:38.340 --> 00:00:42.690
My name is Nicole Jacque,
and I'm with the Directory Server and

00:00:42.690 --> 00:00:45.490
Sharing Technologies group at Apple.

00:00:46.600 --> 00:00:52.360
And the first thing that I want to just
point out is that I did this last year.

00:00:52.360 --> 00:00:53.960
How many people came to
my session last year?

00:00:54.170 --> 00:00:55.040
Oh, good.

00:00:55.040 --> 00:00:57.600
Lots of return--returnees.

00:00:57.600 --> 00:00:59.940
I must not have done too
bad of a job last year.

00:00:59.940 --> 00:01:02.310
So last year,
it turned out to be pretty popular

00:01:02.550 --> 00:01:07.880
that I did session notes for you guys
and put them up on the attendees site.

00:01:07.880 --> 00:01:09.640
And I've done the same thing this year.

00:01:09.940 --> 00:01:12.580
And last year, there were some problems
finding them on the site,

00:01:12.700 --> 00:01:15.320
so I just thought I'd
point out where they are.

00:01:15.320 --> 00:01:18.370
So if you log into the attendees site,
go to this session.

00:01:18.370 --> 00:01:22.270
They're actually called, I believe,
release notes, but they're actually just

00:01:22.420 --> 00:01:24.670
session notes for this session.

00:01:25.010 --> 00:01:30.520
So the idea here is instead of you guys
having to try and scribble as fast as you

00:01:30.520 --> 00:01:36.040
can or type all the commands and various
things that I have up on the slide,

00:01:36.100 --> 00:01:43.070
I've tried to provide as much of
this as I can in the notes for you,

00:01:43.070 --> 00:01:43.070
so you should be able to just
refer to the notes afterwards.

00:01:49.100 --> 00:01:52.000
Okay, so I take it you like this,
the notes.

00:01:52.000 --> 00:01:53.600
Okay.

00:01:53.670 --> 00:01:55.100
Just checking.

00:01:55.130 --> 00:01:58.120
And then I thought I'd also
point out that last year's notes

00:01:58.410 --> 00:02:00.140
are actually still available.

00:02:00.140 --> 00:02:04.760
They actually got moved out to the
regular attendees' site--or sorry,

00:02:04.780 --> 00:02:06.670
the regular developer site.

00:02:06.950 --> 00:02:12.630
You can get to them by navigating
to OS X Server Networking,

00:02:12.630 --> 00:02:17.700
or you can follow this link here
if you can actually remember it.

00:02:18.500 --> 00:02:22.990
And the reason I point out that last
year's notes are available is I'm

00:02:22.990 --> 00:02:27.500
going to try to not cover the same
set of things that I covered last year

00:02:27.500 --> 00:02:36.060
because you can go watch my session
from last year on the ADC iTunes site.

00:02:36.190 --> 00:02:39.890
So this year,
what we're going to cover is we're

00:02:39.890 --> 00:02:44.290
going to first talk about extending
Directory Services with a particular

00:02:44.290 --> 00:02:48.790
emphasis on what's new in Leopard
and what's actually going to be

00:02:49.000 --> 00:02:53.900
particularly useful for people like you,
people that are system administrators,

00:02:54.010 --> 00:02:57.210
people that are trying to
solve particular problems

00:02:57.210 --> 00:02:58.910
with Directory Services.

00:02:59.190 --> 00:03:02.430
I'm going to talk about some new
troubleshooting information that you're

00:03:02.430 --> 00:03:04.220
going to want to know about Leopard.

00:03:04.300 --> 00:03:07.530
And then I'm also going to take you
through five of what we think are

00:03:07.530 --> 00:03:11.470
probably the most common troubleshooting
scenarios that we see with Leopard

00:03:11.500 --> 00:03:15.300
so that you get five hopefully
relevant troubleshooting scenarios.

00:03:15.300 --> 00:03:15.300
And then I'm also going to take you
through five of what we think are

00:03:15.300 --> 00:03:15.300
probably the most common troubleshooting
scenarios that we see with Leopard

00:03:15.300 --> 00:03:15.300
so that you get five hopefully relevant
troubleshooting scenarios that you

00:03:15.300 --> 00:03:15.300
can use to solve particular problems.

00:03:15.300 --> 00:03:15.300
And then I'm also going to take you
through five of what we think are

00:03:15.300 --> 00:03:15.300
probably the most common troubleshooting
scenarios that we see with Leopard

00:03:15.300 --> 00:03:15.300
so that you get five hopefully relevant
troubleshooting scenarios that you

00:03:15.300 --> 00:03:15.300
can use to solve particular problems.

00:03:15.410 --> 00:03:19.740
relevant troubleshooting scenarios
that you'll get to go through here.

00:03:21.040 --> 00:03:25.530
So we're going to start out by talking
about extending directory services.

00:03:25.530 --> 00:03:28.620
And when we talk about this,
mostly I'm going to be using

00:03:28.690 --> 00:03:32.160
as my example of the directory
service that we're going to be

00:03:32.660 --> 00:03:34.640
extending as Active Directory.

00:03:34.680 --> 00:03:38.200
And I use this just because
for a large number of you,

00:03:38.280 --> 00:03:40.820
that is what you are
going to be talking about.

00:03:40.880 --> 00:03:46.580
But everything that I'm talking about
also applies to Open Directory as

00:03:46.580 --> 00:03:51.000
your directory that you're going
to extend for certain things,

00:03:51.040 --> 00:03:55.170
like your own web server or some
other third-party LDAP server.

00:03:55.170 --> 00:03:59.230
So even when I'm saying Active Directory,
this extends to other

00:03:59.340 --> 00:04:01.380
directory services as well.

00:04:03.470 --> 00:04:05.340
So if we're going to talk about
extending directory service,

00:04:05.340 --> 00:04:09.400
the first thing we should think about is,
well, why would we need to do this?

00:04:09.560 --> 00:04:12.500
And the things that people usually
want to accomplish with extending

00:04:12.500 --> 00:04:18.390
directory service is they want to
provide some client management for

00:04:18.390 --> 00:04:23.020
OS X users logging in on clients that
are logging in with accounts from

00:04:23.440 --> 00:04:28.230
some other directory service like AD,
where we don't have the built-in

00:04:28.340 --> 00:04:32.400
managed client functionality
that we have with Open Directory.

00:04:32.400 --> 00:04:37.570
The other thing that people want to
do is they want to use OS X Server,

00:04:37.570 --> 00:04:41.450
and they want to provide extra
services to these users from

00:04:41.570 --> 00:04:42.400
the other directory service.

00:04:42.480 --> 00:04:45.640
And sometimes these services
actually require per-user

00:04:45.640 --> 00:04:49.400
configuration that actually
needs to live in the user record.

00:04:49.400 --> 00:04:52.730
So you need a way to do this.

00:04:53.800 --> 00:04:57.240
And so we've always had
a couple of solutions.

00:04:57.260 --> 00:05:00.820
And the first one was
just schema extension.

00:05:01.100 --> 00:05:03.520
You need a place to
store some information,

00:05:03.650 --> 00:05:07.940
so let's add some attributes,
let's add some object classes,

00:05:08.010 --> 00:05:11.010
and then we can go ahead and
store the information there.

00:05:11.390 --> 00:05:16.900
The second method that people have
started using is something called the

00:05:16.900 --> 00:05:19.640
Magic Triangle or the Golden Triangle.

00:05:19.750 --> 00:05:21.640
And these are two things that
have been out there and they've

00:05:21.640 --> 00:05:22.430
been around for a while.

00:05:22.500 --> 00:05:25.160
How many people are using
one or both of these--Schema

00:05:25.160 --> 00:05:26.930
Extension or Magic Triangle?

00:05:27.020 --> 00:05:28.860
So a lot of you are pretty
familiar with this already,

00:05:28.860 --> 00:05:30.550
even if you're not using it.

00:05:30.720 --> 00:05:34.230
So we're not going to talk real
in-depth about these because there's

00:05:34.330 --> 00:05:36.060
actually lots of you using it already.

00:05:36.060 --> 00:05:39.120
There's good documentation
out there on this.

00:05:39.180 --> 00:05:42.750
What we're going to spend most of our
time talking about here is the new

00:05:43.370 --> 00:05:48.880
way of extending Directory Services,
which is augmented records.

00:05:48.980 --> 00:05:52.700
But we're going to start by just
going quickly through Schema

00:05:52.700 --> 00:05:56.140
Extension and Magic Triangle so
that you can then understand what

00:05:56.140 --> 00:05:58.140
augmented records do for you.

00:05:58.490 --> 00:06:00.400
So we're going to start
with Schema Extension.

00:06:00.600 --> 00:06:04.400
This was the first method of
Directory Services extending

00:06:04.400 --> 00:06:05.400
that people did.

00:06:05.400 --> 00:06:11.400
They went ahead and they went and added
extra object classes that Apple uses,

00:06:11.400 --> 00:06:14.400
put them in Active Directory or
their other Directory server,

00:06:14.610 --> 00:06:16.980
and then they could just go
ahead and store all their

00:06:16.980 --> 00:06:18.350
information in Active Directory.

00:06:18.480 --> 00:06:21.400
And this is pretty great because
all of your Directory data

00:06:21.400 --> 00:06:23.250
is stored in one place.

00:06:23.400 --> 00:06:26.760
You can continue to leverage
your existing Directory service.

00:06:27.400 --> 00:06:30.670
So if you've got Active Directory and
you've got all of your domain

00:06:30.670 --> 00:06:33.400
controllers set up and they're
replicating all over the place,

00:06:33.400 --> 00:06:35.360
you can just leverage all of that.

00:06:35.400 --> 00:06:37.400
You don't have to duplicate anything.

00:06:37.400 --> 00:06:39.400
All of your data is still
stored in one place.

00:06:39.400 --> 00:06:41.260
When you back that up,
you're backing up all

00:06:41.260 --> 00:06:42.400
of your data together.

00:06:43.400 --> 00:06:45.900
So that's pretty cool,
and the nice thing is that you don't

00:06:45.900 --> 00:06:50.580
actually lose the ability to use
things like Workgroup Manager and all

00:06:50.580 --> 00:06:52.600
of the Mac-like ways of managing this.

00:06:52.700 --> 00:06:55.550
Once you've extended the schema,
you can use Workgroup Manager to set your

00:06:55.550 --> 00:06:58.520
managed client preferences and so on.

00:06:58.590 --> 00:07:03.610
And it's not too hard to do if you
have a set of scripts so that you don't

00:07:03.710 --> 00:07:08.560
have to type every single OID number,
which are numbers about this long.

00:07:08.630 --> 00:07:13.560
And we actually have these scripts,
and if you talk to your SE for

00:07:13.560 --> 00:07:17.140
your account or you talk to
Apple Professional Services,

00:07:17.210 --> 00:07:19.860
they can provide you with these scripts,
or Apple Professional Services can

00:07:19.860 --> 00:07:22.380
actually come out to your
site and do it for you.

00:07:22.470 --> 00:07:25.450
So literally,
it comes down to almost just

00:07:25.480 --> 00:07:29.890
a double-click in terms of
actual work required to do this.

00:07:30.960 --> 00:07:33.660
So if this is so great, well,
why doesn't everybody do it?

00:07:33.660 --> 00:07:38.540
Well, the first problem is that
you're modifying the schema.

00:07:38.590 --> 00:07:40.890
And this is a forest-wide change.

00:07:41.050 --> 00:07:45.900
And so you need enterprise admin
rights in Active Directory to do this.

00:07:45.900 --> 00:07:51.290
Which means not only do you need the
actual enterprise admin to do it,

00:07:51.290 --> 00:07:54.600
but you also need their
agreement to do it.

00:07:54.990 --> 00:07:58.900
And sometimes this is more of a
political issue than a technical issue.

00:07:59.300 --> 00:08:03.610
Because for some reason,
your general Active Directory admin

00:08:03.860 --> 00:08:07.900
may not want to just say,
"Oh, I've got these scripts.

00:08:07.900 --> 00:08:10.870
Will you just run them for me
on your domain controller?"

00:08:11.010 --> 00:08:12.900
They don't seem to like that idea.

00:08:13.220 --> 00:08:15.900
And so they want to look at them.

00:08:15.900 --> 00:08:17.900
And so this can take some time.

00:08:17.900 --> 00:08:21.900
A lot of you have pretty lengthy
approval processes for making

00:08:21.900 --> 00:08:23.810
anything that's a forest-wide change.

00:08:23.900 --> 00:08:27.840
And in some cases, the answer is,
for just about anything, no.

00:08:28.050 --> 00:08:31.880
We're not going to mess with
the schema in Active Directory.

00:08:32.020 --> 00:08:35.620
Also, in Windows 2000,
the original version of Active Directory,

00:08:35.720 --> 00:08:38.310
this was a little scarier
because you couldn't back out

00:08:38.310 --> 00:08:39.850
any of your schema changes.

00:08:39.900 --> 00:08:43.840
You can actually do that now,
but that misconception still exists

00:08:43.840 --> 00:08:47.900
out there that once you put in a
schema change in Active Directory,

00:08:47.900 --> 00:08:48.890
it's permanent.

00:08:49.000 --> 00:08:51.600
You can't get out of it.

00:08:52.180 --> 00:08:57.900
The other problem here is that even
once you have the schema extended,

00:08:57.920 --> 00:09:00.840
to actually store this
information in Active Directory,

00:09:00.880 --> 00:09:03.490
you still need admin
rights to Active Directory.

00:09:03.650 --> 00:09:06.630
And in a lot of cases,
just the way in which your

00:09:06.750 --> 00:09:11.270
IT departments are structured,
your Mac guys are over here,

00:09:11.430 --> 00:09:14.300
your Windows guys and your
Active Directory guys are over here,

00:09:14.390 --> 00:09:18.900
and your Mac guys don't have
admin rights to Active Directory,

00:09:18.990 --> 00:09:22.830
and so the Mac guys who would normally
be the people putting in the managed

00:09:23.180 --> 00:09:27.620
preferences and stuff like that,
they don't have admin rights to

00:09:27.620 --> 00:09:31.780
Active Directory to do this and
may not be able to get them.

00:09:31.890 --> 00:09:36.150
So again, it comes down to essentially
maybe more of a political

00:09:36.580 --> 00:09:38.840
problem than a technical issue.

00:09:39.320 --> 00:09:41.920
So to get around this,
people came up with a strategy

00:09:41.970 --> 00:09:44.440
called the Magic Triangle.

00:09:44.920 --> 00:09:47.060
And what the magic triangle is,
essentially,

00:09:47.060 --> 00:09:52.740
is a setup where you have a Mac server,
a Mac client, and Active Directory,

00:09:52.740 --> 00:09:56.540
and they're bound together such that

00:09:57.990 --> 00:10:03.530
You have a server which is bound
first to AD and then to itself

00:10:03.680 --> 00:10:05.130
as an Open Directory master.

00:10:05.560 --> 00:10:08.580
And what you want to do here is you
want to actually bind to AD first,

00:10:08.760 --> 00:10:11.020
then create your Open Directory master.

00:10:11.180 --> 00:10:13.380
The Open Directory process
will recognize that,

00:10:13.420 --> 00:10:14.610
"Oh, hey, you're bound to AD.

00:10:14.630 --> 00:10:16.180
We've got a KDC over there.

00:10:16.490 --> 00:10:20.910
We don't need to bring up our
own KDC." So that is normal

00:10:21.070 --> 00:10:23.300
to not see the KDC running.

00:10:23.950 --> 00:10:26.310
And then after you bind to AD,
you're going to want to kerberize

00:10:26.310 --> 00:10:31.980
your services for Active Directory,
so you would run dsconfigad-enablesso.

00:10:32.070 --> 00:10:36.680
So you've got the server bound
to AD and bound to the client,

00:10:36.750 --> 00:10:42.220
and then you have the client that is
bound to AD and to Open Directory,

00:10:42.220 --> 00:10:45.460
and so you get this lovely
little triangle shape.

00:10:47.340 --> 00:10:51.020
Once you have this set up
with your clients bound to

00:10:51.020 --> 00:10:54.900
Active Directory and Open Directory and
your Open Directory server set up,

00:10:54.980 --> 00:10:57.140
the actual management is pretty simple.

00:10:57.270 --> 00:11:00.160
You just create Open Directory groups,
you put some managed

00:11:00.290 --> 00:11:02.520
client preferences on them,
and then you can add

00:11:02.530 --> 00:11:05.420
Active Directory users or
Active Directory groups into

00:11:05.420 --> 00:11:07.060
this Open Directory group.

00:11:07.230 --> 00:11:09.610
And then when the user logs
in on one of these clients,

00:11:09.610 --> 00:11:12.260
as long as they're bound
to both Directory services,

00:11:12.440 --> 00:11:15.770
they'll get whatever's been applied
to the Open Directory group.

00:11:18.140 --> 00:11:22.690
So the great thing about the
Magic Triangle is you don't need any

00:11:22.690 --> 00:11:24.340
help from your Active Directory admin.

00:11:24.340 --> 00:11:28.100
As long as you can bind
machines to Active Directory,

00:11:28.340 --> 00:11:30.590
they don't need to do
anything special for you.

00:11:30.820 --> 00:11:36.090
So your AD admins really
love this configuration.

00:11:36.250 --> 00:11:39.600
The other thing is that it gives you the
majority of what everybody wants here.

00:11:39.840 --> 00:11:45.750
You can manage your client
with per computer or computer

00:11:45.750 --> 00:11:50.650
lists or computer groups,
and you can do group-based

00:11:50.670 --> 00:11:52.600
management for users.

00:11:52.790 --> 00:11:55.350
And most of the time,
for client management stuff,

00:11:55.410 --> 00:11:57.970
you don't want to manage
each user individually,

00:11:58.020 --> 00:12:00.600
so that's really not an issue.

00:12:00.600 --> 00:12:04.590
The problem here is that
if you do need to do that,

00:12:04.590 --> 00:12:07.600
or you have some service
that you want to run,

00:12:07.600 --> 00:12:11.100
like, for example, the new collaboration,
you can run the collaboration

00:12:11.100 --> 00:12:13.600
services in Leopard,
iCal Server, or the Wiki Server.

00:12:13.750 --> 00:12:18.140
You actually can't run those with
AD users because there's some extra

00:12:18.200 --> 00:12:22.600
information that needs to be in that user
record that they're not going to have.

00:12:22.600 --> 00:12:25.780
And you can't edit because
you're not adding anything

00:12:26.430 --> 00:12:28.570
back into Active Directory.

00:12:28.720 --> 00:12:33.490
So we need a solution
that solves this problem.

00:12:34.400 --> 00:12:41.700
And what we came up with for Leopard
was this idea of augmented records.

00:12:41.800 --> 00:12:46.650
And really, augmented records is not
some totally new thing.

00:12:47.810 --> 00:12:53.880
It's basically here as some way to
give you a way to create pieces of

00:12:53.880 --> 00:12:58.050
information that need to be stored
in a record without having to write

00:12:58.050 --> 00:13:00.040
back to this other directory server.

00:13:00.040 --> 00:13:02.790
So primarily,
the two services that you think of with

00:13:02.900 --> 00:13:06.190
this are iCal Server and Wiki Server.

00:13:06.800 --> 00:13:10.960
And this is really Magic Triangle Plus.

00:13:10.980 --> 00:13:16.470
Now, you may have heard somebody--by
which I mean Joel--call this

00:13:16.650 --> 00:13:19.080
the Cylinder of Destiny.

00:13:21.160 --> 00:13:25.730
We're not going to use silly
things like that because,

00:13:25.900 --> 00:13:29.670
you know,
if we were going to go Magic Triangle

00:13:29.670 --> 00:13:32.140
into another dimension,
it should be like a pyramid or something,

00:13:32.140 --> 00:13:33.740
but I don't know.

00:13:34.360 --> 00:13:37.540
So the Magic Triangle Plus

00:13:38.500 --> 00:13:42.770
And what it lets you do is essentially
tag some record from some other directory

00:13:42.880 --> 00:13:46.170
service--Active Directory or another
Open Directory server or something like

00:13:46.170 --> 00:13:48.450
that--and add some information to it.

00:13:48.530 --> 00:13:51.500
But you're not writing it back
into the other directory server.

00:13:51.500 --> 00:13:53.990
You're storing it on your
Open Directory server.

00:13:54.000 --> 00:13:57.740
It's kind of like you're adding
like a sticky note to something.

00:13:57.740 --> 00:14:01.840
You're not actually changing something.

00:14:01.840 --> 00:14:02.690
You're just saying, "Oh,
I got some more information about this."

00:14:03.460 --> 00:14:05.850
And then the magic happens
in the search node,

00:14:05.850 --> 00:14:08.240
which actually takes the
information from the other service,

00:14:08.240 --> 00:14:11.150
like Active Directory,
and the information from

00:14:11.150 --> 00:14:14.400
your Open Directory server,
and brings the two together,

00:14:14.550 --> 00:14:17.180
makes it look like one big record,
as long as you go

00:14:17.200 --> 00:14:18.640
through the search node.

00:14:18.810 --> 00:14:21.160
And the services that
are querying for it,

00:14:21.220 --> 00:14:24.640
they don't even know that
augmented records are in play.

00:14:24.720 --> 00:14:29.950
They just query the search node and
magically all the information is there.

00:14:31.160 --> 00:14:37.000
The new bit about this is that
originally when we shipped Leopard,

00:14:37.000 --> 00:14:40.490
the only way that you got
augments through the GUI without

00:14:40.580 --> 00:14:46.040
doing things manually yourself
was using the workgroup config.

00:14:46.160 --> 00:14:49.460
And we've actually
expanded that as of 10.5.3,

00:14:49.460 --> 00:14:51.350
which shipped a few weeks ago.

00:14:51.540 --> 00:14:55.500
We now support augmented
records in Workgroup Manager in

00:14:55.500 --> 00:14:58.040
Advanced Server Mode.

00:15:02.780 --> 00:15:07.700
So we're giving you a little more
flexibility about how you can use these.

00:15:07.760 --> 00:15:10.670
There are a few caveats here.

00:15:11.020 --> 00:15:15.600
One is if you have an
augmented value for a record,

00:15:15.630 --> 00:15:18.840
you can't search on that
because that's not actually

00:15:18.950 --> 00:15:21.200
in the directory that it's in.

00:15:21.270 --> 00:15:24.200
And searching for everything
through the search node for

00:15:24.200 --> 00:15:27.910
this was pretty expensive,
so right now we do not support

00:15:27.910 --> 00:15:30.400
search on augmented values.

00:15:30.460 --> 00:15:31.760
It only works with the search node.

00:15:31.850 --> 00:15:35.730
So if you have some application
or some service that is not using

00:15:35.730 --> 00:15:38.850
the search node for some reason,
if it's going and talking

00:15:38.850 --> 00:15:42.490
directly to the other server,
it's not going to see

00:15:42.490 --> 00:15:44.200
the augmented records.

00:15:44.200 --> 00:15:48.100
And so if you're writing applications
where you might want to let people

00:15:48.100 --> 00:15:51.100
take advantage of augmented records,
make sure that you're going through

00:15:51.100 --> 00:15:54.300
the search node in Directory Services.

00:15:54.310 --> 00:15:59.350
The other thing here is that you cannot
use this to replace an existing value.

00:15:59.480 --> 00:16:04.100
So if there's already a
value for some record,

00:16:04.100 --> 00:16:08.060
say somebody already has their
phone number in the directory,

00:16:08.220 --> 00:16:11.500
you can't give them a
different phone number.

00:16:11.710 --> 00:16:14.280
You can only give them, for example,
a new phone number.

00:16:14.330 --> 00:16:16.200
You can't overwrite.

00:16:16.370 --> 00:16:19.100
The idea here is we don't want
to replace existing values,

00:16:19.100 --> 00:16:23.010
just give you an opportunity
to put more data in.

00:16:24.180 --> 00:16:26.900
So let's just take a quick look at
what this looks like conceptually.

00:16:26.900 --> 00:16:31.700
If we have an Active Directory server
and we have our Open Directory server,

00:16:31.700 --> 00:16:34.100
and in Active Directory we
have a few user records,

00:16:34.300 --> 00:16:38.290
and we have Scott and Henry and Nicole,
and I want to use some services

00:16:38.450 --> 00:16:40.630
on an Open Directory server.

00:16:40.740 --> 00:16:44.310
So we go ahead,
we can create this augmented record

00:16:44.780 --> 00:16:48.210
either using Server Preferences
or Workgroup Manager,

00:16:48.210 --> 00:16:51.280
and we add some information
for the augmented,

00:16:51.380 --> 00:16:54.100
so that's going to be used
for iCal and Wikiserver.

00:16:54.100 --> 00:16:59.100
And this actually gets created as
an augment record in Open Directory.

00:16:59.100 --> 00:17:02.100
We haven't changed anything
back in Active Directory.

00:17:02.100 --> 00:17:05.040
So now what happens when things
actually use Directory Service,

00:17:05.100 --> 00:17:10.100
we query for Nicole and
we query the AD node.

00:17:10.100 --> 00:17:14.100
What we're going to get back is
just the information that's in AD,

00:17:14.100 --> 00:17:15.950
no augmented information.

00:17:16.120 --> 00:17:20.830
If we search the LDAP node,
the Open Directory node, for Nicole,

00:17:20.880 --> 00:17:23.100
we're going to get no such user.

00:17:23.650 --> 00:17:24.100
Because, we're going to get a new user.

00:17:24.100 --> 00:17:28.620
And this is because there's not actually
a user record for me in Open Directory,

00:17:28.680 --> 00:17:31.040
there's just an augment information.

00:17:31.100 --> 00:17:34.050
So it's an augment record,
not a user record,

00:17:34.080 --> 00:17:38.720
without the actual user record,
it doesn't actually mean anything.

00:17:38.990 --> 00:17:42.100
Then the magic all happens if
you go through the search node.

00:17:42.100 --> 00:17:46.070
Directory Services says, "Oh, hey,
I know I've got augmented records here.

00:17:46.180 --> 00:17:49.950
I better go check and see if there's
any extra information." And what it will

00:17:50.090 --> 00:17:54.140
actually return is a record for me with
all of my information from both nodes.

00:17:54.140 --> 00:17:58.140
So my Active Directory information,
my Wiki server, my iCal Server,

00:17:58.140 --> 00:18:00.970
all my augmented information.

00:18:03.580 --> 00:18:08.620
In the GUI, what this looks like,
if you're in workgroup mode,

00:18:08.800 --> 00:18:10.690
you actually use server preferences.

00:18:10.830 --> 00:18:13.040
It's called importing a user.

00:18:13.280 --> 00:18:17.240
That basically just means create
an augment record for the user.

00:18:17.350 --> 00:18:18.210
You can bring them in.

00:18:18.250 --> 00:18:20.860
You can add some information for them.

00:18:21.020 --> 00:18:27.170
And now, as of 10.5.3,
you can do this also in advanced mode.

00:18:27.690 --> 00:18:30.260
And you use Work Group Manager.

00:18:30.330 --> 00:18:34.800
There's a new menu item for
Create Augmented User Record.

00:18:34.880 --> 00:18:38.130
So you can search for your user,
or you can search for a group full

00:18:38.130 --> 00:18:41.100
of users that you want to augment.

00:18:42.900 --> 00:18:47.110
And the best practices here
are basically the same as what

00:18:47.190 --> 00:18:49.040
you have for Magic Triangle.

00:18:49.040 --> 00:18:50.900
Because this is not
some totally new config,

00:18:50.900 --> 00:18:52.900
this is Magic Triangle Plus.

00:18:53.010 --> 00:18:55.500
So you're going to bind to AD first,
then you're going to

00:18:55.670 --> 00:18:56.790
create your OD Master.

00:18:56.950 --> 00:18:59.900
You won't have a KDC running
on the OD Master.

00:18:59.900 --> 00:19:02.900
You still want to
Kerberize your services.

00:19:03.010 --> 00:19:06.230
One thing to look out for here is,
especially if you've already

00:19:06.230 --> 00:19:08.750
got this Magic Triangle set up,
and then you go and you

00:19:08.750 --> 00:19:11.160
create these augment records,
until you restart

00:19:11.160 --> 00:19:15.360
Directory Service on these clients,
if they've been bound already and then

00:19:15.360 --> 00:19:20.440
you just go create the augment records,
until you restart Directory Service,

00:19:20.440 --> 00:19:23.900
the clients will not see
the augment information.

00:19:24.000 --> 00:19:27.900
So after that first time when
you create the augment records,

00:19:28.060 --> 00:19:31.250
you're going to need a reboot
of clients or you just need

00:19:31.250 --> 00:19:33.980
to restart Directory Service,
which you can do with

00:19:34.130 --> 00:19:36.450
pseudo-kill-all Directory Service.

00:19:39.210 --> 00:19:42.220
So now let's talk a little
bit more in depth here,

00:19:42.300 --> 00:19:45.540
because we've done some nice
pretty pictures and everything.

00:19:45.630 --> 00:19:47.600
How does this all actually work?

00:19:47.690 --> 00:19:52.230
Well, what we have is there's actually a
record called Augment Configuration

00:19:52.640 --> 00:19:56.060
that lives in the config
container in Open Directory.

00:19:56.130 --> 00:19:59.720
And it contains information
about the Augment node,

00:19:59.780 --> 00:20:02.900
which is the node that is going
to store the Augment information,

00:20:02.900 --> 00:20:04.490
in other words, Open Directory.

00:20:04.770 --> 00:20:07.830
The Augmented node,
which is the other node,

00:20:07.830 --> 00:20:11.500
so Active Directory or
some other foreign server.

00:20:11.560 --> 00:20:13.250
And then the Augmented attributes.

00:20:13.400 --> 00:20:17.120
So for every record type--and
you can use Augmented records,

00:20:17.230 --> 00:20:19.940
by the way, for records other than users.

00:20:19.990 --> 00:20:22.760
Right now, mostly that's what
people are using it for,

00:20:22.760 --> 00:20:25.340
but there's no reason
it's restricted to this.

00:20:25.380 --> 00:20:30.140
But you actually need to, in here,
configure which attributes you can

00:20:30.140 --> 00:20:32.920
augment for particular record types.

00:20:33.280 --> 00:20:36.400
And what this actually looks like is,
not terribly surprisingly,

00:20:36.400 --> 00:20:38.700
it's an XML plist.

00:20:38.780 --> 00:20:42.130
And you can see in this,
you can see the directories that we have

00:20:42.330 --> 00:20:45.040
for the Augment Directory Node Name.

00:20:45.080 --> 00:20:49.960
That's the directory that we
are storing the OD information,

00:20:49.960 --> 00:20:51.320
the augments.

00:20:51.580 --> 00:20:57.060
The Augmented Directory Node Name is
the directory that we are augmenting,

00:20:57.060 --> 00:20:59.200
in this case Active Directory.

00:20:59.300 --> 00:21:04.510
And in this case, and by default,
the only attribute that we have set

00:21:04.510 --> 00:21:10.410
up for you to augment is the services
locator attribute on the user records.

00:21:10.530 --> 00:21:13.780
Once you have this set up,
you have augmented records in play.

00:21:13.780 --> 00:21:17.320
Directory Services knows to
look for augmented records.

00:21:17.390 --> 00:21:20.200
And you can go ahead and
create augment records.

00:21:20.370 --> 00:21:23.460
These are stored in your LDAP Node,
your Open Directory Node,

00:21:23.510 --> 00:21:25.760
under the Augments container.

00:21:25.830 --> 00:21:29.200
And they are stored in a record
name format of record_data.

00:21:29.290 --> 00:21:32.540
And you can type: record_name.

00:21:32.650 --> 00:21:37.440
So if it's a record for me,
it would be users: Nicole.

00:21:37.520 --> 00:21:41.520
So if you were to use DSCL and take a
look inside your Augments container,

00:21:41.520 --> 00:21:44.430
you might see a bunch
of records like this.

00:21:45.960 --> 00:21:51.430
If you read one of these records,
what you see is not all of the

00:21:51.430 --> 00:21:59.910
information from Active Directory,
because we're not trying to

00:21:59.910 --> 00:21:59.910
copy all of this information,
just the information that we

00:21:59.910 --> 00:21:59.910
want to add to the record.

00:22:00.880 --> 00:22:04.470
And the main reason that people
are augmenting things is for

00:22:04.470 --> 00:22:07.190
the iCal and Wiki Server.

00:22:07.390 --> 00:22:12.030
So what they actually require is this
attribute called Services Locator,

00:22:12.030 --> 00:22:14.140
which looks like this.

00:22:15.140 --> 00:22:19.680
That's the main thing that people
are currently using Augments for.

00:22:19.690 --> 00:22:23.310
We're going to talk about some
other ways you can use Augments.

00:22:23.750 --> 00:22:26.610
But what Augments gives you the ability
to do is you have this centralized

00:22:26.610 --> 00:22:30.390
directory server and you might have
a couple different departments and each

00:22:30.460 --> 00:22:34.140
department wants their own Wiki server
and they want their own iCal server.

00:22:34.240 --> 00:22:36.340
So they can go ahead,
they can set these up,

00:22:36.410 --> 00:22:39.620
they can pull in users from AD,
they can augment them,

00:22:39.680 --> 00:22:43.780
they don't need any help
from the AD administrator.

00:22:43.840 --> 00:22:45.900
Everything's great.

00:22:47.230 --> 00:22:50.580
But I want to give you a little bit
more complicated of an example of

00:22:50.700 --> 00:22:52.830
how you might use augmented records.

00:22:52.980 --> 00:22:55.310
So let's say that one
of your departments,

00:22:55.520 --> 00:22:59.290
say maybe your art department,
where you have users that they

00:22:59.290 --> 00:23:01.080
need a lot of disk storage.

00:23:01.080 --> 00:23:06.710
And in Active Directory,

00:23:08.050 --> 00:23:12.590
You probably have some home directory
already given to all of your users

00:23:13.020 --> 00:23:14.700
that your AD admins have assigned.

00:23:14.700 --> 00:23:18.820
It's stored somewhere centrally,
but a lot of times it's not real big.

00:23:18.960 --> 00:23:21.530
Maybe they only give them
a couple hundred megabytes.

00:23:21.690 --> 00:23:27.860
And this art department goes out,
buys a nice brand-new Promise RAID,

00:23:28.200 --> 00:23:32.360
connects it to their XServe, and says,
"I want to use this for my users,

00:23:32.360 --> 00:23:36.920
and I want them to get it for
their home directory." Well...

00:23:37.680 --> 00:23:42.500
How do you do that without, for example,
having to go back and

00:23:42.500 --> 00:23:44.480
edit Active Directory?

00:23:44.480 --> 00:23:46.430
Hmm.

00:23:46.580 --> 00:23:50.040
Well,
you can use augmented records to do this,

00:23:50.130 --> 00:23:51.740
and here's how.

00:23:52.650 --> 00:23:54.260
First thing you need
to do--and by the way,

00:23:54.260 --> 00:23:57.240
all of these steps are in
the session notes for you,

00:23:57.360 --> 00:24:02.500
so you don't have to worry too much about
trying to scribble too much down here.

00:24:02.750 --> 00:24:05.500
First thing you need to do and the
first thing you're going to say is,

00:24:05.500 --> 00:24:06.500
"Wait a minute.

00:24:06.500 --> 00:24:09.990
A few slides ago,
you said we can't actually replace

00:24:10.050 --> 00:24:16.450
a value that's already there." Well,
that's true, but in the AD plugin,

00:24:16.580 --> 00:24:22.500
you can actually disable reading the home
directory path from Active Directory.

00:24:22.500 --> 00:24:26.610
So if we're not reading it,
it's not there.

00:24:26.920 --> 00:24:29.900
So you just disable the use
UNC path from Active Directory.

00:24:30.000 --> 00:24:33.300
You can do it either in
the GUI or with DSConfigAD.

00:24:33.400 --> 00:24:35.740
So now there's essentially,
as far as Directory Services is

00:24:35.890 --> 00:24:38.190
concerned,
there's no home directory.

00:24:38.190 --> 00:24:39.910
So we can augment it.

00:24:41.190 --> 00:24:44.860
So the next thing you want to do is
set up your Magic Triangle config,

00:24:44.900 --> 00:24:46.540
same way you normally would.

00:24:46.660 --> 00:24:48.540
And because we're going to do
home directories here the way

00:24:48.540 --> 00:24:51.620
we've always done them with OS X,
you need a mount record in

00:24:51.620 --> 00:24:55.340
Open Directory for the SharePoint that's
going to have the home directories.

00:24:55.510 --> 00:24:57.800
So create your mount record.

00:24:59.000 --> 00:25:02.170
Then go ahead, and I'm going to show you
the manual way to do this.

00:25:02.480 --> 00:25:04.400
Now, if you were going to do
this for lots of users,

00:25:04.440 --> 00:25:07.470
you'd want to, of course, script this,
but once you know where

00:25:07.510 --> 00:25:09.900
all the pieces are,
it's not so hard to do.

00:25:09.950 --> 00:25:12.400
So you want to go ahead,
augment a user in Workgroup Manager.

00:25:12.400 --> 00:25:15.400
This will actually create
your augment config record,

00:25:15.470 --> 00:25:18.900
and it will also create an
augmented record for the user

00:25:18.900 --> 00:25:21.350
that you're working with.

00:25:22.730 --> 00:25:26.170
And then because we're going to
be augmenting attributes that

00:25:26.290 --> 00:25:30.200
aren't normally in the default
config for what you can augment,

00:25:30.250 --> 00:25:33.200
we're going to go ahead,
we're going to edit the augment config

00:25:34.180 --> 00:25:36.820
record in the augment container,
and we're going to say, okay,

00:25:36.820 --> 00:25:42.000
for the user's record type,
in addition to services locator,

00:25:42.000 --> 00:25:46.980
we want to be able to augment home
directory and NFS home directory,

00:25:46.980 --> 00:25:49.900
which if you guys are all
familiar with directory services,

00:25:49.900 --> 00:25:52.680
those are the standard attributes
that store home directory information.

00:25:52.700 --> 00:25:56.870
So we do that.

00:25:57.920 --> 00:26:01.530
And then you can go ahead
and in Inspector Mode,

00:26:01.530 --> 00:26:04.430
or you could do it with
DSCL or whatever tool you like,

00:26:04.430 --> 00:26:07.620
you're going to actually go
ahead and just add these two

00:26:07.620 --> 00:26:09.900
attributes to the augment record.

00:26:09.900 --> 00:26:12.900
So you're going to add
Apple User Home URL,

00:26:13.280 --> 00:26:19.540
which is the home directory attribute,
and home directory, which is actually the

00:26:19.710 --> 00:26:21.890
NFS home directory attribute.

00:26:22.330 --> 00:26:24.770
And these are going to contain
the standard information that you

00:26:24.770 --> 00:26:26.200
have for OS X home directories.

00:26:26.200 --> 00:26:31.050
So you'll have the sort of XML-looking,
like, home directory path that tells

00:26:31.050 --> 00:26:32.530
you where it is on the network.

00:26:32.630 --> 00:26:36.170
And then for NFS home directory,
you'll have the Unix file path to

00:26:36.420 --> 00:26:40.690
where the home directory is once
it's been mounted on the client.

00:26:41.340 --> 00:26:45.880
So once you've done all of this,
you need to restart Directory Service,

00:26:45.930 --> 00:26:48.200
and then you can go
ahead and on the client,

00:26:48.550 --> 00:26:51.390
log in,
and it will see all of this information

00:26:51.390 --> 00:26:53.530
as the user's home directory.

00:26:53.860 --> 00:26:58.230
And it'll mount it in whatever fashion,
like network home directories or

00:26:58.290 --> 00:27:01.960
mobile accounts or so on that you want.

00:27:02.090 --> 00:27:06.340
So this is just to give you a slightly
more complex example of how you might put

00:27:06.340 --> 00:27:12.090
this into play in your own infrastructure
to solve particular problems.

00:27:12.310 --> 00:27:14.620
You could also use this if
you have your own custom apps,

00:27:14.870 --> 00:27:18.700
for example, that you don't want to write
stuff back to Active Directory.

00:27:18.790 --> 00:27:22.740
You could store it locally or
just to solve any other problems

00:27:23.100 --> 00:27:27.920
with Directory Service that might
have this kind of a problem.

00:27:30.890 --> 00:27:34.130
So now that we've talked about
extending Directory Services,

00:27:34.160 --> 00:27:37.510
we're going to talk about how you
troubleshoot Directory Services because

00:27:38.420 --> 00:27:42.270
sometimes things don't
quite go the way you expect.

00:27:42.470 --> 00:27:45.130
You might have experienced that.

00:27:45.660 --> 00:27:47.600
And the first thing,
because we're going to focus here

00:27:47.600 --> 00:27:51.720
mostly on stuff new in Leopard,
but we always, always,

00:27:51.720 --> 00:27:54.510
always--we've got to talk about
Directory Service debugging,

00:27:54.750 --> 00:27:54.890
right?

00:27:54.900 --> 00:27:57.640
We've got to talk about
how you get that debug log.

00:27:57.850 --> 00:28:00.940
And the basic stuff here has not changed.

00:28:01.190 --> 00:28:05.200
You still get debugging
turned on by sending the USR1

00:28:05.200 --> 00:28:07.660
signal to Directory Services.

00:28:07.870 --> 00:28:10.900
You can do a pseudo kill-all
USR1 Directory Service.

00:28:10.970 --> 00:28:15.600
That turns it on until the next
restart of Directory Service.

00:28:15.950 --> 00:28:19.610
And sometimes that works out,
but if you've got Directory Service,

00:28:19.610 --> 00:28:23.020
for example, crashing a lot or you're
going to be doing a lot of

00:28:23.020 --> 00:28:26.020
rebooting and stuff like that,
it's kind of tedious to

00:28:26.020 --> 00:28:29.400
have to keep going in and
turning on Directory Service.

00:28:29.400 --> 00:28:33.790
Or maybe you want debugging on right away
from boot if it's a boot time problem.

00:28:33.930 --> 00:28:39.500
So then you can actually create a
flag file which is .dslogdebugatstart.

00:28:39.500 --> 00:28:43.400
And this has to live in library
preferences Directory Service.

00:28:43.410 --> 00:28:45.800
You can use the touch
command to create this.

00:28:45.920 --> 00:28:48.560
This will turn
Directory Service debugging on as

00:28:48.560 --> 00:28:50.580
soon as Directory Service comes up.

00:28:50.800 --> 00:28:54.140
And as always,
the logs file is still in library logs,

00:28:54.140 --> 00:28:58.800
directory service,
directoryservice.debug.log.

00:28:58.800 --> 00:29:00.760
And we actually roll these
logs so you don't have to worry

00:29:00.870 --> 00:29:04.790
about these logs growing to be
gigabytes and gigabytes in size.

00:29:04.800 --> 00:29:07.570
We'll just roll them after a
couple of megs and so you'll see

00:29:07.570 --> 00:29:10.800
directoryservice.debug.log.1,
.2 and so on.

00:29:10.800 --> 00:29:15.750
And you don't have to worry about leaving
this on for an extended period of time.

00:29:15.950 --> 00:29:18.800
You won't end up filling
up your hard drive.

00:29:19.240 --> 00:29:21.520
But what is new here?

00:29:22.040 --> 00:29:26.190
is that we have added debugging
levels to Directory Service debugging

00:29:26.610 --> 00:29:29.900
because we actually put a lot
of information in the debug log.

00:29:30.160 --> 00:29:34.740
And sometimes it's too much
and sometimes it's not enough.

00:29:34.740 --> 00:29:37.740
So now we're gonna let you actually
kind of control that a little bit.

00:29:37.900 --> 00:29:42.180
So the levels are 0 through 7,
with 0 being off.

00:29:42.380 --> 00:29:47.540
The default when you turn on
Directory Service debugging is set to 5.

00:29:47.730 --> 00:29:51.540
This is all stored in the
DirectoryServiceDebug.plist file,

00:29:51.590 --> 00:29:54.140
which is in Library Preferences
Directory Service.

00:29:54.260 --> 00:29:57.290
So you could edit that file yourself,
or you could use the defaults

00:29:57.290 --> 00:30:00.160
command to read and write it.

00:30:00.370 --> 00:30:03.520
You will need to restart
Directory Services after you change

00:30:03.520 --> 00:30:06.360
this in order for it to take effect,
though.

00:30:07.750 --> 00:30:10.600
So this is all important if
you're going to be doing some

00:30:10.600 --> 00:30:13.840
troubleshooting or if you're going to
be setting up and filing a bug report.

00:30:13.970 --> 00:30:15.840
One of the first things
I'm sure you all know,

00:30:15.840 --> 00:30:18.660
anybody that's ever talked to
me for troubleshooting help,

00:30:18.780 --> 00:30:21.080
what's the first thing I ask you for?

00:30:21.120 --> 00:30:23.210
It's a debug log.

00:30:26.250 --> 00:30:29.840
The next thing that I want to talk
about is something that a lot of people

00:30:29.840 --> 00:30:33.360
have sort of noticed on their own,

00:30:33.770 --> 00:30:37.200
We never really had
talked about it last year,

00:30:37.200 --> 00:30:38.840
so I want to cover it this year.

00:30:38.840 --> 00:30:43.240
We've changed some of the
Kerberos config files in Leopard.

00:30:43.370 --> 00:30:47.450
And Kerberos, as we all know,
is really important for Leopard,

00:30:47.540 --> 00:30:48.680
for OS X in general.

00:30:48.760 --> 00:30:52.900
Everything we are trying to move
authentication-wise to Kerberos.

00:30:53.130 --> 00:30:56.830
So in Directory Services,
it's really important.

00:30:57.100 --> 00:31:00.370
And if you had, for example,
a Tiger machine and it was bound to

00:31:00.370 --> 00:31:05.330
Open Directory and Active Directory in
this magic triangle configuration,

00:31:05.460 --> 00:31:07.930
if you looked at your
edu.mit.kerberos file,

00:31:07.990 --> 00:31:11.570
which is in library preferences,
you'd see something like this.

00:31:11.700 --> 00:31:17.600
You'd have all this Realm information
and then you have a bunch

00:31:17.600 --> 00:31:17.600
of other sections and--well,

00:31:18.160 --> 00:31:21.040
Everything was just all in this one file.

00:31:21.110 --> 00:31:24.480
And then you upgrade to Leopard.

00:31:24.640 --> 00:31:28.220
You're looking to maybe solve
a problem or you're just poking

00:31:28.220 --> 00:31:29.440
around to see what's new.

00:31:29.500 --> 00:31:31.790
You take a look at this file.

00:31:36.400 --> 00:31:38.740
I'm kind of missing something here.

00:31:38.810 --> 00:31:42.320
Where'd all those realms go?

00:31:42.370 --> 00:31:45.950
The only realm that you'll see
now in the edu.mit.kubaros file

00:31:46.370 --> 00:31:48.620
is the Open Directory realm.

00:31:48.950 --> 00:31:51.670
But we're still--if you're using
the Active Directory plugin,

00:31:51.800 --> 00:31:52.960
we're still using Kerberos.

00:31:53.000 --> 00:31:54.070
We must know about this.

00:31:54.180 --> 00:31:56.300
Where do we put it?

00:31:56.370 --> 00:31:59.600
Well,
the answer is we actually have written

00:31:59.600 --> 00:32:05.100
a plug-in for Kerberos that lets
us store all this information in

00:32:05.100 --> 00:32:07.140
the local Directory Service store.

00:32:07.310 --> 00:32:12.140
So if you look in the config container
of your local Directory Service,

00:32:12.140 --> 00:32:17.610
the DSLocal node, you'll see a bunch of
records that are Kerberos,

00:32:17.810 --> 00:32:20.490
colon, and then your Realm name.

00:32:20.630 --> 00:32:24.650
So all the Realm-specific
stuff has been moved here.

00:32:26.270 --> 00:32:29.470
And if we actually look at one of these,
the information here is basically

00:32:29.470 --> 00:32:33.680
the same stuff that we used
to store in edu.mit.kirbros.

00:32:34.190 --> 00:32:39.340
We've got your KPassword server
and your Kerberos server.

00:32:39.490 --> 00:32:41.800
So if you're actually
looking for any information,

00:32:41.800 --> 00:32:44.900
you want to make sure that the
configuration is correct and so on,

00:32:45.000 --> 00:32:48.800
this is now where you need
to look for that information.

00:32:49.340 --> 00:32:52.370
The other thing that's important
here is if you have a problem and

00:32:52.520 --> 00:32:55.400
you want to talk to us about it,
you want to file a bug

00:32:55.530 --> 00:32:58.920
or something like that,
well,

00:32:59.120 --> 00:33:01.240
That's all information that
we're going to need now.

00:33:01.240 --> 00:33:06.300
So when you're filing a bug report,
which you can do bugreporter.apple.com,

00:33:06.450 --> 00:33:09.040
or if you're talking to AppleCare,

00:33:09.570 --> 00:33:12.500
Make sure that if you have a
problem that you suspect is

00:33:12.620 --> 00:33:16.590
Kerberos/Directory Service related,
make sure you give us not only

00:33:16.890 --> 00:33:20.730
your edu.mit.kerberos file
like you always used to do,

00:33:20.770 --> 00:33:26.340
but also just do a DSCL read-all
of the local node config container

00:33:26.340 --> 00:33:29.560
and give us all that information
because that's actually where

00:33:29.650 --> 00:33:31.500
your Kerberos information is now.

00:33:31.660 --> 00:33:35.500
And as always, just a reminder,
if you have a Directory Service problem,

00:33:35.500 --> 00:33:40.470
pretty much no matter what it is,
if you can give us a debug log,

00:33:40.600 --> 00:33:43.160
that will save us having to
come back to you and say,

00:33:43.160 --> 00:33:45.330
"Please give us a debug log."

00:33:45.780 --> 00:33:46.900
So I thought I'd just remind you.

00:33:47.030 --> 00:33:50.320
I know you all would, of course,
the first thing you would do

00:33:50.320 --> 00:33:53.500
is just get us a debug log,
but just in case.

00:33:55.000 --> 00:34:00.670
So, having talked about that,
some general Directory Service debugging,

00:34:00.740 --> 00:34:04.400
we're going to talk more specifically
about the Active Directory plugin.

00:34:04.440 --> 00:34:08.400
How many people here use
the Active Directory plugin?

00:34:10.050 --> 00:34:12.420
Okay, so pretty popular.

00:34:12.530 --> 00:34:14.920
We've actually made a bunch
of architectural changes in

00:34:14.920 --> 00:34:16.920
Leopard to the AD plugin.

00:34:17.100 --> 00:34:20.640
One of the things we've done is we've
added domain and policy caching.

00:34:20.730 --> 00:34:25.020
This is to try to prevent some delays
when you go on and off your network.

00:34:25.100 --> 00:34:27.920
Before,
we would have to sit and try and query

00:34:27.920 --> 00:34:33.630
and find out this information when you
tried to go on and off the network,

00:34:33.810 --> 00:34:36.500
and if the servers weren't there,
we could wait for a long time.

00:34:36.500 --> 00:34:39.690
So we've just cached
this information now.

00:34:39.800 --> 00:34:43.350
Another thing that we've done is
there's a lot of people that have

00:34:43.770 --> 00:34:47.700
pretty large domains and forests
with lots and lots of domains.

00:34:47.950 --> 00:34:51.670
And previously what we did is
when we bound or every time we

00:34:51.670 --> 00:34:55.060
tried to redo our configuration,
we'd go out and we'd

00:34:55.060 --> 00:34:56.700
query the entire forest.

00:34:56.770 --> 00:34:59.700
Even though you might only be
talking to one domain ever,

00:34:59.700 --> 00:35:02.700
we'd go look everywhere
in the entire forest.

00:35:02.700 --> 00:35:06.130
And that could generate a lot of
traffic if you were binding a lot of

00:35:06.130 --> 00:35:09.010
machines and it could maybe be going
out across some slow links because

00:35:09.180 --> 00:35:12.720
maybe you had some domains that
were only for some isolated places.

00:35:12.800 --> 00:35:14.700
You just didn't want that
extra traffic out there.

00:35:14.700 --> 00:35:17.700
So we've gone to more of
an on-demand configuration.

00:35:17.700 --> 00:35:22.500
We don't put in configuration and query
servers unless we're actually going

00:35:22.500 --> 00:35:25.700
to be using that domain for something.

00:35:25.930 --> 00:35:28.500
We've added dynamic DNS registration.

00:35:28.680 --> 00:35:33.000
So when you bind to AD,
we actually will update the

00:35:33.060 --> 00:35:35.930
dynamic DNS on your AD server.

00:35:36.050 --> 00:35:41.280
The one catch here is that currently
we only do forward DNS for you here.

00:35:41.590 --> 00:35:45.090
The pointer record will not be created.

00:35:45.800 --> 00:35:48.800
And then finally, like I said,
we have taken advantage of

00:35:48.800 --> 00:35:52.060
this new Kerberos plugin,
and we store all of our

00:35:52.060 --> 00:35:56.010
Kerberos information in
DSLocal now for the AD plugin.

00:35:57.030 --> 00:36:00.400
We have a few new dsconfig.ad options.

00:36:00.510 --> 00:36:02.340
We added packet signing and encryption.

00:36:02.670 --> 00:36:05.400
This would be the packet
sign and packet encrypt.

00:36:05.540 --> 00:36:08.480
You can set this to allow, disable,
or require.

00:36:08.610 --> 00:36:12.570
By default, it's set to allow,
which means that if your server is

00:36:12.630 --> 00:36:18.260
configured to allow you to do it,
packet signing and encryption will be on.

00:36:18.400 --> 00:36:22.360
One thing to keep in mind here, however,
for troubleshooting purposes,

00:36:22.420 --> 00:36:26.090
is that if you have to do
something that requires a TCP dump,

00:36:26.560 --> 00:36:29.220
either to send to us or you
just want to look at it,

00:36:29.220 --> 00:36:34.660
it's probably not going to be real useful
with packet signing and encryption on.

00:36:34.660 --> 00:36:36.030
You're not going to be
able to read anything.

00:36:36.060 --> 00:36:38.010
You're just going to be able to
see where the packets are going.

00:36:38.170 --> 00:36:41.320
So for troubleshooting purposes,
a lot of times it may be useful to

00:36:41.320 --> 00:36:44.040
actually disable this temporarily
so that you can get a packet

00:36:44.090 --> 00:36:46.370
trace and see what's going on.

00:36:48.030 --> 00:36:53.100
Another thing that we've added is
we've heard that a lot of people needed

00:36:53.100 --> 00:36:57.000
to be able to change the computer
trust account password periodically,

00:36:57.240 --> 00:36:59.200
either because you had
auditors come in and say,

00:36:59.200 --> 00:37:02.740
"You've got to do this,"
or because in some cases,

00:37:02.830 --> 00:37:06.130
your Active Directory admins were
using this the last time that a

00:37:06.150 --> 00:37:09.400
password was set for a computer
account as a sign of whether or not

00:37:09.500 --> 00:37:11.690
that computer account was still active.

00:37:11.980 --> 00:37:16.120
And so some of you had, like,
scripts on your AD server that were

00:37:16.120 --> 00:37:19.350
going through and disabling all of your
Mac accounts periodically because they

00:37:19.350 --> 00:37:20.780
hadn't changed their password recently.

00:37:20.900 --> 00:37:25.560
So we've added the pass
interval option to dsconfig-ad.

00:37:26.010 --> 00:37:29.240
It takes the number of days
that you would like to have

00:37:29.290 --> 00:37:30.870
it change the password after.

00:37:30.900 --> 00:37:33.900
By default, this is set to 14 days.

00:37:33.900 --> 00:37:38.890
Zero means off,
or anything under one will go to zero.

00:37:38.900 --> 00:37:41.900
And this is something you
want to set at bind time.

00:37:41.980 --> 00:37:46.200
Otherwise,
your default is going to be 14 days.

00:37:48.800 --> 00:37:51.930
And finally,
we also have a new option to help out

00:37:52.020 --> 00:37:54.970
those of you with maybe very large,
complex domains.

00:37:55.010 --> 00:37:57.720
And in some cases,
these may be domains that kind of

00:37:57.720 --> 00:37:59.840
came together kind of after the fact.

00:37:59.840 --> 00:38:03.550
And the admin over here and the
admin over there weren't really

00:38:03.660 --> 00:38:04.880
talking to each other before.

00:38:04.880 --> 00:38:09.910
And so you've got users with the same
short name in these different domains.

00:38:10.460 --> 00:38:13.350
Well,
that doesn't really cause you a problem

00:38:13.410 --> 00:38:18.540
in Windows because in Windows you log in
specifically against a particular domain.

00:38:18.590 --> 00:38:22.640
But in OS X, because we look at all the
domains that you're connected to,

00:38:22.940 --> 00:38:24.990
this would cause collisions.

00:38:25.240 --> 00:38:30.270
So you could either try to get
people to change their names or try

00:38:30.360 --> 00:38:32.960
to only look at a particular domain.

00:38:32.960 --> 00:38:34.260
Sometimes that would work for you.

00:38:34.260 --> 00:38:37.460
But if you needed to allow people
to log in against any domain,

00:38:37.750 --> 00:38:40.750
sometimes these users that
had another user with the same

00:38:40.840 --> 00:38:43.860
account in some other domains,
they couldn't log in because

00:38:43.860 --> 00:38:48.250
we just need a unique,
short user name.

00:38:48.790 --> 00:38:52.170
So what we've done to give you a solution
to this problem is we've created an

00:38:52.170 --> 00:38:55.200
option called the namespace option.

00:38:55.450 --> 00:39:01.540
And you can either use namespace
domain or namespace forest.

00:39:01.710 --> 00:39:04.240
And if you use domain,
you'll get the usernames

00:39:04.240 --> 00:39:06.360
the way they are now,
just the short username.

00:39:06.520 --> 00:39:10.870
If you use the forest option,
you will get all of your usernames in the

00:39:11.000 --> 00:39:15.560
format of domain name backslash username.

00:39:15.730 --> 00:39:19.030
And so now all of your
usernames will be unique.

00:39:23.200 --> 00:39:25.220
And then finally,
one thing that I want to talk about

00:39:25.310 --> 00:39:29.740
is we've changed some of the config
files that are used for the AD plugin.

00:39:29.760 --> 00:39:35.230
In Tiger, this was one single plist file.

00:39:35.360 --> 00:39:38.220
Why do you care about these files?

00:39:38.320 --> 00:39:40.760
Well, one thing is for
troubleshooting purposes,

00:39:40.760 --> 00:39:44.030
you might want to look at them,
find out information about how

00:39:44.030 --> 00:39:46.140
it's configured or send them to us.

00:39:46.210 --> 00:39:50.750
But also, if you're writing scripts to
try and automate certain things,

00:39:50.910 --> 00:39:54.420
sometimes there's pieces of
information that you're looking for.

00:39:54.570 --> 00:39:57.410
Some of these pieces of
information are in these plists,

00:39:57.580 --> 00:39:59.870
so it's useful to know what's where.

00:40:00.010 --> 00:40:03.340
So in Tiger, we had just this
Active Directory dot plist.

00:40:03.400 --> 00:40:06.800
In Leopard, this became four files.

00:40:06.850 --> 00:40:09.140
And so we still have the
Active Directory plist,

00:40:09.200 --> 00:40:11.940
but we now also have
Active Directory domain cache,

00:40:11.970 --> 00:40:17.220
Active Directory domain policies,
and Active Directory dynamic data.

00:40:17.270 --> 00:40:19.650
And what's in these files

00:40:20.000 --> 00:40:22.850
In Active Directory PList,
most of the same information

00:40:22.940 --> 00:40:24.090
that we had before.

00:40:24.190 --> 00:40:25.790
So it's all of your
plug-in config options.

00:40:25.890 --> 00:40:29.590
So if you set things either
in the GUI or with DSConfigAD,

00:40:29.770 --> 00:40:32.380
you've got all of that
information is stored here.

00:40:32.540 --> 00:40:34.610
You also have all of
your attribute mappings.

00:40:34.720 --> 00:40:37.180
So for example,
the mapping that we're going to use

00:40:37.500 --> 00:40:44.210
this particular OID number to be this
particular attribute in Active Directory.

00:40:44.570 --> 00:40:48.000
The computer account information
is also stored in here.

00:40:48.000 --> 00:40:51.260
So the computer account name,
the computer account password,

00:40:51.260 --> 00:40:54.860
so the trust account information is here.

00:40:55.530 --> 00:41:00.490
The MCX template that we actually
insert into every user account,

00:41:00.490 --> 00:41:03.270
things like the default
doc and stuff like that,

00:41:03.270 --> 00:41:05.400
is stored in here.

00:41:05.580 --> 00:41:08.540
And we also store the
next password change date,

00:41:08.750 --> 00:41:12.520
so the next time that the AD plugin's
going to change the password.

00:41:12.650 --> 00:41:16.630
And one thing that a lot of people
don't think about here is that this

00:41:16.630 --> 00:41:19.060
file is actually something you can edit.

00:41:19.510 --> 00:41:21.840
So if you want to change
your attribute mappings,

00:41:21.840 --> 00:41:22.580
you can do that.

00:41:22.700 --> 00:41:26.700
If you want to change the MCX template,
you can do that.

00:41:27.010 --> 00:41:31.070
One thing to also keep in mind here,
though, is for imaging machines,

00:41:31.190 --> 00:41:36.380
you do not want this file to be
in a state where the machine is

00:41:36.380 --> 00:41:39.160
bound when you image your machines.

00:41:39.290 --> 00:41:42.450
Because otherwise,
every single machine that you

00:41:42.500 --> 00:41:46.060
image is going to think it's
the same computer account.

00:41:46.130 --> 00:41:49.810
And while in Leopard, since we have,
by default, your password's going

00:41:49.810 --> 00:41:51.950
to change in 14 days,
the first time the first

00:41:52.110 --> 00:41:56.770
computer changes its password,
every other computer in your domain that

00:41:56.770 --> 00:42:00.410
you've bound from this image is going
to fall off of Active Directory because

00:42:00.520 --> 00:42:02.680
its password just got changed on it.

00:42:02.790 --> 00:42:06.930
So that's probably a less than
optimal sort of experience.

00:42:07.120 --> 00:42:09.960
So make sure that when
you're imaging machines,

00:42:10.010 --> 00:42:11.760
image them.

00:42:11.820 --> 00:42:14.130
Go ahead,
set all the options and stuff that

00:42:14.130 --> 00:42:16.060
you want in AD before you image.

00:42:16.060 --> 00:42:19.210
But actually,
image with the machine unbound,

00:42:19.210 --> 00:42:24.130
and then use a post-flight script or
something to actually do the binding.

00:42:26.670 --> 00:42:29.840
The Active Directory domain
cache is just a cache file.

00:42:29.840 --> 00:42:32.600
It's got all the information about each
domain that you have in your forest,

00:42:32.600 --> 00:42:36.440
your NetBIOS name, your DNS name,
your LDAP partition.

00:42:36.660 --> 00:42:39.550
And the domain policies files,
same thing.

00:42:39.780 --> 00:42:45.270
It's just the domain policy cache
for each domain in the forest.

00:42:46.560 --> 00:42:50.830
And finally,
the dynamic data file is useful

00:42:51.180 --> 00:42:56.010
primarily for trying to figure out
what is the last thing that the

00:42:56.020 --> 00:43:00.120
Active Directory plugin has done
as far as what servers has it used,

00:43:00.210 --> 00:43:02.620
what servers has it configured.

00:43:02.710 --> 00:43:05.490
So for troubleshooting purposes,
this is someplace that you might want

00:43:05.550 --> 00:43:10.810
to look if you're trying to figure out
what server is the AD plugin talking to.

00:43:11.490 --> 00:43:13.600
So to give you just a quick
example of a few things that

00:43:13.600 --> 00:43:19.390
are actually in these files,
in that Active Directory dot plist file,

00:43:19.550 --> 00:43:22.980
One reason you might want to go here
is the pass interval and namespace

00:43:23.080 --> 00:43:25.340
options that we talked about earlier.

00:43:25.420 --> 00:43:30.040
If you do a dsconfigad-show,
we actually don't report what

00:43:30.200 --> 00:43:33.260
settings these are set to with
that command at the moment.

00:43:33.450 --> 00:43:35.340
So if you want to know
what those are set to,

00:43:35.360 --> 00:43:36.980
you can look in the plist.

00:43:37.090 --> 00:43:40.500
Another thing that you can do here
is you can check that password change

00:43:40.500 --> 00:43:44.560
date if you want to see when the
computer's going to change its password.

00:43:44.580 --> 00:43:48.560
Or for purposes of testing
and troubleshooting and so on,

00:43:48.900 --> 00:43:55.700
if you just want to try to make
the password change happen soon,

00:43:55.800 --> 00:43:59.080
well, right now,
you can't supply a number under one day.

00:43:59.270 --> 00:44:01.100
And if you don't want
to wait for a whole day,

00:44:01.140 --> 00:44:03.280
you can just go in there,
change that password change

00:44:03.350 --> 00:44:06.220
date to something much sooner.

00:44:06.280 --> 00:44:09.960
And then one thing you'll want to do
here is after you make this change,

00:44:10.000 --> 00:44:13.360
anytime you edit the
Active Directory.plist file,

00:44:13.450 --> 00:44:14.560
you want to read the name of the file.

00:44:14.560 --> 00:44:16.640
So you want to restart
Directory Services,

00:44:16.710 --> 00:44:19.950
but not such that it's going to
rewrite the config file on you,

00:44:20.000 --> 00:44:21.560
because you just changed it.

00:44:21.560 --> 00:44:25.530
So you want to basically do a
kill nine on Directory Services.

00:44:27.330 --> 00:44:30.110
And then, like I was talking before,
an example of what you might use the

00:44:30.110 --> 00:44:34.600
dynamic data plist for is you might want
to know what the last used server is.

00:44:34.600 --> 00:44:38.020
You want to know what was the last
global catalog server that you talked to,

00:44:38.020 --> 00:44:40.640
or for a particular domain,
which domain controllers

00:44:40.640 --> 00:44:41.940
am I actually using?

00:44:42.200 --> 00:44:45.260
Sometimes you might want to know, well,
am I using the one that's closest to me,

00:44:45.260 --> 00:44:47.400
or am I using one that's
halfway across the world,

00:44:47.400 --> 00:44:49.400
or so on.

00:44:53.600 --> 00:44:56.790
So now that we've talked about
Directory Services troubleshooting in

00:44:56.790 --> 00:45:00.840
general and Active Directory plugin
troubleshooting in general,

00:45:00.890 --> 00:45:07.500
I want to give you five of what we think
are some of the most common scenarios

00:45:07.510 --> 00:45:12.150
that you guys might run into when you're
running Leopard with Directory Service.

00:45:12.470 --> 00:45:16.120
And these are all applicable
to the Golden Triangle,

00:45:16.120 --> 00:45:19.590
Magic Triangle,
Augmented Records setups that

00:45:19.780 --> 00:45:22.100
we've been talking about.

00:45:24.020 --> 00:45:31.100
So the first one is an issue that it's
not entirely Directory Service related.

00:45:31.100 --> 00:45:34.120
It's really more of a Kerberos
client sort of an issue.

00:45:34.280 --> 00:45:38.130
But you hit it when you're using
the Active Directory plugin mostly.

00:45:38.230 --> 00:45:39.660
So we're going to talk about it here.

00:45:39.780 --> 00:45:44.390
And this is issues that you might
hit if you're doing multi-domains

00:45:44.890 --> 00:45:48.420
in a multi-domain forest with
Active Directory and you're

00:45:48.550 --> 00:45:51.030
trying to do Kerberos cross-realm.

00:45:52.470 --> 00:45:55.400
So the configuration would
be your multi-domain forest.

00:45:55.620 --> 00:45:58.940
You've got a user in some domain
trying to access Kerberized

00:45:58.940 --> 00:46:00.400
resources in some other domain.

00:46:00.400 --> 00:46:03.390
So for example,
I'm in the engineering domain.

00:46:03.400 --> 00:46:07.670
I want to access some resources
in the marketing domain.

00:46:08.840 --> 00:46:15.310
And the problem that you might see is
you might get some sort of message like,

00:46:15.310 --> 00:46:21.940
"Can't find KDC." Or you might try to,
for example, connect to the file server,

00:46:22.100 --> 00:46:24.840
and instead of just happily
popping up your file share like

00:46:24.840 --> 00:46:28.460
you expect and everything working
the way Kerberos normally does,

00:46:28.600 --> 00:46:32.480
instead the authentication window
comes up and you've fallen back

00:46:32.480 --> 00:46:35.100
to something other than Kerberos.

00:46:37.410 --> 00:46:39.740
So before we talk about
the solutions here,

00:46:39.740 --> 00:46:42.830
there's two main categories
that this tends to fall into.

00:46:43.000 --> 00:46:46.330
Either you have a unified
or a disjoint AD forest.

00:46:46.450 --> 00:46:48.640
So how do you tell which one you've got?

00:46:48.740 --> 00:46:53.320
If you've got a unified forest,
then you have your DNS domain

00:46:53.470 --> 00:46:55.530
matches your Kerberos realm.

00:46:55.840 --> 00:47:02.900
So if your DNS is foo.apple.com,
your Kerberos realm is foo.apple.com.

00:47:03.230 --> 00:47:04.160
Pretty simple.

00:47:04.160 --> 00:47:06.690
And this is really the
category that most people's

00:47:06.690 --> 00:47:09.270
Active Directory domains fall into.

00:47:10.150 --> 00:47:13.100
If you've got a disjoint
Active Directory for us,

00:47:13.280 --> 00:47:16.700
though, then you're in a situation where
things are a little more complicated.

00:47:16.930 --> 00:47:21.130
Because your DNS domain
might be foo.apple.com,

00:47:21.280 --> 00:47:25.240
and your Kerberos realm is
something else like bar.apple.com.

00:47:25.410 --> 00:47:29.280
Or, in a lot of cases,
you have some shortened version of

00:47:29.370 --> 00:47:33.860
your Kerberos realm as your DNS name,
so you might have apple.com,

00:47:34.070 --> 00:47:37.560
and then your Kerberos realm
might be foo.apple.com.

00:47:37.670 --> 00:47:40.160
So the two don't match.

00:47:40.430 --> 00:47:46.310
One thing to look for here is that
disjoint Active Directory for us are--may

00:47:46.800 --> 00:47:54.800
not be supported by Microsoft after--or
even including in 2008 Server.

00:47:54.800 --> 00:47:59.300
So Microsoft may actually require
you just for their own purposes in

00:47:59.300 --> 00:48:02.460
terms of getting support for them,
nothing to do with Macs

00:48:02.590 --> 00:48:06.290
or anything like that,
may be telling you to migrate away

00:48:06.320 --> 00:48:07.560
from this kind of a configuration.

00:48:07.560 --> 00:48:14.630
For most people,
it was put in place as a NT4 migration.

00:48:14.890 --> 00:48:19.000
AID, but Microsoft may be telling
people that they have to

00:48:19.000 --> 00:48:21.390
actually migrate away from this.

00:48:22.820 --> 00:48:26.840
So if you've got a unified
Active Directory forest,

00:48:26.840 --> 00:48:29.890
the first thing you want to do is, well,
let's just go look at

00:48:29.890 --> 00:48:31.040
your Kerberos records.

00:48:31.180 --> 00:48:33.880
So if you remember,
we said all your Kerberos records

00:48:33.880 --> 00:48:39.510
are stored in that DSLocal
config node on your local client.

00:48:39.630 --> 00:48:43.420
And what you may find is that for
the particular domain that you're

00:48:43.420 --> 00:48:47.500
trying to contact for resources,
you may find that there actually

00:48:47.500 --> 00:48:49.510
is no config information for it.

00:48:49.840 --> 00:48:54.280
The reason for this is since we've
gone to an on-demand configuration

00:48:54.650 --> 00:48:57.050
style for the AD plugin,
if we haven't already

00:48:57.050 --> 00:48:59.800
talked to that domain,
we don't have a config for it.

00:48:59.800 --> 00:49:03.670
So you could work around this
by IDing some user so that we

00:49:03.940 --> 00:49:05.800
actually talk to that domain.

00:49:05.800 --> 00:49:10.070
But generally speaking, you know,
you don't want to tell your users, "Okay,

00:49:10.070 --> 00:49:12.540
yeah, if you want to connect to
that file server over there,

00:49:12.540 --> 00:49:17.980
go launch terminal,
type ID some--" That generally--people

00:49:18.260 --> 00:49:19.800
don't like that.

00:49:19.830 --> 00:49:23.800
So what you want to do
instead is after you've bound,

00:49:23.800 --> 00:49:26.600
you want to edit edu.mit.kubros,
and what you're going

00:49:26.600 --> 00:49:29.800
to do is by default,
we have DNS fallback set to no.

00:49:29.830 --> 00:49:34.800
And that actually needs to be set
to no during our bind process.

00:49:34.800 --> 00:49:39.730
But you're going to want to set
this to DNS fallback equals yes.

00:49:40.080 --> 00:49:43.750
What this will do is it will let
the Kerberos client actually go out,

00:49:43.800 --> 00:49:47.430
search DNS for Kerberos,
and then it will find all the

00:49:47.620 --> 00:49:51.800
information for this other domain,
even though we haven't contacted it

00:49:51.800 --> 00:49:54.800
for directory service and we haven't
created Kerberos records for it.

00:49:54.910 --> 00:49:58.630
It'll just find that information for you,
and you won't need directory

00:49:58.630 --> 00:50:02.750
service to actually write out a
particular config file for it.

00:50:04.070 --> 00:50:08.400
Now if you have an edit in this file,
if you don't want this to

00:50:08.400 --> 00:50:11.890
get overwritten the next time
that Active Directory plugin

00:50:12.110 --> 00:50:16.780
goes and reconfigures itself,
also make sure you delete the pound

00:50:16.780 --> 00:50:22.890
lines at the beginning so that it
does not get regenerated on you.

00:50:25.600 --> 00:51:26.800
[Transcript missing]

00:51:28.940 --> 00:51:32.700
Okay, the second troubleshooting scenario
we're going to talk about is

00:51:32.780 --> 00:51:38.540
a slow binding issue with the
2003 R2 Active Directory schema.

00:51:38.710 --> 00:51:43.640
So how many people here use 2003
R2 on your Active Directory domain?

00:51:43.810 --> 00:51:46.140
How many people don't yet but
are going to upgrade to it

00:51:46.140 --> 00:51:47.960
at some point in the future?

00:51:48.130 --> 00:51:50.060
Okay, these are for you.

00:51:50.060 --> 00:51:53.600
So the configuration, as I said,
is Active Directory 2003

00:51:53.600 --> 00:51:56.480
with the R2 schema.

00:51:57.030 --> 00:52:02.200
And what you'll see as symptoms is,
especially if you have a large domain,

00:52:02.200 --> 00:52:06.320
lots of domain controllers,
you may get some pretty slow binding.

00:52:06.620 --> 00:52:11.460
It will bind eventually, maybe,
but it could be pretty slow.

00:52:11.650 --> 00:52:15.890
And you may also have your
AD administrator come to you and say,

00:52:15.920 --> 00:52:18.680
"You know, I'm getting these really
expensive LDAP queries.

00:52:18.680 --> 00:52:22.320
I'm seeing some high
CPU utilization on the server.

00:52:22.320 --> 00:52:23.940
It kind of looks like
it's coming from the Macs.

00:52:24.120 --> 00:52:25.990
What's going on?"

00:52:26.310 --> 00:52:28.770
Well,
what's happening is there's an attribute

00:52:29.480 --> 00:52:35.700
that is in the R2 schema that is
an attribute that we actually use.

00:52:35.700 --> 00:52:37.640
It's called MAC address.

00:52:37.840 --> 00:52:43.600
And what we use MAC address for is, well,
to help us identify computers.

00:52:43.850 --> 00:52:47.560
Mostly we do it for MCX settings,
but when we bind,

00:52:47.660 --> 00:52:51.280
we check to see if a computer
with that particular MAC address

00:52:51.440 --> 00:52:53.240
already exists in Active Directory.

00:52:53.440 --> 00:52:56.150
If it is, well,
we just join that account.

00:52:56.190 --> 00:52:57.930
If it's not,
we're going to create a new one.

00:52:57.940 --> 00:53:01.930
Now, if you haven't extended your schema,
you don't have this,

00:53:02.010 --> 00:53:03.440
and so we can't edit it.

00:53:03.440 --> 00:53:04.930
We just move on.

00:53:05.070 --> 00:53:08.220
And in that case,
so if you have Windows 2000

00:53:08.220 --> 00:53:11.210
or 2003 Server,
we just query for it.

00:53:11.620 --> 00:53:14.320
The AD Server says,
"I don't even have that attribute.

00:53:14.320 --> 00:53:17.880
Go away." So it's a real simple,
quick query.

00:53:18.130 --> 00:53:20.440
It fails fast, basically.

00:53:20.440 --> 00:53:26.620
If you have the 2003 R2 schema, though,
we actually have a case where

00:53:27.270 --> 00:53:30.130
Microsoft has added it to the schema,
but has not added it to

00:53:30.130 --> 00:53:31.860
the computer object class.

00:53:31.970 --> 00:53:35.740
So we can never actually populate
it for a computer account.

00:53:35.940 --> 00:53:38.310
So we're never actually going
to have any records with it,

00:53:38.310 --> 00:53:40.390
but it exists in the schema.

00:53:40.570 --> 00:53:45.440
So what this means is every time that you
bind an Active Directory plugin client,

00:53:45.440 --> 00:53:47.940
we're going to be searching
for this attribute,

00:53:47.940 --> 00:53:51.810
and Active Directory is going
to search every single record

00:53:51.940 --> 00:53:52.940
in your Active Directory.

00:53:52.940 --> 00:53:55.940
So we're going to have a few records
in your Active Directory forest.

00:53:55.940 --> 00:53:58.940
And for those of you that
have a few million records,

00:53:58.940 --> 00:54:01.170
it's going to take a little while.

00:54:02.520 --> 00:54:04.940
And so this causes problems during
binding because we're sitting and

00:54:04.940 --> 00:54:08.220
waiting for these servers and sometimes
they take so long we think they've

00:54:08.220 --> 00:54:10.760
just disappeared off the face of
the earth and we go try and find

00:54:10.760 --> 00:54:12.860
another server and try and use that.

00:54:12.900 --> 00:54:15.640
So the solution here is
actually pretty simple.

00:54:15.640 --> 00:54:18.740
You just want to index MAC address
so that when we actually

00:54:18.740 --> 00:54:22.180
do this query it can say,
"Oh, no, I don't have that." You know,

00:54:22.290 --> 00:54:25.220
it doesn't have to go
search every single record.

00:54:25.480 --> 00:54:26.860
This is a pretty simple thing.

00:54:26.860 --> 00:54:30.260
It's just a checkbox
in the schema snap-in.

00:54:30.330 --> 00:54:33.820
And Microsoft has actually realized
that maybe this is a good idea.

00:54:33.920 --> 00:54:37.680
And they've actually done
this in 2008 Server for you.

00:54:37.910 --> 00:54:43.820
So it is something that you only
have to deal with in 2003 R2.

00:54:43.880 --> 00:54:46.100
But you can see, well,

00:54:46.270 --> 00:54:50.360
Obviously, it's something that, you know,
going forward,

00:54:50.360 --> 00:54:54.170
you would want to have anyway since
Microsoft is going to do it for 2008.

00:54:54.310 --> 00:54:58.840
So everybody that has this or is
going to upgrade to the R2 schema,

00:54:58.920 --> 00:55:02.830
go back,
tell your AD admins to index this.

00:55:05.540 --> 00:55:11.000
The third scenario that we're going
to talk about is where you have users

00:55:11.250 --> 00:55:16.240
And you've got Magic Triangle,
you've set up your OD Master.

00:55:16.410 --> 00:55:18.810
Your users can authenticate okay,
but every time you try

00:55:18.810 --> 00:55:21.190
and edit Open Directory,
either with Workgroup

00:55:21.190 --> 00:55:24.440
Manager or a directory app,
the authentication works,

00:55:24.600 --> 00:55:29.880
the authorization fails, and it says,
"You don't have access to write to this."

00:55:30.240 --> 00:55:33.700
So even diradmin won't
be able to write things.

00:55:33.710 --> 00:55:38.540
But if you use the built-in default
root account for Open Directory,

00:55:38.760 --> 00:55:41.460
this will still work.

00:55:41.680 --> 00:55:44.490
So how do you fix this?

00:55:45.550 --> 00:55:47.900
I saw a lot of hands when I asked
how many people have been to

00:55:47.900 --> 00:55:50.140
one of my sessions before.

00:55:50.150 --> 00:55:52.700
So what's the first thing that you
should do when you're troubleshooting

00:55:52.700 --> 00:55:55.860
a Directory Service problem?

00:56:02.800 --> 00:56:07.350
I have a very intelligent audience.

00:56:07.350 --> 00:56:11.750
Actually, I like that animation.

00:56:11.750 --> 00:56:14.350
Let's see that again.

00:56:14.700 --> 00:56:16.100
That's fun.

00:56:16.110 --> 00:56:16.110
You guys are all going to be
seasick when you walk out of here,

00:56:16.110 --> 00:56:16.110
you know.

00:56:16.110 --> 00:56:16.110
But if it helps you
remember to check your DNS,

00:56:16.110 --> 00:56:16.110
it's worth it.

00:56:16.850 --> 00:56:20.110
So yeah,
usually the cause of this is that you're

00:56:20.240 --> 00:56:22.410
missing either forward or reverse DNS.

00:56:22.460 --> 00:56:26.000
And a common culprit for this
is you bound with the AD plugin,

00:56:26.260 --> 00:56:30.540
you saw that it created a
DNS record for you in AD,

00:56:30.620 --> 00:56:34.180
which it did, but it didn't create that
reverse pointer record.

00:56:34.180 --> 00:56:39.840
And if you don't have that record,
all manner of things Kerberos related

00:56:39.840 --> 00:56:42.410
and other things are going to fail.

00:56:42.420 --> 00:56:48.070
So actually for servers that are--whether
you're bound to Active Directory,

00:56:48.070 --> 00:56:52.900
Open Directory, whatever,
my recommendation is do not rely

00:56:52.900 --> 00:56:55.420
on dynamic DNS registration.

00:56:55.500 --> 00:57:00.150
Go manually put in that
registration so you know it's there.

00:57:01.020 --> 00:57:04.400
The other thing that can cause
this is you might be missing the

00:57:04.460 --> 00:57:08.550
root DSC file in /etc/open/ldap,
in which case you can actually

00:57:08.640 --> 00:57:12.770
just populate that by doing
slap-config/populate-root-dsc.

00:57:13.210 --> 00:57:16.440
You do, in fact,
actually probably need to be root,

00:57:16.470 --> 00:57:20.260
so either put a pseudo in front
of that or run it as root.

00:57:22.500 --> 00:57:26.740
Another problem that I want to talk
about is just some general issues you

00:57:26.740 --> 00:57:29.560
may run into with augmented records.

00:57:29.820 --> 00:57:33.200
And so you may have services that
are looking for some information

00:57:33.200 --> 00:57:35.830
that's in an augmented record
and they're not working right.

00:57:35.980 --> 00:57:37.640
They maybe give you some
weird information--you know,

00:57:37.650 --> 00:57:41.500
weird errors because they're not finding
the information that they expect.

00:57:41.670 --> 00:57:46.670
So what you should do in this case is
verify that Directory Services is even

00:57:46.820 --> 00:57:49.350
seeing the augment configuration at all.

00:57:49.480 --> 00:57:53.250
So remember, first of all,
it's only--you're going to see

00:57:53.250 --> 00:57:54.960
this only in the search node.

00:57:55.180 --> 00:58:01.230
So use DSCL, go through the search node,
try to read the record using the

00:58:01.230 --> 00:58:04.400
search node as opposed to the,
you know, Active Directory node or

00:58:04.400 --> 00:58:06.740
the LDAP node and so on.

00:58:06.790 --> 00:58:10.170
Also keep in mind,
if this is a machine that was already

00:58:10.170 --> 00:58:14.560
bound to OD before you created
that initial augment config record,

00:58:14.580 --> 00:58:18.180
it's not going to see the
augments until you reboot it.

00:58:18.530 --> 00:58:21.430
So those are the two things
that usually catch people,

00:58:21.430 --> 00:58:24.700
but once you've done that,
then you can go ahead and you

00:58:24.700 --> 00:58:27.860
can actually make sure that your
Augment Config record is created

00:58:27.860 --> 00:58:31.320
correctly or that your actual
Augment records are correct.

00:58:31.440 --> 00:58:35.060
But these are the two things
that usually catch people.

00:58:35.390 --> 00:58:37.570
And finally...

00:58:38.750 --> 00:58:44.040
How many people here try to automate
their Active Directory binding process?

00:58:44.150 --> 00:58:46.100
Post-flight scripts or so on?

00:58:46.370 --> 00:58:47.340
Okay.

00:58:47.340 --> 00:58:51.500
So you use DSConfigAD to do your binding,
and there's two common problems

00:58:51.590 --> 00:58:53.540
that people hit with this.

00:58:53.580 --> 00:58:56.970
And they have the same symptom,
which is DSConfigAD acts

00:58:56.970 --> 00:58:59.140
like it's binding okay.

00:58:59.140 --> 00:59:00.040
You don't get any errors.

00:59:00.040 --> 00:59:01.800
Everything looks good.

00:59:01.860 --> 00:59:03.730
And then nothing works.

00:59:03.940 --> 00:59:08.000
Like you try to look up users in
Active Directory or authenticate

00:59:08.300 --> 00:59:09.600
and nothing's working.

00:59:09.900 --> 00:59:11.420
So what has gone wrong?

00:59:11.750 --> 00:59:14.200
Well, usually it's one of two things.

00:59:14.400 --> 00:59:18.740
The first thing is that the
AD plugin is not actually enabled.

00:59:18.830 --> 00:59:24.800
Turns out DSConfigAD can give you all
of your binding and everything like that

00:59:24.810 --> 00:59:26.860
without the AD plugin being turned on.

00:59:26.960 --> 00:59:30.660
So it goes ahead, binds you,
but then the AD plugin is still off.

00:59:30.720 --> 00:59:34.360
So Directory Service is not
actually using it for anything.

00:59:34.610 --> 00:59:38.150
So I wanted to give you some
little code snippets or script

00:59:38.150 --> 00:59:40.020
snippets to help you do this.

00:59:40.060 --> 00:59:45.860
These are actually all in the notes
that are on the attendees site for you.

00:59:45.860 --> 00:59:48.300
So you don't have to try
and type these all out.

00:59:48.510 --> 00:59:55.510
But the first thing is this information
is just in the Directory Service plist.

00:59:55.880 --> 00:59:59.520
So you just need to set the
Active Directory key to be active.

00:59:59.520 --> 01:00:02.190
Then you need to restart
Directory Service so

01:00:02.540 --> 01:00:05.120
that it takes effect.

01:00:05.120 --> 01:00:10.300
And just for human readability purposes,
you may want to convert this back

01:00:10.300 --> 01:00:13.030
to XML1 format instead of binary.

01:00:13.760 --> 01:00:16.540
But that's purely optional.

01:00:16.650 --> 01:00:19.890
And the second issue is just that
Active Directory may not have

01:00:19.960 --> 01:00:21.740
been added to your search path.

01:00:21.880 --> 01:00:25.480
So the way to do this is you
can use DSCL and you need to

01:00:25.820 --> 01:00:33.560
add your Active Directory search
node to the CSP search path.

01:00:33.630 --> 01:00:37.820
And keep in mind, if you're allowing
authentication from all domains,

01:00:37.820 --> 01:00:39.520
this will be
Active Directory all domains.

01:00:39.680 --> 01:00:42.780
If you're not doing that and you're
specifying each individual domain,

01:00:42.940 --> 01:00:45.640
you will need to do this for each of the
domains that you're going to specify.

01:00:45.640 --> 01:00:49.180
So it'll be like
Active Directory/yourdomain.

01:00:49.500 --> 01:00:56.780
And then you also may need to create
the CSP search path on search policy.

01:00:56.930 --> 01:00:59.840
So you can just do these two commands.

01:00:59.900 --> 01:01:03.850
That will take care of adding
things to your search path.

01:01:05.580 --> 01:01:07.700
So just to wrap up,
we talked about extending

01:01:07.700 --> 01:01:09.120
directory services.

01:01:09.270 --> 01:01:13.330
We have augmented records in Leopard
to help you solve some of these

01:01:13.330 --> 01:01:17.760
problems that we could not fix
with just Magic Triangle and that

01:01:18.020 --> 01:01:22.180
let you do them without having
to go through schema extension and

01:01:22.180 --> 01:01:25.040
get all of your AD admins buy-in.

01:01:25.200 --> 01:01:28.870
And just to remind you,
we now support this in advanced server

01:01:28.870 --> 01:01:32.760
mode with Workgroup Manager as of 10.5.3.

01:01:33.910 --> 01:01:38.370
And for troubleshooting,
remember we have variable debug levels,

01:01:38.440 --> 01:01:41.360
so you may need to adjust
the logging level up or down.

01:01:41.690 --> 01:01:44.840
Your Kerberos config information
is now stored in DSLocal,

01:01:45.030 --> 01:01:47.550
so that's where you need to look,
and that's what the information

01:01:47.640 --> 01:01:51.390
you would want to send to us
if you're filing a bug report.

01:01:51.980 --> 01:01:54.320
DNS, DNS, DNS.

01:01:54.800 --> 01:01:58.290
I could say it all day,
it's that important.

01:01:58.580 --> 01:02:01.300
And finally,
if you're having Kerberos issues,

01:02:01.610 --> 01:02:06.880
you can adjust a lot of these things
by actually editing edu.mit.kerberos.

01:02:09.790 --> 01:02:13.500
For more information,
you can talk to Mark.

01:02:13.520 --> 01:02:16.400
I will actually be in the
Directory Service Lab immediately

01:02:16.500 --> 01:02:17.700
following this session.