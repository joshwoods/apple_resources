---
Title:  Best Practices for Large-Scale Xsan 2 Deployments
Year:   2008
Web:    https://nonstrict.eu/wwdcindex/wwdc2008/920/

[!] This transcript was generated using Whisper, it has known transcription errors.
---

Good afternoon. My name is JD Mankovsky. I manage Apple's Professional Services and wanted to start by just asking a few questions in the audience and get a show of hands and make sure you're paying attention. So how many of you have Xsan today deployed in your environment? Wow.

That's excellent. Well, thank you very much. And we're going to talk a little bit about Xsan 2 and I'm sure -- how many people are still running Xsan 1.4 today? Okay. So hopefully this session will be useful for you. How many people are looking to deploy Xsan in the next six to 12 months? Okay. Excellent. Excellent.

Jason Thorpe is going to be my colleague, my partner in crime here. Jason manages the server engineering group and specifically Xsan as well. So he'll come over and share some of his best practices around some specific topics here. What you're going to learn today and that's really... What you're going to learn today is really what's new in Xsan 2. And we'll talk about some best practices. Now, they're not all up on the slide here. It would be multiple slides to go through it. So those are some of the highlights. You know, some really important integration.

and Jason Thorpe, the founder of Xsan 2. You know, configurations and tips that you should know of even before you even deploy your Xsan. And we'll talk about performance and optimization and redundancy now that we've got some nice new features and multi-pathing and new storage. Lots of fun stuff to talk about.

And finally, we'll have time for Q&A. The session should be about an hour, and we'll have 15 minutes for Q&A, and then you can join us at the lab downstairs, So what I'd like to do now is bring up Jason Thorpe and talk to you quickly about what's new in Xsan 2. Jason?

Thanks JD. Good afternoon. So last year -- who came last year's session introducing XAN2? Raise your hands. Okay. Great. So there's a lot of you who did not see that presentation. So let's cover what is new in XAN2 that's actually really interesting. So the first thing is we have a brand-new XAN admin application that really streamlines the administration tasks, the setup, no more hopping through panes. There's very assistant oriented in XSAN2.

Next is we have a feature called MultiSAN. This is particularly interesting if you're deploying multiple volumes in an environment where uptime is really critical for certain environments and allows you to better utilize the server hardware that you deploy Xsan on. We're going to cover that in a little more detail here later on in this talk.

And then finally, Xsan 2 also introduced full support for Spotlight using the same architecture that we have for Spotlight Server and Mac OS X Server. And not much more to say about that. The two things that we're really going to talk about today are the new Xsan Admin Application and MultiSAN.

So, for those of you who are not familiar, let's kind of just give you a brief primer on how Xsan works. So, first let's take a look at a traditional file sharing environment. We have some storage and you have a file server and you have clients that are connected to that file server over gigabit Ethernet.

All the data is flowing through the server which in turn pulls the data from the high-speed storage. Now, if you notice in the diagram there, there's a big fat pipe between the storage and the server, but there are these teeny little thin pipes between the server and all the clients.

And that is the sort of main disadvantage of using this sort of traditional file sharing environment. You're limited by the gigabit network connection that's between the client and the server. Furthermore, all those clients are actually sharing one connection to the server because the server not just has one port out to the rest of the LAN.

Now, if you contrast that to Xsan, we still have a server, we call it the Xsan Controller, but the main difference here is that those clients are all directly connected to the storage through a fiber channel switch, which if you notice in the diagram here, those pipes are a little fatter than they were in the previous slide. That enables the clients to basically get the full bandwidth from the storage into their application.

The controller is there primarily to handle namespace operations, so creating a file, renaming a file, looking up files, and figuring out where on the storage that the file lives, but no data flows through the Xsan Controller. So, main advantage of this, of course, is that as you add storage, the performance scales up, and that's because you can take advantage of the multi-pathing support in the Mac OS X storage stack, and with the new Promise RAID, we can actually take advantage of multiple paths to that storage as well.

And then finally, you can actually gain some high availability by adding redundant Xsan controllers so that if one were to go down, the power failure or, you know, CPU catches on fire or whatever, there's another one there that can take over for you. So, I'm gonna now hand it back to JD, who's gonna start covering best practices. Thanks, Jason.

So the first thing we want to cover is power, cooling and UPS. So even before you would deploy a Xsan, you want to make sure that all that, that the house is in order, right? You want to make sure you've got the right amount of cooling, that you've got the right amount of AC and that the power is sufficient to power up the servers and the storage and the rest of the equipment. And we do see a lot of situations where when we show up and do those deployments, you know, that those are not in order, right?

The AC is either not sufficient or, you know, there's not enough power coming to the racks and then you run into situations where, you know, you get blown fuses and you bring your data center down or you might bring your whole, you know, shop down, which is not a good situation you want to be in.

So what we usually start with is when we come in and spec out the Xsan, we'll basically calculate, you know, the total amount of wattage required for the equipment as well as the cooling and make sure we deliver that to the customer ahead of time so they can make sure that that room and the data center can actually sustain that new equipment.

So just a few examples that are up there, but obviously a lot of that stuff is available on our website if you're looking for specific, you know, product specs in terms of wattage and BTU on the Apple website and a lot of that stuff is available from, you know, the Xsan.

So just a few examples that are up there, but obviously a lot of that stuff is available on our website if you're looking for specific, you know, product specs in terms of wattage and BTU on the Apple website and a lot of that stuff is available from, you know, the Xsan. from all the third-party vendors that would, you know, build that Xsan and that video Xsan. So examples, you know, the Intel Xserve, 750 watts, Promise V-Track, around 450 watts, and then, you know, some 3-com switches.

The next thing we want to talk about is UPSs. It's really important that when you deploy a Xsan, you make sure you've got the right amount of UPS to actually sustain a power outage. And not only should you have one UPS, you should have redundant UPSs because again, you never want a single point of failure in your system. So you should at least have two UPSs and basically with the fact that you've got dual power supplies, right, on the servers and on the storage and the rest of the equipment, you should make sure that that power gets distributed across the UPSs.

What's also very important is to make sure you've got the APC, you know, SNMP network management card. And that card is, you know, something in the order of $200 and it just slides right into the slot in the back of the UPS. And that allows you to manage your UPS and it gives you information such as once you have your system up and running, you can literally trigger a test. It'll tell you your uptime.

So it'll tell you how long your system can sustain a power failure. It'll also run battery checks every month. So you get email notifications. Of course, if you set them up, you get email notifications that let you know that, hey, I've checked the UPS and, you know, the internal check has happened and all your UPSs are good to go.

So you can just, you know, understand you're running, you know, those are lead batteries. And, you know, there is, you know, those lead batteries will last about a year to two years. So you also need to refresh and make sure that your UPSs are not, you know, collecting dust and they haven't been touched in five years.

So if you have a UPS and you've got APC, make sure that those SNMP cards are in the systems. And we really recommend not just a single SNMP card, but you need to have one in each of the UPS, you know, devices. So very important. And then finally, the software is the Parachute software.

And that's a free download and that's something you would load on the XSERVs so that when there is a power failure, you know, when the threshold gets hit, it sends -- the UPS sends a notification to the XSERV and will gracefully shut down the XSERVs, you know, and bring the system down.

So how does a UPS integration work? Well, again, you know, the XSERVs have dual power supplies, so make sure you order your XSERVs with dual power supplies, right? The Promise RAID has dual power supplies and then obviously, you know, you get more than one UPS and you basically just, you know, distribute the load across those UPSs.

Another thing you want to be careful of is when you build your XSAN and you calculate the total amount of wattage required, right, assume, if you want to assume that one of the UPS could potentially fail, you need to make sure that that single UPS can sustain the load of the entire system.

So that's something else to really look for is, you know, when we did a test, we did a big deployment in Asia a few weeks ago, we actually made sure that the entire system was actually, you know, could work off a single UPS. So, you know, a single set of UPS and batteries that are attached to that system. So very important to make sure that all that is in order before you put your XSAN in production. You know, you really want to make sure all those tests are taken care of ahead of time.

So the network management card, when you get that card by default, you know, there's a little receipt that comes with it that has the MAC address. And that is how you configure that card. So you basically connect a laptop to the card. You open up a terminal window. You send those commands up there. And make sure you, before you put the card in, make sure you actually write down the MAC address of the card. And you basically send the ARP command and you assign an IP address.

Once you assign an IP address, you can then telnet into the card. And then you basically go in and configure, you know, the subnet and the router. And then you can then open up a Safari window and configure the rest of the UPS, you know, via Safari. So, you know, pretty straightforward.

Another nice feature to look into is Apple Remote Desktop is a great management tool that's available from Apple. And if your system goes down, if there is a power failure and your SAN goes down, when the power gets restored, all your devices will potentially all boot up at the same time.

So your storage boots up, your fiber switches boot up and your servers boot up. Well, it takes time for the storage to come up. It takes time for the fiber channel switch to come up. And we all know how fast our servers and our desktop machines come up. They usually come up way quicker than the storage and the back-end fabric.

So what you can do is you can actually put a delay so that when the power gets restored, the Xsers don't boot up right away. And it gives time for the server and the storage to come up ahead of that. Okay, so very simple command. It's actually built into Apple Remote Desktop. And it's the system setup command.

And now let's talk a little bit about shutdown procedures and bring up procedures because, you know, that is one thing that is critical is when you once you've deployed the system in your data center, you might be the Xsan admin, right? I mean, a lot of you guys are Xsan admins, but what if you're on vacation, right? What if there's someone else in the data center that's maintaining your system? You know, usually when problems happen, you have to react very quickly. You might not be available. Someone else might need to do that.

So having the shutdown and the bring up procedure, you know, clearly illustrated in the data center by the rack, where the Xsan is actually located, will always be a good thing to have so that whoever's in the data center follows that procedure to a T. And obviously the shutdown procedure, you know, let's assume here, you know, a major shutdown, which, you know, if you can do it, you wanna do a graceful shutdown, which is unmounting the volumes, you know, stopping the volume in the Xsan admin, you know, the Xsan clients, you can shut them down or just unmount the volume from the Xsan clients.

Then you wanna shut down the secondary MDC first, shut down the primary. You can obviously, through the UI, figure out which one is the primary and the secondary, and then shut down, you know, any RAID tape devices. And then finally, if you need to shut down your directory, your DNS, your DHCP, you could do that as well. Not required, obviously. And then shut down the fiber channel and the ethernet.

So that's kind of a, you know, quick synopsis of how to shut down the system. Now the startup is pretty much the reverse, where you first bring up the fiber channel and the ethernet, make sure those come up, right? Those usually take about a minute to minute and a half to boot up.

Then you bring up your directory, your DNS, your DHCP, and then you bring up your storage, and then your primary MDC, right? Your secondary MDC. And then finally, any reshare type file server that might be resharing the SAN. And then you start the SAN and you mount the Xsan on your clients.

So what I want to do now is bring up Jason back for directory integration and ACLs. Jason? Great, thanks JD.

[Transcript missing]

So once you have your centralized group management, you can manage your access controls directly from Xsan Admin as well. This is something that you no longer have to use server admin for, workroom manager for. You can do it all right from Xsan Admin. Now, for those of you who have previously been using workarounds such as, you know, UMASK and whatnot to enable collaboration, you don't have to do that anymore. Access controls are the way to do that.

If you have Xsan Admin manage your users and groups, by default, we create a workgroup at the top level that allows you to sort of collaborate out of the box. But you can actually have much finer control using this interface. So, I'm gonna now hand it back to JD, and he's going to talk more about configuring Xsan clients. Thank you.

So let's talk quickly about configuring your Xsan 2 clients. You know, it's pretty straightforward. The cool thing about Xsan 2 is you don't even actually have to reboot the clients. You just install the software and there is no need to actually reboot. But some of the things that we like doing is quite often, you know, you're dealing with end users who, and if you wanna start doing some troubleshooting as the IT admin, you know, you wanna make sure that the NICs, that the network Ethernet ports are usually, you know, renamed from Ethernet 2 and Ethernet 1, which doesn't make a lot of sense to end users, to something that's more meaningful, like metadata LAN, you know, 2 and public LAN 1, right?

And that would be Ethernet 1 and Ethernet 2, which allows you to quickly troubleshoot and figure out if some, by some reason or another, someone reversed the ports, right? And flipped around the metadata LAN with the public LAN. So some things that are very simple, but that are gonna help you as IT admins, you know, troubleshoot an Xsan, you know, an Xsan client very quickly instead of like uninstalling and reinstalling.

And, you know, those again are very easy commands to send out with Apple Remote Desktop. And that's, those are the commands that are up there. And you can actually do that dynamically. You can literally have the network panel up, send those commands and it just refreshes in Leopard. And you can see the renaming just happen on the fly. So it's actually pretty neat and easy to do. And again, you can do that on all the machines at the same time through Apple Remote Desktop.

So let's talk a little bit about networking and best practices around network configurations. You know, the first thing that we always cover and that's always really important is no matter what deployment you do with OS X Server, you have to have proper DNS working, right? And that is essential with Xsan as well.

And that hasn't changed, okay? So make sure that you always set up your DNS properly. And our recommendation is not just to set up DNS on the public LAN, but also have DNS working on the metadata side as well. And make sure you've got DNS entries for all of your clients as well as all your servers, right? That's just really important.

And if you're in a bigger deployment and you've got an IT group, make sure that you work with them to get the right amount of IP addresses for the servers. You know, remember now we've got lights out management, so make sure you get an IP address for the lights out management on the servers. And then the promise storage requires three IP addresses per E plus J unit. So make sure you've got, for each of the main controllers, you need three IP addresses, two per controller and one for the virtual IP.

So DNS is always important. If you see any type of sluggishness, it's probably your DNS. So that's usually the main issue that we see with a big Xsan deployment. So pretty straightforward and the new user interface in Leopard is actually really easy to configure. So if you need any tips on troubleshooting, I think most of you know how to do that.

But you can use dig, hostname, nslookup. You can also use the change IP, check hostname command. That's a server only command. But again, it's great if you have a bunch of servers that are metadata doing ingest, you can just simply through Apple Remote Desktop, send that command out and make sure that all the servers are configured properly.

One thing I wanted to make clear, DHCP is not an option with Xsan clients. Okay, so you should not be using DHCP or you could potentially do DHCP with static IP. Okay, so that's fine, but no DHCP. And then make sure if you've got spanning tree enabled, you're in a Cisco environment, if you've got spanning tree enabled, you should enable for port fast. But again, that's typical for most IT shops. But again, just wanted to make sure that was covered.

So now let's talk about building maximum performance and redundancy out of your Xsan. Right, it's all about redundancy. Well, the first thing I wanna talk to you about is, before we talk about really redundancy, is making sure that not only you've got good UPS and good power, but that whoever you're gonna pick to actually deploy the fiber between your data center and your machines, that that is done properly.

And we've seen so many situations where, you know, the customer tries to do it themselves, they don't know how to handle, you know, fiber, or they'll pick, you know, a contractor that might not be certified to actually, you know, terminate and set up your fiber properly. So it is really important to make sure that the fiber is done the right way and that you pick someone who's certified and who will give you a DB output reading of, you know, each strand of fiber that's being pulled and make sure that the fiber has been terminated properly, okay? Another thing to talk about and mention is, some corporations, you might have their data center on one floor and your edit machines might be on another floor. And that means that there's some longer distances to cover.

And what you can do in that situation is you could possibly have the fiber switch, the fabric managing your backend server architecture and the data center and have a second fabric that is, the one that where all your clients are connecting to. And then you can interconnect those two fabrics using some, you know, higher speed, you know, GBIX.

And you've got some long distance GBIX that are up there and they're actually available on the Apple store. So again, you know, make sure that if you are going long distances, you know, you wanna, you know, the typical standard is 50 micron. There's some 62 and a half micron out there.

And if that's what you have in the walls, you wanna make sure that the patch cable, the patch cables that are gonna go between the wall and the machine or between the data center patch cable and the server are 62 micron as well. It can be 50, but our recommendation again, is to make sure that the patch cables match whatever you have running in your building.

So again, the beauty with Xsan 2, Leopard and the Promise Storage is you can truly build a completely redundant system. So we've got active-active controllers now on the storage. You've got the multi-pathing, which works just amazingly well in Leopard. You've got dual power supplies on the servers. And so it makes it really easy for you to build a fully meshed architecture with your fabric.

And so again, our recommendation is if you buy Xsan and you're looking for high availability, that you build it just this way. Dual metadata controllers, you get two fiber channel switches, right? And again, you just calculate the total amount of ports you need and make sure that you balance that across the two fiber channel switches and then the amount of storage that you need.

So pretty straightforward. But again, here, what I could do in this scenario is I could literally, and I've done it before, for the customers who've seen the demo, you can literally just pull the power on the fiber channel switch and the system will just behave and work exactly the same way. There's no drop whatsoever by pulling one of the power switches out of the fabric. The Xsan just keeps on working. You might lose some throughput because you're not taking advantage of the multi-pathing anymore, but the system will just stay up and keep working.

So let's talk quickly about Multisan. And Multisan, the beauty about Multisan is it really is a per volume controller provisioning. So that allows you to assign a set of Xsers, metadata servers to manage a specific set of volumes. So pretty straightforward and we'll show you just a quick diagram so you can understand in what situation you might wanna use Multisan.

So the first thing is, let's assume you've got a set of editors and you've got a production volume and those editors are editing all day long on the production volume and you've got 20 plus editors on there. Well, you can basically have a set of metadata servers managing that volume, right?

With spotlight turn on and all the indexing and everything going on properly. And then let's assume that some of that content then is now going to Xsan 2. So you can actually get a set of metadata servers that are actually playing out to air. And you wanna make sure that if your editors are really banging on the Xsan, right?

And there's obviously, there's always gonna be throughput limitations of the Xsan depending on how many editors you have. You don't wanna get any drop frame happening when you're actually playing out to air. That would not be a good thing. So what you do is you basically segregate, you move that data very easily from the production volume to the play out volume.

And then you can just sort of isolate the two, you know, controllers managing that play out volume. And that way you've kind of isolated the two volumes. And if there is, you know, for some reason or another, some issue on the production volume, your play out volume will stay, you know, up and everything is just gonna keep on chumming along. So make sure you do that again for high availability. And if you're in, you know, some critical situations Another tip is, you know, domain, you know, lock the domain ID.

So if you look at the screenshot on the up there, there's a feature here where you've got the domain ID lock. And you can see that by default, that domain ID lock is set to disable. Now, this is critical because now we're talking about redundancy, right? So most of you will basically get two Fiber Channel switches, right, for multi-pathing.

And what happens is when you power those switches, they have that domain ID lock, you know, lock set to disable and they all have the same domain ID. So for those of you who remember the old SCSI days, right, you went, you had the little wheel on the back and you'd set the number from zero to seven, right? Well, this is about the same thing.

You have to go in, you edit the properties of your QLogic switch and you lock the domain ID to its own, you know, unique number. And what happens is if there is a power failure and your system all comes back up at the same time, there's not gonna be any domain ID conflict with your Fiber Channel switches. So simply go in, you know, change the domain ID and lock it to a specific number and you'll be all set.

As far as how to configure the clients and the storage, well, usually what you do, is, you know, the port type, the port state and the speed stays, you know, to online and auto detect. Port type can stay at a GL and then the IO stream guard usually is set to enable and device scan set to disable. On the storage, you actually disable the IO stream guard. So that's really the most critical point here. For any type of storage or tape libraries, you wanna disable the IO stream guard on the target devices. Thank you.

So now let's talk a little bit about best Xsan volume configurations. How many people were in the session last year? Okay, so you saw the amount of time we talked about, kind of like, you know, best configurations and how to set up, you know, per storage pools, four LUNs per storage pool. We spent a lot of time talking about best practices around Xsan 1.4. Well, the good news is the engineering team has been really hard at work to make things much simpler for, you know, you folks, for the admins, right?

And so now you've got those presets where you can on the fly, when you launch the Xsan 2 admin, you can actually pick, you know, the best optimization, the best volume configs for the work you wanna do. So for those of you who were in the iCal Server session prior to this one, you can go in and pick Calendar Server Cluster, and that'll optimize, you know, the block size and the stripe breadth and everything you need to actually deploy, you know, an iCal Server. If you wanna go uncompressed HD, you can just basically pick the pull down. So the point of it is you really wanna pick one of those settings, right? Because that's where the magic happens.

And the magic is you've got all your data LUNs, you're gonna take all your LUNs, drag them onto the volume, and it will automagically basically assign, you know, the right amount of LUNs per storage pool and do it all for you. And that also applies to when you expand your volume, you know, down the road. So it's very neat and much easier than it was, you know, in the 1.4 days.

So we talked last year about the fact that you wanna do, you know, for video, you wanna do four LUNs per storage pool. Well, again, that's the standard now. And so it just automatically does it for you. So the assistant does the work for you. You still wanna combine the, you know, all your LUNs that build a storage pool all have to be of the same size. So that is really still critical for any deployment.

And your storage pool should still be in a RAID 1 configuration. So there's no changes there, no RAID 5 or RAID 1E. There really is no need for that. Just make sure you've got a RAID 1. And with the Promise RAID, what's very neat is you can actually have both the metadata and a data LUN on the same controller, right?

So we've got a lot of scripts that are available off the Apple support website that you can download and apply to the Promise storage to help you configure this and optimize it for your Xsan. And for Xsan usage. So take advantage of those scripts. And as well on the metadata side, you know, as people grow and not just, you know, for video, but start using Xsan for file serving and, you know, directories or iCal, you know, you might have millions of files on your SAN.

And so make sure that you understand that your metadata LUN, right? It's gonna use about 10 gigabytes of space for about 10 million files. So if you're gonna be in a situation where you're gonna be dealing with a lot of small files, you wanna make sure you take that into account. But it's actually quite straightforward in Xsan 2 to grow that metadata LUN as well and to just expand it.

So again, data-lun best practices. You can see here, we've just picked by default, we went in and picked the HD option. So you can see that the block allocation is set to 16K. You should never go beyond 16K. Okay, there is no reason for you to ever go beyond 16K block size. There was some documentation at some point that might've said something different. 16K is the block size that is optimal for any type of uncompressed video.

So just stick with that. Round robin is the allocation strategy. And then as Jason discussed earlier, you should really use ACLs now. I mean, those are solid and work very well with 10.5 and Final Cut. So let me turn it back over to Jason and to talk to you about about affinities. Jason.

Okay, affinities. Affinities are a way for you to steer data to specific set of storage based on a policy that you define. You configure these using the file management pane. You actually assign them to folders in the file management pane. And the affinities are actually set up and defined when you create the volume.

If you noticed in JD's earlier slide in the volume creation assistant, when you are dragging LUNs into the volume, you're actually dragging those to what we call an affinity tag. And one affinity tag in Xsan 2 can actually be associated with multiple storage pools. That's different from Xsan 1. And that's what allows us to be able to split your storage into multiple storage pools sort of underneath the hood.

So one critical tip, and this is a question I field a lot, when you are moving a file from one folder to another and those folders have different affinities but that they're in the same volume, you have to understand that when you do that in the finder, it does not actually copy the file.

It renames the file. It gives it just a different path. And the reason that's important is because a file inherits its affinity from its parent folder when the file is created. When you're renaming a file, you're not creating a file. So if you actually want to assign that file to the new affinity and get it actually migrated to the other storage, make sure you hold on the option key when you drag it in the finder. That tells finder to copy the file.

When it copies the file, it, you know, creates a new file, moves the data there, it gets steered to the appropriate storage, and then once that's done, you can then delete the file from the old folder just by dragging it in the trash and emptying the trash can. There's actually a KBase article on that. See the slide for more info. So that's all I have on affinities. JD is now gonna talk about backing up Xsan. - Thanks, Jason.

So backup is critical, right? We all know this. How many people actually backup their Xsan today? Wow, that's pretty amazing. So we went from pretty much everyone raising their hand in this room that are having Xsan deployed to probably about 10% of the people in this room actually backing up. Well, you know, let's talk about this.

And, you know, some of you might not have the, you know, the money to deploy or your Xsan is so big that you just don't know what to do with it. But the first thing you should do is at least backup your config files, right? So anytime you make a change to your Xsan, it is critical that you actually, you know, backup those configuration files.

So if you're not backing up your data and you feel like you can restore it within 10 minutes, you're really good. But at least just backup the config files. And that's really simple. You can just do, you know, CV gather, which is one way of doing it, but that doesn't give you, you know, a way to restore it very quickly. So our recommendation is to use a tar command to actually just tar up the config directory.

And you should do that both on the metadata master as well as on the replica. And then obviously you take that email, you take that configuration file, you email it to your mom, to your parents, to your, you know, on a DVD, to your best friends. Because you want to make sure you've got multiple copies of that and those are accessible at any time.

So make sure you do that. Another nice tidbit is the log files, right? So if you have a lot of logs that get generated, make sure you actually, you know, script that and maybe in a launch D job and have those logs backed up on a regular basis.

Because if you ever run into a problem, you want to go back, you know, and figure out what the, where it happened. And possibly if there is an issue, the log is going to get filled with the same issue over and over again. So you want to go back and figure out exactly what happened when the problem went on. That's on the metadata controller, correct. Yes.

So, you've backed up your config file. You now have money for those of you who didn't raise their hand in the room. And you're ready to either implement disk to disk, right? You're buying more storage and you're backing up your data, or at least your project files, right? That would be a good first step. And, or you've got a tape device. You've got money to now purchase a tape device. So what software do you use?

Well, you know, there's three major software vendors that actually offer both server and client solutions on the Mac. And those are vendors that are enterprise level, you know, backup solutions. So they can back up, you know, 20 terabytes, 30 terabytes, 50 terabytes of data. You know, they're definitely enterprise level, you know, backup solutions. So you've got ATempo, Archiware, German company, PressStore is the product, and you've got Backbone, NetVault.

So those are kind of the top three backup vendors that our customers use, you know, around the world. And then you, if you're in a larger IT infrastructure and you already have Tivoli or Veritas, those vendors don't have a server product, but they do have a client agent on the Mac. So you could possibly load that client agent on your SAN and backup your SAN that way. Make sure that client agent actually works over a fiber channel, because if you do backup your SAN over a gig E, the restore time might be just a little slow.

Like in a matter of weeks. So again, you always, and again, once you back it up, make sure you test or restore, right? And that you can actually restore your data. I mean, that's also really important before you go into production. So we just, we see a lot of fun things out there.

So Xsan support, all of those products support Xsan and obviously Leopard. So tape device. So there's a lot of tape devices out there. A lot of the vendors work at the lower SCSI level, Fiber Channel level. So they pretty much work with all the vendors that we talked about.

If you're running kind of low on Fiber Channel ports, a nice way to save money and is to basically get a second Fiber Channel card on that server that is actually gonna be acting as your tape backup device. And we've got some nice four port Fiber Channel cards now that are available.

So you should probably get one of those for that backup server. So you've got two ports for multi-pathing going to your Xsan and you've got two ports left for your tape device. Assuming it's a small to medium sized tape device. And so you can just connect it directly to the server. You go into system profiler, you can just make sure that it actually sees the tape device and then you can install the third party backup product and configure it.

If you wanna connect the tape device to the Fiber Channel switch, our recommendation is always to create a soft zone. That's what's best practices. And into that soft zone, you would obviously have the Fiber Channel ports of that backup server. And you'd have the tape device that is also a part of that.

So how to repair your sand volume. Well, the first thing I wanted to mention is when you buy Xsan, you get 90 days of free AppleCare support. So make sure you take advantage of that, right? So you should really, you know, call AppleCare. You should make sure you do get Xsan support when you buy Xsan and make sure that the AppleCare person is on the phone with you if you do run into a situation. But if you want to attempt it by yourself, you're more than welcome to.

And you can go to apple.com/support, pull up this article 301-911. 911 is a good last three-digit number right there. And it'll basically run you through, you know, how to, you know, what are some of the things to run through and the commands that are up there like CVFSCK to check your volume and repair it, okay?

So again, Pretty straightforward. Now, when you, again, best practices is, we talked about a lot of things, but you know, you should really make sure that you've got the right amount of, you know, support available. Those are available from Apple, so just look at those. You've got Xsan support, you've got support available for your hardware, and obviously, if you want us to come in and help you deploy it, we're also available.

So in summary, let's talk about some high-level best practices. We talked about DNS. I'm just re-emphasizing that. So you will set up DNS. Excellent. Make sure your date and time is synchronized. We all love single sign-on. We all love Kerberos. We all love tying to open directory or active directory. That requires that your date and time be synchronized properly. So make sure that you're pointing to the right NTP server and that that's all working properly. Make sure you backup your Xsan config files every time you make a change to your Xsan configuration.

And another fun one is make sure that your local boot drive is picked, is selected on all your clients as well as all your servers. By default, it should be, but we have seen situations where if you do a firmware update for some reason or another, that startup disk, that local disk will get unselected. And if that machine reboots, we've got this nice feature that allows you to actually boot, you know, storage over fiber channel.

So it will try to actually boot the machine first over fiber channel, which is not a good thing, right? So make sure you've got your local boot drive set to boot on the internal hard drive. And then finally, you know, firmware. So you've got, you know, promise raids, you've got XServe raids, you bought the parts kits that go with it, right? Obviously, you always get a parts kit. And, you know, there's firmware updates that come out.

Well, that controller that's just waiting, collecting dust in your parts kit, that firmware might not be up to date. So again, when you've got maintenance windows, make sure you put that controller in and make sure that controller has always the same firmware as what you're running in production.

You know, don't defrag your volume, you know, every day or every week. There's no need for that. If you, as long as you follow the guidelines, which is I shall buy new storage, you know, additional storage and expand my Xsan when my volume goes over 80%, you'll be fine.

We all follow that rule, right? Yeah. And that's what email notifications are for. You just set that number up and it'll just email you and say, "Hey." I mean, we'll ask Jason, maybe he'll add a feature where it'll just go automatically to the Apple Store and just, you know, buy additional storage on the fly, you know, an entry to put the credit card in.

So, or the channel, I'm sorry. If you do run into a situation where, you know, you're getting dropped frames for some reason or another on a file, it might be due to the fact that the volume is getting full or that file might be over fragmented. So, a simple test would be to simply duplicate that file, relink it to that file and see if the drop frame goes away. So, that's just a quick tidbit.

But if you are running into situations where your volume is getting full, you know, by simply duplicating the folder or the file, the finder does a great job doing what's called pre-allocation. And what it'll do is that it'll be really smart in terms of finding, you know, a contiguous amount of space and basically writing that file in a single chunk. Make sure you test the metadata failover.

So, that was not, you know, as easy in XN1 days. You could do it from the command line or you could pull the power or you can shut down the server. But here you can simply go into the GUI, and basically say failover and test the failover. You could still power, you know, pull the power, you know, cord on the server as well if you want to do that. You're more than welcome to.

Make sure you connect all the devices to dual power supplies. Again, we talked about that, but, you know, very important. And those should be in different PDUs and different circuits, right? So, again, make sure that you work with your electrician. You go all the way back to the circuit panel and it's not all tied into a single circuit.

And make sure you understand the bring up and bring down process of the SAN, as well as all the other individuals that would be maintaining the system. And then email notification. There's a lot of areas for you to where you need to configure email notification, right? So, let's make sure we all do that. You've got server, you know, a server monitor. You've got XN. You have your UPSs. You've got the promise storage.

You've got the SNMP monitoring card. So, there's a lot of areas to set up email notifications. So, make sure you do that. So, you do get the notifications if something goes wrong. And even the fiber channel switch has a notification. So, and then register your support contracts, right? Really important.

Because, you know, Murphy's Law, right? After a year, you know, a year and a month, something goes bad, you need to call support. You want to make sure those are active and working. So, I'm going to bring it up to Jason for upcoming XN releases. Great. Thanks. All right.

So, the site sort of let the cat out of the bag for me. This used to be a build, but... So, going live tomorrow, Xsan 2.1 is going to be released. It's available on Apple Developer Connection today for all of you to download, and it goes live on Software Update tomorrow. So, I encourage you to download that and install it. Lot of bug fixes in Xsan Admin, so I encourage you to go ahead and do that.

There's also been a lot of improvements to the Xsan 1 to Xsan 2 upgrade and migration path. So, if you're currently on Xsan 1 and you're going to upgrade to Xsan 2, before you actually reboot that system and get that whole process started, make sure you run Software Update to get Xsan 2.1 installed first, because the upgrade process works much better in Xsan 2.1. And again, it's available on ADC now. Now, for those of you who have been following the sort of OS goings-on, you've probably heard of Snow Leopard. Snow Leopard does not currently work with Xsan 2.

And so, I'm just going to let you know that there will be an Xsan 2.2 that will be compatible with Snow Leopard. It will include 64-bit support on both the client side, the kernel extensions, as well as the server. And we're also adding native extended attribute and resource fork support, so all those little Apple double files are going to go away. We hope to get a big performance boost out of that.

And, yeah. Another thing to keep in mind is we will not be supporting Xsan 1 clients with Xsan 2.2. So, make sure you get updated before you start planning to upgrade to Snow Leopard and Xsan 2.2. And for those of you who participate in the seeding program, just, you know, watch for that. Watch Apple Developer Connection for seeding info.

And so, that's basically it. It's time to wrap up. JD will come on up and finish the wrap-up. We'll be up on stage, then we'll answer questions. We'll bring up a couple of engineers to do field Q&A. Get the mic back on? Perfect. Yeah, so thank you all for using Xsan. We saw a great amount of show of hands today. So, we appreciate your support. So, Xsan is a very flexible product.

So, take advantage of all the new functionality in Xsan 2. And, you know, planning is everything. So, make sure you do plan your Xsan installation ahead of time. And work with your IT group to make sure that networking and IP and everything is in place for the setup.

And don't cut corners, please, right? You know, make sure you've got redundancy built into the system because, you know, most of you in the room, you know, the people that you're supporting are the people who are bringing in the money in the company, right? They're the video editors, they're the graphic designers, and you want to make sure you keep those people happy. And backup is very important. So, I want to see more show of hands next year when you guys all come back at the developer conference in terms of backup.

And finally, if you want us to help you with deploying Xsan and actually installing your Xsan, you can go to apple.com/services or just ping us on consulting services at apple.com. We have a team that's deployed over 500 Xsans in the past two years. So, we'll be glad to help you and lend a hand.

And you've got a group of people here that are more than willing to help. And with that, oh, upcoming sessions. So, after this, there's going to be a lab. All of us are going to be in the lab to help answer questions, more questions related to your specific environment. There's a great podcast producer session tomorrow. And podcast producer uses Xsan on the back end. So, a good session to attend. And then there's also a best practice Mac OS X panel on Friday.
