# Wwdc2021 10202

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Transcript

Detect bugs early with the static analyzerDiscover how Xcode can automatically track down infinite loops, unused code, and other issues before you even run your app. Learn how, with a single click, Xcode can analyze your project to discover security issues, logical bugs, and other hard-to-spot errors in Objective-C, C, and C++. We'll show you how to use the static analyzer to save you time investigating bug reports and improve your app's overall quality.ResourcesHD VideoSD VideoRelated VideosWWDC19What's New in Clang and LLVM

Discover how Xcode can automatically track down infinite loops, unused code, and other issues before you even run your app. Learn how, with a single click, Xcode can analyze your project to discover security issues, logical bugs, and other hard-to-spot errors in Objective-C, C, and C++. We'll show you how to use the static analyzer to save you time investigating bug reports and improve your app's overall quality.

HD VideoSD Video

HD Video

SD Video

What's New in Clang and LLVM

Search this video…♪ ♪I am Ravi Kandadai Madhavan,and in this video,I will show how to use the static analyzerin Xcode to find and fix bugs in your apps.First, I will demonstrate how to usethe static analyzer to find bugs and also understand them.Then, I will describe the new checks in Xcode 13,which can help find more kinds of issues in your code.Finally, I will describe the waysin which you can customize the analyzerto better integrate it with your development workflow.Let's now see how to use the analyzer to find bugs.The static analyzer is a tool in Xcode that can discover bugsby analyzing the source code without running it,so it can reveal bugs, even before you dotesting and quality assurance of your app.It can also find problems in code pathsthat are rare and not covered by tests.The analyzer finds bugs in C/C++ and Objective-C code,even in mixed Swift and Objective-C projects.Let us see the analyzer in actionusing an app I am developing.I am trying to improve an existing app written in Swiftand Objective-C that allows exploring the solar system.This is the Xcode project for the app.I am going to run the Static Analyzer to seeif it finds anything wrong with my code.It's very easy to run.Just go to Product and choose Analyze,or use the keyboard shortcut Command-Shift-B.You can see the analyzer running in the status bar of Xcode.Analyzing your project is very similar to building it.The analyzer scans all the sources files in the targetsof the currently-active scheme looking for bugs.As you see in the status,the analyzer has found an issue in my project.I can go to Xcode's issue navigatorto learn more about it.As I showed you, all it takes to runthe analyzer on your project is a single click.And with this single click, you can findseveral kinds of bugs, like security issues,logical bugs, misuse of APIs, and many more.The analyzer can not only find bugs,but can also explain them.Let's get back to the bug found in my appand try to understand it.The problem here is that the Objective-C methodpositionAtDate is returning nil when it is not supposed to.The method's return value is declared to be non-nullin the method's definition.But now, I want to understand howthis method is returning nil.You can expand the analyzer issuesand see the sequence of events that lead to the bug.The events are also shown in the editor,alongside the statements where they happen.The arrows show how the events are ordered.I find it easier to read these reports from bottom to top.The last event showsthat the returned value, position, is nil.The previous events show that this is because the methodregularPositionAtDate, meant to initialize position,is not called because its receiver object is nil.Looking at the arrows, this happens alongthe default case of the switch.Going back to the beginning of the report revealsthat the receiver object is initialized to niland remains so along the default case.Now, I understand that I haven't handled objects that are notspherical or irregular within the switch.To fix this, I am going to makethe default case identical to the spherical case.I will rerun the analyzer to make sure the issue is fixed.I am quite relieved that this bugis detected while I am developing the app.This is because returning nil from an Objective-C methodannotated as returning a non-null valuecan result in unexpected runtime behavior when the methodis called from Swift, which happens in my code.Thankfully, running the static analyzer has revealedthis bug before it could affect the users of my app.In Xcode 13, we have made the analyzer even better,and we have some brand-new checks for you.The analyzer can now catch more logic bugs in your code.It can detect infinite loops and redundant code,such as unnecessary branch conditions.It can report side-effects in asserts, and in C++ code,it can catch errors in the use of move and forward operators.Parts of these new checks are open-source contributionsmade to Apple's Clang compiler.Let's see some examples of bugs these new checks can catch.In general, it's a good practice to use asserts to validateyour expectations about your code.However, you must make surethat asserts do not have side effects,such as writing to variables or memory.For example, consider the code snippetshown here that traverses an arrayof astronomical objects and counts the numberof those that have associated moons.It has an NSAssert that checks that the number of objectswith moons is less than or equal to the number of planets.But the assert has a side effect of incrementingthe counter tracking the objects with moons.Updates like this can be lost in the releasebuild configuration, where asserts couldbe disabled to make your code run faster.So this code may not increment the counterat all in release builds.It's easy to miss bugs like these during development,as they do not show up in debug builds.Starting Xcode 13, the analyzer can findsuch issues in your code and report it.This check works not just for NSAsserts,but also for asserts in C and C++.These bugs are easy to fix,and you just move the side effectoutside of the assert, as shown here.Infinite loops are another common bug.You might have seen it happenwhen there are loops with complex logic.For instance, the nested loop shown here triesto populate a two-dimensional grid with a value.It hides a bug where the variable valueis incremented by the inner loop instead of column,which is the actual loop counter.The analyzer can now detect such mistakes and explain it to you.Once you spot it, this bug is very easy to fix.Just replace value by column.Though these checks find simple mistake,we have found real bugs with them.Now you can use them, too, and find bugsand fix them as you develop your app.Xcode offers many customizations for fine tuning the analyzerto fit in with your development workflow.You can make the analyzer run along with every buildof your project from the project's build settings.To quickly narrow down on the relevant settings,make use of the search functionality.For example, using "analysis" as the search keyword,I can look at just those options relevant to the analyzer.To enable Analyze During 'Build',all you need to do is turn on a build setting.Like incremental builds, the analysis runsonly on files that are modified.This makes running the analyzer after code changesboth fast and easy.The analyzer offers two modes of analysis: shallow and deep.Shallow mode is faster, but avoids exploringbugs spanning multiple functions.Use this mode in projectsthat are sensitive to build and analysis times.As I mentioned earlier, the analyzer has checksfor finding different kinds of bugs,and some of them are opt-in.You can fine tune the checksthat suit your project by enabling or disabling themselectively from the build settings.For instance, if your project has security-critical code,enable the checks for security issues.On the other hand, if you find that some issuesare not relevant to your code, you can disable less usefulchecks individually and still benefit from the other checks.You can also analyze a single fileinstead of the entire project.Choose the file to analyze from the Product > Perform Action menu.Use this to check your changes quickly,without even needing to build your project.This is particularly useful when modifying header files.It would skip reanalyzing all files importing it.The static analyzer in Xcode can reveal bugsin your code very early during development.Run it with a click of a button and find many kinds of bugs.And don't forget to customize it to your workflow.In Xcode 13, we have further improved the analyzerand added many new checks for finding logical bugs.Use the analyzer and fix bugs in your appbefore they reach your users.Thank you, and enjoy the rest of WWDC![upbeat music]

♪ ♪I am Ravi Kandadai Madhavan,and in this video,I will show how to use the static analyzerin Xcode to find and fix bugs in your apps.First, I will demonstrate how to usethe static analyzer to find bugs and also understand them.Then, I will describe the new checks in Xcode 13,which can help find more kinds of issues in your code.Finally, I will describe the waysin which you can customize the analyzerto better integrate it with your development workflow.Let's now see how to use the analyzer to find bugs.The static analyzer is a tool in Xcode that can discover bugsby analyzing the source code without running it,so it can reveal bugs, even before you dotesting and quality assurance of your app.It can also find problems in code pathsthat are rare and not covered by tests.The analyzer finds bugs in C/C++ and Objective-C code,even in mixed Swift and Objective-C projects.Let us see the analyzer in actionusing an app I am developing.I am trying to improve an existing app written in Swiftand Objective-C that allows exploring the solar system.This is the Xcode project for the app.I am going to run the Static Analyzer to seeif it finds anything wrong with my code.It's very easy to run.Just go to Product and choose Analyze,or use the keyboard shortcut Command-Shift-B.

You can see the analyzer running in the status bar of Xcode.Analyzing your project is very similar to building it.The analyzer scans all the sources files in the targetsof the currently-active scheme looking for bugs.As you see in the status,the analyzer has found an issue in my project.I can go to Xcode's issue navigatorto learn more about it.As I showed you, all it takes to runthe analyzer on your project is a single click.And with this single click, you can findseveral kinds of bugs, like security issues,logical bugs, misuse of APIs, and many more.The analyzer can not only find bugs,but can also explain them.Let's get back to the bug found in my appand try to understand it.The problem here is that the Objective-C methodpositionAtDate is returning nil when it is not supposed to.The method's return value is declared to be non-nullin the method's definition.But now, I want to understand howthis method is returning nil.You can expand the analyzer issuesand see the sequence of events that lead to the bug.The events are also shown in the editor,alongside the statements where they happen.The arrows show how the events are ordered.I find it easier to read these reports from bottom to top.The last event showsthat the returned value, position, is nil.The previous events show that this is because the methodregularPositionAtDate, meant to initialize position,is not called because its receiver object is nil.

Looking at the arrows, this happens alongthe default case of the switch.Going back to the beginning of the report revealsthat the receiver object is initialized to niland remains so along the default case.Now, I understand that I haven't handled objects that are notspherical or irregular within the switch.

To fix this, I am going to makethe default case identical to the spherical case.I will rerun the analyzer to make sure the issue is fixed.

I am quite relieved that this bugis detected while I am developing the app.This is because returning nil from an Objective-C methodannotated as returning a non-null valuecan result in unexpected runtime behavior when the methodis called from Swift, which happens in my code.Thankfully, running the static analyzer has revealedthis bug before it could affect the users of my app.In Xcode 13, we have made the analyzer even better,and we have some brand-new checks for you.The analyzer can now catch more logic bugs in your code.It can detect infinite loops and redundant code,such as unnecessary branch conditions.It can report side-effects in asserts, and in C++ code,it can catch errors in the use of move and forward operators.Parts of these new checks are open-source contributionsmade to Apple's Clang compiler.Let's see some examples of bugs these new checks can catch.In general, it's a good practice to use asserts to validateyour expectations about your code.However, you must make surethat asserts do not have side effects,such as writing to variables or memory.For example, consider the code snippetshown here that traverses an arrayof astronomical objects and counts the numberof those that have associated moons.It has an NSAssert that checks that the number of objectswith moons is less than or equal to the number of planets.But the assert has a side effect of incrementingthe counter tracking the objects with moons.Updates like this can be lost in the releasebuild configuration, where asserts couldbe disabled to make your code run faster.So this code may not increment the counterat all in release builds.It's easy to miss bugs like these during development,as they do not show up in debug builds.Starting Xcode 13, the analyzer can findsuch issues in your code and report it.This check works not just for NSAsserts,but also for asserts in C and C++.These bugs are easy to fix,and you just move the side effectoutside of the assert, as shown here.

Infinite loops are another common bug.You might have seen it happenwhen there are loops with complex logic.For instance, the nested loop shown here triesto populate a two-dimensional grid with a value.It hides a bug where the variable valueis incremented by the inner loop instead of column,which is the actual loop counter.The analyzer can now detect such mistakes and explain it to you.

Once you spot it, this bug is very easy to fix.Just replace value by column.Though these checks find simple mistake,we have found real bugs with them.Now you can use them, too, and find bugsand fix them as you develop your app.Xcode offers many customizations for fine tuning the analyzerto fit in with your development workflow.You can make the analyzer run along with every buildof your project from the project's build settings.To quickly narrow down on the relevant settings,make use of the search functionality.For example, using "analysis" as the search keyword,I can look at just those options relevant to the analyzer.

To enable Analyze During 'Build',all you need to do is turn on a build setting.Like incremental builds, the analysis runsonly on files that are modified.This makes running the analyzer after code changesboth fast and easy.The analyzer offers two modes of analysis: shallow and deep.Shallow mode is faster, but avoids exploringbugs spanning multiple functions.Use this mode in projectsthat are sensitive to build and analysis times.As I mentioned earlier, the analyzer has checksfor finding different kinds of bugs,and some of them are opt-in.You can fine tune the checksthat suit your project by enabling or disabling themselectively from the build settings.For instance, if your project has security-critical code,enable the checks for security issues.On the other hand, if you find that some issuesare not relevant to your code, you can disable less usefulchecks individually and still benefit from the other checks.

You can also analyze a single fileinstead of the entire project.Choose the file to analyze from the Product > Perform Action menu.Use this to check your changes quickly,without even needing to build your project.This is particularly useful when modifying header files.It would skip reanalyzing all files importing it.The static analyzer in Xcode can reveal bugsin your code very early during development.Run it with a click of a button and find many kinds of bugs.And don't forget to customize it to your workflow.In Xcode 13, we have further improved the analyzerand added many new checks for finding logical bugs.Use the analyzer and fix bugs in your appbefore they reach your users.Thank you, and enjoy the rest of WWDC![upbeat music]

## Code Samples

