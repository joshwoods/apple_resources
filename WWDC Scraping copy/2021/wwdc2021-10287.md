# Wwdc2021 10287

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Transcript

Code

Measure health with motionDiscover how you can take your app's health monitoring to the next level with motion data. Meet Walking Steadiness for iPhone and the six-minute-walk metric for Apple Watch: Walking Steadiness can help your app interpret someone's quality of walking and risk of falling, while the six-minute-walk metric — along with the HealthKit estimate recalibration API — can track changes to walking endurance following acute events like surgery. We'll show you how you can support these metrics and help provide actionable health data to people who use your app, helping improve patient care and clinical trials, especially as more services must be delivered remotely.ResourcesappleWalkingSteadinessappleWalkingSteadinessEventCMFallDetectionManagerCore MotionGetting movement disorder symptom dataHKAppleWalkingSteadinessClassificationMeasuring Walking Quality Through iPhone Mobility MetricsUsing Apple Watch to Estimate Cardio Fitness with VO2 maxUsing Apple Watch to Estimate Six-Minute Walk DistanceHD VideoSD VideoRelated VideosWWDC20Beyond counting stepsGetting started with HealthKit

Discover how you can take your app's health monitoring to the next level with motion data. Meet Walking Steadiness for iPhone and the six-minute-walk metric for Apple Watch: Walking Steadiness can help your app interpret someone's quality of walking and risk of falling, while the six-minute-walk metric — along with the HealthKit estimate recalibration API — can track changes to walking endurance following acute events like surgery. We'll show you how you can support these metrics and help provide actionable health data to people who use your app, helping improve patient care and clinical trials, especially as more services must be delivered remotely.

appleWalkingSteadiness

appleWalkingSteadinessEvent

CMFallDetectionManager

Core Motion

Getting movement disorder symptom data

HKAppleWalkingSteadinessClassification

Measuring Walking Quality Through iPhone Mobility Metrics

Using Apple Watch to Estimate Cardio Fitness with VO2 max

Using Apple Watch to Estimate Six-Minute Walk Distance

HD VideoSD Video

HD Video

SD Video

Beyond counting steps

Getting started with HealthKit

Search this video…♪ Bass music playing ♪♪Irida Mance: Hello and welcome to WWDC.I'm Irida, a scientist on the Apple software team,and I will be joined by Sohum, a Motion engineer.Today, we'll introduce two brand-new featuresthat will enable you to better understand walking enduranceand quality.Walking is a vital sign.The way an individual walks is highly informativeof their overall health and well-being.It can be used to track recovery from an injury,assess risk of falling, monitor the aging process,and even predict mortality.At WWDC2020, we introduced a suite of mobility metricsthat provide a powerful insight into your walking patternsthroughout the day.You can learn all about them in last year's session,"Beyond counting steps".Today we're excited to share an updateto one of these metrics:the Six-Minute Walk metric, available for Apple Watch.Through a new recalibration API, the metric will enable youto better capture acute changes in health.In addition, we're going to talk about a brand-new metric:the Walking Steadiness feature, available for iPhone.What do these two metrics have in common?They're both great ways to track important aspectsof walking and can provide continuousand objective measures for monitoring improvementsor catching early warning signs.But they capture different things.The Six-Minute Walk metric estimates how far you can walkin six minutesand is a measure of your walking capacity and endurance.Walking steadiness captures the quality of your walkingand is designed to make it easy for youto assess an individual's risk of fallingbased on their mobility.Whether you are tracking these metrics week over week --to measure changes in response to treatment --or year over year --to monitor natural aging trends --both metrics can provide a unique windowinto an individual's health.We'll start by diving deeperinto the Six-Minute Walk distance metric.The in-clinic Six-Minute Walk testis a staple for clinicians in many fieldsto assess cardiovascular and musculoskeletal health.The metric captures walking endurancefor low-capacity individuals.It can help identify which individualshave a lower endurance relative to others their age and height,which is often indicative of poor health outcomes.This year, using a new recalibration API,the Six-Minute Walk metric is also a great wayto track changes to walking capacityfollowing an intervention -- such as a surgery --or an acute events, like an injury.Let's run through a scenariowhere recalibrating the Six-Minute Walk metricwill be useful.Imagine that we have a patient, Jamie,who just had knee surgery.We know that Jamie could barely walk after surgery,but we only see a small dipin their Six-Minute Walk estimate.Let's look into what may be causing this.To build an accurate estimate of an individual's capacity,the Six-Minute Walk distance estimate looks at activityand motion data across a historical measurement window.For example,this is the measurement window used for this estimate.To see how far back an estimate looked,you can use a brand-new metadata field,which will tell youthe beginning of the data window used.We can see that our example estimateused data from way before the surgery.What we can do now is recalibrate our estimatesto use data only postsurgery.With this recalibration,our estimates now capture Jamie's true dip in mobilityimmediately following the surgery, which allowsfor a way more accurate pre- and postsurgery comparison.Now, Sohum can show ushow to use these new features in your app.Sohum Thakkar: Thank you, Irida!The recalibration API lets you use your knowledgeof Jamie's surgery dateto improve their Six-Minute Walk distance estimates.If know you want to recalibrate,you can use the brand-new recalibrateEstimates methodin HKHealthStore.This new method has a few requirements.The first thing you need is a SampleTypethat can be recalibrated.You can check if a type can be recalibratedwith the .allowsRecalibration ForEstimates property.As of iOS 15,sixMinuteWalkType is the only sampleTypethat can be recalibrated.The second thing you need is a new entitlement.You can add this entitlement to your Xcode project yourself.And lastly, your app will need authorizationfor both reading and sharing the SampleType.To prompt the user to grant your app authorization,simply create a setwith just the Six-Minute Walk distance type,and then pass it into healthStore. requestAuthorization.And with those requirements out of the way,let's recalibrate.Just use HKHealthStore's recalibrateEstimates methodand pass in the date of surgery.Since this affects the patient's health data,a prompt will pop up on screenasking them to allow the recalibration.And that's it!For the next few estimates,you'll see the recalibration datereflected in the Measurement Start Datein the Health Appand in the EarliestDateUsed ForEstimate metadatathat will come with every HealthKit sample.A few things to consider:First, this method does not affect estimatesthat are already present in HealthKit at the time of use,so it's important to recalibrate as soon as possibleafter a surgery.Secondly, after recalibration,it could take up to 14 daysto rebuild enough activity historyto make a confident estimate.And thirdly, the effect is temporary.Once the recalibration date is far enough in the past,the estimates will once againstart using their normal measurement window.You might be tempted to recalibrate every fallor every surgery you learn about,but these often don't result in reduced mobility or fitness.There's a trade-off.In general, a longer data windowwill result in more accurate estimatesbut will be less responsive to acute changes.In Jamie's case,we know their surgery will cause a substantial changeto their mobility and fitness,and we'd like to monitor that change closely.If they're not recovering well,we can reach out and provide support.This new recalibration API extends the capabilitiesof Apple's Six-Minute Walk distance metricto a whole new use case of tracking recoveryfrom injury or surgery.We hope you'll find it usefulin better monitoring your patient's healthand improving outcomes.Now I'd like to pass it off to Iridato tell you about a brand-new metric, Walking Steadiness,which measures a different dimension of your walking.Irida: Thanks, Sohum.In addition to being able to track how muchor how far an individual is able to walk,it's also important to monitor the quality of that movement.With iOS 15, we've built upon our foundational understandingof walking quality and extended it through a new metric,the Apple Walking Steadiness metric.The metric is designed for youto better understand your overall walking qualityand can help assess your risk of fallingdue to a mobility limitation in the next 12 months.Your quality of walking is impacted by many factors,including your muscular strength,your physical endurance, your balance,or external factors like injuries or surgeries,all of which can alter your risk of falling.The Apple Walking Steadiness metric provides a unified wayto track the mobility components that contribute to fall risk.The feature consists of three elements.First, we provide a scorethat can be used to continuously monitor changesin walking steadiness over time.A new score will be saved to HealthKit weekly,and it will represent the user's steadiness for that week.The score provides you the greatest level of detail;the higher the score, the better your walking quality,and the lower your predicted risk of fallingbecause of a mobility limitation.Second,to give a better idea of what the steadiness scores mean,we've categorized them into three classifications:OK, Low, and Very Low.These classifications provide you a simpler wayof identifying who is at the highest risk of falling.Lastly,after individuals onboard onto the Walking Steadiness featurein the Health app,we have enabled a notification.The notification will alert individualswhenever their steadiness has droppedto the Low or Very Low category,or if they've remained at those categories for several months.Now you may be wondering, What does steadiness look likefor typical healthy individuals throughout their life?Let's see what the Walking Steadiness metriccould look like for two folks.For this individual,their walking quality decreases as they age.This is fairly typical.We've all seen that our elderly relativesmay not walk as well as us.But we also know there are behavioral factorsthat contribute to steadiness.For example,an individual that is able to maintain a high level of fitnessis likely to preserve a higher quality of walkingas they age.But we also know that age or better fitnessare not the only factors that impact walking steadiness.Acute events like an ankle injurycan drastically change walking qualityand lead to heightened fall risk.So anyone can bounce between steadiness categoriesthroughout their life.And as I mentioned,the steadiness classification helps you understandthe significance of these changes.Let's dive a little deeperinto what individuals with these classification levelsmay look like.An OK classification will be your healthy, confident walker.They generally will not have any difficultygoing about their day and doing many of the tasksthat challenge their strength and coordination.Their scores will be high, and their risk of fallingdue to a mobility-related health issue is low.A low-classification individualwill have more compromised mobility.They may be generally OK;but in more challenging situations --say a difficult hike --they may need to take more precautionsto prevent from falling.They might not have fallen yet,but this early awareness will be useful.Lastly,a Very Low classification is indicativeof someone that has noticeably compromised steadiness.Based on their mobility,this individual would be at high risk of falling.Again, they might not have fallen yet,but their mobility is compromised,and they should take the necessary measuresto avoid situations where falls are more likely to happenor, if possible, to improve their strength and balancethrough exercise.All right.That's what this metric is capable of.Now you might ask,What is required to get a Walking Steadiness estimate?Actually, not much.the metric is optimized to measure steadinesswhile individuals are carrying their iPhonein some of the most common locations,for example, a pant pocket, a jacket pocket,even a purse held closely;all will work as long as the device is held tightlyto the center of your body.Now back to Sohum to walk us throughhow to leverage the Walking Steadiness metricin your apps.Thanks, Iridafor that introduction to Walking Steadiness.Let's put it to use.Imagine you're building an app for a physical therapy clinic.One of the toughest challenges in physical therapyand rehabilitation is tracking progress.And now that most visits are virtual,and telehealth is gaining popularity,it can be even tougher.Let's say your app's purpose is to keep patients up to dateand identify those at higher risk of fallingand those who are declining in steadiness.That's an incredibly difficult thing to measure,but Walking Steadiness can help.As Irida mentioned,Walking Steadiness has three elements:the score, the classification, and the notification.We'll see how each can be integrated into your appfor physical therapy patients...starting with the score.Let's say you want to displaya patient's most recent steadiness score.Let's see how to do that.The score is a HealthKit quantityTypewith the name appleWalkingSteadiness.Since it's an Apple-defined metric, it's read-only.Its unit in HealthKit is percent,and it ranges from zero to one.And it's written weekly,although estimates may be delayedif there isn't enough data to compute an estimate.To kick us off, let's grab an authorization.We'll construct a set with the appleWalkingSteadiness type.Then, we'll call requestAuthorization.To get the most recent steadiness score,we'll construct a SampleQuery with a limit of one,sorted by end date.If there is a returned sample,we'll grab the value with percent unitsand update our status in the app.This is what it'll look like.The score is great for tracking trends,but is sometimes kind of hard to interpret on its own.What does 45 mean?The classification might be the more appropriate levelof granularity for most people.Let's use it to add context.The classification comes in the formof a brand-new HealthKit enum:HKAppleWalkingSteadiness Classification.The enum can take the values .ok, .low, and .veryLow.Starting from our previous code to grab the most recent score,it only takes a single lineto convert a score to a classification.The classification enum has a convenience constructorthat will translate a score to the appropriate classification.And we'll display the classificationalong with the score.There! That's far more interpretable.Now we can tell this individual is in the Low classificationand may be at increased risk of falling.OK, so now let's tackle the patient-monitoring portionof this app.We'd like to be able to identifyand reach out to patients who are at high risk of falling.The Walking Steadiness notification is great for this.You can register to be notifiedwhen a patient receives a steadiness notificationand reach out to them for a check-in.The notification arrives in HealthKitas a CategoryType sample, and it's called"appleWalkingSteadinessEvent" in HealthKit.It's also a read-only type.There are four types of steadinessEvents..initialLow and .initialVeryLow are triggered about a monthafter the individual dropsinto the Low or Very Low classifications.After this initial notification,.repeatLow or .repeatVeryLow eventswill remind the individual about once every three monthsif they stay at the same classification.You can read more about the notification typesin the developer documentationin the links associated with this session.To read the notifications,we'll need another authorization.This time, we'll construct a setwith only the type appleWalkingSteadinessEventand pass it in to the requestAuthorization method.Let's watch for notifications.Here we're creating an HKObserverQuerythat will execute a handler every time a steadiness eventis saved to HealthKit,meaning the user got a notification.In this handler, we'll prompt the user for a checkup.We'll also allow HealthKit to deliver the event to usin the background to ensure we can respondto the notification within a day.When we execute the query,our app will begin listening for notifications.And every time the user receives a notification,we could trigger a promptto schedule a virtual checkup with the clinic.Great! Now you can reach out to patients at increased fall risk.But there are other usersa physical therapy clinic might be interested in.Here's an example of a patient who showed great progressat first but is now declining in steadiness.They wouldn't have receiveda Walking Steadiness notificationbecause they aren't yet at a higher-fall-risk classification.But a physical therapy clinicmight be concerned about trends like this.Are the exercises appropriate?Are they causing damage?Is the patient just not keeping up?We'd like to schedule a follow-up,so let's design our own notification criteria.Here are the patient's steadiness scores over time.The plan is to query six weeks of steadiness scoresand calculate the best-fit slope.We'll do this every week,and if a patient's steadiness is declining more than, say,five points per week on average,we should try to schedule a check-in.Let's create a predicate to query in the past six weeksand execute an HKSampleQueryfor the appleWalkingSteadiness QuantityType.In the callback,we'll pass the results off to a detectTrends function.Now, all we need to do is calculate the best-fit slope,using a custom function we have defined,and check if it's less than -5,meaning steadiness is decliningat a rate of over five points per week.And if it is, we can prompt the user for a checkup,just like before.So now when we detect their steadiness is declining,they will receive a prompt!So that's how to use all three elementsof Walking Steadinessand how to design your own simple notification criteria.It's never been so easyto perform passive mobility monitoring.But let's not get ahead of ourselves.All of this is dependenton the patient getting Walking Steadiness scores.Here are four best practicesto make sure they don't miss a single sample.First off, users will only get steadinessif they have their height set in the Health app.Weight and age are highly recommended.So first things first, let's prompt them for those.We recommend writing updated samples directly,via the HealthKit API.Secondly, we recommend prompting the userto turn on Apple's Walking Steadiness notifications.They can do this from the Health app in the Mobility room.Third, as Irida mentioned,for the vast majority of patients,keeping their phone in their pocketwhile they go about their everyday activitiesis enough to get steadiness scores.Let's just encourage them to take their phone with themwhile they're walking around.To check if they're meeting the walking criteria,we can check if they're receivingwalking speed estimates in HealthKit.Two weeks with consistent Walking Speed samplesis a good indicator they're carrying their device enough.As a reminder,walking speed requires an iPhone 8 or above,and is measured when the phone is held tightlyto the center of the body while walking over flat ground.A quick glance in the Health app,or a quick HealthKit query,can tell us if we need to prompt themto walk with their phone more.So there you have it!You have all the tools you needto build the next-generation physical therapy appthat can keep track of your patient's walking qualitywithout any dedicated equipment or assessments.Now, over to Irida to talk about the many other amazing waysyou can use Walking Steadiness for health monitoring.Irida: Thanks, Sohum.We just saw how Walking Steadinesscan make a huge difference to virtual carefor physical therapy, and it can do so much more.Consider using Walking Steadinessif you want to build an app that helps familiescheck up on an aging grandparent,or perhaps you can help patients with neurological diseaseslike multiple sclerosis monitor disease progression.You could even use it to recommend workoutsand hikes that are more tailored to an individual's fall risk.Walking Steadiness and the new capabilitiesfor Six-Minute Walk built on top of a rich ecosystemfor using motion sensing to monitor heath.Given the strong ties between mobility,cardiovascular and respiratory functioning,we encourage you to explorehow metrics related to cardiovascular healthon the Apple Watch --and mobility for the iPhone --can be used for rehabilitation or prehabilitation applications,to best prepare patients for successful surgery.Or consider how Walking Steadiness,the mobility metrics, and our Movement Disorder APIcan be combined to monitor the complicated motor symptomsof Parkinson's Disease.The combination of these metricscan unlock a truly powerful experience for your apps.To wrap up, we want to provide some best practiceswhen collecting this data.First,though walking is something we don't often think a lot about,as we've just seen, it carries a powerful health signal.As with any health information,make sure that your data collection has strong privacyand security safeguards.Any data you take outside of HealthKitshould at the very least be key-coded and encrypted.Next, you should be transparentabout the information you are collecting and why.Anytime you request to read a certain HealthKit type,we'll prompt the user to approve its use.But beyond this basic measure, it's our joint responsibilityto collect only the most meaningful dataand to be transparent on how that data will be used.For example, for Six-Minute Walk estimates,our users should understand when the recalibration is appropriateand how it helps their care.For the Walking Steadiness metric,the requirements to get an estimateshould be clearly communicated.Working with domain experts,like physicians or physical therapists,will ensure that you collect the most meaningful datafrom these metrics.Lastly, your customer should have control of their data.In HealthKit, an individual can tap Show All Dataand delete any and all samples collected from them.If you take data outside of HealthKit,your customer should have an easy way to view and delete,turn off data collection,or have other means to exercise controlover what is collected from them.Whether you are using Walking Steadinessto measure quality of movement,the Six-Minute Walk metric to assess recovery from injury,or any other health metric,following these guidelines will protect our customers' dataand promote user trust.A commitment to these principles is essentialwhen handling any health data.OK, that's a wrap for us.We want to thank you for watchingand being part of WWDC21.We cannot wait to see what you build next.♪

♪ Bass music playing ♪♪Irida Mance: Hello and welcome to WWDC.

I'm Irida, a scientist on the Apple software team,and I will be joined by Sohum, a Motion engineer.

Today, we'll introduce two brand-new featuresthat will enable you to better understand walking enduranceand quality.

Walking is a vital sign.

The way an individual walks is highly informativeof their overall health and well-being.

It can be used to track recovery from an injury,assess risk of falling, monitor the aging process,and even predict mortality.

At WWDC2020, we introduced a suite of mobility metricsthat provide a powerful insight into your walking patternsthroughout the day.

You can learn all about them in last year's session,"Beyond counting steps".

Today we're excited to share an updateto one of these metrics:the Six-Minute Walk metric, available for Apple Watch.

Through a new recalibration API, the metric will enable youto better capture acute changes in health.

In addition, we're going to talk about a brand-new metric:the Walking Steadiness feature, available for iPhone.

What do these two metrics have in common?They're both great ways to track important aspectsof walking and can provide continuousand objective measures for monitoring improvementsor catching early warning signs.

But they capture different things.

The Six-Minute Walk metric estimates how far you can walkin six minutesand is a measure of your walking capacity and endurance.

Walking steadiness captures the quality of your walkingand is designed to make it easy for youto assess an individual's risk of fallingbased on their mobility.

Whether you are tracking these metrics week over week --to measure changes in response to treatment --or year over year --to monitor natural aging trends --both metrics can provide a unique windowinto an individual's health.

We'll start by diving deeperinto the Six-Minute Walk distance metric.

The in-clinic Six-Minute Walk testis a staple for clinicians in many fieldsto assess cardiovascular and musculoskeletal health.

The metric captures walking endurancefor low-capacity individuals.

It can help identify which individualshave a lower endurance relative to others their age and height,which is often indicative of poor health outcomes.

This year, using a new recalibration API,the Six-Minute Walk metric is also a great wayto track changes to walking capacityfollowing an intervention -- such as a surgery --or an acute events, like an injury.

Let's run through a scenariowhere recalibrating the Six-Minute Walk metricwill be useful.

Imagine that we have a patient, Jamie,who just had knee surgery.

We know that Jamie could barely walk after surgery,but we only see a small dipin their Six-Minute Walk estimate.

Let's look into what may be causing this.

To build an accurate estimate of an individual's capacity,the Six-Minute Walk distance estimate looks at activityand motion data across a historical measurement window.

For example,this is the measurement window used for this estimate.

To see how far back an estimate looked,you can use a brand-new metadata field,which will tell youthe beginning of the data window used.

We can see that our example estimateused data from way before the surgery.

What we can do now is recalibrate our estimatesto use data only postsurgery.

With this recalibration,our estimates now capture Jamie's true dip in mobilityimmediately following the surgery, which allowsfor a way more accurate pre- and postsurgery comparison.

Now, Sohum can show ushow to use these new features in your app.

Sohum Thakkar: Thank you, Irida!The recalibration API lets you use your knowledgeof Jamie's surgery dateto improve their Six-Minute Walk distance estimates.

If know you want to recalibrate,you can use the brand-new recalibrateEstimates methodin HKHealthStore.

This new method has a few requirements.

The first thing you need is a SampleTypethat can be recalibrated.

You can check if a type can be recalibratedwith the .allowsRecalibration ForEstimates property.

As of iOS 15,sixMinuteWalkType is the only sampleTypethat can be recalibrated.

The second thing you need is a new entitlement.

You can add this entitlement to your Xcode project yourself.

And lastly, your app will need authorizationfor both reading and sharing the SampleType.

To prompt the user to grant your app authorization,simply create a setwith just the Six-Minute Walk distance type,and then pass it into healthStore. requestAuthorization.

And with those requirements out of the way,let's recalibrate.

Just use HKHealthStore's recalibrateEstimates methodand pass in the date of surgery.

Since this affects the patient's health data,a prompt will pop up on screenasking them to allow the recalibration.

And that's it!For the next few estimates,you'll see the recalibration datereflected in the Measurement Start Datein the Health Appand in the EarliestDateUsed ForEstimate metadatathat will come with every HealthKit sample.

A few things to consider:First, this method does not affect estimatesthat are already present in HealthKit at the time of use,so it's important to recalibrate as soon as possibleafter a surgery.

Secondly, after recalibration,it could take up to 14 daysto rebuild enough activity historyto make a confident estimate.

And thirdly, the effect is temporary.

Once the recalibration date is far enough in the past,the estimates will once againstart using their normal measurement window.

You might be tempted to recalibrate every fallor every surgery you learn about,but these often don't result in reduced mobility or fitness.

There's a trade-off.

In general, a longer data windowwill result in more accurate estimatesbut will be less responsive to acute changes.

In Jamie's case,we know their surgery will cause a substantial changeto their mobility and fitness,and we'd like to monitor that change closely.

If they're not recovering well,we can reach out and provide support.

This new recalibration API extends the capabilitiesof Apple's Six-Minute Walk distance metricto a whole new use case of tracking recoveryfrom injury or surgery.

We hope you'll find it usefulin better monitoring your patient's healthand improving outcomes.

Now I'd like to pass it off to Iridato tell you about a brand-new metric, Walking Steadiness,which measures a different dimension of your walking.

Irida: Thanks, Sohum.

In addition to being able to track how muchor how far an individual is able to walk,it's also important to monitor the quality of that movement.

With iOS 15, we've built upon our foundational understandingof walking quality and extended it through a new metric,the Apple Walking Steadiness metric.

The metric is designed for youto better understand your overall walking qualityand can help assess your risk of fallingdue to a mobility limitation in the next 12 months.

Your quality of walking is impacted by many factors,including your muscular strength,your physical endurance, your balance,or external factors like injuries or surgeries,all of which can alter your risk of falling.

The Apple Walking Steadiness metric provides a unified wayto track the mobility components that contribute to fall risk.

The feature consists of three elements.

First, we provide a scorethat can be used to continuously monitor changesin walking steadiness over time.

A new score will be saved to HealthKit weekly,and it will represent the user's steadiness for that week.

The score provides you the greatest level of detail;the higher the score, the better your walking quality,and the lower your predicted risk of fallingbecause of a mobility limitation.

Second,to give a better idea of what the steadiness scores mean,we've categorized them into three classifications:OK, Low, and Very Low.

These classifications provide you a simpler wayof identifying who is at the highest risk of falling.

Lastly,after individuals onboard onto the Walking Steadiness featurein the Health app,we have enabled a notification.

The notification will alert individualswhenever their steadiness has droppedto the Low or Very Low category,or if they've remained at those categories for several months.

Now you may be wondering, What does steadiness look likefor typical healthy individuals throughout their life?Let's see what the Walking Steadiness metriccould look like for two folks.

For this individual,their walking quality decreases as they age.

This is fairly typical.

We've all seen that our elderly relativesmay not walk as well as us.

But we also know there are behavioral factorsthat contribute to steadiness.

For example,an individual that is able to maintain a high level of fitnessis likely to preserve a higher quality of walkingas they age.

But we also know that age or better fitnessare not the only factors that impact walking steadiness.

Acute events like an ankle injurycan drastically change walking qualityand lead to heightened fall risk.

So anyone can bounce between steadiness categoriesthroughout their life.

And as I mentioned,the steadiness classification helps you understandthe significance of these changes.

Let's dive a little deeperinto what individuals with these classification levelsmay look like.

An OK classification will be your healthy, confident walker.

They generally will not have any difficultygoing about their day and doing many of the tasksthat challenge their strength and coordination.

Their scores will be high, and their risk of fallingdue to a mobility-related health issue is low.

A low-classification individualwill have more compromised mobility.

They may be generally OK;but in more challenging situations --say a difficult hike --they may need to take more precautionsto prevent from falling.

They might not have fallen yet,but this early awareness will be useful.

Lastly,a Very Low classification is indicativeof someone that has noticeably compromised steadiness.

Based on their mobility,this individual would be at high risk of falling.

Again, they might not have fallen yet,but their mobility is compromised,and they should take the necessary measuresto avoid situations where falls are more likely to happenor, if possible, to improve their strength and balancethrough exercise.

All right.

That's what this metric is capable of.

Now you might ask,What is required to get a Walking Steadiness estimate?Actually, not much.

the metric is optimized to measure steadinesswhile individuals are carrying their iPhonein some of the most common locations,for example, a pant pocket, a jacket pocket,even a purse held closely;all will work as long as the device is held tightlyto the center of your body.

Now back to Sohum to walk us throughhow to leverage the Walking Steadiness metricin your apps.

Thanks, Iridafor that introduction to Walking Steadiness.

Let's put it to use.

Imagine you're building an app for a physical therapy clinic.

One of the toughest challenges in physical therapyand rehabilitation is tracking progress.

And now that most visits are virtual,and telehealth is gaining popularity,it can be even tougher.

Let's say your app's purpose is to keep patients up to dateand identify those at higher risk of fallingand those who are declining in steadiness.

That's an incredibly difficult thing to measure,but Walking Steadiness can help.

As Irida mentioned,Walking Steadiness has three elements:the score, the classification, and the notification.

We'll see how each can be integrated into your appfor physical therapy patients...

starting with the score.

Let's say you want to displaya patient's most recent steadiness score.

Let's see how to do that.

The score is a HealthKit quantityTypewith the name appleWalkingSteadiness.

Since it's an Apple-defined metric, it's read-only.

Its unit in HealthKit is percent,and it ranges from zero to one.

And it's written weekly,although estimates may be delayedif there isn't enough data to compute an estimate.

To kick us off, let's grab an authorization.

We'll construct a set with the appleWalkingSteadiness type.

Then, we'll call requestAuthorization.

To get the most recent steadiness score,we'll construct a SampleQuery with a limit of one,sorted by end date.

If there is a returned sample,we'll grab the value with percent unitsand update our status in the app.

This is what it'll look like.

The score is great for tracking trends,but is sometimes kind of hard to interpret on its own.

What does 45 mean?The classification might be the more appropriate levelof granularity for most people.

Let's use it to add context.

The classification comes in the formof a brand-new HealthKit enum:HKAppleWalkingSteadiness Classification.

The enum can take the values .ok, .low, and .veryLow.

Starting from our previous code to grab the most recent score,it only takes a single lineto convert a score to a classification.

The classification enum has a convenience constructorthat will translate a score to the appropriate classification.

And we'll display the classificationalong with the score.

There! That's far more interpretable.

Now we can tell this individual is in the Low classificationand may be at increased risk of falling.

OK, so now let's tackle the patient-monitoring portionof this app.

We'd like to be able to identifyand reach out to patients who are at high risk of falling.

The Walking Steadiness notification is great for this.

You can register to be notifiedwhen a patient receives a steadiness notificationand reach out to them for a check-in.

The notification arrives in HealthKitas a CategoryType sample, and it's called"appleWalkingSteadinessEvent" in HealthKit.

It's also a read-only type.

There are four types of steadinessEvents.

.initialLow and .initialVeryLow are triggered about a monthafter the individual dropsinto the Low or Very Low classifications.

After this initial notification,.repeatLow or .repeatVeryLow eventswill remind the individual about once every three monthsif they stay at the same classification.

You can read more about the notification typesin the developer documentationin the links associated with this session.

To read the notifications,we'll need another authorization.

This time, we'll construct a setwith only the type appleWalkingSteadinessEventand pass it in to the requestAuthorization method.

Let's watch for notifications.

Here we're creating an HKObserverQuerythat will execute a handler every time a steadiness eventis saved to HealthKit,meaning the user got a notification.

In this handler, we'll prompt the user for a checkup.

We'll also allow HealthKit to deliver the event to usin the background to ensure we can respondto the notification within a day.

When we execute the query,our app will begin listening for notifications.

And every time the user receives a notification,we could trigger a promptto schedule a virtual checkup with the clinic.

Great! Now you can reach out to patients at increased fall risk.

But there are other usersa physical therapy clinic might be interested in.

Here's an example of a patient who showed great progressat first but is now declining in steadiness.

They wouldn't have receiveda Walking Steadiness notificationbecause they aren't yet at a higher-fall-risk classification.

But a physical therapy clinicmight be concerned about trends like this.

Are the exercises appropriate?Are they causing damage?Is the patient just not keeping up?We'd like to schedule a follow-up,so let's design our own notification criteria.

Here are the patient's steadiness scores over time.

The plan is to query six weeks of steadiness scoresand calculate the best-fit slope.

We'll do this every week,and if a patient's steadiness is declining more than, say,five points per week on average,we should try to schedule a check-in.

Let's create a predicate to query in the past six weeksand execute an HKSampleQueryfor the appleWalkingSteadiness QuantityType.

In the callback,we'll pass the results off to a detectTrends function.

Now, all we need to do is calculate the best-fit slope,using a custom function we have defined,and check if it's less than -5,meaning steadiness is decliningat a rate of over five points per week.

And if it is, we can prompt the user for a checkup,just like before.

So now when we detect their steadiness is declining,they will receive a prompt!So that's how to use all three elementsof Walking Steadinessand how to design your own simple notification criteria.

It's never been so easyto perform passive mobility monitoring.

But let's not get ahead of ourselves.

All of this is dependenton the patient getting Walking Steadiness scores.

Here are four best practicesto make sure they don't miss a single sample.

First off, users will only get steadinessif they have their height set in the Health app.

Weight and age are highly recommended.

So first things first, let's prompt them for those.

We recommend writing updated samples directly,via the HealthKit API.

Secondly, we recommend prompting the userto turn on Apple's Walking Steadiness notifications.

They can do this from the Health app in the Mobility room.

Third, as Irida mentioned,for the vast majority of patients,keeping their phone in their pocketwhile they go about their everyday activitiesis enough to get steadiness scores.

Let's just encourage them to take their phone with themwhile they're walking around.

To check if they're meeting the walking criteria,we can check if they're receivingwalking speed estimates in HealthKit.

Two weeks with consistent Walking Speed samplesis a good indicator they're carrying their device enough.

As a reminder,walking speed requires an iPhone 8 or above,and is measured when the phone is held tightlyto the center of the body while walking over flat ground.

A quick glance in the Health app,or a quick HealthKit query,can tell us if we need to prompt themto walk with their phone more.

So there you have it!You have all the tools you needto build the next-generation physical therapy appthat can keep track of your patient's walking qualitywithout any dedicated equipment or assessments.

Now, over to Irida to talk about the many other amazing waysyou can use Walking Steadiness for health monitoring.

Irida: Thanks, Sohum.

We just saw how Walking Steadinesscan make a huge difference to virtual carefor physical therapy, and it can do so much more.

Consider using Walking Steadinessif you want to build an app that helps familiescheck up on an aging grandparent,or perhaps you can help patients with neurological diseaseslike multiple sclerosis monitor disease progression.

You could even use it to recommend workoutsand hikes that are more tailored to an individual's fall risk.

Walking Steadiness and the new capabilitiesfor Six-Minute Walk built on top of a rich ecosystemfor using motion sensing to monitor heath.

Given the strong ties between mobility,cardiovascular and respiratory functioning,we encourage you to explorehow metrics related to cardiovascular healthon the Apple Watch --and mobility for the iPhone --can be used for rehabilitation or prehabilitation applications,to best prepare patients for successful surgery.

Or consider how Walking Steadiness,the mobility metrics, and our Movement Disorder APIcan be combined to monitor the complicated motor symptomsof Parkinson's Disease.

The combination of these metricscan unlock a truly powerful experience for your apps.

To wrap up, we want to provide some best practiceswhen collecting this data.

First,though walking is something we don't often think a lot about,as we've just seen, it carries a powerful health signal.

As with any health information,make sure that your data collection has strong privacyand security safeguards.

Any data you take outside of HealthKitshould at the very least be key-coded and encrypted.

Next, you should be transparentabout the information you are collecting and why.

Anytime you request to read a certain HealthKit type,we'll prompt the user to approve its use.

But beyond this basic measure, it's our joint responsibilityto collect only the most meaningful dataand to be transparent on how that data will be used.

For example, for Six-Minute Walk estimates,our users should understand when the recalibration is appropriateand how it helps their care.

For the Walking Steadiness metric,the requirements to get an estimateshould be clearly communicated.

Working with domain experts,like physicians or physical therapists,will ensure that you collect the most meaningful datafrom these metrics.

Lastly, your customer should have control of their data.

In HealthKit, an individual can tap Show All Dataand delete any and all samples collected from them.

If you take data outside of HealthKit,your customer should have an easy way to view and delete,turn off data collection,or have other means to exercise controlover what is collected from them.

Whether you are using Walking Steadinessto measure quality of movement,the Six-Minute Walk metric to assess recovery from injury,or any other health metric,following these guidelines will protect our customers' dataand promote user trust.

A commitment to these principles is essentialwhen handling any health data.

OK, that's a wrap for us.

We want to thank you for watchingand being part of WWDC21.

We cannot wait to see what you build next.

♪

0:01 -Grab authorization to read and share sixMinuteWalkTestDistance type

0:02 -Recalibrate Six-Minute Walk estimates

0:03 -Get authorized for walkingSteadiness type

0:04 -Construct a query for most recent walkingSteadiness score

0:05 -Construct a query for most recent walkingSteadiness classification

0:06 -Get authorized .walkingSteadinessEvent

0:07 -Watch for walkingSteadiness notifications

0:08 -Query walking steadiness in the past 6 weeks

## Code Samples

```swift
// Grab authorization to read and share sixMinuteWalkTestDistance type



let
 healthStore 
=
 
HKHealthStore
()

let
 types: 
Set
 
=
 [
    
HKObjectType
.quantityType(forIdentifier: .sixMinuteWalkTestDistance)
!

]

healthStore.requestAuthorization(toShare: types, read: types) { 
_
, 
_
 
in
 }
```

```swift
// Recalibrate estimate



let
 healthStore 
=
 
HKHealthStore
()

let
 sixMinuteWalkType 
=
 
HKSampleType
.quantityType(forIdentifier: .sixMinuteWalkTestDistance)
!



if
 sixMinuteWalkType.allowsRecalibrationForEstimates {

    healthStore.recalibrateEstimates(sampleType: sixMinuteWalkType, date: surgeryDate) { 
        (success, error) 
in

        
// Handle error

    }

}
```

```swift
// Get authorized



let
 types: 
Set
 
=
 [
    
HKObjectType
.quantityType(forIdentifier: .walkingSteadiness)
!

]

healthKitStore.requestAuthorization(toShare: 
nil
, read: types) { 
_
, 
_
 
in
 }
```

```swift
// Construct a query for most recent walkingSteadiness score



let
 steadinessType 
=
 
HKObjectType
.quantityType(forIdentifier: .walkingSteadiness)

let
 sortByEndDate 
=
 
NSSortDescriptor
(key: 
HKSampleSortIdentifierEndDate
, ascending: 
false
)


let
 query 
=
 
HKSampleQuery
(sampleType: steadinessType,
                          predicate: 
nil
,
                          limit: 
1
,
                          sortDescriptors: [sortByEndDate]) { (query, samples, error) 
in


    
if
 
let
 sample 
=
 samples
?
.first 
as?
 
HKQuantitySample
{

        
let
 recentScore 
=
 sample.quantity.doubleValue(forUnit: .percentUnit)

        updateStatus(score: recentScore)
    }
}


self
.healthStore.execute(query)
```

```swift
// Construct a query for most recent walkingSteadiness classification



let
 steadinessType 
=
 
HKObjectType
.quantityType(forIdentifier: .walkingSteadiness)


let
 query 
=
 
HKSampleQuery
(sampleType: steadinessType,
                          predicate: 
nil
,
                          limit: 
1
,
                          sortDescriptors: 
nil
) { (query, samples, error) 
in


    
if
 
let
 sample 
=
 samples
?
.first 
as?
 
HKQuantitySample
{
        
        
let
 recentScore 
=
 sample.quantity.doubleValue(forUnit: .percentUnit)

        
// Use HealthKit API to classify a value as OK, Low, or Very Low

        
let
 recentClassification 
=
 
HKAppleWalkingSteadinessClassification
(for: walkingSteadiness.quantity)

        updateStatus(classification: recentClassification, score: recentScore)
    }
}


self
.healthStore.execute(query)
```

```swift
// Get authorized



let
 types: 
Set
 
=
 [
    
HKObjectType
.categoryType(forIdentifier: .walkingSteadinessEvent)
!

]

healthKitStore.requestAuthorization(toShare: 
nil
, read: types) { 
_
, 
_
 
in
 }
```

```swift
// Watch for walkingSteadiness notifications



let
 notificationType 
=
 
HKCategoryType
.categoryType(forIdentifier: .appleWalkingSteadinessEvent)
!



let
 query 
=
 
HKObserverQuery
(sampleType: notificationType, predicate: 
nil
) { 
    (query, completionHandler, errorOrNil) 
in

    
    
if
 
let
 error 
=
 errorOrNil {
        
// Properly handle the error.

        
return

    }

    promptCheckupForNotification()

    completionHandler()
}


self
.healthStore.execute(query)
```

```swift
// Query samples from HealthKit



// Look back 6 weeks


let
 end 
=
 
Date
()

let
 start 
=
 
Calendar
.current.date(byAdding: .week, value: 
-
6
, to: end)


let
 datePredicate 
=
 
HKQuery
.predicateForSamples(withStart: start, end: end, options: [])


// Query walking steadiness


let
 steadinessType 
=
 
HKObjectType
.quantityType(forIdentifier: .walkingSteadiness)

let
 sortByEndDate 
=
 
NSSortDescriptor
(key: 
HKSampleSortIdentifierEndDate
, ascending: 
false
)


let
 query 
=
 
HKSampleQuery
(sampleType: steadinessType,
                          predicate: sortByEndDate,
                          limit: 
nil
,
                          sortDescriptors:[sortByEndDate]) { (
_
, samples, 
_
) 
in


    detectTrends(samples)
}

self
.healthStore.execute(query)
```

