# Wwdc2021 10102

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Transcript

Meet the Location ButtonMeet CLLocationButton: a secure interface element that provides an easy, low-friction way to grant your app location access only when and where it is needed. Learn how you can add CLLocationButton to new or existing code, how to customize it within interface legibility guidelines, how to recognize and address customization failures, and how it interacts with iOS's traditional prompt-based Location Services authorization.

To get the most out of this session, we recommend basic familiarity with the Core Location API.ResourcesCore LocationCoreLocationUIHuman Interface Guidelines: Accessing User DataRequesting authorization to use location servicesSharing Your Location to Find a ParkHD VideoSD VideoRelated VideosWWDC21Apple’s privacy pillars in focusWhat's new in UIKitWhat's new in watchOS 8WWDC20What's new in location

Meet CLLocationButton: a secure interface element that provides an easy, low-friction way to grant your app location access only when and where it is needed. Learn how you can add CLLocationButton to new or existing code, how to customize it within interface legibility guidelines, how to recognize and address customization failures, and how it interacts with iOS's traditional prompt-based Location Services authorization.

To get the most out of this session, we recommend basic familiarity with the Core Location API.

Core Location

CoreLocationUI

Human Interface Guidelines: Accessing User Data

Requesting authorization to use location services

Sharing Your Location to Find a Park

HD VideoSD Video

HD Video

SD Video

Apple’s privacy pillars in focus

What's new in UIKit

What's new in watchOS 8

What's new in location

Search this video…Hello.I'm Cindy Clarissa.I'm a software engineer with Core Location.Today, I'll be talking aboutsome cool new things for Core Location this year.We are introducing two new featuresthat may let you power location-based functionalityin your apps without confronting peoplewith the need to grant them as much authorization.Starting with the first feature,we are bringing Region-based user notifications to watchOS 8.Now your Apple Watch appcan remind people to start a workoutwhen they arrive at the gymor feed the dog when they get home.For example,here we have App in the Air using this new featureto notify people about their flightswhen they arrive at the airport.With Region-based user notifications,the system can present spatially relevant informationon behalf of your appwithout it having "always" authorization.To learn moreabout how you can adopt Region-based user notificationsfor watchOS,check out the session "What's New in watchOS."Now let's talk about the main topic of this session.We're introducing a new way to request locationthat gives people more control over their databut, at the same time, gives more functionalities to your app.I'll begin by talkingabout today's state of location authorizationand the motivation behind our new feature.In iOS 14,when an app requests for location authorization,an initial prompt shows upand people have the ability to choose from Allow Once,While in Use, or Don't Allow authorization.And with last year's new feature,people have the ability to control their precisionof the location being sent to your app.Some of you may have noticedthat people select Allow Once on your app,and it could bethat they don't think giving when-in-use authorizationis necessary to your app.For example,a pet store app might request location authorizationto determine the closest pet store near them,but it doesn't require their locationwhen they are just browsing for different cat food options.In this case,people using this app might be more likely to select Allow Onceor Don't Allow authorization.If people select Allow Once,we would grant location authorizationfor the duration that they are using your app.But your app will lose authorizationwhen it enters the background.This could lead to multiple location authorization requests,which may negatively impact the user experience.In another case,you might notice that someone who is tired of the promptsmight select Don't Allowto prevent the prompts from being shown again.This could result in having to send peopleto Settings to authorize for locations later.As privacy continues to be an important priority for Apple,we thought,"How can we give more controlswithout hindering user-experience?”Can we provide an easy and friendly wayto authorize locationonly at the moment when its needed?Starting in iOS 15,we're introducing CLLocationButton for UIKitand LocationButton for SwiftUIto tackle the pain points I've mentioned.Here, we have a Park Finder appthat finds the closest park nearby.At the bottom,we have a blue Location Buttonwith the title "Current Location"next to the arrow glyph.When I press on the button,Park Finder is able to get my current locationand show a map view of all the parks nearby.A location arrow at the top leftwill turn blue to call to the user's attentionto the authorization they just have granted.One thing to noteis that Location Button is actually giving your appAllow-Once authorizationwithout making people go through the prompt each time.Later, I will go over about how this would affectyour existing authorization status.We'll be bringing Location Button to watchOS, iOS,macOS with Catalyst, and iPad apps on Mac.Now, let's dive into the APIand how you can add CLLocationButton to your app.CLLocationButton is part of the CoreLocationUI framework.Similar to the UIButton,CLLocationButton is derived from UIControls.So, you're able to use UIControl functionalities with the button.In addition, we have four propertiesthat are specific to our button.We have CLLocationButtonIcon to set the type of the arrow,CLLocationLabel to set the label of the button,a cornerRadius to set the roundness of the button,and lastly, we have fontSize to set the size of the label.Now that I went through a brief overview, you might wonder,"How can I receive location with CLLocationButton?"Well, it's similar to requesting location with a UIButton.I think it's easier to understand with an example.Let me demonstrate how you can replaceyour UIButton with CLLocationButton.In this UIButton example,I will create a simple button that requests for locationby first requesting when-in-use authorization upon button tap.I'll begin by instantiating a UIButtonand setting it's title to "Current Location”.I wanna add a target-action that calls a functionand do the necessary action we wantevery time a button is tapped.In this case, I wanna display all the parks nearby.So let's call this function "showNearByParks”.In this showNearByParks function,I will use locationManagerto call requestWhenInUseAuthorizationand startUpdatingLocation.Within this function,I will also add additional logicto render the map view accordingly.But, for simplicity, let's omit that.Let's begin by replacing UIButtonby removing the first two linesand replacing it with an instantiationof CLLocationButtonand then setting the label to ".currentLocation”.Lastly, we can comment out the callto requestWhenInUseAuthorization,and that's because the Location Buttonwill grant a one-time authorizationon your behalf every time a button is successfully tapped.So if you have an existing UIButton,replacing it will be as simple as shown here.But we wanna make it even easier,so you can see an example of the Park Finder appattached to this talk.For those with SwiftUI apps,the Location Button is also in SwiftUI.You can use LocationButton as shown in the example here.I'd like to point outthat I am using SwiftUI's new "symbolVariant"to set the arrow type,and "tint"to set the background color of the button.Let's go through some exampleson how you can customize Location Button.With our Location Button,you are able to customize the background color,the text and glyph color,the rounded corners, and so forth.Here are just some example stylesthat you can create with our button.Let's go through step-by-step examplesof customizing Location Button.Let's start with our default button.The default look has "Current Location" titlein whiteand a systemBlue background color, as shown here.We can set the button icon to arrowFilled.Next, we can change the foreground color of the iconby setting tintColor from white to black...and then setting the backgroundColor to white.And lastly, I can set the corner radiusto have rounded corners by setting it to 25.0.And depending on how you set the constraintsand the sizing for the button,if the button's width is equal to the height,you can create a perfect circlewhen the corner radius is half of the width.Now, we turned our default location buttoninto a white circular button with just simple adjustments.We've just gone through some stylistic changesthat you can add to Location Button.You can customize the buttonto create the perfect look that fits your app.However, with great power comes great responsibility.When customizing your Location Button,there are some restrictions that you might encounterto ensure that your Location Buttonis clear and visible.I wanna talk about some examplesthat you can expectif your button does not seem to be drawn correctlyor receive any location.If that's the case,while your target-action will be called,you won't get authorization.But don't worry.We'll give plenty of feedback with log messagesto help you figure outwhat restrictions you're encountering.For example,these are just different log messagesthat refer to the insufficiency of the button sizing,alpha value, and color contrastbetween tintColor and backgroundColor.Now let's go through some examplesof what feedback you can expectif you're using Interface Builder in Xcode.Continuing with the button I have created earlier,if I was to change the existing buttonto have a white tintColor,people will not be able to see thisbecause the button's background color is already white.So if you do this,you will see this issue shown in the navigation paneunder the Issue tab in Xcode.Instead, let's revert our original buttonand try to change the opacity, or alpha, of this button.Maybe you can see this,but to others, it's a little too transparent,and so it fails our accessibility guidelines.A similar issue statement is produced in Xcode,recommending you to increase the alpha value.Another issue you might encounteris insufficient button sizing.This is when the content of the buttonis too small or too large for the button size.Depending on the user's localization setting,the button's text length can change.Now let's increase the text size by changing the language.Depending on whether your implementationis Auto-layout friendly,if we change the language,the size of the text could outgrow the button.Notice that the text does not fit the button in German.If this happens,look at the log messages for feedback.Don't forget to test your Location Buttonwith really small or really large text sizes,as well as testing it in different languagesto ensure that your button is working in all cases.So, when customizing your button,remember that it's imperative that it's clear and visible.If your button does not seem to be drawn correctlyor receive location,it could be that it's no longer legible.If that's the case,we provide log messages for guidanceto help you determine what could be wrong.Now that you know how to implement Location Button,you might wonder how it will affectyour existing authorization status.As I mentioned before,Location Button is essentially giving youAllow-Once authorization.If your app does not have any authorization statusof any kind,it will have "NotDetermined" authorizationwith "When I Share" selected in Privacy Settings.If this is your app's current state,then the very first timeeach user presses a Location Button,this prompt will ask them to confirm that they're on board.However, if your app is already authorized for location,such as "While Using the App" state,then using Location Button will not changeyour existing stateand will behave like any other UIButton.Where it works,Location Button can feel magical and also reassuring,because you're letting people decidewhen and whether their location will be used each time.Since Location Button is much more comfortable,we think people will be more likely to give your app locationvia Location Button than they were previously.So we wanna give users and your appanother chance to get off on the right foot.If someone, who has chosen "Don't Allow" authorizationon your app in the pasttaps our new Location Button,they will see this button introduction promptand have the opportunityto move your app back to NotDeterminedand use Location Button going on forward.So in this session,I talked about bringing more dynamic abilitiesto your watchOS appswith Region-based user notifications.If you're interested in learning more,don't forget to view the resources with the session.We've also covered some cool new featuresthat can change the game of how you can ask for location.Giving people more control over their data privacyis important to Apple.People are increasingly more awareof how their data is being shared.When designing your appto provide the most amazing user experience,but also build trust with your customers,you might want to ask yourself:"Does my app require traditional authorization,or would a one-time location authorizationwith Location Button be more suitable?"And the answer, in some cases, might be that once is enough.With Location Button,you can gain trust with peopleby giving more controlabout when they want to share their location.Thank you.[music]

Hello.I'm Cindy Clarissa.I'm a software engineer with Core Location.Today, I'll be talking aboutsome cool new things for Core Location this year.We are introducing two new featuresthat may let you power location-based functionalityin your apps without confronting peoplewith the need to grant them as much authorization.

Starting with the first feature,we are bringing Region-based user notifications to watchOS 8.Now your Apple Watch appcan remind people to start a workoutwhen they arrive at the gymor feed the dog when they get home.For example,here we have App in the Air using this new featureto notify people about their flightswhen they arrive at the airport.With Region-based user notifications,the system can present spatially relevant informationon behalf of your appwithout it having "always" authorization.To learn moreabout how you can adopt Region-based user notificationsfor watchOS,check out the session "What's New in watchOS."Now let's talk about the main topic of this session.We're introducing a new way to request locationthat gives people more control over their databut, at the same time, gives more functionalities to your app.I'll begin by talkingabout today's state of location authorizationand the motivation behind our new feature.In iOS 14,when an app requests for location authorization,an initial prompt shows upand people have the ability to choose from Allow Once,While in Use, or Don't Allow authorization.And with last year's new feature,people have the ability to control their precisionof the location being sent to your app.

Some of you may have noticedthat people select Allow Once on your app,and it could bethat they don't think giving when-in-use authorizationis necessary to your app.For example,a pet store app might request location authorizationto determine the closest pet store near them,but it doesn't require their locationwhen they are just browsing for different cat food options.In this case,people using this app might be more likely to select Allow Onceor Don't Allow authorization.If people select Allow Once,we would grant location authorizationfor the duration that they are using your app.But your app will lose authorizationwhen it enters the background.This could lead to multiple location authorization requests,which may negatively impact the user experience.In another case,you might notice that someone who is tired of the promptsmight select Don't Allowto prevent the prompts from being shown again.This could result in having to send peopleto Settings to authorize for locations later.As privacy continues to be an important priority for Apple,we thought,"How can we give more controlswithout hindering user-experience?”Can we provide an easy and friendly wayto authorize locationonly at the moment when its needed?Starting in iOS 15,we're introducing CLLocationButton for UIKitand LocationButton for SwiftUIto tackle the pain points I've mentioned.Here, we have a Park Finder appthat finds the closest park nearby.At the bottom,we have a blue Location Buttonwith the title "Current Location"next to the arrow glyph.When I press on the button,Park Finder is able to get my current locationand show a map view of all the parks nearby.A location arrow at the top leftwill turn blue to call to the user's attentionto the authorization they just have granted.

One thing to noteis that Location Button is actually giving your appAllow-Once authorizationwithout making people go through the prompt each time.Later, I will go over about how this would affectyour existing authorization status.We'll be bringing Location Button to watchOS, iOS,macOS with Catalyst, and iPad apps on Mac.Now, let's dive into the APIand how you can add CLLocationButton to your app.CLLocationButton is part of the CoreLocationUI framework.Similar to the UIButton,CLLocationButton is derived from UIControls.So, you're able to use UIControl functionalities with the button.In addition, we have four propertiesthat are specific to our button.We have CLLocationButtonIcon to set the type of the arrow,CLLocationLabel to set the label of the button,a cornerRadius to set the roundness of the button,and lastly, we have fontSize to set the size of the label.

Now that I went through a brief overview, you might wonder,"How can I receive location with CLLocationButton?"Well, it's similar to requesting location with a UIButton.I think it's easier to understand with an example.Let me demonstrate how you can replaceyour UIButton with CLLocationButton.In this UIButton example,I will create a simple button that requests for locationby first requesting when-in-use authorization upon button tap.I'll begin by instantiating a UIButtonand setting it's title to "Current Location”.I wanna add a target-action that calls a functionand do the necessary action we wantevery time a button is tapped.In this case, I wanna display all the parks nearby.So let's call this function "showNearByParks”.

In this showNearByParks function,I will use locationManagerto call requestWhenInUseAuthorizationand startUpdatingLocation.Within this function,I will also add additional logicto render the map view accordingly.But, for simplicity, let's omit that.Let's begin by replacing UIButtonby removing the first two linesand replacing it with an instantiationof CLLocationButtonand then setting the label to ".currentLocation”.Lastly, we can comment out the callto requestWhenInUseAuthorization,and that's because the Location Buttonwill grant a one-time authorizationon your behalf every time a button is successfully tapped.

So if you have an existing UIButton,replacing it will be as simple as shown here.But we wanna make it even easier,so you can see an example of the Park Finder appattached to this talk.

For those with SwiftUI apps,the Location Button is also in SwiftUI.You can use LocationButton as shown in the example here.I'd like to point outthat I am using SwiftUI's new "symbolVariant"to set the arrow type,and "tint"to set the background color of the button.

Let's go through some exampleson how you can customize Location Button.With our Location Button,you are able to customize the background color,the text and glyph color,the rounded corners, and so forth.Here are just some example stylesthat you can create with our button.Let's go through step-by-step examplesof customizing Location Button.Let's start with our default button.The default look has "Current Location" titlein whiteand a systemBlue background color, as shown here.

We can set the button icon to arrowFilled.

Next, we can change the foreground color of the iconby setting tintColor from white to black...and then setting the backgroundColor to white.And lastly, I can set the corner radiusto have rounded corners by setting it to 25.0.

And depending on how you set the constraintsand the sizing for the button,if the button's width is equal to the height,you can create a perfect circlewhen the corner radius is half of the width.Now, we turned our default location buttoninto a white circular button with just simple adjustments.We've just gone through some stylistic changesthat you can add to Location Button.You can customize the buttonto create the perfect look that fits your app.However, with great power comes great responsibility.When customizing your Location Button,there are some restrictions that you might encounterto ensure that your Location Buttonis clear and visible.I wanna talk about some examplesthat you can expectif your button does not seem to be drawn correctlyor receive any location.If that's the case,while your target-action will be called,you won't get authorization.

But don't worry.We'll give plenty of feedback with log messagesto help you figure outwhat restrictions you're encountering.For example,these are just different log messagesthat refer to the insufficiency of the button sizing,alpha value, and color contrastbetween tintColor and backgroundColor.Now let's go through some examplesof what feedback you can expectif you're using Interface Builder in Xcode.Continuing with the button I have created earlier,if I was to change the existing buttonto have a white tintColor,people will not be able to see thisbecause the button's background color is already white.So if you do this,you will see this issue shown in the navigation paneunder the Issue tab in Xcode.Instead, let's revert our original buttonand try to change the opacity, or alpha, of this button.Maybe you can see this,but to others, it's a little too transparent,and so it fails our accessibility guidelines.A similar issue statement is produced in Xcode,recommending you to increase the alpha value.Another issue you might encounteris insufficient button sizing.This is when the content of the buttonis too small or too large for the button size.Depending on the user's localization setting,the button's text length can change.Now let's increase the text size by changing the language.

Depending on whether your implementationis Auto-layout friendly,if we change the language,the size of the text could outgrow the button.Notice that the text does not fit the button in German.If this happens,look at the log messages for feedback.Don't forget to test your Location Buttonwith really small or really large text sizes,as well as testing it in different languagesto ensure that your button is working in all cases.So, when customizing your button,remember that it's imperative that it's clear and visible.If your button does not seem to be drawn correctlyor receive location,it could be that it's no longer legible.If that's the case,we provide log messages for guidanceto help you determine what could be wrong.

Now that you know how to implement Location Button,you might wonder how it will affectyour existing authorization status.As I mentioned before,Location Button is essentially giving youAllow-Once authorization.If your app does not have any authorization statusof any kind,it will have "NotDetermined" authorizationwith "When I Share" selected in Privacy Settings.

If this is your app's current state,then the very first timeeach user presses a Location Button,this prompt will ask them to confirm that they're on board.However, if your app is already authorized for location,such as "While Using the App" state,then using Location Button will not changeyour existing stateand will behave like any other UIButton.Where it works,Location Button can feel magical and also reassuring,because you're letting people decidewhen and whether their location will be used each time.Since Location Button is much more comfortable,we think people will be more likely to give your app locationvia Location Button than they were previously.So we wanna give users and your appanother chance to get off on the right foot.

If someone, who has chosen "Don't Allow" authorizationon your app in the pasttaps our new Location Button,they will see this button introduction promptand have the opportunityto move your app back to NotDeterminedand use Location Button going on forward.So in this session,I talked about bringing more dynamic abilitiesto your watchOS appswith Region-based user notifications.If you're interested in learning more,don't forget to view the resources with the session.We've also covered some cool new featuresthat can change the game of how you can ask for location.

Giving people more control over their data privacyis important to Apple.People are increasingly more awareof how their data is being shared.When designing your appto provide the most amazing user experience,but also build trust with your customers,you might want to ask yourself:"Does my app require traditional authorization,or would a one-time location authorizationwith Location Button be more suitable?"And the answer, in some cases, might be that once is enough.With Location Button,you can gain trust with peopleby giving more controlabout when they want to share their location.Thank you.[music]

## Code Samples

