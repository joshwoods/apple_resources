# Wwdc2021 10066

## Transcript

More Videos

Streaming is available in most browsers,and in the Developer app.

About

Transcript

Code

What’s new in Game Center: Widgets, friends, and multiplayer improvementsPower up your online gaming experience with GameKit and adopt features like multiplayer, leaderboards, and achievements in your game. We'll take you through the latest improvements to Game Center, including player matching and multiplayer APIs, and explore how you can boost discovery of your game.ResourcesFinding multiple players for a gameGKLocalPlayerHuman Interface Guidelines: Game CenterHD VideoSD VideoRelated VideosWWDC22Reach new players with Game Center dashboardWWDC21Bring Recurring Leaderboards to your gameWWDC20Design for Game CenterTap into Game Center: Leaderboards, Achievements, and Multiplayer

Power up your online gaming experience with GameKit and adopt features like multiplayer, leaderboards, and achievements in your game. We'll take you through the latest improvements to Game Center, including player matching and multiplayer APIs, and explore how you can boost discovery of your game.

Finding multiple players for a game

GKLocalPlayer

Human Interface Guidelines: Game Center

HD VideoSD Video

HD Video

SD Video

Reach new players with Game Center dashboard

Bring Recurring Leaderboards to your game

Design for Game Center

Tap into Game Center: Leaderboards, Achievements, and Multiplayer

Search this video…♪ Bass music playing ♪Ally Kazmucha: Hi, I'm Ally,and I'm the engineering program manager for Game Center.I'm really excited to spend some time walking you throughall the improvements we're making this year.We also launched some great new features this springlike Friends API,which we'll be talking to you about as well.But before I get into some of those details,I'd like to briefly talk about some of the core featuresGame Center offers,many of which were completely refreshed last year.Game Center is Apple's own social gaming network.As a developer,you can take advantage of whichever Game Center featuresmake sense in your game through our GameKit framework.For players, Game Center Is a single gaming IDthat allows them to instantly compete on leaderboards,track achievement progress,play multiplayer games together,and even check out their friends' profiles.Helping players find and discover great new gamesis also one of the primary goals of Game Center.We added quite a few features in iOS 14to help with game discoverability,and we're adding even more this year.Games are all about community,and keeping up with what our friends are playingis a great way to discover new titleswe may have otherwise missed.That's why we integrated Game Centerdirectly with the App Store last year.We now show more informationon what your Game Center friends are up to,through both the Games and Arcade tabs of the App Store.Let's take a closer look.While browsing the Arcade tab,I can see that several of my Game Center friendsare playing a few games that look interesting to me,including a new game called "Wonderbox."Let's check out the product page to learn more.Not only can I read more about the game itselfon the product page,I can also see a complete list of my Game Center friendswho are already playing that particular game.Tapping on one of them brings up their Game Center profile.From here, I can see even more of the games they've been playing.And if I see one I like,I can download it directly from their profile.The Friends Are Playing section will automatically appearon the product page for all Game Center-enabled games.There are, of course,opportunities outside of the App Storeto check out a friend's profile as well.For example,I can tap on a friend within any leaderboard --like shown here -- to bring up their profile.These are all great opportunities for playersto find new games to play.And there's nothing you have to doto make your game eligible either.All Game Center-enabled games automatically show upin both Friends Are Playing and Recently Played.This fall, we're also adding two new Game Center-powered widgets.The first is -- you guessed it --Friends Are Playing.We think this is going to be an even easier way for playersto keep up with and discover more of the gamestheir friends are playing, right from their home screen.The second widget is called Continue Playing.This widget automatically resurfaces gamesyou've already launched and played.So you can jump right back in where you left offwith a single tap.And if you're on an iPad,both of these Game Center widgetssupport the new larger format as well.And just like Friends Are Playing and Recently Played,there's no additional code needed or feature to adopt.If your game supports Game Center,it's automatically included.And since friends are such an important part of social play,we're making some significant improvementsto both our friending and multiplayer flows too.First up, friends.Game Center friend requestswill continue to be sent through Messagesjust like they are today.But just in case you miss one,we've added a brand-new Friend Requests inboxto let you manage them all in one place.We've also made some great improvementsto the flow within Messages,including support to send and receive friend requestson MacOS.But as a developer,you're probably most interested in what you can dowith Game Center friends.And that's where Friends API comes in.Friends API gives you privacy-friendly accessto a player's Game Center friends,so you can create all kinds of unique experienceswithin your game.Whether it's showing what level my friends are onin a progression map,or letting players launch missions together,all of these can now be accomplishedby adopting Friends API.Chee Han will be walking you through how to do just that.So now that you know about some of the waysGame Center can help improve discoverabilityand connect players together outside of your game,let's look at some of the benefits Game Center offerswithin your game.In iOS 14, we introduced a brand-new player dashboardyou can add to your game through the Access Point API.We also shipped an entirely refreshed UI --virtually no screen went untouched.With vibrant colors that matchthe underlying tones of your game,this refresh was meant to feel at home in any game.You can also choose to use a combinationof our native Game Center UI alongside any custom UIthat best fits within your game.For example, showing current leaderboard scoreswithin a level selection screen --or even as a live indicator while playing a level --are all examples that make senseto be themed in a UI that matches your game.While not in a level, you can still chooseto give players access to all their Game Center datathrough the access point -- like shown here.This just gives your players even more ways to keep up withand interact with their Game Center rankingsand achievements.And if your game supports multiplayer,we've got some great updates here as well.This year, we continued to focus on helping people connectand start playing a game together as fast as possible.Now, when you start a multiplayer match,our new suggestions sectionalso surfaces your existing Messages groups.Tap a group, and the invite is sentwithin the Messages thread you already have going.We also remember the Game Center friend groups you’ve played withand suggest them as well.So one tap gets you back in the gamewith the same friends again.We're also introducing a brand-new multiplayer APIcalled "Fast Start."Zhehong will be walking you through some of the benefitsof Fast Start and how you can implement it within your game.Finally, we've also added controller supportfor all Game Center UI on both iPhone and iPad.The best part: there's zero new API to adoptor versioning in Xcode required on your part.Just press the Home button on any supported controllerand the Game Center dashboard is instantly presented.Press it again and you're back in the game.While the Game Center dashboard and all the sections within itwill be navigable by default,you will need to add controller support for your own UI.And if you're interested in what else is new with controllers,be sure to check out the session titled"Tap into virtual and physical game controllers"to learn more.Here's a look at the rest of the session.First up, Chee Han is going to walk you throughour friending improvements,including a detailed walk-through of Friends APIand how you can implement it to leverage Game Center friendswithin your game.And to wrap up the session,Zhehong will fill you in on everything multiplayer,including a walk-throughof how we've streamlined the invite flowand how you can implement our new Fast Start APIto speed up the process even further.To get you started on Friends,here's Chee Han.Chee Han Lim: Hi, I'm Chee Han.I'm an engineer on the Game Center team.One of the best parts of playing gamesis being able to share those experienceswith your family and friends.For some of us, it's about the competition;and for others, it's about the connection.Game Center friends allows you to do just that.So there are two capabilitiesthat we will be focusing on today.First, we have made it easyto enable players to send friend requests within your game.Second, we have introduced some new APIsfor you to leverage your player's friends listthrough Friends API.First, let's talk about sending friend requests.When your game is better when played together,it might make sense to encourage your playerto make Game Center friends within your game.We have introduced a new API to let you do just that.In your game, you can have an Add Friends button on your UI,where we recommend you to use SF Symbols as a button image.When your user presses on the button,you can call our friending APIto allow your player to add friends within your game.Let's see how we can do that in code.When you call presentFriendRequestCreator FromViewController API,a message sheet will be presented with a real controllerthat you have passed in.After your player finishes sending the friend request,we will dismiss the sheet and return the control to your appwith an optional error.That's it!With a few lines of code,you will be able to provide your player the opportunityto send friend requests without leaving your game.And now, let's take a look at what you can dowith all those Games Center friends.The second feature we have added this springis privacy-friendly API access to Game Center friends.When a player launches your game and tries to use functionalityfor the first time that requires Game Center friends access,they will be prompted to allow or denyaccess to their friends list.If allowed,we will return you a list of their bi-directional friends,which means the list will only contain their friendswho have also granted access to your game.We will also sync this permission for youacross all their devices,and the user will only need to approve your request once.So what kind of experiences can you createif your player allows you access to their friends list?Well, this will allow you to do things like,show what level my friends are on within a progression map,let me launch a mission together with my friends in the lobby,show a friends-only recurring leaderboardwhile we are playing a multiplayer game together,and much more.Let us walk through what Friends API will look likefrom your player's perspective.Your game will call an APIto ask for permission to access the player's friends.And the player will see a familiar system promptwhere they have to decide to allow or deny your request.And you will have the option to explain to the playerwhy you are requesting friends access.Once your player approves your request,we will return the list of friendswho have also granted access to your game.In this example, we will use a leaderboard to keep trackof players' progression with the score that I have submittedto this leaderboard.With the score submitted, I can utilize Friends APIto show my friends on a progression mapnext to the level corresponding to their leaderboard scores.This may look something like this within your own game UI.You can see that my friends' progression is populatedon the map,where I will know exactly where they are in my game.Let's jump into how to create this UI with code.We will need to do some setup before you can call Friends API.First, you'll need to add NSGKFriendListUsageDescriptionto your info.plist.This description will be displayedas part of the permission prompt to our player,as seen in the previous slide.If the description is missing,all Friends API calls will result into an error.Once the description is set,you can now call the two new APIs in GKLocalPlayer class.To check for friends list access,you should call loadFriendsAuthorizationStatusin GKLocalPlayer class.You may want to call thisin your app’s applicationDidFinishLaunching,and if the state is not determined,you may want to delay loading players' friends listuntil there is a good momentfor you to show the permission prompt.This will allow your player some time to make a decisiononce the prompt is presented.You will receive GKFriendsAuthorizationStatusin one of the following four stateswithin a completion block.You can refer to GKLocalPlayer headerfor a detailed explanation of each state.When returned state is denied or restricted,if you have previously collected data for this player,you should delete the collected data on your end.If your player chooses to grant you accesswith an authorized state,you will then be able to proceed to load their friends listby calling loadFriends API.Let's take a look at that now.In this code, we will leverage the power of Swift async call,to simplify our calls to GameKit framework.We will start with an async methodwith the name loadFriendsOnProgressionMap.First, we will call loadFriends API in GKLocalPlayer class.GameKit will return your player’s friendsas an array of GKPlayer objects.Next, we will load our progression leaderboardfrom GameKit with the leaderboard ID "progress."Once we have the leaderboard object,we can then pass in your player’s friendsto loadEntries method.You will obtain the score they have on that leaderboard,which is used to keep track of which level they are in now.With that, we have all the information we needto display your player's friends on the progression map.And that's it!You have now successfully integratedFriends API in your gameand displayed your player's friends on a progression map.We are super excited to see all the amazing experiencesthat our developer community will come up withusing this new feature.And with that, I would like to turn it over to Zhehong.He will tell you all about the great changeswe have made to multiplayer this year.Zhehong An: Thanks, Chee Han.Hi everyone, I am Zhehong from the Game Center team.I cannot wait to introduce all the new featuresand improvements in Game Center multiplayer this year.We have made significant improvementsto Game Center multiplayer, as Ally mentioned previously.The main purpose behind all of these changesis to help your players find people to play withand get into a game as fast as possible.Game Center multiplayer UI allows many different waysfor players to find people to connect and play with.This includes automatching with other playersor sending invites at once to multiple friends, contacts,nearby players, a phone number or an email address,Game Center groups, or Message groups.It dramatically reduces your effortsto show different people from different sources.As you might know, automatching is the mechanismwhich helps your players find each otherfrom Game Center's matchmaking pool.I will walk through the other new conceptsin the following slides.To bring better suggestions to the players,we have introduced the Suggestions Shelfcontaining a list of peoplefrom within and without Game Centerthat your players might want to invite.It contains nearby players, Game Center groups,and Message groups.A Game Center group,which is a new concept we have introduced this year,is a group of players you recently played within real-time or turn-based matches.We believe this new feature will make it fairly easyfor players who want to play a game repeatedlywith a certain group of people,because this makes it possible to select all the playersin that group with just a single tap.And we are leveraging the people you already talk toon a regular basis over iMessage with Message Groups.A single tap will select an entire Message Group,and the invitation uses your existing group chat.Now, you can not only send invites faster via Messages,but also chat about a game afterwards.Once you have selected the people you wish to invite,tap the Send button at the top right,and you will see them in the lobby.We now have the capability for adding or removing playerseven after the initial invitations have gone out.For example, you may want to remove some invited playerswho are not able to respond,but you don't want to remove other playerswho have already accepted.So, we have made it possibleto individually remove invited playersby tapping on the X button in their player slot,as long as they have not accepted yet,or they leave the game after they have accepted.And players can continue inviting more peopleto your game,which gives them a lot of flexibilityto quickly craft the right group of people to play with.All of this greatly simplifies and streamlines the experienceby making it much easier for playersto play your multiplayer game faster and easier than ever.Making it easy for players to invite people they knowin turn helps increase your game's discoverability.As you can see, if you leverage Game Center multiplayer UI,you get all these awesome features for free.To make it even quicker to start a multiplayer game,we added a new API this year called "Fast Start."If you adopt Fast Start,the game initiator will have the choiceto either wait for everyone to be connected or begin a gameas soon as the minimum number of invited players have connected.It gets players much faster from Game Center UIback into your game UI.Meanwhile in the background, Game Center will continueconnecting the rest of the playersand automatching any unfilled player slots.All these players will be able to join your gamewhen they connect.If your game can support players joining a multiplayer sessionat different times,then you can take advantage of Fast Start via Game Center UI.You can utilize this featureto make some warmup game scenes as well.The best way to see this in actionis to show you an example.Here, we are using a game called "The Coast,"which leverages Fast Start.You will see how powerful it is to utilize Fast Startto build your game.First, I present GKMatchmakerViewControllerwith a GKMatchRequest,configured with 2 minPlayers and 5 maxPlayers.In this way, the game can startas long as two players are ready,including the local player.Then I tap the Invite Friends buttonto launch the player picker.I pick the players I want to invite,and I wait for them to respond.As you can see, once an invitee accepts,the Start Game button is highlighted,so I can either start a game or wait for other players to join.I decide to start, and the gameplay beginsas soon as the matchmaker view controller is dismissed.Since this game initially started with two players,you can see two boats.Meanwhile, Game Center is still connecting in the background.Once the third player joins,the game is notified, and we bring up the third boat.Because we also had two automatched slots,Game Center is still automatching in the background.After the matchmaking process is finished,two automatched players join.Now, we have a full set of five players for this game.As you can see, by adopting Fast Start,different players will be able to join the same game sessionat different times.Finally, let's look at the code you need to addto accomplish what we have just walked through together.To construct a GKMatchmakerViewControllerwith Fast Start mode turned on,simply set its property canStartWithMinimumPlayersto "true".Please note: the minPlayers of the GKMatchRequestis the minimum number of playersthat the gameplay in your game needs to start.Set the delegate after you get the GKMatch instance,so that you can know the connection statusof the players in the match.And didChangeConnectionStateis the delegate method where you can handle playerswho join later.On the invitee side,just present the GKMatchmakerViewControllerinitialized with the GKInvite instance.This is probably the same as what you are doing today.And don't forget to set the matchmakerDelegate.That's pretty much about it.We are excited to see how you adopt not only Fast Start,but all the new features and improvements we are providingthis year for multiplayer.To recap, here is what we covered today.We introduced how Game Center helpsincrease the discoverability of your game.After that, we talked about Friends APIalong with some general improvements to Friends.Then all the multiplayer features and improvementswe just talked through help your players play multiplayer gameswith people they know, as fast as possible.And also, we have better support for controllers this year.At the bottom, you will see another two sessionswhich you might be interested in.They're about recurring leaderboardand game controllers.Thank you all for watching.Enjoy your week at WWDC.♪

♪ Bass music playing ♪Ally Kazmucha: Hi, I'm Ally,and I'm the engineering program manager for Game Center.

I'm really excited to spend some time walking you throughall the improvements we're making this year.

We also launched some great new features this springlike Friends API,which we'll be talking to you about as well.

But before I get into some of those details,I'd like to briefly talk about some of the core featuresGame Center offers,many of which were completely refreshed last year.

Game Center is Apple's own social gaming network.

As a developer,you can take advantage of whichever Game Center featuresmake sense in your game through our GameKit framework.

For players, Game Center Is a single gaming IDthat allows them to instantly compete on leaderboards,track achievement progress,play multiplayer games together,and even check out their friends' profiles.

Helping players find and discover great new gamesis also one of the primary goals of Game Center.

We added quite a few features in iOS 14to help with game discoverability,and we're adding even more this year.

Games are all about community,and keeping up with what our friends are playingis a great way to discover new titleswe may have otherwise missed.

That's why we integrated Game Centerdirectly with the App Store last year.

We now show more informationon what your Game Center friends are up to,through both the Games and Arcade tabs of the App Store.

Let's take a closer look.

While browsing the Arcade tab,I can see that several of my Game Center friendsare playing a few games that look interesting to me,including a new game called "Wonderbox."Let's check out the product page to learn more.

Not only can I read more about the game itselfon the product page,I can also see a complete list of my Game Center friendswho are already playing that particular game.

Tapping on one of them brings up their Game Center profile.

From here, I can see even more of the games they've been playing.

And if I see one I like,I can download it directly from their profile.

The Friends Are Playing section will automatically appearon the product page for all Game Center-enabled games.

There are, of course,opportunities outside of the App Storeto check out a friend's profile as well.

For example,I can tap on a friend within any leaderboard --like shown here -- to bring up their profile.

These are all great opportunities for playersto find new games to play.

And there's nothing you have to doto make your game eligible either.

All Game Center-enabled games automatically show upin both Friends Are Playing and Recently Played.

This fall, we're also adding two new Game Center-powered widgets.

The first is -- you guessed it --Friends Are Playing.

We think this is going to be an even easier way for playersto keep up with and discover more of the gamestheir friends are playing, right from their home screen.

The second widget is called Continue Playing.

This widget automatically resurfaces gamesyou've already launched and played.

So you can jump right back in where you left offwith a single tap.

And if you're on an iPad,both of these Game Center widgetssupport the new larger format as well.

And just like Friends Are Playing and Recently Played,there's no additional code needed or feature to adopt.

If your game supports Game Center,it's automatically included.

And since friends are such an important part of social play,we're making some significant improvementsto both our friending and multiplayer flows too.

First up, friends.

Game Center friend requestswill continue to be sent through Messagesjust like they are today.

But just in case you miss one,we've added a brand-new Friend Requests inboxto let you manage them all in one place.

We've also made some great improvementsto the flow within Messages,including support to send and receive friend requestson MacOS.

But as a developer,you're probably most interested in what you can dowith Game Center friends.

And that's where Friends API comes in.

Friends API gives you privacy-friendly accessto a player's Game Center friends,so you can create all kinds of unique experienceswithin your game.

Whether it's showing what level my friends are onin a progression map,or letting players launch missions together,all of these can now be accomplishedby adopting Friends API.

Chee Han will be walking you through how to do just that.

So now that you know about some of the waysGame Center can help improve discoverabilityand connect players together outside of your game,let's look at some of the benefits Game Center offerswithin your game.

In iOS 14, we introduced a brand-new player dashboardyou can add to your game through the Access Point API.

We also shipped an entirely refreshed UI --virtually no screen went untouched.

With vibrant colors that matchthe underlying tones of your game,this refresh was meant to feel at home in any game.

You can also choose to use a combinationof our native Game Center UI alongside any custom UIthat best fits within your game.

For example, showing current leaderboard scoreswithin a level selection screen --or even as a live indicator while playing a level --are all examples that make senseto be themed in a UI that matches your game.

While not in a level, you can still chooseto give players access to all their Game Center datathrough the access point -- like shown here.

This just gives your players even more ways to keep up withand interact with their Game Center rankingsand achievements.

And if your game supports multiplayer,we've got some great updates here as well.

This year, we continued to focus on helping people connectand start playing a game together as fast as possible.

Now, when you start a multiplayer match,our new suggestions sectionalso surfaces your existing Messages groups.

Tap a group, and the invite is sentwithin the Messages thread you already have going.

We also remember the Game Center friend groups you’ve played withand suggest them as well.

So one tap gets you back in the gamewith the same friends again.

We're also introducing a brand-new multiplayer APIcalled "Fast Start."Zhehong will be walking you through some of the benefitsof Fast Start and how you can implement it within your game.

Finally, we've also added controller supportfor all Game Center UI on both iPhone and iPad.

The best part: there's zero new API to adoptor versioning in Xcode required on your part.

Just press the Home button on any supported controllerand the Game Center dashboard is instantly presented.

Press it again and you're back in the game.

While the Game Center dashboard and all the sections within itwill be navigable by default,you will need to add controller support for your own UI.

And if you're interested in what else is new with controllers,be sure to check out the session titled"Tap into virtual and physical game controllers"to learn more.

Here's a look at the rest of the session.

First up, Chee Han is going to walk you throughour friending improvements,including a detailed walk-through of Friends APIand how you can implement it to leverage Game Center friendswithin your game.

And to wrap up the session,Zhehong will fill you in on everything multiplayer,including a walk-throughof how we've streamlined the invite flowand how you can implement our new Fast Start APIto speed up the process even further.

To get you started on Friends,here's Chee Han.

Chee Han Lim: Hi, I'm Chee Han.

I'm an engineer on the Game Center team.

One of the best parts of playing gamesis being able to share those experienceswith your family and friends.

For some of us, it's about the competition;and for others, it's about the connection.

Game Center friends allows you to do just that.

So there are two capabilitiesthat we will be focusing on today.

First, we have made it easyto enable players to send friend requests within your game.

Second, we have introduced some new APIsfor you to leverage your player's friends listthrough Friends API.

First, let's talk about sending friend requests.

When your game is better when played together,it might make sense to encourage your playerto make Game Center friends within your game.

We have introduced a new API to let you do just that.

In your game, you can have an Add Friends button on your UI,where we recommend you to use SF Symbols as a button image.

When your user presses on the button,you can call our friending APIto allow your player to add friends within your game.

Let's see how we can do that in code.

When you call presentFriendRequestCreator FromViewController API,a message sheet will be presented with a real controllerthat you have passed in.

After your player finishes sending the friend request,we will dismiss the sheet and return the control to your appwith an optional error.

That's it!With a few lines of code,you will be able to provide your player the opportunityto send friend requests without leaving your game.

And now, let's take a look at what you can dowith all those Games Center friends.

The second feature we have added this springis privacy-friendly API access to Game Center friends.

When a player launches your game and tries to use functionalityfor the first time that requires Game Center friends access,they will be prompted to allow or denyaccess to their friends list.

If allowed,we will return you a list of their bi-directional friends,which means the list will only contain their friendswho have also granted access to your game.

We will also sync this permission for youacross all their devices,and the user will only need to approve your request once.

So what kind of experiences can you createif your player allows you access to their friends list?Well, this will allow you to do things like,show what level my friends are on within a progression map,let me launch a mission together with my friends in the lobby,show a friends-only recurring leaderboardwhile we are playing a multiplayer game together,and much more.

Let us walk through what Friends API will look likefrom your player's perspective.

Your game will call an APIto ask for permission to access the player's friends.

And the player will see a familiar system promptwhere they have to decide to allow or deny your request.

And you will have the option to explain to the playerwhy you are requesting friends access.

Once your player approves your request,we will return the list of friendswho have also granted access to your game.

In this example, we will use a leaderboard to keep trackof players' progression with the score that I have submittedto this leaderboard.

With the score submitted, I can utilize Friends APIto show my friends on a progression mapnext to the level corresponding to their leaderboard scores.

This may look something like this within your own game UI.

You can see that my friends' progression is populatedon the map,where I will know exactly where they are in my game.

Let's jump into how to create this UI with code.

We will need to do some setup before you can call Friends API.

First, you'll need to add NSGKFriendListUsageDescriptionto your info.plist.

This description will be displayedas part of the permission prompt to our player,as seen in the previous slide.

If the description is missing,all Friends API calls will result into an error.

Once the description is set,you can now call the two new APIs in GKLocalPlayer class.

To check for friends list access,you should call loadFriendsAuthorizationStatusin GKLocalPlayer class.

You may want to call thisin your app’s applicationDidFinishLaunching,and if the state is not determined,you may want to delay loading players' friends listuntil there is a good momentfor you to show the permission prompt.

This will allow your player some time to make a decisiononce the prompt is presented.

You will receive GKFriendsAuthorizationStatusin one of the following four stateswithin a completion block.

You can refer to GKLocalPlayer headerfor a detailed explanation of each state.

When returned state is denied or restricted,if you have previously collected data for this player,you should delete the collected data on your end.

If your player chooses to grant you accesswith an authorized state,you will then be able to proceed to load their friends listby calling loadFriends API.

Let's take a look at that now.

In this code, we will leverage the power of Swift async call,to simplify our calls to GameKit framework.

We will start with an async methodwith the name loadFriendsOnProgressionMap.

First, we will call loadFriends API in GKLocalPlayer class.

GameKit will return your player’s friendsas an array of GKPlayer objects.

Next, we will load our progression leaderboardfrom GameKit with the leaderboard ID "progress."Once we have the leaderboard object,we can then pass in your player’s friendsto loadEntries method.

You will obtain the score they have on that leaderboard,which is used to keep track of which level they are in now.

With that, we have all the information we needto display your player's friends on the progression map.

And that's it!You have now successfully integratedFriends API in your gameand displayed your player's friends on a progression map.

We are super excited to see all the amazing experiencesthat our developer community will come up withusing this new feature.

And with that, I would like to turn it over to Zhehong.

He will tell you all about the great changeswe have made to multiplayer this year.

Zhehong An: Thanks, Chee Han.

Hi everyone, I am Zhehong from the Game Center team.

I cannot wait to introduce all the new featuresand improvements in Game Center multiplayer this year.

We have made significant improvementsto Game Center multiplayer, as Ally mentioned previously.

The main purpose behind all of these changesis to help your players find people to play withand get into a game as fast as possible.

Game Center multiplayer UI allows many different waysfor players to find people to connect and play with.

This includes automatching with other playersor sending invites at once to multiple friends, contacts,nearby players, a phone number or an email address,Game Center groups, or Message groups.

It dramatically reduces your effortsto show different people from different sources.

As you might know, automatching is the mechanismwhich helps your players find each otherfrom Game Center's matchmaking pool.

I will walk through the other new conceptsin the following slides.

To bring better suggestions to the players,we have introduced the Suggestions Shelfcontaining a list of peoplefrom within and without Game Centerthat your players might want to invite.

It contains nearby players, Game Center groups,and Message groups.

A Game Center group,which is a new concept we have introduced this year,is a group of players you recently played within real-time or turn-based matches.

We believe this new feature will make it fairly easyfor players who want to play a game repeatedlywith a certain group of people,because this makes it possible to select all the playersin that group with just a single tap.

And we are leveraging the people you already talk toon a regular basis over iMessage with Message Groups.

A single tap will select an entire Message Group,and the invitation uses your existing group chat.

Now, you can not only send invites faster via Messages,but also chat about a game afterwards.

Once you have selected the people you wish to invite,tap the Send button at the top right,and you will see them in the lobby.

We now have the capability for adding or removing playerseven after the initial invitations have gone out.

For example, you may want to remove some invited playerswho are not able to respond,but you don't want to remove other playerswho have already accepted.

So, we have made it possibleto individually remove invited playersby tapping on the X button in their player slot,as long as they have not accepted yet,or they leave the game after they have accepted.

And players can continue inviting more peopleto your game,which gives them a lot of flexibilityto quickly craft the right group of people to play with.

All of this greatly simplifies and streamlines the experienceby making it much easier for playersto play your multiplayer game faster and easier than ever.

Making it easy for players to invite people they knowin turn helps increase your game's discoverability.

As you can see, if you leverage Game Center multiplayer UI,you get all these awesome features for free.

To make it even quicker to start a multiplayer game,we added a new API this year called "Fast Start."If you adopt Fast Start,the game initiator will have the choiceto either wait for everyone to be connected or begin a gameas soon as the minimum number of invited players have connected.

It gets players much faster from Game Center UIback into your game UI.

Meanwhile in the background, Game Center will continueconnecting the rest of the playersand automatching any unfilled player slots.

All these players will be able to join your gamewhen they connect.

If your game can support players joining a multiplayer sessionat different times,then you can take advantage of Fast Start via Game Center UI.

You can utilize this featureto make some warmup game scenes as well.

The best way to see this in actionis to show you an example.

Here, we are using a game called "The Coast,"which leverages Fast Start.

You will see how powerful it is to utilize Fast Startto build your game.

First, I present GKMatchmakerViewControllerwith a GKMatchRequest,configured with 2 minPlayers and 5 maxPlayers.

In this way, the game can startas long as two players are ready,including the local player.

Then I tap the Invite Friends buttonto launch the player picker.

I pick the players I want to invite,and I wait for them to respond.

As you can see, once an invitee accepts,the Start Game button is highlighted,so I can either start a game or wait for other players to join.

I decide to start, and the gameplay beginsas soon as the matchmaker view controller is dismissed.

Since this game initially started with two players,you can see two boats.

Meanwhile, Game Center is still connecting in the background.

Once the third player joins,the game is notified, and we bring up the third boat.

Because we also had two automatched slots,Game Center is still automatching in the background.

After the matchmaking process is finished,two automatched players join.

Now, we have a full set of five players for this game.

As you can see, by adopting Fast Start,different players will be able to join the same game sessionat different times.

Finally, let's look at the code you need to addto accomplish what we have just walked through together.

To construct a GKMatchmakerViewControllerwith Fast Start mode turned on,simply set its property canStartWithMinimumPlayersto "true".

Please note: the minPlayers of the GKMatchRequestis the minimum number of playersthat the gameplay in your game needs to start.

Set the delegate after you get the GKMatch instance,so that you can know the connection statusof the players in the match.

And didChangeConnectionStateis the delegate method where you can handle playerswho join later.

On the invitee side,just present the GKMatchmakerViewControllerinitialized with the GKInvite instance.

This is probably the same as what you are doing today.

And don't forget to set the matchmakerDelegate.

That's pretty much about it.

We are excited to see how you adopt not only Fast Start,but all the new features and improvements we are providingthis year for multiplayer.

To recap, here is what we covered today.

We introduced how Game Center helpsincrease the discoverability of your game.

After that, we talked about Friends APIalong with some general improvements to Friends.

Then all the multiplayer features and improvementswe just talked through help your players play multiplayer gameswith people they know, as fast as possible.

And also, we have better support for controllers this year.

At the bottom, you will see another two sessionswhich you might be interested in.

They're about recurring leaderboardand game controllers.

Thank you all for watching.

Enjoy your week at WWDC.

♪

8:23 -Friending API

11:47 -loadFriendsAuthorizationStatus

12:53 -loadFriends

20:17 -Enable Fast Start Mode

20:39 -Handle Players Who Join The Game

20:54 -Present GKMatchmakerViewController on The Invitee Side

## Code Samples

```swift
// Call Friend Requests API to present friend request view from a view controller, when player click on Add Friends Button in your game


let
 error 
=
 
GKLocalPlayer
.local
.presentFriendRequestCreatorFromViewController(using: navigationController)


if
 error 
!=
 
nil
 {
    
print
(
"Fail to send friend request with error: 
\(error
!
.localizedDescription)
."
)
}
```

```swift
// Checking authorization


GKLocalPlayer
.local.loadFriendsAuthorizationStatus { (authorizationStatus, error) 
in

    
guard
 error 
==
 
nil
 
else
 {
       
// Error handling

       
print
(“
Fail
 to load friends list with error: \(error
!
.localizedDescription).”)
       
return

    }

    
// Handle GKFriendsAuthorizationStatus

    
switch
 authorizationStatus {
      
case
 .notDetermined:
         
// Player have not made a choice on friends list sharing

      
case
 .denied:
         
// Player have denied your request to access their friends list

      
case
 .restricted:
         
// You should delete collected player data from your end

      
case
 .authorized:
         
// Player have authorized your request to access their friends list

    }
}
```

```swift
func
 
loadFriendsOnProgressionMap
()
 
async
 {
    
do
 {
        
let
 friends 
=
 
try
 
await
 
GKLocalPlayer
.local.loadFriends()
        
if
 friends.count 
>
 
0
 {
            
let
 leaderboards 
=
 
try
 
await
 
GKLeaderboard
.loadLeaderboards(IDs: [“progress
"])
            if let leaderboard = leaderboards.first {
                let entries = try await leaderboard.loadEntries(for: friends, timeScope: .allTime)
               for entry in entries.1 {
                    let avatar = try await entry.player.loadPhoto(for: .normal)
                    let name = entry.player.displayName
                    let friendLevel = entry.score
                    // Display player on progression map
                }
            }
        }
    } catch {
        print("
Error: \(error.localizedDescription).
")
    }
}
```

```swift
// Set canStartWithMinimumPlayers to true to enable Fast Start mode


let
 request 
=
 
GKMatchRequest
()
request.minPlayers 
=
 
2

request.maxPlayers 
=
 
6

request.playerGroup 
=
 
2021



let
 vc 
=
 
GKMatchmakerViewController
(matchRequest: request)
vc.canStartWithMinimumPlayers 
=
 
true

vc.delegate 
=
 
self


self
.present(vc, animated: 
true
, completion: 
nil
)
```

```swift
// Set the GKMatch delegate and present your game scene when didFindMatch is called


func
 
matchmakerViewController
(
_
 
viewController
: 
GKMatchmakerViewController
, 
didFind
 
match
: 
GKMatch
)
 {
    viewController.dismiss(animated: 
true
, completion: 
nil
)
    
let
 gameVC 
=
 
GameSceneViewController
()
    gameVC.match 
=
 match
    match.delegate 
=
 gameVC
    
self
.present(gameVC, animated: 
true
, completion: 
nil
)
}


// Add players who join later by implementing didChangeState delegate


func
 
match
(
_
 
match
: 
GKMatch
, 
player
: 
GKPlayer
, 
didChange
 
state
: 
GKPlayerConnectionState
)
 {
    
if
 state 
==
 .connected {
        
self
.addPlayer(player)
    }
}
```

```swift
// On the invitee side, present GKMatchmakerViewController with the invite


func
 
player
(
_
 
player
: 
GKPlayer
, 
didAccept
 
invite
: 
GKInvite
)
 {
    
if
 
let
 vc 
=
 
GKMatchmakerViewController
(invite: invite) {
        vc.matchmakerDelegate 
=
 
self

        
self
.present(vc, animated: 
true
, completion: 
nil
)
    }
}
```

